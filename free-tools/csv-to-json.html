<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>CSV to JSON Converter — Free Online Tool | NexTool</title>
<meta name="description" content="Convert CSV to JSON and JSON to CSV instantly. Handles quoted fields, custom delimiters, and complex data. Download or copy results. Free, no signup required.">
<meta name="keywords" content="csv to json, json to csv, csv converter, json converter, data conversion, free tool">
<meta name="robots" content="index, follow">
<link rel="canonical" href="https://nextool.app/free-tools/csv-to-json.html">
<meta property="og:type" content="website">
<meta property="og:url" content="https://nextool.app/free-tools/csv-to-json.html">
<meta property="og:title" content="CSV to JSON Converter — Free Online Tool | NexTool">
<meta property="og:description" content="Convert CSV to JSON and JSON to CSV instantly. Handles quoted fields, custom delimiters, and complex data.">
<meta property="og:image" content="https://nextool.app/assets/og/csv-to-json.png">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="CSV to JSON Converter — Free Online Tool | NexTool">
<meta name="twitter:description" content="Convert CSV to JSON and JSON to CSV instantly. Handles quoted fields, custom delimiters, and complex data.">
<meta name="twitter:image" content="https://nextool.app/assets/og/csv-to-json.png">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@type":"BreadcrumbList",
  "itemListElement":[
    {"@type":"ListItem","position":1,"name":"Home","item":"https://nextool.app/"},
    {"@type":"ListItem","position":2,"name":"Free Tools","item":"https://nextool.app/free-tools/"},
    {"@type":"ListItem","position":3,"name":"CSV to JSON Converter","item":"https://nextool.app/free-tools/csv-to-json.html"}
  ]
}
</script>
<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@type":"FAQPage",
  "mainEntity":[
    {
      "@type":"Question",
      "name":"How does the CSV to JSON conversion work?",
      "acceptedAnswer":{"@type":"Answer","text":"The tool parses your CSV data using the first row as headers (keys) by default. Each subsequent row becomes a JSON object with those keys. It handles quoted fields, escaped quotes, commas within values, and multi-line fields according to RFC 4180."}
    },
    {
      "@type":"Question",
      "name":"Can I convert JSON back to CSV?",
      "acceptedAnswer":{"@type":"Answer","text":"Yes! This tool supports bidirectional conversion. Switch to JSON-to-CSV mode, paste your JSON array of objects, and get properly formatted CSV output with headers derived from the object keys."}
    },
    {
      "@type":"Question",
      "name":"What delimiters are supported?",
      "acceptedAnswer":{"@type":"Answer","text":"The tool supports comma (,), semicolon (;), tab, and pipe (|) as delimiters. You can select the appropriate delimiter for your data in the options panel."}
    },
    {
      "@type":"Question",
      "name":"Is my data safe?",
      "acceptedAnswer":{"@type":"Answer","text":"Absolutely. All conversion happens entirely in your browser using JavaScript. No data is uploaded to any server. Your data never leaves your device."}
    }
  ]
}
</script>
<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#050508;--surface:#111118;--surface2:#1a1a24;
  --primary:#6366f1;--accent:#a855f7;
  --text:#e2e8f0;--text2:#94a3b8;--text3:#64748b;
  --border:rgba(255,255,255,0.06);--border2:rgba(255,255,255,0.1);
  --radius:16px;--radius-sm:10px;
  --glow:0 0 20px rgba(99,102,241,0.15);
  --green:#22c55e;--red:#ef4444;--yellow:#eab308;
}
html{scroll-behavior:smooth}
body{font-family:'Inter',system-ui,-apple-system,sans-serif;background:var(--bg);color:var(--text);line-height:1.6;min-height:100vh;-webkit-font-smoothing:antialiased}
a{color:var(--primary);text-decoration:none;transition:color .2s}a:hover{color:var(--accent)}

nav{position:sticky;top:0;z-index:100;background:rgba(5,5,8,0.85);backdrop-filter:blur(20px);border-bottom:1px solid var(--border);padding:0 24px}
.nav-inner{max-width:1100px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;height:60px}
.nav-logo{font-size:20px;font-weight:800;background:linear-gradient(135deg,var(--primary),var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent;letter-spacing:-0.5px}
.nav-links{display:flex;gap:24px;align-items:center}
.nav-links a{color:var(--text2);font-size:14px;font-weight:500;transition:color .2s}
.nav-links a:hover{color:#fff}
.nav-badge{background:linear-gradient(135deg,var(--primary),var(--accent));color:#fff;font-size:11px;font-weight:700;padding:4px 10px;border-radius:20px}

.hero{text-align:center;padding:60px 24px 40px;max-width:750px;margin:0 auto}
.hero-badge{display:inline-block;background:rgba(99,102,241,0.1);border:1px solid rgba(99,102,241,0.2);color:var(--primary);font-size:12px;font-weight:600;padding:6px 16px;border-radius:20px;margin-bottom:16px;text-transform:uppercase;letter-spacing:1px}
.hero h1{font-size:clamp(28px,5vw,44px);font-weight:900;line-height:1.15;margin-bottom:12px;background:linear-gradient(135deg,#fff 40%,var(--text2));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.hero p{color:var(--text2);font-size:17px;max-width:560px;margin:0 auto}

.tool-wrap{max-width:1100px;margin:0 auto;padding:0 24px 40px}
.tool-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:28px;margin-bottom:20px}

.mode-toggle{display:flex;background:var(--bg);border-radius:var(--radius-sm);padding:4px;margin-bottom:20px;border:1px solid var(--border)}
.mode-btn{flex:1;padding:10px;text-align:center;font-size:14px;font-weight:600;color:var(--text2);cursor:pointer;border-radius:8px;transition:all .25s;border:none;background:none;font-family:inherit}
.mode-btn.active{background:var(--primary);color:#fff;box-shadow:var(--glow)}

.options-row{display:flex;gap:16px;flex-wrap:wrap;margin-bottom:16px;align-items:center}
.option-group{display:flex;align-items:center;gap:8px}
.option-group label{font-size:13px;color:var(--text2);font-weight:500;white-space:nowrap}
select,input[type="text"]{background:var(--bg);border:1px solid var(--border2);color:var(--text);padding:8px 12px;border-radius:8px;font-size:13px;font-family:inherit}
select:focus,input[type="text"]:focus{outline:none;border-color:var(--primary)}
input[type="checkbox"]{accent-color:var(--primary)}

.panels{display:grid;grid-template-columns:1fr 1fr;gap:20px}
@media(max-width:768px){.panels{grid-template-columns:1fr}}
.panel{display:flex;flex-direction:column}
.panel-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
.panel-label{font-size:13px;font-weight:600;color:var(--text2);text-transform:uppercase;letter-spacing:0.5px}
.panel-actions{display:flex;gap:6px}

textarea{width:100%;min-height:300px;background:var(--bg);border:1px solid var(--border2);border-radius:var(--radius-sm);padding:16px;color:var(--text);font-family:'Inter',monospace;font-size:13px;line-height:1.6;resize:vertical;transition:border-color .2s;tab-size:2}
textarea:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 3px rgba(99,102,241,0.15)}
textarea::placeholder{color:var(--text3)}

.output-pre{width:100%;min-height:300px;max-height:500px;overflow:auto;background:var(--bg);border:1px solid var(--border2);border-radius:var(--radius-sm);padding:16px;color:var(--text);font-family:'Inter',monospace;font-size:13px;line-height:1.6;white-space:pre;tab-size:2}
.output-pre:empty::before{content:'Output will appear here...';color:var(--text3);white-space:normal}

/* Syntax highlighting */
.json-key{color:#818cf8}.json-string{color:#34d399}.json-number{color:#f59e0b}.json-bool{color:#f472b6}.json-null{color:#94a3b8}

.btn-row{display:flex;gap:10px;flex-wrap:wrap;margin-top:16px}
.btn{display:inline-flex;align-items:center;gap:8px;padding:10px 20px;border-radius:var(--radius-sm);font-size:14px;font-weight:600;cursor:pointer;border:none;transition:all .2s;font-family:inherit}
.btn-primary{background:linear-gradient(135deg,var(--primary),var(--accent));color:#fff}
.btn-primary:hover{transform:translateY(-1px);box-shadow:0 4px 20px rgba(99,102,241,0.3)}
.btn-secondary{background:var(--surface2);color:var(--text);border:1px solid var(--border2)}
.btn-secondary:hover{border-color:var(--primary);color:#fff}
.btn-sm{padding:6px 12px;font-size:12px;border-radius:6px}

.error-msg{background:rgba(239,68,68,0.1);border:1px solid rgba(239,68,68,0.2);border-radius:var(--radius-sm);padding:12px 16px;color:var(--red);font-size:13px;margin-top:12px;display:none}
.error-msg.show{display:block}

.stats-bar{display:flex;gap:20px;padding:12px 0;border-top:1px solid var(--border);margin-top:12px;flex-wrap:wrap}
.stat{font-size:12px;color:var(--text3)}.stat span{color:var(--primary);font-weight:700}

.file-drop{border:2px dashed var(--border2);border-radius:var(--radius-sm);padding:24px;text-align:center;color:var(--text3);font-size:13px;margin-bottom:16px;cursor:pointer;transition:all .2s}
.file-drop:hover,.file-drop.dragover{border-color:var(--primary);color:var(--primary);background:rgba(99,102,241,0.04)}

.toast{position:fixed;bottom:24px;left:50%;transform:translateX(-50%) translateY(100px);background:var(--surface2);color:#fff;padding:12px 24px;border-radius:var(--radius-sm);font-size:14px;font-weight:600;border:1px solid var(--border2);z-index:999;transition:transform .3s cubic-bezier(.4,0,.2,1);pointer-events:none}
.toast.show{transform:translateX(-50%) translateY(0)}

footer{border-top:1px solid var(--border);padding:40px 24px;text-align:center;margin-top:40px}
.footer-links{display:flex;gap:24px;justify-content:center;flex-wrap:wrap;margin-bottom:16px}
.footer-links a{color:var(--text3);font-size:14px;font-weight:500}.footer-links a:hover{color:var(--primary)}
.footer-copy{color:var(--text3);font-size:13px}

@media(max-width:640px){
  .nav-links a:not(.nav-badge){display:none}
  .hero{padding:40px 20px 28px}
  .tool-card{padding:20px}
  .btn-row{flex-direction:column}.btn{justify-content:center}
  .options-row{flex-direction:column;gap:10px}
}
</style>
</head>
<body>

<nav>
  <div class="nav-inner">
    <a href="/" class="nav-logo">NexTool</a>
    <div class="nav-links">
      <a href="/free-tools/">Free Tools</a>
      <a href="/pro.html">Pro</a>
      <a href="/blog/">Blog</a>
      <a href="/pro.html" class="nav-badge">Get Pro</a>
    </div>
  </div>
</nav>

<section class="hero">
  <div class="hero-badge">Free Tool</div>
  <h1>CSV &harr; JSON Converter</h1>
  <p>Convert between CSV and JSON instantly. Handles quoted fields, custom delimiters, and complex nested data with full RFC 4180 compliance.</p>
</section>

<div class="tool-wrap">
  <div class="tool-card">

    <!-- MODE -->
    <div class="mode-toggle">
      <button class="mode-btn active" data-mode="csv2json" onclick="setMode('csv2json')">CSV &rarr; JSON</button>
      <button class="mode-btn" data-mode="json2csv" onclick="setMode('json2csv')">JSON &rarr; CSV</button>
    </div>

    <!-- OPTIONS -->
    <div class="options-row" id="csvOptions">
      <div class="option-group">
        <label for="delimiter">Delimiter:</label>
        <select id="delimiter">
          <option value=",">Comma (,)</option>
          <option value=";">Semicolon (;)</option>
          <option value="&#9;">Tab</option>
          <option value="|">Pipe (|)</option>
        </select>
      </div>
      <div class="option-group">
        <label><input type="checkbox" id="hasHeaders" checked> First row as headers</label>
      </div>
      <div class="option-group">
        <label><input type="checkbox" id="trimValues" checked> Trim whitespace</label>
      </div>
      <div class="option-group">
        <label for="jsonIndent">JSON indent:</label>
        <select id="jsonIndent">
          <option value="2">2 spaces</option>
          <option value="4">4 spaces</option>
          <option value="tab">Tab</option>
          <option value="0">Minified</option>
        </select>
      </div>
    </div>

    <!-- FILE DROP -->
    <div class="file-drop" id="fileDrop" onclick="document.getElementById('fileInput').click()">
      Drop a file here or click to upload (.csv or .json)
      <input type="file" id="fileInput" accept=".csv,.json,.tsv,.txt" style="display:none">
    </div>

    <!-- PANELS -->
    <div class="panels">
      <div class="panel">
        <div class="panel-header">
          <span class="panel-label" id="inputLabel">CSV Input</span>
          <div class="panel-actions">
            <button class="btn btn-sm btn-secondary" onclick="loadSample()">Sample</button>
            <button class="btn btn-sm btn-secondary" onclick="clearInput()">Clear</button>
          </div>
        </div>
        <textarea id="inputArea" placeholder="Paste your CSV data here..."></textarea>
      </div>
      <div class="panel">
        <div class="panel-header">
          <span class="panel-label" id="outputLabel">JSON Output</span>
          <div class="panel-actions">
            <button class="btn btn-sm btn-secondary" onclick="copyOutput()">Copy</button>
            <button class="btn btn-sm btn-secondary" onclick="downloadOutput()">Download</button>
          </div>
        </div>
        <div class="output-pre" id="outputArea"></div>
      </div>
    </div>

    <!-- BUTTONS -->
    <div class="btn-row">
      <button class="btn btn-primary" onclick="convert()">
        <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg>
        Convert
      </button>
      <button class="btn btn-secondary" onclick="swapMode()">
        <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"/></svg>
        Swap Direction
      </button>
    </div>

    <!-- ERROR -->
    <div class="error-msg" id="errorMsg"></div>

    <!-- STATS -->
    <div class="stats-bar">
      <div class="stat">Rows: <span id="statRows">0</span></div>
      <div class="stat">Columns: <span id="statCols">0</span></div>
      <div class="stat">Input size: <span id="statInputSize">0 B</span></div>
      <div class="stat">Output size: <span id="statOutputSize">0 B</span></div>
    </div>
  </div>
</div>

<!-- BUNDLE PROMO -->
<section style="max-width:900px;margin:40px auto;padding:0 24px;">
<div style="background:linear-gradient(135deg,rgba(99,102,241,0.1),rgba(168,85,247,0.08));border:1px solid rgba(99,102,241,0.15);border-radius:20px;padding:32px 28px;text-align:center;">
<div style="font-size:13px;color:#818cf8;font-weight:600;text-transform:uppercase;letter-spacing:1px;margin-bottom:8px;">Founding Member</div>
<h3 style="font-size:22px;font-weight:800;color:#fff;margin:0 0 8px;">Get NexTool Pro</h3>
<p style="color:#94a3b8;font-size:14px;margin:0 auto 20px;max-width:500px;">No banners, clean output, enhanced features on all 220+ tools. One-time payment.</p>
<a href="/pro.html" style="display:inline-block;padding:12px 28px;background:linear-gradient(135deg,#6366f1,#a855f7);color:#fff;text-decoration:none;border-radius:12px;font-weight:700;font-size:15px;">$29 — Get Pro</a>
<a href="/free-tools/" style="display:inline-block;margin-left:12px;color:#818cf8;text-decoration:none;font-size:14px;">Browse 220+ Free Tools &rarr;</a>
</div>
</section>


<!-- AUTO-LINKED by NexTool Engine -->
<div style="margin:2rem 0;padding:1.5rem;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius)">
<p style="font-weight:600;margin-bottom:.5rem">Related Tools</p>
<p><a href="/free-tools/box-shadow-generator.html" style="color:var(--primary);text-decoration:none">CSS Box Shadow Generator</a> · <a href="/free-tools/emoji-picker.html" style="color:var(--primary);text-decoration:none">Emoji Picker & Search</a> · <a href="/free-tools/meta-tag-generator.html" style="color:var(--primary);text-decoration:none">Meta Tag Generator</a> · <a href="/free-tools/favicon-generator.html" style="color:var(--primary);text-decoration:none">Favicon Generator</a> · <a href="/free-tools/base64.html" style="color:var(--primary);text-decoration:none">Free Base64 Encoder/Decoder</a></p>
</div>

<!-- AUTO-LINKED by NexTool Engine -->
<div style="margin:2rem 0;padding:1.5rem;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius)">
<p style="font-weight:600;margin-bottom:.5rem">Related Tools</p>
<p><a href="/free-tools/icon-generator.html" style="color:var(--primary);text-decoration:none">Free Icon Generator</a> · <a href="/free-tools/git-diff-viewer.html" style="color:var(--primary);text-decoration:none">Free Git Diff Viewer</a> · <a href="/free-tools/accessibility-checker.html" style="color:var(--primary);text-decoration:none">Free Accessibility Checker</a></p>
</div>
<footer>
  <div class="footer-links">
    <a href="/">Home</a>
    <a href="/free-tools/">Free Tools</a>
    <a href="/pro.html">Pro</a>
    <a href="/blog/">Blog</a>
  </div>
  <p class="footer-copy">&copy; 2026 NexTool. All rights reserved.</p>
</footer>

<div class="toast" id="toast"></div>

<script>
let currentMode = 'csv2json';

function setMode(mode) {
  currentMode = mode;
  document.querySelectorAll('.mode-btn').forEach(b => b.classList.toggle('active', b.dataset.mode === mode));
  const isC2J = mode === 'csv2json';
  document.getElementById('inputLabel').textContent = isC2J ? 'CSV Input' : 'JSON Input';
  document.getElementById('outputLabel').textContent = isC2J ? 'JSON Output' : 'CSV Output';
  document.getElementById('csvOptions').style.display = isC2J ? 'flex' : 'none';
  document.getElementById('inputArea').placeholder = isC2J ? 'Paste your CSV data here...' : 'Paste your JSON array here...';
  hideError();
}

function swapMode() {
  const outputText = document.getElementById('outputArea').textContent;
  if (outputText) document.getElementById('inputArea').value = outputText;
  setMode(currentMode === 'csv2json' ? 'json2csv' : 'csv2json');
}

// ── CSV Parser (RFC 4180 compliant) ──
function parseCSV(text, delimiter, trim) {
  const rows = [];
  let row = [];
  let field = '';
  let inQuotes = false;
  let i = 0;
  while (i < text.length) {
    const ch = text[i];
    if (inQuotes) {
      if (ch === '"') {
        if (i + 1 < text.length && text[i + 1] === '"') {
          field += '"';
          i += 2;
        } else {
          inQuotes = false;
          i++;
        }
      } else {
        field += ch;
        i++;
      }
    } else {
      if (ch === '"') {
        inQuotes = true;
        i++;
      } else if (ch === delimiter) {
        row.push(trim ? field.trim() : field);
        field = '';
        i++;
      } else if (ch === '\r') {
        if (i + 1 < text.length && text[i + 1] === '\n') i++;
        row.push(trim ? field.trim() : field);
        field = '';
        rows.push(row);
        row = [];
        i++;
      } else if (ch === '\n') {
        row.push(trim ? field.trim() : field);
        field = '';
        rows.push(row);
        row = [];
        i++;
      } else {
        field += ch;
        i++;
      }
    }
  }
  // Last field
  if (field || row.length > 0) {
    row.push(trim ? field.trim() : field);
    rows.push(row);
  }
  // Remove trailing empty row
  if (rows.length > 0 && rows[rows.length - 1].length === 1 && rows[rows.length - 1][0] === '') {
    rows.pop();
  }
  return rows;
}

function csvToJSON(text) {
  const delimiter = document.getElementById('delimiter').value;
  const hasHeaders = document.getElementById('hasHeaders').checked;
  const trim = document.getElementById('trimValues').checked;
  const rows = parseCSV(text, delimiter, trim);
  if (rows.length === 0) throw new Error('No data found in CSV input.');
  let headers, dataRows;
  if (hasHeaders) {
    headers = rows[0];
    dataRows = rows.slice(1);
  } else {
    headers = rows[0].map((_, i) => 'column' + (i + 1));
    dataRows = rows;
  }
  const result = dataRows.map(row => {
    const obj = {};
    headers.forEach((h, i) => {
      let val = row[i] !== undefined ? row[i] : '';
      // Auto-detect numbers and booleans
      if (val === '') { obj[h] = val; }
      else if (val === 'true') { obj[h] = true; }
      else if (val === 'false') { obj[h] = false; }
      else if (val === 'null') { obj[h] = null; }
      else if (!isNaN(val) && val.trim() !== '') { obj[h] = Number(val); }
      else { obj[h] = val; }
    });
    return obj;
  });
  updateStats(dataRows.length, headers.length);
  return result;
}

function jsonToCSV(text) {
  const data = JSON.parse(text);
  if (!Array.isArray(data)) throw new Error('JSON input must be an array of objects.');
  if (data.length === 0) throw new Error('JSON array is empty.');
  // Collect all keys
  const keysSet = new Set();
  data.forEach(obj => { if (typeof obj === 'object' && obj !== null) Object.keys(obj).forEach(k => keysSet.add(k)); });
  const headers = [...keysSet];
  const escapeField = (val) => {
    const s = val === null || val === undefined ? '' : String(val);
    if (s.includes(',') || s.includes('"') || s.includes('\n') || s.includes('\r')) {
      return '"' + s.replace(/"/g, '""') + '"';
    }
    return s;
  };
  const lines = [headers.map(escapeField).join(',')];
  data.forEach(obj => {
    const row = headers.map(h => escapeField(obj[h]));
    lines.push(row.join(','));
  });
  updateStats(data.length, headers.length);
  return lines.join('\n');
}

function convert() {
  const input = document.getElementById('inputArea').value;
  if (!input.trim()) { showError('Please enter some data to convert.'); return; }
  hideError();
  try {
    let output;
    if (currentMode === 'csv2json') {
      const json = csvToJSON(input);
      const indentVal = document.getElementById('jsonIndent').value;
      const indent = indentVal === 'tab' ? '\t' : indentVal === '0' ? undefined : Number(indentVal);
      output = JSON.stringify(json, null, indent);
      document.getElementById('outputArea').innerHTML = syntaxHighlight(output);
    } else {
      output = jsonToCSV(input);
      document.getElementById('outputArea').textContent = output;
    }
    document.getElementById('statInputSize').textContent = formatSize(new Blob([input]).size);
    document.getElementById('statOutputSize').textContent = formatSize(new Blob([output]).size);
  } catch (e) {
    showError(e.message);
  }
}

function syntaxHighlight(json) {
  return json.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')
    .replace(/"([^"\\]*(\\.[^"\\]*)*)"\s*:/g, '<span class="json-key">"$1"</span>:')
    .replace(/"([^"\\]*(\\.[^"\\]*)*)"/g, '<span class="json-string">"$1"</span>')
    .replace(/\b(-?\d+\.?\d*([eE][+-]?\d+)?)\b/g, '<span class="json-number">$1</span>')
    .replace(/\b(true|false)\b/g, '<span class="json-bool">$1</span>')
    .replace(/\bnull\b/g, '<span class="json-null">null</span>');
}

function updateStats(rows, cols) {
  document.getElementById('statRows').textContent = rows;
  document.getElementById('statCols').textContent = cols;
}

function formatSize(bytes) {
  if (bytes < 1024) return bytes + ' B';
  if (bytes < 1048576) return (bytes / 1024).toFixed(1) + ' KB';
  return (bytes / 1048576).toFixed(1) + ' MB';
}

function showError(msg) {
  const el = document.getElementById('errorMsg');
  el.textContent = msg;
  el.classList.add('show');
}
function hideError() { document.getElementById('errorMsg').classList.remove('show'); }

function copyOutput() {
  const text = document.getElementById('outputArea').textContent;
  if (!text) return showToast('Nothing to copy');
  navigator.clipboard.writeText(text).then(() => showToast('Copied to clipboard!'));
}

function downloadOutput() {
  const text = document.getElementById('outputArea').textContent;
  if (!text) return showToast('Nothing to download');
  const ext = currentMode === 'csv2json' ? 'json' : 'csv';
  const mime = currentMode === 'csv2json' ? 'application/json' : 'text/csv';
  const blob = new Blob([text], { type: mime });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'converted.' + ext;
  a.click();
  URL.revokeObjectURL(url);
  showToast('Download started!');
}

function clearInput() {
  document.getElementById('inputArea').value = '';
  document.getElementById('outputArea').innerHTML = '';
  hideError();
  ['statRows','statCols'].forEach(id => document.getElementById(id).textContent = '0');
  ['statInputSize','statOutputSize'].forEach(id => document.getElementById(id).textContent = '0 B');
}

function loadSample() {
  if (currentMode === 'csv2json') {
    document.getElementById('inputArea').value =
`name,email,age,city,active
Alice Johnson,alice@example.com,28,New York,true
Bob Smith,bob@example.com,34,San Francisco,true
"Carol White, Jr.",carol@example.com,22,Chicago,false
"Dave ""The Dev"" Brown",dave@example.com,41,Austin,true
Eve Williams,eve@example.com,30,"Portland, OR",true`;
  } else {
    document.getElementById('inputArea').value = JSON.stringify([
      { name: "Alice Johnson", email: "alice@example.com", age: 28, city: "New York", active: true },
      { name: "Bob Smith", email: "bob@example.com", age: 34, city: "San Francisco", active: true },
      { name: "Carol White, Jr.", email: "carol@example.com", age: 22, city: "Chicago", active: false }
    ], null, 2);
  }
  convert();
}

// File drop/upload
const fileDrop = document.getElementById('fileDrop');
const fileInput = document.getElementById('fileInput');
fileDrop.addEventListener('dragover', e => { e.preventDefault(); fileDrop.classList.add('dragover'); });
fileDrop.addEventListener('dragleave', () => fileDrop.classList.remove('dragover'));
fileDrop.addEventListener('drop', e => {
  e.preventDefault(); fileDrop.classList.remove('dragover');
  handleFile(e.dataTransfer.files[0]);
});
fileInput.addEventListener('change', e => { if (e.target.files[0]) handleFile(e.target.files[0]); });

function handleFile(file) {
  const reader = new FileReader();
  reader.onload = (e) => {
    document.getElementById('inputArea').value = e.target.result;
    if (file.name.endsWith('.json')) setMode('json2csv');
    else setMode('csv2json');
    convert();
  };
  reader.readAsText(file);
}

function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg; t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2000);
}
</script>

<script defer src="/js/revenue.js"></script>
<script defer src="/js/lead-capture.js"></script>
<script defer src="/js/analytics-lite.js"></script>
</body>
</html>
