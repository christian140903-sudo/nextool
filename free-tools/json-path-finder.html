<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
    <link rel="icon" type="image/svg+xml" href="/img/favicon.svg">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Free JSON Path Finder — Test JSONPath Queries | ANIMA</title>
<meta name="description" content="Free JSONPath expression tester. Paste JSON, write queries with dot or bracket notation, see results highlighted instantly. No signup required.">
<meta name="keywords" content="JSONPath tester, JSON path finder, JSONPath query, JSON navigator, JSON path extractor, free online tool, ANIMA">
<meta name="robots" content="index, follow">
<meta property="og:title" content="Free JSON Path Finder & Query Tool | ANIMA">
<meta property="og:description" content="Test JSONPath expressions. Paste JSON, write queries, see results highlighted. 100% free.">
<meta property="og:type" content="website">
<meta property="og:url" content="https://nextool.app/free-tools/json-path-finder.html">
<meta property="og:image" content="https://nextool.app/img/og-image.png">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<link rel="canonical" href="https://nextool.app/free-tools/json-path-finder.html">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Free JSON Path Finder & Query Tool | ANIMA">
<meta name="twitter:description" content="Test JSONPath expressions instantly. Free online tool by ANIMA.">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"SoftwareApplication","name":"JSON Path Finder","applicationCategory":"DeveloperApplication","operatingSystem":"Web","offers":{"@type":"Offer","price":"0","priceCurrency":"USD"},"description":"Free JSONPath expression tester with dot and bracket notation, tree view, and result highlighting."}
</script>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{--bg:#050508;--surface:#111118;--surface2:#1a1a24;--border:#2a2a3a;--text:#e4e4eb;--text2:#9494a8;--primary:#00d4ff;--accent:#a855f7;--pink:#ec4899;--green:#22c55e;--red:#ef4444;--cyan:#22d3ee;--yellow:#eab308;--radius:12px;--glass:rgba(17,17,24,0.7)}
html{scroll-behavior:smooth}
body{font-family:'Inter',system-ui,sans-serif;background:var(--bg);color:var(--text);line-height:1.6;min-height:100vh;overflow-x:hidden}
.nav{position:sticky;top:0;z-index:100;background:rgba(5,5,8,0.85);backdrop-filter:blur(20px);border-bottom:1px solid var(--border);padding:0 2rem;height:64px;display:flex;align-items:center;justify-content:space-between}
.nav-logo{font-size:1.4rem;font-weight:800;background:linear-gradient(135deg,var(--primary),var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent;text-decoration:none}
.nav-links{display:flex;align-items:center;gap:1.5rem}
.nav-links a{color:var(--text2);text-decoration:none;font-size:.875rem;font-weight:500;transition:color .2s}
.nav-links a:hover{color:var(--text)}
.nav-cta{background:linear-gradient(135deg,var(--primary),var(--accent));color:#fff!important;padding:.5rem 1.2rem;border-radius:8px;font-weight:600;-webkit-text-fill-color:#fff!important}
.nav-cta:hover{opacity:.9}
.nav-toggle{display:none;background:none;border:none;color:var(--text);font-size:1.5rem;cursor:pointer}
.hero{text-align:center;padding:3rem 1.5rem 2rem;max-width:700px;margin:0 auto}
.hero h1{font-size:2.2rem;font-weight:800;line-height:1.2;margin-bottom:.75rem}
.hero h1 span{background:linear-gradient(135deg,var(--primary),var(--accent),var(--pink));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.hero p{color:var(--text2);font-size:1rem}
.tool-container{max-width:1200px;margin:0 auto;padding:0 1.5rem 3rem}
.toolbar{display:flex;flex-wrap:wrap;gap:.5rem;margin-bottom:1rem;align-items:center}
.toolbar button{background:var(--surface2);border:1px solid var(--border);color:var(--text);padding:.45rem .9rem;border-radius:8px;font-size:.8rem;font-weight:500;cursor:pointer;transition:all .2s;font-family:inherit}
.toolbar button:hover{border-color:var(--primary);background:rgba(0,212,255,.12)}
.toolbar button.active{background:linear-gradient(135deg,var(--primary),var(--accent));border-color:transparent;color:#fff}
.query-bar{display:flex;gap:.5rem;margin-bottom:1rem;align-items:stretch}
.query-bar input{flex:1;background:var(--surface);border:1px solid var(--border);color:var(--text);padding:.6rem 1rem;border-radius:var(--radius);font-family:'JetBrains Mono',monospace;font-size:.85rem;outline:none;transition:border-color .2s}
.query-bar input:focus{border-color:var(--primary)}
.query-bar input::placeholder{color:var(--text2);opacity:.5}
.query-bar button{background:linear-gradient(135deg,var(--primary),var(--accent));border:none;color:#fff;padding:.6rem 1.2rem;border-radius:var(--radius);font-size:.8rem;font-weight:600;cursor:pointer;transition:opacity .2s;font-family:inherit;white-space:nowrap}
.query-bar button:hover{opacity:.9}
.status-bar{display:flex;align-items:center;gap:1rem;margin-bottom:1rem;font-size:.8rem;color:var(--text2)}
.status-dot{width:8px;height:8px;border-radius:50%;display:inline-block}
.status-dot.valid{background:var(--green)}.status-dot.invalid{background:var(--red)}.status-dot.empty{background:var(--border)}
.panels{display:grid;grid-template-columns:1fr 1fr;gap:1rem;min-height:500px}
.panel{background:var(--glass);backdrop-filter:blur(16px);border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;display:flex;flex-direction:column}
.panel-header{padding:.6rem 1rem;border-bottom:1px solid var(--border);font-size:.8rem;font-weight:600;color:var(--text2);display:flex;justify-content:space-between;align-items:center;background:rgba(26,26,36,0.5)}
.panel-body{flex:1;position:relative;overflow:auto}
textarea.code-input{width:100%;height:100%;min-height:400px;background:transparent;border:none;color:var(--text);font-family:'JetBrains Mono',monospace;font-size:.85rem;padding:1rem;resize:none;outline:none;line-height:1.7;tab-size:2}
textarea.code-input::placeholder{color:var(--text2);opacity:.5}
/* Tree view */
.tree-wrap{padding:1rem;font-family:'JetBrains Mono',monospace;font-size:.82rem;line-height:1.8}
.tree-node{margin-left:1.2rem;border-left:1px solid var(--border);padding-left:.6rem}
.tree-node.root{margin-left:0;border-left:none;padding-left:0}
.tree-key{color:#c084fc;font-weight:600}
.tree-toggle{cursor:pointer;user-select:none;display:inline-flex;align-items:center;gap:.3rem;padding:1px 0}
.tree-toggle::before{content:'';display:inline-block;width:0;height:0;border-left:5px solid var(--text2);border-top:4px solid transparent;border-bottom:4px solid transparent;transition:transform .15s}
.tree-toggle.open::before{transform:rotate(90deg)}
.tree-children.collapsed{display:none}
.tree-bracket{color:var(--text2);font-size:.75rem;margin-left:.3rem}
.val-str{color:var(--green)}.val-num{color:var(--cyan)}.val-bool{color:var(--yellow)}.val-null{color:#6b7280}
.tree-line{padding:1px 4px;border-radius:3px;cursor:pointer;transition:background .15s}
.tree-line:hover{background:rgba(0,212,255,.08)}
.tree-line.highlighted{background:rgba(0,212,255,.18);outline:1px solid rgba(0,212,255,.3);border-radius:4px}
.tree-line.match{background:rgba(34,197,94,.12);outline:1px solid rgba(34,197,94,.3)}
/* Results panel */
.results-panel{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);margin-top:1rem;overflow:hidden;display:none}
.results-panel.visible{display:block}
.results-header{padding:.6rem 1rem;border-bottom:1px solid var(--border);font-size:.8rem;font-weight:600;color:var(--text2);display:flex;justify-content:space-between;align-items:center;background:rgba(26,26,36,0.5)}
.results-body{padding:1rem;font-family:'JetBrains Mono',monospace;font-size:.82rem;white-space:pre-wrap;line-height:1.7;max-height:300px;overflow:auto;color:var(--text)}
.path-display{margin-top:1rem;display:none}
.path-display.visible{display:block}
.path-row{display:flex;align-items:center;gap:.5rem;margin-bottom:.5rem;padding:.5rem .75rem;background:var(--surface);border:1px solid var(--border);border-radius:8px;font-family:'JetBrains Mono',monospace;font-size:.8rem;cursor:pointer;transition:border-color .2s}
.path-row:hover{border-color:var(--primary)}
.path-row .label{color:var(--text2);font-size:.7rem;font-weight:600;text-transform:uppercase;min-width:55px}
.path-row .value{color:var(--text);flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.cta-section{text-align:center;padding:4rem 1.5rem;max-width:700px;margin:0 auto}
.cta-section h2{font-size:1.8rem;font-weight:800;margin-bottom:.75rem}
.cta-section h2 span{background:linear-gradient(135deg,var(--primary),var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.cta-section p{color:var(--text2);margin-bottom:1.5rem}
.cta-btn{display:inline-block;background:linear-gradient(135deg,var(--primary),var(--accent));color:#fff;padding:.75rem 2rem;border-radius:10px;font-weight:700;text-decoration:none;font-size:1rem;transition:transform .2s,box-shadow .2s}
.cta-btn:hover{transform:translateY(-2px);box-shadow:0 8px 30px rgba(0,212,255,.3)}
.footer{border-top:1px solid var(--border);padding:3rem 2rem 2rem;max-width:1200px;margin:0 auto}
.footer-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:2rem;margin-bottom:2rem}
.footer-col h4{font-size:.85rem;font-weight:700;margin-bottom:.75rem;color:var(--text)}
.footer-col a{display:block;color:var(--text2);text-decoration:none;font-size:.8rem;margin-bottom:.4rem;transition:color .2s}
.footer-col a:hover{color:var(--primary)}
.footer-bottom{text-align:center;color:var(--text2);font-size:.75rem;padding-top:1.5rem;border-top:1px solid var(--border)}
.fade-in{opacity:0;transform:translateY(20px);transition:opacity .6s,transform .6s}
.fade-in.visible{opacity:1;transform:translateY(0)}
.toast{position:fixed;bottom:2rem;left:50%;transform:translateX(-50%) translateY(80px);background:var(--surface2);border:1px solid var(--border);color:var(--text);padding:.6rem 1.2rem;border-radius:10px;font-size:.85rem;font-weight:500;z-index:200;transition:transform .3s;pointer-events:none}
.toast.show{transform:translateX(-50%) translateY(0)}
@media(max-width:768px){
  .panels{grid-template-columns:1fr}
  .nav-links{display:none;position:absolute;top:64px;left:0;right:0;background:var(--bg);border-bottom:1px solid var(--border);flex-direction:column;padding:1rem 2rem;gap:1rem}
  .nav-links.open{display:flex}
  .nav-toggle{display:block}
  .hero h1{font-size:1.6rem}
  .footer-grid{grid-template-columns:1fr}
  .toolbar{gap:.35rem}
  .query-bar{flex-direction:column}
}
</style>
</head>
<body>

<nav class="nav">
  <a href="/" class="nav-logo">ANIMA</a>
  <button class="nav-toggle" onclick="document.querySelector('.nav-links').classList.toggle('open')" aria-label="Menu">&#9776;</button>
  <div class="nav-links">
    <a href="/">Home</a>
    <a href="/free-tools/">Tools</a>
    <a href="/free-tools/">Free Tools</a>
    <a href="/blog/">Blog</a>
    <a href="https://github.com/christian140903-sudo/nextool" class="nav-cta" target="_blank" rel="noopener">GitHub</a>
  </div>
</nav>

<section class="hero fade-in">
  <h1>Free <span>JSON Path Finder</span></h1>
  <p>Paste JSON, write JSONPath queries, see results highlighted instantly. Supports dot notation, bracket notation, wildcards, and filters. Click any value to get its path.</p>
</section>

<div class="tool-container fade-in">
  <div class="toolbar">
    <button onclick="formatInput()">Format</button>
    <button onclick="copyResults()">Copy Results</button>
    <button onclick="loadSample()">Sample</button>
    <button onclick="clearAll()">Clear</button>
  </div>

  <div class="query-bar">
    <input type="text" id="queryInput" placeholder="$.store.book[0].title  or  $..author  or  $.store.book[?(@.price<10)]" spellcheck="false">
    <button onclick="runQuery()">Query</button>
  </div>

  <div class="status-bar">
    <span><span class="status-dot empty" id="statusDot"></span></span>
    <span id="statusText">Paste JSON to begin</span>
    <span id="sizeInfo" style="margin-left:auto"></span>
  </div>

  <div class="panels">
    <div class="panel">
      <div class="panel-header"><span>JSON Input</span><span id="lineCount"></span></div>
      <div class="panel-body">
        <textarea class="code-input" id="jsonInput" placeholder='Paste your JSON here...' spellcheck="false"></textarea>
      </div>
    </div>
    <div class="panel">
      <div class="panel-header"><span>Tree View</span><span id="nodeCount"></span></div>
      <div class="panel-body" id="treePanel">
        <div class="tree-wrap" id="treeOutput"></div>
      </div>
    </div>
  </div>

  <div class="path-display" id="pathDisplay">
    <div class="path-row" onclick="copyPath('dot')" title="Click to copy">
      <span class="label">Dot</span>
      <span class="value" id="pathDot">-</span>
    </div>
    <div class="path-row" onclick="copyPath('bracket')" title="Click to copy">
      <span class="label">Bracket</span>
      <span class="value" id="pathBracket">-</span>
    </div>
    <div class="path-row" onclick="copyPath('value')" title="Click to copy">
      <span class="label">Value</span>
      <span class="value" id="pathValue">-</span>
    </div>
  </div>

  <div class="results-panel" id="resultsPanel">
    <div class="results-header">
      <span>Query Results</span>
      <span id="matchCount">0 matches</span>
    </div>
    <div class="results-body" id="resultsBody"></div>
  </div>
</div>

<section class="cta-section fade-in">
  <h2>Need something <span>more powerful</span>?</h2>
  <p>Let us build it for you. Custom APIs, dashboards, automations &mdash; whatever you need.</p>
  <a href="/#contact" class="cta-btn">Start a Project &rarr;</a>
</section>

<section style="max-width:900px;margin:40px auto;padding:0 24px;">
<div style="background:linear-gradient(135deg,rgba(0,212,255,0.1),rgba(168,85,247,0.08));border:1px solid rgba(0,212,255,0.15);border-radius:20px;padding:32px 28px;text-align:center;">
<div style="font-size:13px;color:#818cf8;font-weight:600;text-transform:uppercase;letter-spacing:1px;margin-bottom:8px;">Founding Member</div>
<h3 style="font-size:22px;font-weight:800;color:#fff;margin:0 0 8px;">ANIMA on GitHub</h3>
<p style="color:#94a3b8;font-size:14px;margin:0 auto 20px;max-width:500px;">253+ free tools. No signup. Open source. Built by Christian Bucher.</p>
<div style="display:flex;align-items:center;justify-content:center;gap:12px;flex-wrap:wrap;">
<a href="/about/" style="display:inline-block;padding:12px 28px;background:linear-gradient(135deg,#00d4ff,#a855f7,#ec4899);color:#fff;border-radius:10px;font-weight:700;font-size:15px;text-decoration:none;">GitHub</a>
<a href="/free-tools/" style="color:#94a3b8;font-size:14px;text-decoration:none;">Browse 250+ Free Tools &rarr;</a>
</div>
</div>
</section>


<!-- AUTO-LINKED by ANIMA Engine -->
<div style="margin:2rem 0;padding:1.5rem;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius)">
<p style="font-weight:600;margin-bottom:.5rem">Related Tools</p>
<p><a href="/free-tools/box-shadow-generator.html" style="color:var(--primary);text-decoration:none">CSS Box Shadow Generator</a> · <a href="/free-tools/emoji-picker.html" style="color:var(--primary);text-decoration:none">Emoji Picker & Search</a> · <a href="/free-tools/json-to-form.html" style="color:var(--primary);text-decoration:none">Free JSON to Form Generator</a></p>
</div>

<!-- AUTO-LINKED by ANIMA Engine -->
<div style="margin:2rem 0;padding:1.5rem;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius)">
<p style="font-weight:600;margin-bottom:.5rem">Related Tools</p>
<p><a href="/free-tools/json-to-yaml-converter.html" style="color:var(--primary);text-decoration:none">Free JSON to YAML Converter</a> · <a href="/free-tools/json-tree-visualizer.html" style="color:var(--primary);text-decoration:none">Free JSON Tree Visualizer</a> · <a href="/free-tools/accessibility-checker.html" style="color:var(--primary);text-decoration:none">Free Accessibility Checker</a></p>
</div>
<footer class="footer fade-in">
  <div class="footer-grid">
    <div class="footer-col">
      <h4>Products</h4>
      <a href="/free-tools/">250+ Free Tools</a>
      <a href="/about/">About</a>
      <a href="/docs/">Documentation</a>
    </div>
    <div class="footer-col">
      <h4>Explore</h4>
      <a href="/free-tools/">Free Tools</a><a href="/blog/">Blog</a><a href="/about/">FAQ</a><a href="/about/">About</a>
    </div>
    <div class="footer-col">
      <h4>Ecosystem</h4>
      <a href="/">ANIMA Home</a><a href="/#contact">Contact</a><a href="https://github.com/christian140903-sudo/nextool" target="_blank">GitHub</a>
    </div>
  </div>
  <div class="footer-bottom">&copy; 2026 ANIMA. AI-powered tools for everyone.</div>
</footer>

<div class="toast" id="toast"></div>

<script>
const jsonInput = document.getElementById('jsonInput');
const queryInput = document.getElementById('queryInput');
const treeOutput = document.getElementById('treeOutput');
const statusDot = document.getElementById('statusDot');
const statusText = document.getElementById('statusText');
const sizeInfo = document.getElementById('sizeInfo');
const lineCountEl = document.getElementById('lineCount');
const nodeCountEl = document.getElementById('nodeCount');
const pathDisplay = document.getElementById('pathDisplay');
const resultsPanel = document.getElementById('resultsPanel');
const resultsBody = document.getElementById('resultsBody');
const matchCount = document.getElementById('matchCount');
let parsed = null;
let nodeMap = new Map(); // maps DOM elements to {path, value}
let selectedEl = null;

jsonInput.addEventListener('input', debounce(parseAndRender, 300));
jsonInput.addEventListener('input', updateLineCount);
queryInput.addEventListener('keydown', e => { if (e.key === 'Enter') runQuery(); });
queryInput.addEventListener('input', debounce(runQuery, 400));

function debounce(fn, ms) { let t; return (...a) => { clearTimeout(t); t = setTimeout(() => fn(...a), ms); }; }

function updateLineCount() {
  const n = jsonInput.value.split('\n').length;
  lineCountEl.textContent = n + ' line' + (n !== 1 ? 's' : '');
}

function parseAndRender() {
  const raw = jsonInput.value.trim();
  if (!raw) {
    treeOutput.innerHTML = '';
    parsed = null;
    statusDot.className = 'status-dot empty';
    statusText.textContent = 'Paste JSON to begin';
    sizeInfo.textContent = '';
    nodeCountEl.textContent = '';
    pathDisplay.classList.remove('visible');
    resultsPanel.classList.remove('visible');
    return;
  }
  sizeInfo.textContent = formatBytes(new Blob([raw]).size);
  try {
    parsed = JSON.parse(raw);
    statusDot.className = 'status-dot valid';
    statusText.textContent = 'Valid JSON';
    renderTree(parsed);
    if (queryInput.value.trim()) runQuery();
  } catch (e) {
    parsed = null;
    statusDot.className = 'status-dot invalid';
    statusText.textContent = 'Invalid JSON: ' + e.message.split(' at ')[0];
    treeOutput.innerHTML = '<div style="color:var(--red);padding:1rem">' + escHtml(e.message) + '</div>';
    nodeCountEl.textContent = '';
  }
}

function renderTree(data) {
  treeOutput.innerHTML = '';
  nodeMap = new Map();
  let count = 0;
  const root = buildNode('$', data, ['$'], true);
  root.classList.add('root');
  treeOutput.appendChild(root);
  nodeCountEl.textContent = nodeMap.size + ' nodes';
}

function buildNode(key, value, pathParts, isRoot) {
  const wrap = document.createElement('div');
  wrap.className = 'tree-node' + (isRoot ? ' root' : '');

  if (value !== null && typeof value === 'object') {
    const isArr = Array.isArray(value);
    const entries = isArr ? value.map((v, i) => [i, v]) : Object.entries(value);
    const count = entries.length;
    const line = document.createElement('span');
    line.className = 'tree-line';
    const toggle = document.createElement('span');
    toggle.className = 'tree-toggle open';
    let label = '';
    if (!isRoot) label = '<span class="tree-key">"' + escHtml(String(key)) + '"</span>: ';
    label += '<span class="tree-bracket">' + (isArr ? '[' : '{') + ' ' + count + (count === 1 ? ' item' : ' items') + ' ' + (isArr ? ']' : '}') + '</span>';
    toggle.innerHTML = label;
    line.appendChild(toggle);
    wrap.appendChild(line);

    const dotPath = pathParts.join('');
    const bracketPath = pathParts.map((p, i) => i === 0 ? p : typeof p === 'number' ? '[' + p + ']' : "['" + p + "']").join('');
    nodeMap.set(line, { dotPath, bracketPath, value: JSON.stringify(value, null, 2).substring(0, 200) });
    line.addEventListener('click', e => { e.stopPropagation(); selectNode(line); });

    const children = document.createElement('div');
    children.className = 'tree-children';
    entries.forEach(([k, v]) => {
      const childPath = isArr ? [...pathParts, '[' + k + ']'] : [...pathParts, needsBracket(k) ? "['" + k + "']" : '.' + k];
      const childPathParts = isArr ? [...pathParts, k] : [...pathParts, k];
      children.appendChild(buildNode(k, v, childPath, false));
    });
    wrap.appendChild(children);

    toggle.addEventListener('click', e => {
      e.stopPropagation();
      toggle.classList.toggle('open');
      children.classList.toggle('collapsed');
    });
  } else {
    const line = document.createElement('span');
    line.className = 'tree-line';
    let valHtml;
    if (typeof value === 'string') valHtml = '<span class="val-str">"' + escHtml(value) + '"</span>';
    else if (typeof value === 'number') valHtml = '<span class="val-num">' + value + '</span>';
    else if (typeof value === 'boolean') valHtml = '<span class="val-bool">' + value + '</span>';
    else valHtml = '<span class="val-null">null</span>';
    line.innerHTML = '<span class="tree-key">"' + escHtml(String(key)) + '"</span>: ' + valHtml;
    wrap.appendChild(line);

    const dotPath = pathParts.join('');
    const bracketPath = buildBracketPath(pathParts);
    nodeMap.set(line, { dotPath, bracketPath, value: JSON.stringify(value) });
    line.addEventListener('click', e => { e.stopPropagation(); selectNode(line); });
  }
  return wrap;
}

function needsBracket(key) {
  return !/^[a-zA-Z_$][a-zA-Z0-9_$]*$/.test(key);
}

function buildBracketPath(parts) {
  return parts.map((p, i) => {
    if (i === 0) return p;
    if (typeof p === 'number') return '[' + p + ']';
    if (typeof p === 'string' && p.startsWith('[')) return p;
    if (typeof p === 'string' && p.startsWith('.')) return "['" + p.substring(1) + "']";
    return "['" + p + "']";
  }).join('');
}

function selectNode(el) {
  if (selectedEl) selectedEl.classList.remove('highlighted');
  selectedEl = el;
  el.classList.add('highlighted');
  const info = nodeMap.get(el);
  if (!info) return;
  document.getElementById('pathDot').textContent = info.dotPath;
  document.getElementById('pathBracket').textContent = info.bracketPath;
  document.getElementById('pathValue').textContent = info.value;
  pathDisplay.classList.add('visible');
}

function copyPath(type) {
  let text = '';
  if (type === 'dot') text = document.getElementById('pathDot').textContent;
  else if (type === 'bracket') text = document.getElementById('pathBracket').textContent;
  else text = document.getElementById('pathValue').textContent;
  navigator.clipboard.writeText(text).then(() => showToast('Copied: ' + text.substring(0, 60) + (text.length > 60 ? '...' : '')));
}

/* ========== JSONPath Query Engine ========== */
function runQuery() {
  const expr = queryInput.value.trim();
  if (!expr || !parsed) {
    resultsPanel.classList.remove('visible');
    clearHighlights('match');
    return;
  }
  try {
    const results = queryJsonPath(parsed, expr);
    matchCount.textContent = results.length + ' match' + (results.length !== 1 ? 'es' : '');
    resultsBody.textContent = JSON.stringify(results.length === 1 ? results[0] : results, null, 2);
    resultsPanel.classList.add('visible');
    highlightMatches(parsed, expr);
  } catch (e) {
    matchCount.textContent = 'Error';
    resultsBody.textContent = e.message;
    resultsPanel.classList.add('visible');
    clearHighlights('match');
  }
}

function queryJsonPath(data, path) {
  path = path.trim();
  if (!path.startsWith('$')) path = '$' + (path.startsWith('.') || path.startsWith('[') ? '' : '.') + path;
  // Handle recursive descent
  if (path.includes('..')) {
    return handleRecursive(data, path);
  }
  const tokens = tokenize(path.substring(1)); // strip $
  const results = [];
  resolve(data, tokens, results);
  return results;
}

function handleRecursive(data, path) {
  const parts = path.split('..');
  const prefix = parts[0]; // $ or $.something
  const suffix = parts.slice(1).join('..');
  let roots = [data];
  if (prefix && prefix !== '$') {
    const prefixTokens = tokenize(prefix.substring(1));
    roots = [];
    resolve(data, prefixTokens, roots);
  }
  const results = [];
  const suffixTokens = tokenize(suffix.startsWith('.') ? suffix : '.' + suffix);
  roots.forEach(root => {
    collectRecursive(root, suffixTokens, results);
  });
  return results;
}

function collectRecursive(obj, tokens, results) {
  if (obj === null || typeof obj !== 'object') return;
  // Try to resolve tokens from this point
  const r = [];
  resolve(obj, tokens, r);
  results.push(...r);
  // Recurse into children
  if (Array.isArray(obj)) {
    obj.forEach(item => collectRecursive(item, tokens, results));
  } else {
    Object.values(obj).forEach(val => collectRecursive(val, tokens, results));
  }
}

function tokenize(path) {
  if (!path) return [];
  const tokens = [];
  const re = /\.([a-zA-Z_$][\w$]*)|\.?\[(\d+)\]|\.?\[\?\(([^)]+)\)\]|\.?\[(['"])([^'"]*)\4\]|\.?\[\*\]/g;
  let m;
  while ((m = re.exec(path)) !== null) {
    if (m[1] !== undefined) tokens.push({ type: 'key', value: m[1] });
    else if (m[2] !== undefined) tokens.push({ type: 'index', value: parseInt(m[2]) });
    else if (m[3] !== undefined) tokens.push({ type: 'filter', value: m[3] });
    else if (m[5] !== undefined) tokens.push({ type: 'key', value: m[5] });
    else if (m[0].includes('*')) tokens.push({ type: 'wildcard' });
  }
  return tokens;
}

function resolve(obj, tokens, results) {
  if (tokens.length === 0) { results.push(obj); return; }
  const [tok, ...rest] = tokens;
  if (obj == null) return;
  if (tok.type === 'key') {
    if (typeof obj === 'object' && !Array.isArray(obj) && tok.value in obj) {
      resolve(obj[tok.value], rest, results);
    }
  } else if (tok.type === 'index') {
    if (Array.isArray(obj) && tok.value < obj.length && tok.value >= 0) {
      resolve(obj[tok.value], rest, results);
    }
  } else if (tok.type === 'wildcard') {
    const items = Array.isArray(obj) ? obj : Object.values(obj);
    items.forEach(v => resolve(v, rest, results));
  } else if (tok.type === 'filter') {
    if (Array.isArray(obj)) {
      const expr = tok.value.replace(/@/g, 'item');
      obj.forEach(item => {
        try { if (new Function('item', 'return ' + expr)(item)) resolve(item, rest, results); } catch (e) {}
      });
    }
  }
}

function highlightMatches(data, path) {
  clearHighlights('match');
  // Simple heuristic: highlight tree nodes whose paths match query results
  try {
    const results = queryJsonPath(data, path);
    const resultStrs = new Set(results.map(r => JSON.stringify(r)));
    nodeMap.forEach((info, el) => {
      try {
        if (resultStrs.has(info.value) || resultStrs.has('"' + info.value.replace(/^"|"$/g, '') + '"')) {
          el.classList.add('match');
        }
      } catch (e) {}
    });
  } catch (e) {}
}

function clearHighlights(cls) {
  document.querySelectorAll('.tree-line.' + cls).forEach(el => el.classList.remove(cls));
}

/* ========== Utility Functions ========== */
function formatInput() {
  if (!parsed) { showToast('No valid JSON to format'); return; }
  jsonInput.value = JSON.stringify(parsed, null, 2);
  updateLineCount();
  showToast('Formatted');
}

function copyResults() {
  const text = resultsBody.textContent;
  if (!text) { showToast('No results to copy'); return; }
  navigator.clipboard.writeText(text).then(() => showToast('Results copied'));
}

function clearAll() {
  jsonInput.value = '';
  queryInput.value = '';
  treeOutput.innerHTML = '';
  parsed = null;
  statusDot.className = 'status-dot empty';
  statusText.textContent = 'Paste JSON to begin';
  sizeInfo.textContent = '';
  lineCountEl.textContent = '';
  nodeCountEl.textContent = '';
  pathDisplay.classList.remove('visible');
  resultsPanel.classList.remove('visible');
}

function loadSample() {
  jsonInput.value = JSON.stringify({
    "store": {
      "book": [
        { "category": "reference", "author": "Nigel Rees", "title": "Sayings of the Century", "price": 8.95 },
        { "category": "fiction", "author": "Evelyn Waugh", "title": "Sword of Honour", "price": 12.99 },
        { "category": "fiction", "author": "Herman Melville", "title": "Moby Dick", "isbn": "0-553-21311-3", "price": 8.99 },
        { "category": "fiction", "author": "J. R. R. Tolkien", "title": "The Lord of the Rings", "isbn": "0-395-19395-8", "price": 22.99 }
      ],
      "bicycle": { "color": "red", "price": 19.95 }
    },
    "expensive": 10
  }, null, 2);
  queryInput.value = '$.store.book[?(@.price<10)]';
  updateLineCount();
  parseAndRender();
}

function formatBytes(b) {
  if (b === 0) return '0 B';
  const k = 1024, s = ['B', 'KB', 'MB'];
  const i = Math.floor(Math.log(b) / Math.log(k));
  return parseFloat((b / Math.pow(k, i)).toFixed(1)) + ' ' + s[i];
}

function escHtml(s) { return String(s).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;'); }

function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2000);
}

jsonInput.addEventListener('keydown', e => {
  if (e.key === 'Tab') {
    e.preventDefault();
    const s = jsonInput.selectionStart, end = jsonInput.selectionEnd;
    jsonInput.value = jsonInput.value.substring(0, s) + '  ' + jsonInput.value.substring(end);
    jsonInput.selectionStart = jsonInput.selectionEnd = s + 2;
  }
});

const observer = new IntersectionObserver(entries => {
  entries.forEach(entry => { if (entry.isIntersecting) { entry.target.classList.add('visible'); observer.unobserve(entry.target); }});
}, { threshold: 0.1 });
document.querySelectorAll('.fade-in').forEach(el => observer.observe(el));
</script>
<script src="/js/analytics-lite.js" defer></script>
<script src="/js/revenue.js" defer></script>
<script src="/js/lead-capture.js" defer></script>
</body>
</html>