<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Free PDF Compressor — Reduce PDF File Size | NexTool</title>
<meta name="description" content="Compress PDF files to reduce file size for free. Client-side PDF compressor — no upload to servers. Remove metadata, optimize images, shrink PDFs instantly.">
<meta name="keywords" content="pdf compress, compress pdf online, reduce pdf size, pdf compressor, shrink pdf, free pdf compress">
<meta property="og:title" content="Free PDF Compressor — Reduce PDF File Size | NexTool">
<meta property="og:description" content="Compress PDF files to reduce file size. 100% client-side processing — your files never leave your browser.">
<meta property="og:type" content="website">
<meta property="og:url" content="https://nextool.app/free-tools/pdf-compress.html">
<meta property="og:image" content="https://nextool.app/assets/og-default.png">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<link rel="canonical" href="https://nextool.app/free-tools/pdf-compress.html">
<meta name="robots" content="index, follow">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Free PDF Compressor — Reduce PDF File Size | NexTool">
<meta name="twitter:description" content="Compress PDF files to reduce file size. Free online tool by NexTool. No upload to servers.">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"SoftwareApplication","name":"NexTool PDF Compressor","applicationCategory":"UtilitiesApplication","operatingSystem":"Web","offers":{"@type":"Offer","price":"0","priceCurrency":"USD"},"description":"Free online PDF compressor. Reduce PDF file size with client-side processing. No upload to servers."}
</script>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{--bg:#050508;--surface:#111118;--surface2:#1a1a24;--border:#2a2a3a;--text:#e4e4eb;--text2:#9494a8;--primary:#6366f1;--accent:#a855f7;--pink:#ec4899;--green:#22c55e;--red:#ef4444;--cyan:#22d3ee;--yellow:#eab308;--radius:12px;--glass:rgba(17,17,24,0.7)}
html{scroll-behavior:smooth}
body{font-family:'Inter',system-ui,sans-serif;background:var(--bg);color:var(--text);line-height:1.6;min-height:100vh;overflow-x:hidden}
/* NAV */
.nav{position:sticky;top:0;z-index:100;background:rgba(5,5,8,0.85);backdrop-filter:blur(20px);border-bottom:1px solid var(--border);padding:0 2rem;height:64px;display:flex;align-items:center;justify-content:space-between}
.nav-logo{font-size:1.4rem;font-weight:800;background:linear-gradient(135deg,var(--primary),var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent;text-decoration:none}
.nav-links{display:flex;align-items:center;gap:1.5rem}
.nav-links a{color:var(--text2);text-decoration:none;font-size:.875rem;font-weight:500;transition:color .2s}
.nav-links a:hover{color:var(--text)}
.nav-cta{background:linear-gradient(135deg,var(--primary),var(--accent));color:#fff!important;padding:.5rem 1.2rem;border-radius:8px;font-weight:600;-webkit-text-fill-color:#fff!important}
.nav-cta:hover{opacity:.9}
.nav-toggle{display:none;background:none;border:none;color:var(--text);font-size:1.5rem;cursor:pointer}
/* HERO */
.hero{text-align:center;padding:3rem 1.5rem 2rem;max-width:700px;margin:0 auto}
.hero h1{font-size:2.2rem;font-weight:800;line-height:1.2;margin-bottom:.75rem}
.hero h1 span{background:linear-gradient(135deg,var(--primary),var(--accent),var(--pink));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.hero p{color:var(--text2);font-size:1rem}
/* TOOL */
.tool-container{max-width:800px;margin:0 auto;padding:0 1.5rem 3rem}
/* DROP ZONE */
.drop-zone{border:2px dashed var(--border);border-radius:var(--radius);padding:3rem 2rem;text-align:center;cursor:pointer;transition:all .3s;background:var(--glass);backdrop-filter:blur(16px);position:relative}
.drop-zone:hover,.drop-zone.dragover{border-color:var(--primary);background:rgba(99,102,241,.06)}
.drop-zone-icon{font-size:3rem;margin-bottom:1rem;opacity:.6}
.drop-zone-text{color:var(--text2);font-size:.95rem;margin-bottom:.5rem}
.drop-zone-sub{color:var(--text2);font-size:.8rem;opacity:.6}
.drop-zone input{display:none}
/* FILE INFO */
.file-info{display:none;background:var(--glass);backdrop-filter:blur(16px);border:1px solid var(--border);border-radius:var(--radius);padding:1.5rem;margin-top:1rem}
.file-info.show{display:block}
.file-name{font-weight:700;font-size:1rem;margin-bottom:.5rem;word-break:break-all}
.file-meta{display:flex;flex-wrap:wrap;gap:1rem;font-size:.85rem;color:var(--text2)}
.file-meta span{display:flex;align-items:center;gap:.3rem}
/* COMPRESSION OPTIONS */
.options-panel{display:none;background:var(--glass);backdrop-filter:blur(16px);border:1px solid var(--border);border-radius:var(--radius);padding:1.5rem;margin-top:1rem}
.options-panel.show{display:block}
.options-label{font-weight:600;font-size:.9rem;margin-bottom:1rem;color:var(--text)}
.compression-levels{display:grid;grid-template-columns:repeat(3,1fr);gap:.75rem}
.level-btn{background:var(--surface2);border:2px solid var(--border);border-radius:10px;padding:1rem .75rem;text-align:center;cursor:pointer;transition:all .2s;font-family:inherit}
.level-btn:hover{border-color:var(--primary);background:rgba(99,102,241,.08)}
.level-btn.active{border-color:var(--primary);background:rgba(99,102,241,.12);box-shadow:0 0 20px rgba(99,102,241,.15)}
.level-btn .level-name{font-weight:700;font-size:.9rem;color:var(--text);margin-bottom:.25rem}
.level-btn .level-desc{font-size:.75rem;color:var(--text2);line-height:1.3}
.level-btn .level-icon{font-size:1.5rem;margin-bottom:.5rem}
/* TECHNIQUES */
.techniques{margin-top:1.25rem;padding-top:1.25rem;border-top:1px solid var(--border)}
.tech-title{font-size:.8rem;font-weight:600;color:var(--text2);margin-bottom:.75rem;text-transform:uppercase;letter-spacing:.5px}
.tech-list{display:flex;flex-wrap:wrap;gap:.5rem}
.tech-tag{display:flex;align-items:center;gap:.3rem;padding:.35rem .7rem;background:var(--surface2);border:1px solid var(--border);border-radius:6px;font-size:.75rem;color:var(--text2)}
.tech-tag .tech-check{color:var(--green);font-weight:700}
/* COMPRESS BUTTON */
.compress-btn{display:none;width:100%;margin-top:1rem;padding:.9rem 2rem;background:linear-gradient(135deg,var(--primary),var(--accent));color:#fff;border:none;border-radius:10px;font-size:1rem;font-weight:700;cursor:pointer;transition:all .2s;font-family:inherit}
.compress-btn.show{display:block}
.compress-btn:hover{transform:translateY(-2px);box-shadow:0 8px 30px rgba(99,102,241,.3)}
.compress-btn:disabled{opacity:.5;cursor:not-allowed;transform:none;box-shadow:none}
/* PROGRESS */
.progress-container{display:none;margin-top:1rem;background:var(--glass);backdrop-filter:blur(16px);border:1px solid var(--border);border-radius:var(--radius);padding:1.5rem}
.progress-container.show{display:block}
.progress-bar-outer{background:var(--surface2);border-radius:8px;height:8px;overflow:hidden;margin-bottom:1rem}
.progress-bar-inner{height:100%;background:linear-gradient(135deg,var(--primary),var(--accent));border-radius:8px;transition:width .3s;width:0}
.progress-text{font-size:.85rem;color:var(--text2);text-align:center}
/* RESULTS */
.results{display:none;background:var(--glass);backdrop-filter:blur(16px);border:1px solid var(--border);border-radius:var(--radius);padding:1.5rem;margin-top:1rem}
.results.show{display:block}
.results-header{font-weight:700;font-size:1.1rem;margin-bottom:1rem;color:var(--green);display:flex;align-items:center;gap:.5rem}
.results-grid{display:grid;grid-template-columns:1fr auto 1fr;gap:1rem;align-items:center;margin-bottom:1.5rem}
.result-card{background:var(--surface2);border:1px solid var(--border);border-radius:10px;padding:1rem;text-align:center}
.result-card .label{font-size:.75rem;color:var(--text2);text-transform:uppercase;letter-spacing:.5px;margin-bottom:.25rem}
.result-card .value{font-size:1.4rem;font-weight:800}
.result-card.original .value{color:var(--text)}
.result-card.compressed .value{color:var(--green)}
.result-arrow{font-size:1.5rem;color:var(--primary);text-align:center}
.reduction-badge{text-align:center;padding:.6rem 1.5rem;background:rgba(34,197,94,.1);border:1px solid rgba(34,197,94,.2);border-radius:8px;color:var(--green);font-weight:700;font-size:1rem;margin-bottom:1rem}
.download-btn{width:100%;padding:.8rem 2rem;background:linear-gradient(135deg,var(--green),#16a34a);color:#fff;border:none;border-radius:10px;font-size:.95rem;font-weight:700;cursor:pointer;transition:all .2s;font-family:inherit}
.download-btn:hover{transform:translateY(-2px);box-shadow:0 8px 30px rgba(34,197,94,.3)}
.reset-btn{width:100%;margin-top:.75rem;padding:.6rem 1rem;background:transparent;border:1px solid var(--border);color:var(--text2);border-radius:8px;font-size:.85rem;font-weight:500;cursor:pointer;transition:all .2s;font-family:inherit}
.reset-btn:hover{border-color:var(--primary);color:var(--text)}
/* ERROR */
.error-box{display:none;background:rgba(239,68,68,.08);border:1px solid rgba(239,68,68,.2);border-radius:var(--radius);padding:1rem 1.5rem;margin-top:1rem;color:var(--red);font-size:.9rem}
.error-box.show{display:block}
/* CTA */
.cta-section{text-align:center;padding:4rem 1.5rem;max-width:700px;margin:0 auto}
.cta-section h2{font-size:1.8rem;font-weight:800;margin-bottom:.75rem}
.cta-section h2 span{background:linear-gradient(135deg,var(--primary),var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.cta-section p{color:var(--text2);margin-bottom:1.5rem}
.cta-btn{display:inline-block;background:linear-gradient(135deg,var(--primary),var(--accent));color:#fff;padding:.75rem 2rem;border-radius:10px;font-weight:700;text-decoration:none;font-size:1rem;transition:transform .2s,box-shadow .2s}
.cta-btn:hover{transform:translateY(-2px);box-shadow:0 8px 30px rgba(99,102,241,.3)}
/* FOOTER */
.footer{border-top:1px solid var(--border);padding:3rem 2rem 2rem;max-width:1200px;margin:0 auto}
.footer-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:2rem;margin-bottom:2rem}
.footer-col h4{font-size:.85rem;font-weight:700;margin-bottom:.75rem;color:var(--text)}
.footer-col a{display:block;color:var(--text2);text-decoration:none;font-size:.8rem;margin-bottom:.4rem;transition:color .2s}
.footer-col a:hover{color:var(--primary)}
.footer-bottom{text-align:center;color:var(--text2);font-size:.75rem;padding-top:1.5rem;border-top:1px solid var(--border)}
/* FADE IN */
.fade-in{opacity:0;transform:translateY(20px);transition:opacity .6s,transform .6s}
.fade-in.visible{opacity:1;transform:translateY(0)}
/* TOAST */
.toast{position:fixed;bottom:2rem;left:50%;transform:translateX(-50%) translateY(80px);background:var(--surface2);border:1px solid var(--border);color:var(--text);padding:.6rem 1.2rem;border-radius:10px;font-size:.85rem;font-weight:500;z-index:200;transition:transform .3s;pointer-events:none}
.toast.show{transform:translateX(-50%) translateY(0)}
/* PRIVACY BADGE */
.privacy-badge{display:flex;align-items:center;justify-content:center;gap:.5rem;margin-top:1.5rem;padding:.6rem 1rem;background:rgba(34,197,94,.06);border:1px solid rgba(34,197,94,.15);border-radius:8px;font-size:.8rem;color:var(--green)}
/* RESPONSIVE */
@media(max-width:768px){
  .nav-links{display:none;position:absolute;top:64px;left:0;right:0;background:var(--bg);border-bottom:1px solid var(--border);flex-direction:column;padding:1rem 2rem;gap:1rem}
  .nav-links.open{display:flex}
  .nav-toggle{display:block}
  .hero h1{font-size:1.6rem}
  .footer-grid{grid-template-columns:1fr}
  .compression-levels{grid-template-columns:1fr}
  .results-grid{grid-template-columns:1fr;gap:.5rem}
  .result-arrow{transform:rotate(90deg)}
  .drop-zone{padding:2rem 1rem}
}
</style>
</head>
<body>

<nav class="nav">
  <a href="/" class="nav-logo">NexTool</a>
  <button class="nav-toggle" onclick="document.querySelector('.nav-links').classList.toggle('open')" aria-label="Menu">&#9776;</button>
  <div class="nav-links">
    <a href="/">Home</a>
    <a href="/free-tools/">Tools</a>
    <a href="/free-tools/">Free Tools</a>
    <a href="/blog/">Blog</a>
    <a href="/pro.html" class="nav-cta">Get Pro — $29</a>
  </div>
</nav>

<section class="hero fade-in">
  <h1>Free <span>PDF Compressor</span></h1>
  <p class="tool-summary" style="color:#94a3b8;font-size:15px;line-height:1.6;margin-bottom:24px;max-width:700px;margin-left:auto;margin-right:auto;">Compress PDF files to reduce file size. Remove metadata, flatten forms, and optimize content. 100% client-side processing — your files never leave your browser. No signup, no upload limits.</p>
</section>

<div class="tool-container fade-in">
  <!-- Drop Zone -->
  <div class="drop-zone" id="dropZone">
    <div class="drop-zone-icon">
      <svg width="56" height="56" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="opacity:.5">
        <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
        <polyline points="14 2 14 8 20 8"/>
        <line x1="12" y1="18" x2="12" y2="12"/>
        <polyline points="9 15 12 12 15 15"/>
      </svg>
    </div>
    <div class="drop-zone-text">Drop your PDF here or <strong style="color:var(--primary)">click to browse</strong></div>
    <div class="drop-zone-sub">Maximum file size: 100 MB</div>
    <input type="file" id="fileInput" accept=".pdf,application/pdf">
  </div>

  <!-- File Info -->
  <div class="file-info" id="fileInfo">
    <div class="file-name" id="fileName"></div>
    <div class="file-meta">
      <span><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/></svg> <span id="fileSize"></span></span>
      <span><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg> <span id="filePages"></span></span>
    </div>
  </div>

  <!-- Compression Options -->
  <div class="options-panel" id="optionsPanel">
    <div class="options-label">Compression Level</div>
    <div class="compression-levels">
      <div class="level-btn" data-level="low" onclick="selectLevel('low')">
        <div class="level-icon">
          <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#22c55e" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
        </div>
        <div class="level-name">Low</div>
        <div class="level-desc">Best quality, smaller reduction</div>
      </div>
      <div class="level-btn active" data-level="medium" onclick="selectLevel('medium')">
        <div class="level-icon">
          <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#6366f1" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M8 14s1.5 2 4 2 4-2 4-2"/><line x1="9" y1="9" x2="9.01" y2="9"/><line x1="15" y1="9" x2="15.01" y2="9"/></svg>
        </div>
        <div class="level-name">Medium</div>
        <div class="level-desc">Balanced quality and size</div>
      </div>
      <div class="level-btn" data-level="high" onclick="selectLevel('high')">
        <div class="level-icon">
          <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#ec4899" stroke-width="2"><path d="M21 16V8a2 2 0 00-1-1.73l-7-4a2 2 0 00-2 0l-7 4A2 2 0 002 8v8a2 2 0 001 1.73l7 4a2 2 0 002 0l7-4A2 2 0 0022 16z"/><polyline points="7.5 4.21 12 6.81 16.5 4.21"/><polyline points="7.5 19.79 7.5 14.6 3 12"/><polyline points="21 12 16.5 14.6 16.5 19.79"/></svg>
        </div>
        <div class="level-name">High</div>
        <div class="level-desc">Smallest file, lower quality</div>
      </div>
    </div>

    <div class="techniques">
      <div class="tech-title">Optimization techniques applied</div>
      <div class="tech-list" id="techList">
        <div class="tech-tag"><span class="tech-check">&#10003;</span> Remove metadata</div>
        <div class="tech-tag"><span class="tech-check">&#10003;</span> Flatten forms</div>
        <div class="tech-tag"><span class="tech-check">&#10003;</span> Optimize images</div>
        <div class="tech-tag"><span class="tech-check">&#10003;</span> Clean structure</div>
      </div>
    </div>
  </div>

  <!-- Compress Button -->
  <button class="compress-btn" id="compressBtn" onclick="compressPDF()">Compress PDF</button>

  <!-- Progress -->
  <div class="progress-container" id="progressContainer">
    <div class="progress-bar-outer">
      <div class="progress-bar-inner" id="progressBar"></div>
    </div>
    <div class="progress-text" id="progressText">Preparing compression...</div>
  </div>

  <!-- Error -->
  <div class="error-box" id="errorBox"></div>

  <!-- Results -->
  <div class="results" id="results">
    <div class="results-header">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 11-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
      Compression Complete
    </div>
    <div class="results-grid">
      <div class="result-card original">
        <div class="label">Original</div>
        <div class="value" id="originalSize">-</div>
      </div>
      <div class="result-arrow">&rarr;</div>
      <div class="result-card compressed">
        <div class="label">Compressed</div>
        <div class="value" id="compressedSize">-</div>
      </div>
    </div>
    <div class="reduction-badge" id="reductionBadge">-</div>
    <button class="download-btn" id="downloadBtn" onclick="downloadCompressed()">Download Compressed PDF</button>
    <button class="reset-btn" onclick="resetTool()">Compress Another PDF</button>
  </div>

  <!-- Privacy Badge -->
  <div class="privacy-badge">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
    100% client-side — your files never leave your browser
  </div>
</div>

<section class="cta-section fade-in">
  <h2>Need something <span>more powerful</span>?</h2>
  <p>Let us build it for you. Custom APIs, dashboards, automations &mdash; whatever you need.</p>
  <a href="/#contact" class="cta-btn">Start a Project &rarr;</a>
</section>

<!-- Cross Promo -->
<section style="max-width:900px;margin:40px auto;padding:0 24px;">
<div style="background:linear-gradient(135deg,rgba(99,102,241,0.1),rgba(168,85,247,0.08));border:1px solid rgba(99,102,241,0.15);border-radius:20px;padding:32px 28px;text-align:center;">
<div style="font-size:13px;color:#818cf8;font-weight:600;text-transform:uppercase;letter-spacing:1px;margin-bottom:8px;">Founding Member</div>
<h3 style="font-size:22px;font-weight:800;color:#fff;margin:0 0 8px;">Get NexTool Pro</h3>
<p style="color:#94a3b8;font-size:14px;margin:0 auto 20px;max-width:500px;">No banners, clean output, enhanced features on all 250+ tools. One-time payment.</p>
<div style="display:flex;align-items:center;justify-content:center;gap:12px;flex-wrap:wrap;">
<a href="/pro.html" style="display:inline-block;padding:12px 28px;background:linear-gradient(135deg,#6366f1,#a855f7,#ec4899);color:#fff;border-radius:10px;font-weight:700;font-size:15px;text-decoration:none;">$29 — Get Pro</a>
<a href="/free-tools/" style="color:#94a3b8;font-size:14px;text-decoration:none;">Browse 250+ Free Tools &rarr;</a>
</div>
</div>
</section>

<footer class="footer fade-in">
  <div class="footer-grid">
    <div class="footer-col">
      <h4>Products</h4>
      <a href="/free-tools/">250+ Free Tools</a>
<a href="/pro.html">NexTool Pro</a>
<a href="/workspace.html">Workspace</a>
    </div>
    <div class="footer-col">
      <h4>Explore</h4>
      <a href="/free-tools/">Free Tools</a><a href="/blog/">Blog</a><a href="/pro.html">FAQ</a><a href="/pro.html">Pro — $29</a>
    </div>
    <div class="footer-col">
      <h4>Ecosystem</h4>
      <a href="/">NexTool Home</a><a href="/#contact">Contact</a><a href="https://github.com/christian140903-sudo/nextool" target="_blank">GitHub</a>
    </div>
  </div>
  <div class="footer-bottom">&copy; 2026 NexTool. AI-powered tools for everyone.</div>
</footer>

<div class="toast" id="toast"></div>

<script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
<script>
/* State */
let pdfFile = null;
let pdfBytes = null;
let compressedBytes = null;
let compressionLevel = 'medium';
let originalFileName = '';

/* Elements */
const dropZone = document.getElementById('dropZone');
const fileInput = document.getElementById('fileInput');
const fileInfo = document.getElementById('fileInfo');
const fileName = document.getElementById('fileName');
const fileSize = document.getElementById('fileSize');
const filePages = document.getElementById('filePages');
const optionsPanel = document.getElementById('optionsPanel');
const compressBtn = document.getElementById('compressBtn');
const progressContainer = document.getElementById('progressContainer');
const progressBar = document.getElementById('progressBar');
const progressText = document.getElementById('progressText');
const errorBox = document.getElementById('errorBox');
const results = document.getElementById('results');

/* Drop Zone events */
dropZone.addEventListener('click', function() { fileInput.click(); });
fileInput.addEventListener('change', function(e) {
  if (e.target.files.length > 0) handleFile(e.target.files[0]);
});

dropZone.addEventListener('dragover', function(e) {
  e.preventDefault();
  dropZone.classList.add('dragover');
});
dropZone.addEventListener('dragleave', function(e) {
  e.preventDefault();
  dropZone.classList.remove('dragover');
});
dropZone.addEventListener('drop', function(e) {
  e.preventDefault();
  dropZone.classList.remove('dragover');
  if (e.dataTransfer.files.length > 0) handleFile(e.dataTransfer.files[0]);
});

/* Handle file selection */
async function handleFile(file) {
  hideError();
  results.classList.remove('show');
  progressContainer.classList.remove('show');

  if (file.type !== 'application/pdf' && !file.name.toLowerCase().endsWith('.pdf')) {
    showError('Please select a valid PDF file.');
    return;
  }

  if (file.size > 100 * 1024 * 1024) {
    showError('File is too large. Maximum size is 100 MB.');
    return;
  }

  pdfFile = file;
  originalFileName = file.name;

  try {
    pdfBytes = new Uint8Array(await file.arrayBuffer());

    /* Validate it is a real PDF by loading it */
    const pdfDoc = await PDFLib.PDFDocument.load(pdfBytes, { ignoreEncryption: true });
    const pageCount = pdfDoc.getPageCount();

    fileName.textContent = file.name;
    fileSize.textContent = formatBytes(file.size);
    filePages.textContent = pageCount + ' page' + (pageCount !== 1 ? 's' : '');

    fileInfo.classList.add('show');
    optionsPanel.classList.add('show');
    compressBtn.classList.add('show');
    dropZone.style.display = 'none';
  } catch (err) {
    showError('Could not read the PDF file. It may be corrupted or password-protected. (' + err.message + ')');
    pdfFile = null;
    pdfBytes = null;
  }
}

/* Compression level */
function selectLevel(level) {
  compressionLevel = level;
  document.querySelectorAll('.level-btn').forEach(function(btn) {
    btn.classList.toggle('active', btn.dataset.level === level);
  });
}

/* Main compression function */
async function compressPDF() {
  if (!pdfBytes) return;

  compressBtn.disabled = true;
  compressBtn.textContent = 'Compressing...';
  progressContainer.classList.add('show');
  results.classList.remove('show');
  hideError();

  try {
    updateProgress(5, 'Loading PDF document...');

    /* Load source document */
    const srcDoc = await PDFLib.PDFDocument.load(pdfBytes, { ignoreEncryption: true });
    const pageCount = srcDoc.getPageCount();

    updateProgress(10, 'Creating optimized document...');

    /* Create a new document and copy pages — this drops unused objects */
    const newDoc = await PDFLib.PDFDocument.create();

    /* Copy all pages */
    const pages = await newDoc.copyPages(srcDoc, srcDoc.getPageIndices());
    pages.forEach(function(page) { newDoc.addPage(page); });

    updateProgress(30, 'Removing metadata...');

    /* Remove metadata */
    newDoc.setTitle('');
    newDoc.setAuthor('');
    newDoc.setSubject('');
    newDoc.setKeywords([]);
    newDoc.setProducer('');
    newDoc.setCreator('');

    updateProgress(40, 'Processing pages...');

    /* Process embedded images based on compression level */
    const qualityMap = { low: 0.85, medium: 0.65, high: 0.35 };
    const scaleMap = { low: 1.0, medium: 0.85, high: 0.65 };
    const quality = qualityMap[compressionLevel];
    const scale = scaleMap[compressionLevel];

    /* Walk the PDF structure looking for image XObjects to re-encode */
    let imagesProcessed = 0;
    const allPages = newDoc.getPages();

    for (let i = 0; i < allPages.length; i++) {
      updateProgress(40 + Math.round((i / allPages.length) * 40), 'Processing page ' + (i + 1) + ' of ' + allPages.length + '...');

      try {
        const page = allPages[i];
        const node = page.node;
        const resources = node.get(PDFLib.PDFName.of('Resources'));
        if (!resources) continue;

        let xObjectDict;
        if (resources instanceof PDFLib.PDFDict) {
          xObjectDict = resources.get(PDFLib.PDFName.of('XObject'));
        } else {
          const resolved = newDoc.context.lookup(resources);
          if (resolved instanceof PDFLib.PDFDict) {
            xObjectDict = resolved.get(PDFLib.PDFName.of('XObject'));
          }
        }

        if (!xObjectDict) continue;

        let xObjects;
        if (xObjectDict instanceof PDFLib.PDFDict) {
          xObjects = xObjectDict;
        } else {
          xObjects = newDoc.context.lookup(xObjectDict);
        }

        if (!(xObjects instanceof PDFLib.PDFDict)) continue;

        const entries = xObjects.entries();
        for (const [name, ref] of entries) {
          try {
            const xObj = newDoc.context.lookup(ref);
            if (!(xObj instanceof PDFLib.PDFRawStream || xObj instanceof PDFLib.PDFStream)) continue;

            const dict = xObj.dict || xObj;
            const subtype = dict.get(PDFLib.PDFName.of('Subtype'));
            if (!subtype || subtype.toString() !== '/Image') continue;

            const widthObj = dict.get(PDFLib.PDFName.of('Width'));
            const heightObj = dict.get(PDFLib.PDFName.of('Height'));
            if (!widthObj || !heightObj) continue;

            const origW = typeof widthObj.value === 'function' ? widthObj.value() : (widthObj.numberValue ? widthObj.numberValue : parseInt(widthObj.toString()));
            const origH = typeof heightObj.value === 'function' ? heightObj.value() : (heightObj.numberValue ? heightObj.numberValue : parseInt(heightObj.toString()));

            if (isNaN(origW) || isNaN(origH) || origW < 10 || origH < 10) continue;

            /* Only re-encode large images where it makes a difference */
            if (origW * origH < 2500) continue;

            const newW = Math.round(origW * scale);
            const newH = Math.round(origH * scale);

            /* Try to decode the image to a canvas and re-encode as JPEG */
            try {
              const decodedData = xObj.getContents ? xObj.getContents() : null;
              if (!decodedData || decodedData.length === 0) continue;

              const bitsObj = dict.get(PDFLib.PDFName.of('BitsPerComponent'));
              const bits = bitsObj ? (typeof bitsObj.value === 'function' ? bitsObj.value() : parseInt(bitsObj.toString())) : 8;
              const colorSpaceObj = dict.get(PDFLib.PDFName.of('ColorSpace'));
              const csStr = colorSpaceObj ? colorSpaceObj.toString() : '/DeviceRGB';

              let channels = 3;
              if (csStr.indexOf('Gray') !== -1) channels = 1;
              else if (csStr.indexOf('CMYK') !== -1) channels = 4;
              else if (csStr.indexOf('RGB') !== -1) channels = 3;

              /* Verify data size matches expected dimensions */
              const expectedBytes = origW * origH * channels * (bits / 8);
              if (Math.abs(decodedData.length - expectedBytes) > expectedBytes * 0.1) continue;

              /* Create canvas and draw raw pixel data */
              const canvas = document.createElement('canvas');
              canvas.width = newW;
              canvas.height = newH;
              const ctx = canvas.getContext('2d');

              const srcCanvas = document.createElement('canvas');
              srcCanvas.width = origW;
              srcCanvas.height = origH;
              const srcCtx = srcCanvas.getContext('2d');
              const imgData = srcCtx.createImageData(origW, origH);

              if (channels === 3 && bits === 8) {
                for (let p = 0, d = 0; p < origW * origH; p++, d += 4) {
                  imgData.data[d] = decodedData[p * 3];
                  imgData.data[d + 1] = decodedData[p * 3 + 1];
                  imgData.data[d + 2] = decodedData[p * 3 + 2];
                  imgData.data[d + 3] = 255;
                }
              } else if (channels === 1 && bits === 8) {
                for (let p = 0, d = 0; p < origW * origH; p++, d += 4) {
                  const v = decodedData[p];
                  imgData.data[d] = v;
                  imgData.data[d + 1] = v;
                  imgData.data[d + 2] = v;
                  imgData.data[d + 3] = 255;
                }
              } else {
                continue; /* Skip unsupported formats */
              }

              srcCtx.putImageData(imgData, 0, 0);
              ctx.drawImage(srcCanvas, 0, 0, newW, newH);

              /* Re-encode as JPEG */
              const jpegDataUrl = canvas.toDataURL('image/jpeg', quality);
              const jpegBase64 = jpegDataUrl.split(',')[1];
              const jpegBytes = Uint8Array.from(atob(jpegBase64), function(c) { return c.charCodeAt(0); });

              /* Only replace if the new image is actually smaller */
              if (jpegBytes.length < decodedData.length * 0.9) {
                const newImage = await newDoc.embedJpg(jpegBytes);
                imagesProcessed++;
              }
            } catch (imgErr) {
              /* Skip images that fail to process */
              continue;
            }
          } catch (entryErr) {
            continue;
          }
        }
      } catch (pageErr) {
        continue;
      }
    }

    updateProgress(85, 'Flattening forms...');

    /* Flatten form fields by removing the AcroForm */
    try {
      const catalog = newDoc.catalog;
      if (catalog && catalog.get) {
        catalog.delete(PDFLib.PDFName.of('AcroForm'));
      }
    } catch (e) { /* ignore */ }

    updateProgress(90, 'Serializing compressed PDF...');

    /* Save with optimizations */
    compressedBytes = await newDoc.save({
      useObjectStreams: true,
      addDefaultPage: false,
      objectsPerTick: 100
    });

    updateProgress(100, 'Done!');

    /* Show results */
    const origSize = pdfBytes.length;
    const compSize = compressedBytes.length;

    /* If the "compressed" file is larger, use original (no negative compression) */
    if (compSize >= origSize) {
      compressedBytes = pdfBytes;
      document.getElementById('originalSize').textContent = formatBytes(origSize);
      document.getElementById('compressedSize').textContent = formatBytes(origSize);
      document.getElementById('reductionBadge').textContent = 'PDF is already optimized — no further reduction possible';
      document.getElementById('reductionBadge').style.background = 'rgba(234,179,8,.1)';
      document.getElementById('reductionBadge').style.borderColor = 'rgba(234,179,8,.2)';
      document.getElementById('reductionBadge').style.color = 'var(--yellow)';
    } else {
      const reduction = ((1 - compSize / origSize) * 100).toFixed(1);
      document.getElementById('originalSize').textContent = formatBytes(origSize);
      document.getElementById('compressedSize').textContent = formatBytes(compSize);
      document.getElementById('reductionBadge').textContent = reduction + '% smaller (' + formatBytes(origSize - compSize) + ' saved)';
      document.getElementById('reductionBadge').style.background = 'rgba(34,197,94,.1)';
      document.getElementById('reductionBadge').style.borderColor = 'rgba(34,197,94,.2)';
      document.getElementById('reductionBadge').style.color = 'var(--green)';
    }

    setTimeout(function() {
      progressContainer.classList.remove('show');
      results.classList.add('show');
    }, 500);

  } catch (err) {
    progressContainer.classList.remove('show');
    showError('Compression failed: ' + err.message);
  }

  compressBtn.disabled = false;
  compressBtn.textContent = 'Compress PDF';
}

/* Download compressed PDF */
function downloadCompressed() {
  if (!compressedBytes) return;
  const blob = new Blob([compressedBytes], { type: 'application/pdf' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  const name = originalFileName.replace(/\.pdf$/i, '');
  a.download = name + '-compressed.pdf';
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
  showToast('Downloaded compressed PDF');
}

/* Reset */
function resetTool() {
  pdfFile = null;
  pdfBytes = null;
  compressedBytes = null;
  originalFileName = '';
  fileInput.value = '';
  fileInfo.classList.remove('show');
  optionsPanel.classList.remove('show');
  compressBtn.classList.remove('show');
  progressContainer.classList.remove('show');
  results.classList.remove('show');
  hideError();
  dropZone.style.display = '';
  selectLevel('medium');
}

/* Helpers */
function updateProgress(pct, text) {
  progressBar.style.width = pct + '%';
  progressText.textContent = text;
}

function formatBytes(bytes) {
  if (bytes === 0) return '0 B';
  var k = 1024, sizes = ['B', 'KB', 'MB', 'GB'];
  var i = Math.floor(Math.log(bytes) / Math.log(k));
  return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
}

function showError(msg) {
  errorBox.textContent = msg;
  errorBox.classList.add('show');
}

function hideError() {
  errorBox.textContent = '';
  errorBox.classList.remove('show');
}

function showToast(msg) {
  var t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(function() { t.classList.remove('show'); }, 2000);
}

/* IntersectionObserver fade-in */
var observer = new IntersectionObserver(function(entries) {
  entries.forEach(function(entry) {
    if (entry.isIntersecting) { entry.target.classList.add('visible'); observer.unobserve(entry.target); }
  });
}, { threshold: 0.1 });
document.querySelectorAll('.fade-in').forEach(function(el) { observer.observe(el); });
</script>
<script src="/js/analytics-lite.js" defer></script>
<script src="/js/revenue.js" defer></script>
<script src="/js/lead-capture.js" defer></script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    {
      "@type": "Question",
      "name": "How does the PDF compressor work?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "NexTool's PDF compressor works entirely in your browser using pdf-lib. It removes metadata, flattens form fields, cleans the document structure, and re-encodes images at lower quality to reduce file size. Your files are never uploaded to any server."
      }
    },
    {
      "@type": "Question",
      "name": "Is it safe to compress PDFs online?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Yes, NexTool's PDF compressor is 100% client-side. Your PDF files are processed entirely in your browser and never leave your device. No data is uploaded to any server, making it completely private and secure."
      }
    },
    {
      "@type": "Question",
      "name": "What compression levels are available?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "There are three compression levels: Low (best quality, smaller file size reduction), Medium (balanced quality and size), and High (smallest file size, lower image quality). Choose based on your needs."
      }
    },
    {
      "@type": "Question",
      "name": "Is this PDF compressor free?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Yes, NexTool's PDF compressor is completely free with no signup, no upload limits, and no watermarks. It runs entirely in your browser for maximum privacy."
      }
    }
  ]
}
</script>
</body>
</html>