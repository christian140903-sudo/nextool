<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>XML Formatter &amp; Validator — Free Online Tool | NexTool</title>
<meta name="description" content="Format, beautify, validate, and minify XML online. Syntax highlighting, error detection with line numbers, custom indentation. Free, instant, no signup.">
<meta name="keywords" content="xml formatter, xml beautifier, xml validator, xml minifier, format xml, pretty print xml, free tool">
<meta name="robots" content="index, follow">
<link rel="canonical" href="https://nextool.app/free-tools/xml-formatter.html">
<meta property="og:type" content="website">
<meta property="og:url" content="https://nextool.app/free-tools/xml-formatter.html">
<meta property="og:title" content="XML Formatter & Validator — Free Online Tool | NexTool">
<meta property="og:description" content="Format, beautify, validate, and minify XML online. Syntax highlighting, custom indentation, error detection.">
<meta property="og:image" content="https://nextool.app/assets/og/xml-formatter.png">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="XML Formatter & Validator — Free Online Tool | NexTool">
<meta name="twitter:description" content="Format, beautify, validate, and minify XML online. Syntax highlighting, custom indentation, error detection.">
<meta name="twitter:image" content="https://nextool.app/assets/og/xml-formatter.png">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@type":"BreadcrumbList",
  "itemListElement":[
    {"@type":"ListItem","position":1,"name":"Home","item":"https://nextool.app/"},
    {"@type":"ListItem","position":2,"name":"Free Tools","item":"https://nextool.app/free-tools/"},
    {"@type":"ListItem","position":3,"name":"XML Formatter & Validator","item":"https://nextool.app/free-tools/xml-formatter.html"}
  ]
}
</script>
<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@type":"FAQPage",
  "mainEntity":[
    {
      "@type":"Question",
      "name":"How does the XML formatter work?",
      "acceptedAnswer":{"@type":"Answer","text":"The formatter parses your XML using the browser's built-in DOMParser, then reconstructs it with proper indentation. You can choose between 2 spaces, 4 spaces, or tab indentation. It preserves all content, attributes, CDATA sections, and comments."}
    },
    {
      "@type":"Question",
      "name":"What errors can the validator detect?",
      "acceptedAnswer":{"@type":"Answer","text":"The validator detects all well-formedness errors including unclosed tags, mismatched tags, invalid characters, malformed attributes, missing quotes, duplicate attributes, and invalid XML declarations. Error messages include the approximate line number."}
    },
    {
      "@type":"Question",
      "name":"What is the difference between formatting and minifying?",
      "acceptedAnswer":{"@type":"Answer","text":"Formatting (beautifying) adds proper indentation and line breaks to make XML human-readable. Minifying removes all unnecessary whitespace and line breaks to create the smallest possible file size, ideal for production use."}
    }
  ]
}
</script>
<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#050508;--surface:#111118;--surface2:#1a1a24;
  --primary:#6366f1;--accent:#a855f7;
  --text:#e2e8f0;--text2:#94a3b8;--text3:#64748b;
  --border:rgba(255,255,255,0.06);--border2:rgba(255,255,255,0.1);
  --radius:16px;--radius-sm:10px;
  --glow:0 0 20px rgba(99,102,241,0.15);
  --green:#22c55e;--red:#ef4444;--yellow:#eab308;
}
html{scroll-behavior:smooth}
body{font-family:'Inter',system-ui,-apple-system,sans-serif;background:var(--bg);color:var(--text);line-height:1.6;min-height:100vh;-webkit-font-smoothing:antialiased}
a{color:var(--primary);text-decoration:none;transition:color .2s}a:hover{color:var(--accent)}

nav{position:sticky;top:0;z-index:100;background:rgba(5,5,8,0.85);backdrop-filter:blur(20px);border-bottom:1px solid var(--border);padding:0 24px}
.nav-inner{max-width:1100px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;height:60px}
.nav-logo{font-size:20px;font-weight:800;background:linear-gradient(135deg,var(--primary),var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent;letter-spacing:-0.5px}
.nav-links{display:flex;gap:24px;align-items:center}
.nav-links a{color:var(--text2);font-size:14px;font-weight:500;transition:color .2s}
.nav-links a:hover{color:#fff}
.nav-badge{background:linear-gradient(135deg,var(--primary),var(--accent));color:#fff;font-size:11px;font-weight:700;padding:4px 10px;border-radius:20px}

.hero{text-align:center;padding:60px 24px 40px;max-width:750px;margin:0 auto}
.hero-badge{display:inline-block;background:rgba(99,102,241,0.1);border:1px solid rgba(99,102,241,0.2);color:var(--primary);font-size:12px;font-weight:600;padding:6px 16px;border-radius:20px;margin-bottom:16px;text-transform:uppercase;letter-spacing:1px}
.hero h1{font-size:clamp(28px,5vw,44px);font-weight:900;line-height:1.15;margin-bottom:12px;background:linear-gradient(135deg,#fff 40%,var(--text2));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.hero p{color:var(--text2);font-size:17px;max-width:560px;margin:0 auto}

.tool-wrap{max-width:1100px;margin:0 auto;padding:0 24px 40px}
.tool-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:28px;margin-bottom:20px}

.options-bar{display:flex;gap:16px;flex-wrap:wrap;margin-bottom:16px;align-items:center}
.option-group{display:flex;align-items:center;gap:8px}
.option-group label{font-size:13px;color:var(--text2);font-weight:500;white-space:nowrap}
select{background:var(--bg);border:1px solid var(--border2);color:var(--text);padding:8px 12px;border-radius:8px;font-size:13px;font-family:inherit;cursor:pointer}
select:focus{outline:none;border-color:var(--primary)}

.panels{display:grid;grid-template-columns:1fr 1fr;gap:20px}
@media(max-width:768px){.panels{grid-template-columns:1fr}}
.panel{display:flex;flex-direction:column}
.panel-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
.panel-label{font-size:13px;font-weight:600;color:var(--text2);text-transform:uppercase;letter-spacing:0.5px}
.panel-actions{display:flex;gap:6px}
.btn-sm{padding:6px 12px;font-size:12px;border-radius:6px;display:inline-flex;align-items:center;gap:4px;background:var(--surface2);color:var(--text);border:1px solid var(--border2);cursor:pointer;font-family:inherit;font-weight:600;transition:all .2s}
.btn-sm:hover{border-color:var(--primary);color:#fff}

textarea{width:100%;min-height:350px;background:var(--bg);border:1px solid var(--border2);border-radius:var(--radius-sm);padding:16px;color:var(--text);font-family:'Inter',monospace;font-size:13px;line-height:1.6;resize:vertical;transition:border-color .2s;tab-size:2;white-space:pre;overflow-wrap:normal;overflow-x:auto}
textarea:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 3px rgba(99,102,241,0.15)}
textarea::placeholder{color:var(--text3)}

.output-wrap{position:relative;width:100%;min-height:350px;max-height:600px;overflow:auto;background:var(--bg);border:1px solid var(--border2);border-radius:var(--radius-sm)}
.output-pre{padding:16px;margin:0;font-family:'Inter',monospace;font-size:13px;line-height:1.6;white-space:pre;overflow-wrap:normal;color:var(--text);min-height:350px}
.output-pre:empty::before{content:'Formatted XML will appear here...';color:var(--text3);white-space:normal}
.line-nums{position:absolute;left:0;top:0;padding:16px 8px 16px 12px;text-align:right;color:var(--text3);font-family:'Inter',monospace;font-size:13px;line-height:1.6;user-select:none;border-right:1px solid var(--border);min-width:40px;background:var(--bg)}

/* Syntax highlighting */
.xml-tag{color:#818cf8}
.xml-attr{color:#f59e0b}
.xml-val{color:#34d399}
.xml-comment{color:#64748b;font-style:italic}
.xml-cdata{color:#a78bfa}
.xml-pi{color:#f472b6}
.xml-text{color:var(--text)}

.btn-row{display:flex;gap:10px;flex-wrap:wrap;margin-top:16px}
.btn{display:inline-flex;align-items:center;gap:8px;padding:10px 20px;border-radius:var(--radius-sm);font-size:14px;font-weight:600;cursor:pointer;border:none;transition:all .2s;font-family:inherit}
.btn-primary{background:linear-gradient(135deg,var(--primary),var(--accent));color:#fff}
.btn-primary:hover{transform:translateY(-1px);box-shadow:0 4px 20px rgba(99,102,241,0.3)}
.btn-secondary{background:var(--surface2);color:var(--text);border:1px solid var(--border2)}
.btn-secondary:hover{border-color:var(--primary);color:#fff}
.btn-success{background:rgba(34,197,94,0.15);color:var(--green);border:1px solid rgba(34,197,94,0.25)}
.btn-success:hover{background:rgba(34,197,94,0.25)}

.validation-result{margin-top:12px;padding:14px 18px;border-radius:var(--radius-sm);font-size:14px;font-weight:600;display:none}
.validation-result.valid{display:block;background:rgba(34,197,94,0.08);border:1px solid rgba(34,197,94,0.2);color:var(--green)}
.validation-result.invalid{display:block;background:rgba(239,68,68,0.08);border:1px solid rgba(239,68,68,0.2);color:var(--red)}
.validation-result .err-detail{font-weight:400;font-size:13px;margin-top:6px;color:var(--text2);line-height:1.5}

.stats-bar{display:flex;gap:20px;padding:12px 0;border-top:1px solid var(--border);margin-top:12px;flex-wrap:wrap}
.stat{font-size:12px;color:var(--text3)}.stat span{color:var(--primary);font-weight:700}

.toast{position:fixed;bottom:24px;left:50%;transform:translateX(-50%) translateY(100px);background:var(--surface2);color:#fff;padding:12px 24px;border-radius:var(--radius-sm);font-size:14px;font-weight:600;border:1px solid var(--border2);z-index:999;transition:transform .3s cubic-bezier(.4,0,.2,1);pointer-events:none}
.toast.show{transform:translateX(-50%) translateY(0)}

footer{border-top:1px solid var(--border);padding:40px 24px;text-align:center;margin-top:40px}
.footer-links{display:flex;gap:24px;justify-content:center;flex-wrap:wrap;margin-bottom:16px}
.footer-links a{color:var(--text3);font-size:14px;font-weight:500}.footer-links a:hover{color:var(--primary)}
.footer-copy{color:var(--text3);font-size:13px}

@media(max-width:640px){
  .nav-links a:not(.nav-badge){display:none}
  .hero{padding:40px 20px 28px}
  .tool-card{padding:20px}
  .btn-row{flex-direction:column}.btn{justify-content:center}
  .options-bar{flex-direction:column;gap:10px}
}
</style>
</head>
<body>

<nav>
  <div class="nav-inner">
    <a href="/" class="nav-logo">NexTool</a>
    <div class="nav-links">
      <a href="/free-tools/">Free Tools</a>
      <a href="/pro.html">Pro</a>
      <a href="/blog/">Blog</a>
      <a href="/pro.html" class="nav-badge">Get Pro</a>
    </div>
  </div>
</nav>

<section class="hero">
  <div class="hero-badge">Free Tool</div>
  <h1>XML Formatter &amp; Validator</h1>
  <p>Format, beautify, validate, and minify XML with syntax highlighting and error detection. Paste your XML and get instant results.</p>
</section>

<div class="tool-wrap">
  <div class="tool-card">

    <!-- OPTIONS -->
    <div class="options-bar">
      <div class="option-group">
        <label for="indentType">Indent:</label>
        <select id="indentType">
          <option value="2">2 Spaces</option>
          <option value="4">4 Spaces</option>
          <option value="tab">Tab</option>
        </select>
      </div>
      <div class="option-group">
        <label><input type="checkbox" id="preserveComments" checked style="accent-color:var(--primary)"> Preserve comments</label>
      </div>
      <div class="option-group">
        <label><input type="checkbox" id="sortAttributes" style="accent-color:var(--primary)"> Sort attributes</label>
      </div>
    </div>

    <!-- PANELS -->
    <div class="panels">
      <div class="panel">
        <div class="panel-header">
          <span class="panel-label">XML Input</span>
          <div class="panel-actions">
            <button class="btn-sm" onclick="loadSample()">Sample</button>
            <button class="btn-sm" onclick="clearAll()">Clear</button>
          </div>
        </div>
        <textarea id="inputArea" placeholder="Paste your XML here..." spellcheck="false"></textarea>
      </div>
      <div class="panel">
        <div class="panel-header">
          <span class="panel-label" id="outputLabel">Formatted Output</span>
          <div class="panel-actions">
            <button class="btn-sm" onclick="copyOutput()">Copy</button>
            <button class="btn-sm" onclick="downloadOutput()">Download</button>
          </div>
        </div>
        <div class="output-wrap" id="outputWrap">
          <pre class="output-pre" id="outputArea"></pre>
        </div>
      </div>
    </div>

    <!-- BUTTONS -->
    <div class="btn-row">
      <button class="btn btn-primary" onclick="formatXML()">
        <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M4 6h16M4 12h16M4 18h16"/></svg>
        Format / Beautify
      </button>
      <button class="btn btn-secondary" onclick="minifyXML()">
        <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M4 12h16"/></svg>
        Minify
      </button>
      <button class="btn btn-success" onclick="validateOnly()">
        <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
        Validate
      </button>
    </div>

    <!-- VALIDATION RESULT -->
    <div class="validation-result" id="validationResult"></div>

    <!-- STATS -->
    <div class="stats-bar">
      <div class="stat">Lines: <span id="statLines">0</span></div>
      <div class="stat">Elements: <span id="statElements">0</span></div>
      <div class="stat">Attributes: <span id="statAttrs">0</span></div>
      <div class="stat">Size: <span id="statSize">0 B</span></div>
    </div>
  </div>
</div>

<!-- BUNDLE PROMO -->
<section style="max-width:900px;margin:40px auto;padding:0 24px;">
<div style="background:linear-gradient(135deg,rgba(99,102,241,0.1),rgba(168,85,247,0.08));border:1px solid rgba(99,102,241,0.15);border-radius:20px;padding:32px 28px;text-align:center;">
<div style="font-size:13px;color:#818cf8;font-weight:600;text-transform:uppercase;letter-spacing:1px;margin-bottom:8px;">Founding Member</div>
<h3 style="font-size:22px;font-weight:800;color:#fff;margin:0 0 8px;">Get NexTool Pro</h3>
<p style="color:#94a3b8;font-size:14px;margin:0 auto 20px;max-width:500px;">No banners, clean output, enhanced features on all 245+ tools. One-time payment.</p>
<a href="/pro.html" style="display:inline-block;padding:12px 28px;background:linear-gradient(135deg,#6366f1,#a855f7);color:#fff;text-decoration:none;border-radius:12px;font-weight:700;font-size:15px;">$29 — Get Pro</a>
<a href="/free-tools/" style="display:inline-block;margin-left:12px;color:#818cf8;text-decoration:none;font-size:14px;">Browse 245+ Free Tools &rarr;</a>
</div>
</section>


<!-- AUTO-LINKED by NexTool Engine -->
<div style="margin:2rem 0;padding:1.5rem;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius)">
<p style="font-weight:600;margin-bottom:.5rem">Related Tools</p>
<p><a href="/free-tools/box-shadow-generator.html" style="color:var(--primary);text-decoration:none">CSS Box Shadow Generator</a> · <a href="/free-tools/emoji-picker.html" style="color:var(--primary);text-decoration:none">Emoji Picker & Search</a> · <a href="/free-tools/meta-tag-generator.html" style="color:var(--primary);text-decoration:none">Meta Tag Generator</a> · <a href="/free-tools/favicon-generator.html" style="color:var(--primary);text-decoration:none">Favicon Generator</a> · <a href="/free-tools/base64.html" style="color:var(--primary);text-decoration:none">Free Base64 Encoder/Decoder</a></p>
</div>

<!-- AUTO-LINKED by NexTool Engine -->
<div style="margin:2rem 0;padding:1.5rem;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius)">
<p style="font-weight:600;margin-bottom:.5rem">Related Tools</p>
<p><a href="/free-tools/xml-validator.html" style="color:var(--primary);text-decoration:none">Free XML Validator &amp; Formatter</a> · <a href="/free-tools/icon-generator.html" style="color:var(--primary);text-decoration:none">Free Icon Generator</a> · <a href="/free-tools/git-diff-viewer.html" style="color:var(--primary);text-decoration:none">Free Git Diff Viewer</a></p>
</div>

<!-- AUTO-LINKED by NexTool Engine -->
<div style="margin:2rem 0;padding:1.5rem;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius)">
<p style="font-weight:600;margin-bottom:.5rem">Related Tools</p>
<p><a href="/free-tools/json-to-yaml-converter.html" style="color:var(--primary);text-decoration:none">Free JSON to YAML Converter</a> · <a href="/free-tools/accessibility-checker.html" style="color:var(--primary);text-decoration:none">Free Accessibility Checker</a> · <a href="/free-tools/api-request-builder.html" style="color:var(--primary);text-decoration:none">Free API Request Builder</a></p>
</div>
<footer>
  <div class="footer-links">
    <a href="/">Home</a>
    <a href="/free-tools/">Free Tools</a>
    <a href="/pro.html">Pro</a>
    <a href="/blog/">Blog</a>
  </div>
  <p class="footer-copy">&copy; 2026 NexTool. All rights reserved.</p>
</footer>

<div class="toast" id="toast"></div>

<script>
// ── Get indent string ──
function getIndent() {
  const val = document.getElementById('indentType').value;
  return val === 'tab' ? '\t' : ' '.repeat(Number(val));
}

// ── Parse & validate XML ──
function parseXML(text) {
  const parser = new DOMParser();
  const doc = parser.parseFromString(text, 'application/xml');
  const parseError = doc.querySelector('parsererror');
  if (parseError) {
    let errMsg = parseError.textContent || 'Unknown XML parsing error';
    // Try to extract line number
    const lineMatch = errMsg.match(/line\s+(\d+)/i);
    const colMatch = errMsg.match(/column\s+(\d+)/i);
    return { doc: null, error: errMsg.trim(), line: lineMatch ? parseInt(lineMatch[1]) : null, col: colMatch ? parseInt(colMatch[1]) : null };
  }
  return { doc, error: null };
}

// ── Format XML node to string with indentation ──
function serializeNode(node, indent, level, preserveComments, sortAttrs) {
  const pad = indent.repeat(level);
  let result = '';

  switch (node.nodeType) {
    case Node.DOCUMENT_NODE:
      // Process children
      for (const child of node.childNodes) {
        result += serializeNode(child, indent, level, preserveComments, sortAttrs);
      }
      break;

    case Node.PROCESSING_INSTRUCTION_NODE:
      result += pad + '<?' + node.target;
      if (node.data) result += ' ' + node.data;
      result += '?>\n';
      break;

    case Node.ELEMENT_NODE:
      result += pad + '<' + node.tagName;
      // Attributes
      let attrs = [];
      for (let i = 0; i < node.attributes.length; i++) {
        attrs.push(node.attributes[i]);
      }
      if (sortAttrs) attrs.sort((a, b) => a.name.localeCompare(b.name));
      for (const attr of attrs) {
        result += ' ' + attr.name + '="' + escapeAttr(attr.value) + '"';
      }
      // Self-closing or children
      const children = [];
      for (const child of node.childNodes) {
        if (child.nodeType === Node.COMMENT_NODE && !preserveComments) continue;
        children.push(child);
      }
      if (children.length === 0) {
        result += '/>\n';
      } else if (children.length === 1 && children[0].nodeType === Node.TEXT_NODE && !children[0].textContent.includes('\n')) {
        // Inline text
        result += '>' + escapeXML(children[0].textContent.trim()) + '</' + node.tagName + '>\n';
      } else {
        result += '>\n';
        for (const child of children) {
          result += serializeNode(child, indent, level + 1, preserveComments, sortAttrs);
        }
        result += pad + '</' + node.tagName + '>\n';
      }
      break;

    case Node.TEXT_NODE:
      const trimmed = node.textContent.trim();
      if (trimmed) {
        result += pad + escapeXML(trimmed) + '\n';
      }
      break;

    case Node.COMMENT_NODE:
      if (preserveComments) {
        result += pad + '<!--' + node.textContent + '-->\n';
      }
      break;

    case Node.CDATA_SECTION_NODE:
      result += pad + '<![CDATA[' + node.textContent + ']]>\n';
      break;
  }
  return result;
}

function escapeXML(text) {
  return text.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}
function escapeAttr(text) {
  return text.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

// ── Syntax highlight XML string ──
function highlightXML(xml) {
  let html = xml
    .replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;');

  // Processing instructions
  html = html.replace(/(&lt;\?[\s\S]*?\?&gt;)/g, '<span class="xml-pi">$1</span>');
  // Comments
  html = html.replace(/(&lt;!--[\s\S]*?--&gt;)/g, '<span class="xml-comment">$1</span>');
  // CDATA
  html = html.replace(/(&lt;!\[CDATA\[[\s\S]*?\]\]&gt;)/g, '<span class="xml-cdata">$1</span>');
  // Tags and attributes
  html = html.replace(/(&lt;\/?)([\w:.-]+)((?:\s+[\w:.-]+\s*=\s*&quot;[^&]*&quot;)*\s*\/?&gt;)/g, function(match, open, tag, rest) {
    // Highlight attributes within rest
    const attrHighlighted = rest.replace(/([\w:.-]+)(\s*=\s*)(&quot;)([^&]*)(&quot;)/g,
      '<span class="xml-attr">$1</span>$2<span class="xml-val">$3$4$5</span>');
    return '<span class="xml-tag">' + open + tag + '</span>' + attrHighlighted;
  });
  // Self-closing and closing tags that might have been missed
  html = html.replace(/(&lt;\/)([\w:.-]+)(&gt;)/g, '<span class="xml-tag">$1$2$3</span>');

  return html;
}

// ── Format ──
function formatXML() {
  const input = document.getElementById('inputArea').value.trim();
  if (!input) return showValidation('invalid', 'Please enter XML to format.');

  const { doc, error, line } = parseXML(input);
  if (error) {
    showValidation('invalid', 'XML Parsing Error' + (line ? ' (line ~' + line + ')' : ''), error);
    return;
  }

  const indent = getIndent();
  const preserveComments = document.getElementById('preserveComments').checked;
  const sortAttrs = document.getElementById('sortAttributes').checked;

  // Check for XML declaration
  let xmlDecl = '';
  const declMatch = input.match(/^<\?xml[^?]*\?>/);
  if (declMatch) {
    xmlDecl = declMatch[0] + '\n';
  }

  let formatted = '';
  for (const child of doc.childNodes) {
    formatted += serializeNode(child, indent, 0, preserveComments, sortAttrs);
  }

  // If there was an XML declaration, prepend it
  if (xmlDecl && !formatted.startsWith('<?xml')) {
    formatted = xmlDecl + formatted;
  }

  formatted = formatted.trimEnd() + '\n';

  const outputEl = document.getElementById('outputArea');
  outputEl.innerHTML = highlightXML(formatted);
  outputEl.dataset.raw = formatted;

  showValidation('valid', 'Valid XML');
  updateStats(formatted, doc);
}

// ── Minify ──
function minifyXML() {
  const input = document.getElementById('inputArea').value.trim();
  if (!input) return showValidation('invalid', 'Please enter XML to minify.');

  const { doc, error, line } = parseXML(input);
  if (error) {
    showValidation('invalid', 'XML Parsing Error' + (line ? ' (line ~' + line + ')' : ''), error);
    return;
  }

  // Serialize to string, then remove whitespace between tags
  const serializer = new XMLSerializer();
  let minified = serializer.serializeToString(doc);
  minified = minified.replace(/>\s+</g, '><').trim();

  const outputEl = document.getElementById('outputArea');
  outputEl.innerHTML = highlightXML(minified);
  outputEl.dataset.raw = minified;

  showValidation('valid', 'Valid XML — Minified');
  updateStats(minified, doc);
}

// ── Validate only ──
function validateOnly() {
  const input = document.getElementById('inputArea').value.trim();
  if (!input) return showValidation('invalid', 'Please enter XML to validate.');

  const { doc, error, line } = parseXML(input);
  if (error) {
    showValidation('invalid', 'Invalid XML' + (line ? ' (line ~' + line + ')' : ''), error);
  } else {
    showValidation('valid', 'XML is well-formed and valid');
    updateStats(input, doc);
  }
}

// ── Show validation result ──
function showValidation(type, title, detail) {
  const el = document.getElementById('validationResult');
  el.className = 'validation-result ' + type;
  let icon = type === 'valid' ? '&#10004; ' : '&#10006; ';
  el.innerHTML = icon + title + (detail ? '<div class="err-detail">' + escapeHTML(detail) + '</div>' : '');
}

function escapeHTML(s) { return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

// ── Update stats ──
function updateStats(xml, doc) {
  const lines = xml.split('\n').length;
  let elements = 0, attributes = 0;
  if (doc) {
    const walk = (node) => {
      if (node.nodeType === Node.ELEMENT_NODE) {
        elements++;
        attributes += node.attributes.length;
      }
      for (const child of node.childNodes) walk(child);
    };
    walk(doc);
  }
  document.getElementById('statLines').textContent = lines;
  document.getElementById('statElements').textContent = elements;
  document.getElementById('statAttrs').textContent = attributes;
  document.getElementById('statSize').textContent = formatSize(new Blob([xml]).size);
}

function formatSize(bytes) {
  if (bytes < 1024) return bytes + ' B';
  if (bytes < 1048576) return (bytes / 1024).toFixed(1) + ' KB';
  return (bytes / 1048576).toFixed(1) + ' MB';
}

// ── Copy / Download / Clear ──
function copyOutput() {
  const raw = document.getElementById('outputArea').dataset.raw || document.getElementById('outputArea').textContent;
  if (!raw) return showToast('Nothing to copy');
  navigator.clipboard.writeText(raw).then(() => showToast('Copied to clipboard!'));
}

function downloadOutput() {
  const raw = document.getElementById('outputArea').dataset.raw || document.getElementById('outputArea').textContent;
  if (!raw) return showToast('Nothing to download');
  const blob = new Blob([raw], { type: 'application/xml' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'formatted.xml'; a.click();
  URL.revokeObjectURL(url);
  showToast('Download started!');
}

function clearAll() {
  document.getElementById('inputArea').value = '';
  document.getElementById('outputArea').innerHTML = '';
  document.getElementById('outputArea').dataset.raw = '';
  document.getElementById('validationResult').className = 'validation-result';
  document.getElementById('validationResult').innerHTML = '';
  ['statLines','statElements','statAttrs'].forEach(id => document.getElementById(id).textContent = '0');
  document.getElementById('statSize').textContent = '0 B';
}

function loadSample() {
  document.getElementById('inputArea').value =
`<?xml version="1.0" encoding="UTF-8"?>
<catalog>
  <!-- Book collection -->
  <book id="bk101" category="fiction">
    <author>Gambardella, Matthew</author>
    <title>XML Developer's Guide</title>
    <genre>Computer</genre>
    <price>44.95</price>
    <publish_date>2000-10-01</publish_date>
    <description>An in-depth look at creating applications with XML.</description>
  </book>
  <book id="bk102" category="fiction">
    <author>Ralls, Kim</author>
    <title>Midnight Rain</title>
    <genre>Fantasy</genre>
    <price>5.95</price>
    <publish_date>2000-12-16</publish_date>
    <description>A former architect battles corporate zombies, an evil sorceress, and her own childhood to become queen of the world.</description>
  </book>
  <book id="bk103" category="non-fiction">
    <author>Corets, Eva</author>
    <title>Maeve Ascendant</title>
    <genre>Fantasy</genre>
    <price>5.95</price>
    <publish_date>2000-11-17</publish_date>
    <description><![CDATA[After the collapse of a <nanotechnology> society, young Maeve must restore order.]]></description>
  </book>
</catalog>`;
  formatXML();
}

function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg; t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2000);
}
</script>

<script defer src="/js/revenue.js"></script>
<script defer src="/js/lead-capture.js"></script>
<script defer src="/js/analytics-lite.js"></script>
</body>
</html>
