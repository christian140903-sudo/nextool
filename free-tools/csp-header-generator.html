<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Free CSP Header Generator — Content Security Policy Builder | NexTool</title>
<meta name="description" content="Free online CSP header generator. Build Content Security Policy headers visually with presets for Strict, WordPress, React SPA. Export as HTTP header, meta tag, Nginx, Apache, Express.js.">
<meta name="keywords" content="csp header generator, content security policy generator, csp builder online, csp policy generator, security headers, web security tool, NexTool">
<meta property="og:title" content="Free CSP Header Generator | NexTool">
<meta property="og:description" content="Build Content Security Policy headers visually. Presets, validation, export to Nginx, Apache, Express.js. 100% free.">
<meta property="og:type" content="website">
<meta property="og:url" content="https://nextool.app/free-tools/csp-header-generator.html">
<meta property="og:image" content="https://nextool.app/assets/og-default.png">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<link rel="canonical" href="https://nextool.app/free-tools/csp-header-generator.html">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Free CSP Header Generator | NexTool">
<meta name="twitter:description" content="Build Content Security Policy headers visually. Free online tool by NexTool.">
<meta name="robots" content="index, follow">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"SoftwareApplication","name":"NexTool CSP Header Generator","applicationCategory":"DeveloperApplication","operatingSystem":"Web","offers":{"@type":"Offer","price":"0","priceCurrency":"USD"},"description":"Free online Content Security Policy header generator with visual builder, presets, and multi-format export."}
</script>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{--bg:#050508;--surface:#111118;--surface2:#1a1a24;--border:#2a2a3a;--text:#e4e4eb;--text2:#9494a8;--primary:#6366f1;--accent:#a855f7;--pink:#ec4899;--green:#22c55e;--red:#ef4444;--cyan:#22d3ee;--yellow:#eab308;--orange:#f97316;--radius:12px;--glass:rgba(17,17,24,0.7)}
html{scroll-behavior:smooth}
body{font-family:'Inter',system-ui,sans-serif;background:var(--bg);color:var(--text);line-height:1.6;min-height:100vh;overflow-x:hidden}
/* NAV */
.nav{position:sticky;top:0;z-index:100;background:rgba(5,5,8,0.85);backdrop-filter:blur(20px);border-bottom:1px solid var(--border);padding:0 2rem;height:64px;display:flex;align-items:center;justify-content:space-between}
.nav-logo{font-size:1.4rem;font-weight:800;background:linear-gradient(135deg,var(--primary),var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent;text-decoration:none}
.nav-links{display:flex;align-items:center;gap:1.5rem}
.nav-links a{color:var(--text2);text-decoration:none;font-size:.875rem;font-weight:500;transition:color .2s}
.nav-links a:hover{color:var(--text)}
.nav-cta{background:linear-gradient(135deg,var(--primary),var(--accent));color:#fff!important;padding:.5rem 1.2rem;border-radius:8px;font-weight:600;-webkit-text-fill-color:#fff!important}
.nav-cta:hover{opacity:.9}
.nav-toggle{display:none;background:none;border:none;color:var(--text);font-size:1.5rem;cursor:pointer}
/* HERO */
.hero{text-align:center;padding:3rem 1.5rem 2rem;max-width:700px;margin:0 auto}
.hero h1{font-size:2.2rem;font-weight:800;line-height:1.2;margin-bottom:.75rem}
.hero h1 span{background:linear-gradient(135deg,var(--primary),var(--accent),var(--pink));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.hero p{color:var(--text2);font-size:1rem}
/* TOOL */
.tool-container{max-width:1100px;margin:0 auto;padding:0 1.5rem 3rem}
.toolbar{display:flex;flex-wrap:wrap;gap:.5rem;margin-bottom:1rem;align-items:center}
.toolbar button,.toolbar select{background:var(--surface2);border:1px solid var(--border);color:var(--text);padding:.45rem .9rem;border-radius:8px;font-size:.8rem;font-weight:500;cursor:pointer;transition:all .2s;font-family:inherit}
.toolbar button:hover{border-color:var(--primary);background:rgba(99,102,241,.12)}
.toolbar button.active{background:linear-gradient(135deg,var(--primary),var(--accent));border-color:transparent;color:#fff}
.toolbar select{appearance:none;padding-right:1.8rem;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%239494a8' viewBox='0 0 16 16'%3E%3Cpath d='M8 11L3 6h10z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right .6rem center}
/* DIRECTIVES */
.directives-grid{display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin-bottom:1.5rem}
.directive-card{background:var(--glass);backdrop-filter:blur(16px);border:1px solid var(--border);border-radius:var(--radius);padding:1rem;transition:border-color .2s}
.directive-card.active-directive{border-color:rgba(99,102,241,.4)}
.directive-card.has-warning{border-color:rgba(234,179,8,.3)}
.directive-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:.6rem}
.directive-name{font-size:.85rem;font-weight:700;color:var(--primary);font-family:'Courier New',monospace}
.directive-toggle{position:relative;width:36px;height:20px;cursor:pointer}
.directive-toggle input{opacity:0;width:0;height:0}
.directive-toggle .slider{position:absolute;top:0;left:0;right:0;bottom:0;background:var(--surface2);border:1px solid var(--border);border-radius:10px;transition:.2s}
.directive-toggle .slider::before{content:'';position:absolute;width:14px;height:14px;left:2px;bottom:2px;background:var(--text2);border-radius:50%;transition:.2s}
.directive-toggle input:checked+.slider{background:var(--primary);border-color:var(--primary)}
.directive-toggle input:checked+.slider::before{transform:translateX(16px);background:#fff}
.source-chips{display:flex;flex-wrap:wrap;gap:4px;margin-bottom:.5rem}
.source-chip{display:inline-flex;align-items:center;gap:2px;padding:3px 8px;background:var(--surface2);border:1px solid var(--border);border-radius:6px;font-size:.7rem;font-weight:500;cursor:pointer;transition:all .15s;user-select:none;color:var(--text2)}
.source-chip:hover{border-color:var(--primary)}
.source-chip.selected{background:rgba(99,102,241,.15);border-color:var(--primary);color:var(--text)}
.source-chip.warn{background:rgba(234,179,8,.1);border-color:var(--yellow);color:var(--yellow)}
.source-chip.warn.selected{background:rgba(234,179,8,.2)}
.custom-input{width:100%;background:var(--surface2);border:1px solid var(--border);border-radius:6px;padding:5px 8px;font-size:.75rem;color:var(--text);font-family:inherit;outline:none;transition:border-color .2s}
.custom-input:focus{border-color:var(--primary)}
.custom-input::placeholder{color:var(--text2);opacity:.5}
/* OUTPUT */
.output-section{margin-top:1.5rem}
.output-tabs{display:flex;gap:4px;margin-bottom:.5rem;flex-wrap:wrap}
.output-tab{background:var(--surface2);border:1px solid var(--border);color:var(--text2);padding:6px 12px;border-radius:8px 8px 0 0;font-size:.75rem;font-weight:600;cursor:pointer;transition:all .2s;font-family:inherit}
.output-tab:hover{color:var(--text);border-color:var(--primary)}
.output-tab.active{background:var(--primary);border-color:var(--primary);color:#fff}
.output-panel{background:var(--glass);backdrop-filter:blur(16px);border:1px solid var(--border);border-radius:0 var(--radius) var(--radius) var(--radius);padding:1rem;position:relative;min-height:120px}
.output-code{font-family:'Courier New',monospace;font-size:.8rem;line-height:1.7;white-space:pre-wrap;word-break:break-all;color:var(--text)}
.copy-btn{position:absolute;top:.6rem;right:.6rem;background:var(--surface2);border:1px solid var(--border);color:var(--text2);padding:5px 12px;border-radius:6px;font-size:.7rem;font-weight:600;cursor:pointer;transition:all .2s;font-family:inherit}
.copy-btn:hover{border-color:var(--primary);color:var(--text)}
/* WARNINGS */
.warnings{margin-top:1rem}
.warning-item{display:flex;align-items:flex-start;gap:.5rem;padding:.6rem .8rem;background:rgba(234,179,8,.06);border:1px solid rgba(234,179,8,.15);border-radius:8px;font-size:.78rem;color:var(--yellow);margin-bottom:.4rem}
.warning-item .wi{flex-shrink:0;font-size:1rem;line-height:1}
.warning-text{line-height:1.4}
.info-item{display:flex;align-items:flex-start;gap:.5rem;padding:.6rem .8rem;background:rgba(34,211,238,.06);border:1px solid rgba(34,211,238,.15);border-radius:8px;font-size:.78rem;color:var(--cyan);margin-bottom:.4rem}
/* CTA */
.cta-section{text-align:center;padding:4rem 1.5rem;max-width:700px;margin:0 auto}
.cta-section h2{font-size:1.8rem;font-weight:800;margin-bottom:.75rem}
.cta-section h2 span{background:linear-gradient(135deg,var(--primary),var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.cta-section p{color:var(--text2);margin-bottom:1.5rem}
.cta-btn{display:inline-block;background:linear-gradient(135deg,var(--primary),var(--accent));color:#fff;padding:.75rem 2rem;border-radius:10px;font-weight:700;text-decoration:none;font-size:1rem;transition:transform .2s,box-shadow .2s}
.cta-btn:hover{transform:translateY(-2px);box-shadow:0 8px 30px rgba(99,102,241,.3)}
/* FOOTER */
.footer{border-top:1px solid var(--border);padding:3rem 2rem 2rem;max-width:1200px;margin:0 auto}
.footer-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:2rem;margin-bottom:2rem}
.footer-col h4{font-size:.85rem;font-weight:700;margin-bottom:.75rem;color:var(--text)}
.footer-col a{display:block;color:var(--text2);text-decoration:none;font-size:.8rem;margin-bottom:.4rem;transition:color .2s}
.footer-col a:hover{color:var(--primary)}
.footer-bottom{text-align:center;color:var(--text2);font-size:.75rem;padding-top:1.5rem;border-top:1px solid var(--border)}
/* FADE IN */
.fade-in{opacity:0;transform:translateY(20px);transition:opacity .6s,transform .6s}
.fade-in.visible{opacity:1;transform:translateY(0)}
/* TOAST */
.toast{position:fixed;bottom:2rem;left:50%;transform:translateX(-50%) translateY(80px);background:var(--surface2);border:1px solid var(--border);color:var(--text);padding:.6rem 1.2rem;border-radius:10px;font-size:.85rem;font-weight:500;z-index:200;transition:transform .3s;pointer-events:none}
.toast.show{transform:translateX(-50%) translateY(0)}
/* RESPONSIVE */
@media(max-width:768px){
  .directives-grid{grid-template-columns:1fr}
  .nav-links{display:none;position:absolute;top:64px;left:0;right:0;background:var(--bg);border-bottom:1px solid var(--border);flex-direction:column;padding:1rem 2rem;gap:1rem}
  .nav-links.open{display:flex}
  .nav-toggle{display:block}
  .hero h1{font-size:1.6rem}
  .footer-grid{grid-template-columns:1fr}
  .toolbar{gap:.35rem}
}
</style>
</head>
<body>

<nav class="nav">
  <a href="/" class="nav-logo">NexTool</a>
  <button class="nav-toggle" onclick="document.querySelector('.nav-links').classList.toggle('open')" aria-label="Menu">&#9776;</button>
  <div class="nav-links">
    <a href="/">Home</a>
    <a href="/free-tools/">Tools</a>
    <a href="/free-tools/">Free Tools</a>
    <a href="/blog/">Blog</a>
    <a href="/pro.html" class="nav-cta">Get Pro — $29</a>
  </div>
</nav>

<section class="hero fade-in">
  <h1>Free <span>CSP Header Generator</span></h1>
  <p class="tool-summary" style="color:#94a3b8;font-size:15px;line-height:1.6;margin-bottom:24px;max-width:700px;margin-left:auto;margin-right:auto;">Build Content Security Policy headers visually. Toggle directives, pick common sources, add custom domains, and export as HTTP header, HTML meta tag, Nginx, Apache, or Express.js config. Includes presets for Strict, Moderate, Relaxed, WordPress, React SPA, and Static Site policies.</p>
</section>

<div class="tool-container fade-in">
  <div class="toolbar">
    <label style="font-size:.8rem;font-weight:600;color:var(--text2);margin-right:.25rem">Presets:</label>
    <button onclick="applyPreset('strict')">Strict</button>
    <button onclick="applyPreset('moderate')">Moderate</button>
    <button onclick="applyPreset('relaxed')">Relaxed</button>
    <button onclick="applyPreset('wordpress')">WordPress</button>
    <button onclick="applyPreset('react')">React SPA</button>
    <button onclick="applyPreset('static')">Static Site</button>
    <button onclick="resetAll()" style="margin-left:auto">Reset All</button>
  </div>

  <div class="directives-grid" id="directivesGrid"></div>

  <div class="warnings" id="warnings"></div>

  <div class="output-section">
    <div class="output-tabs" id="outputTabs">
      <button class="output-tab active" data-fmt="raw" onclick="switchTab('raw',this)">Raw Header</button>
      <button class="output-tab" data-fmt="formatted" onclick="switchTab('formatted',this)">Formatted</button>
      <button class="output-tab" data-fmt="meta" onclick="switchTab('meta',this)">Meta Tag</button>
      <button class="output-tab" data-fmt="nginx" onclick="switchTab('nginx',this)">Nginx</button>
      <button class="output-tab" data-fmt="apache" onclick="switchTab('apache',this)">Apache</button>
      <button class="output-tab" data-fmt="express" onclick="switchTab('express',this)">Express.js</button>
    </div>
    <div class="output-panel">
      <button class="copy-btn" onclick="copyOutput()">Copy</button>
      <div class="output-code" id="outputCode">Enable directives above to generate your CSP header.</div>
    </div>
  </div>
</div>

<section class="cta-section fade-in">
  <h2>Need something <span>more powerful</span>?</h2>
  <p>Let us build it for you. Custom APIs, dashboards, automations &mdash; whatever you need.</p>
  <a href="/#contact" class="cta-btn">Start a Project &rarr;</a>
</section>

<!-- Cross Promo -->
<section style="max-width:900px;margin:40px auto;padding:0 24px;">
<div style="background:linear-gradient(135deg,rgba(99,102,241,0.1),rgba(168,85,247,0.08));border:1px solid rgba(99,102,241,0.15);border-radius:20px;padding:32px 28px;text-align:center;">
<div style="font-size:13px;color:#818cf8;font-weight:600;text-transform:uppercase;letter-spacing:1px;margin-bottom:8px;">Founding Member</div>
<h3 style="font-size:22px;font-weight:800;color:#fff;margin:0 0 8px;">Get NexTool Pro</h3>
<p style="color:#94a3b8;font-size:14px;margin:0 auto 20px;max-width:500px;">No banners, clean output, enhanced features on all 250+ tools. One-time payment.</p>
<div style="display:flex;align-items:center;justify-content:center;gap:12px;flex-wrap:wrap;">
<a href="/pro.html" style="display:inline-block;padding:12px 28px;background:linear-gradient(135deg,#6366f1,#a855f7,#ec4899);color:#fff;border-radius:10px;font-weight:700;font-size:15px;text-decoration:none;">$29 — Get Pro</a>
<a href="/free-tools/" style="color:#94a3b8;font-size:14px;text-decoration:none;">Browse 250+ Free Tools &rarr;</a>
</div>
</div>
</section>


<!-- AUTO-LINKED by NexTool Engine -->
<div style="margin:2rem 0;padding:1.5rem;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius)">
<p style="font-weight:600;margin-bottom:.5rem">Related Tools</p>
<p><a href="/free-tools/box-shadow-generator.html" style="color:var(--primary);text-decoration:none">CSS Box Shadow Generator</a> · <a href="/free-tools/emoji-picker.html" style="color:var(--primary);text-decoration:none">Emoji Picker & Search</a> · <a href="/free-tools/meta-tag-generator.html" style="color:var(--primary);text-decoration:none">Meta Tag Generator</a></p>
</div>

<!-- AUTO-LINKED by NexTool Engine -->
<div style="margin:2rem 0;padding:1.5rem;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius)">
<p style="font-weight:600;margin-bottom:.5rem">Related Tools</p>
<p><a href="/free-tools/htaccess-generator.html" style="color:var(--primary);text-decoration:none">Free .htaccess Generator</a> · <a href="/free-tools/http-header-analyzer.html" style="color:var(--primary);text-decoration:none">Free HTTP Header Analyzer</a> · <a href="/free-tools/json-to-yaml-converter.html" style="color:var(--primary);text-decoration:none">Free JSON to YAML Converter</a></p>
</div>

<!-- AUTO-LINKED by NexTool Engine -->
<div style="margin:2rem 0;padding:1.5rem;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius)">
<p style="font-weight:600;margin-bottom:.5rem">Related Tools</p>
<p><a href="/free-tools/json-to-yaml.html" style="color:var(--primary);text-decoration:none">Free JSON to YAML Converter</a> · <a href="/free-tools/yaml-to-json.html" style="color:var(--primary);text-decoration:none">YAML to JSON Converter</a> · <a href="/free-tools/accessibility-checker.html" style="color:var(--primary);text-decoration:none">Free Accessibility Checker</a></p>
</div>
<footer class="footer fade-in">
  <div class="footer-grid">
    <div class="footer-col">
      <h4>Products</h4>
      <a href="/free-tools/">250+ Free Tools</a>
<a href="/pro.html">NexTool Pro</a>
<a href="/workspace.html">Workspace</a>
    </div>
    <div class="footer-col">
      <h4>Explore</h4>
      <a href="/free-tools/">Free Tools</a><a href="/blog/">Blog</a><a href="/pro.html">FAQ</a><a href="/pro.html">Pro — $29</a>
    </div>
    <div class="footer-col">
      <h4>Ecosystem</h4>
      <a href="/">NexTool Home</a><a href="/#contact">Contact</a><a href="https://github.com/christian140903-sudo/nextool" target="_blank">GitHub</a>
    </div>
  </div>
  <div class="footer-bottom">&copy; 2026 NexTool. AI-powered tools for everyone.</div>
</footer>

<div class="toast" id="toast"></div>

<script>
/* ===== DIRECTIVE DEFINITIONS ===== */
const DIRECTIVES = [
  { id:'default-src', label:'default-src', desc:'Fallback for all resource types', sources:["'self'","'none'","'unsafe-inline'","'unsafe-eval'","data:","blob:","https:","http:"], warn:["'unsafe-inline'","'unsafe-eval'","http:"] },
  { id:'script-src', label:'script-src', desc:'JavaScript sources', sources:["'self'","'none'","'unsafe-inline'","'unsafe-eval'","'strict-dynamic'","'wasm-unsafe-eval'","data:","blob:","https:"], warn:["'unsafe-inline'","'unsafe-eval'","data:"] },
  { id:'style-src', label:'style-src', desc:'CSS stylesheets', sources:["'self'","'none'","'unsafe-inline'","data:","https:"], warn:["'unsafe-inline'"] },
  { id:'img-src', label:'img-src', desc:'Image sources', sources:["'self'","'none'","data:","blob:","https:","http:"], warn:["http:"] },
  { id:'font-src', label:'font-src', desc:'Font file sources', sources:["'self'","'none'","data:","https:"], warn:[] },
  { id:'connect-src', label:'connect-src', desc:'XHR, WebSocket, fetch endpoints', sources:["'self'","'none'","https:","wss:","data:","blob:"], warn:[] },
  { id:'frame-src', label:'frame-src', desc:'Iframe sources', sources:["'self'","'none'","https:","data:","blob:"], warn:[] },
  { id:'media-src', label:'media-src', desc:'Audio and video sources', sources:["'self'","'none'","data:","blob:","https:"], warn:[] },
  { id:'object-src', label:'object-src', desc:'Plugin sources (Flash, etc.)', sources:["'self'","'none'","https:"], warn:[] },
  { id:'base-uri', label:'base-uri', desc:'Restrict base element URLs', sources:["'self'","'none'"], warn:[] },
  { id:'form-action', label:'form-action', desc:'Valid form submission targets', sources:["'self'","'none'","https:"], warn:[] },
  { id:'frame-ancestors', label:'frame-ancestors', desc:'Who can embed this page', sources:["'self'","'none'","https:"], warn:[], noMeta:true },
  { id:'upgrade-insecure-requests', label:'upgrade-insecure-requests', desc:'Upgrade HTTP to HTTPS', sources:[], isFlag:true },
  { id:'report-uri', label:'report-uri', desc:'Endpoint for CSP violation reports', sources:[], isCustomOnly:true },
  { id:'report-to', label:'report-to', desc:'Reporting API group name', sources:[], isCustomOnly:true }
];

/* ===== STATE ===== */
let state = {};
let currentTab = 'raw';

function initState() {
  state = {};
  DIRECTIVES.forEach(d => {
    state[d.id] = { enabled: false, selected: [], custom: '' };
  });
}

/* ===== BUILD UI ===== */
function buildUI() {
  const grid = document.getElementById('directivesGrid');
  grid.innerHTML = '';
  DIRECTIVES.forEach(d => {
    const card = document.createElement('div');
    card.className = 'directive-card';
    card.id = 'card-' + d.id;
    let html = '<div class="directive-header">';
    html += '<span class="directive-name">' + d.label + '</span>';
    html += '<label class="directive-toggle"><input type="checkbox" data-dir="' + d.id + '" onchange="toggleDirective(\'' + d.id + '\',this.checked)"><span class="slider"></span></label>';
    html += '</div>';
    html += '<div style="font-size:.7rem;color:var(--text2);margin-bottom:.5rem">' + d.desc + '</div>';
    if (!d.isFlag && !d.isCustomOnly && d.sources.length > 0) {
      html += '<div class="source-chips" id="chips-' + d.id + '">';
      d.sources.forEach(s => {
        const isWarn = d.warn && d.warn.includes(s);
        html += '<span class="source-chip' + (isWarn ? ' warn' : '') + '" data-dir="' + d.id + '" data-src="' + escHtml(s) + '" onclick="toggleSource(\'' + d.id + '\',\'' + escJs(s) + '\')">' + escHtml(s) + '</span>';
      });
      html += '</div>';
    }
    if (!d.isFlag) {
      const ph = d.isCustomOnly ? (d.id === 'report-uri' ? 'https://example.com/csp-report' : 'csp-endpoint') : 'Custom domains (space-separated): *.cdn.com api.example.com';
      html += '<input class="custom-input" type="text" placeholder="' + ph + '" data-dir="' + d.id + '" oninput="updateCustom(\'' + d.id + '\',this.value)">';
    }
    card.innerHTML = html;
    grid.appendChild(card);
  });
}

/* ===== INTERACTIONS ===== */
function toggleDirective(id, on) {
  state[id].enabled = on;
  const card = document.getElementById('card-' + id);
  card.classList.toggle('active-directive', on);
  generate();
}

function toggleSource(dirId, src) {
  const s = state[dirId];
  const idx = s.selected.indexOf(src);
  if (idx === -1) s.selected.push(src); else s.selected.splice(idx, 1);
  if (!s.enabled && s.selected.length > 0) {
    s.enabled = true;
    document.querySelector('[data-dir="' + dirId + '"][type="checkbox"]').checked = true;
    document.getElementById('card-' + dirId).classList.add('active-directive');
  }
  // Update chip UI
  const chips = document.querySelectorAll('.source-chip[data-dir="' + dirId + '"]');
  chips.forEach(c => {
    c.classList.toggle('selected', s.selected.includes(c.dataset.src));
  });
  generate();
}

function updateCustom(dirId, val) {
  state[dirId].custom = val.trim();
  if (!state[dirId].enabled && val.trim()) {
    state[dirId].enabled = true;
    document.querySelector('[data-dir="' + dirId + '"][type="checkbox"]').checked = true;
    document.getElementById('card-' + dirId).classList.add('active-directive');
  }
  generate();
}

/* ===== GENERATE CSP ===== */
function buildCSPParts() {
  const parts = [];
  DIRECTIVES.forEach(d => {
    const s = state[d.id];
    if (!s.enabled) return;
    if (d.isFlag) {
      parts.push(d.label);
      return;
    }
    const vals = [...s.selected];
    if (s.custom) {
      s.custom.split(/\s+/).forEach(v => { if (v && !vals.includes(v)) vals.push(v); });
    }
    if (vals.length === 0 && !d.isCustomOnly) return;
    if (d.isCustomOnly && vals.length === 0 && !s.custom) return;
    parts.push(d.label + ' ' + vals.join(' '));
  });
  return parts;
}

function generate() {
  const parts = buildCSPParts();
  renderOutput(parts);
  renderWarnings();
}

function renderOutput(parts) {
  const code = document.getElementById('outputCode');
  if (parts.length === 0) {
    code.textContent = 'Enable directives above to generate your CSP header.';
    return;
  }
  const raw = parts.join('; ');
  switch (currentTab) {
    case 'raw':
      code.textContent = 'Content-Security-Policy: ' + raw;
      break;
    case 'formatted':
      code.textContent = 'Content-Security-Policy:\n  ' + parts.join(';\n  ') + ';';
      break;
    case 'meta':
      {
        // frame-ancestors not allowed in meta tag
        const metaParts = parts.filter(p => !p.startsWith('frame-ancestors') && !p.startsWith('report-uri') && !p.startsWith('report-to'));
        if (metaParts.length === 0) {
          code.textContent = '<!-- Note: frame-ancestors, report-uri, and report-to are not supported in meta tags -->';
        } else {
          code.textContent = '<meta http-equiv="Content-Security-Policy"\n      content="' + metaParts.join('; ') + '">';
        }
      }
      break;
    case 'nginx':
      code.textContent = '# Nginx - add to server or location block\nadd_header Content-Security-Policy "' + raw + '" always;';
      break;
    case 'apache':
      code.textContent = '# Apache - add to .htaccess or VirtualHost\nHeader set Content-Security-Policy "' + raw + '"';
      break;
    case 'express':
      code.textContent = "// Express.js middleware\napp.use((req, res, next) => {\n  res.setHeader(\n    'Content-Security-Policy',\n    '" + raw.replace(/'/g, "\\'") + "'\n  );\n  next();\n});";
      break;
  }
}

function renderWarnings() {
  const container = document.getElementById('warnings');
  const warns = [];
  const infos = [];
  DIRECTIVES.forEach(d => {
    const s = state[d.id];
    if (!s.enabled) return;
    if (d.warn) {
      d.warn.forEach(w => {
        if (s.selected.includes(w)) {
          if (w === "'unsafe-inline'") {
            warns.push('<strong>' + d.label + '</strong>: <code>\'unsafe-inline\'</code> allows inline scripts/styles, which weakens XSS protection significantly.');
          } else if (w === "'unsafe-eval'") {
            warns.push('<strong>' + d.label + '</strong>: <code>\'unsafe-eval\'</code> allows eval() and similar functions, enabling code injection attacks.');
          } else if (w === "data:") {
            warns.push('<strong>' + d.label + '</strong>: <code>data:</code> URIs in script-src can be used to bypass CSP. Consider removing it.');
          } else if (w === "http:") {
            warns.push('<strong>' + d.label + '</strong>: Allowing <code>http:</code> enables mixed content and MITM attacks. Use <code>https:</code> instead.');
          }
        }
      });
    }
  });
  // Check if default-src is missing
  if (!state['default-src'].enabled) {
    const hasAny = DIRECTIVES.some(d => d.id !== 'default-src' && state[d.id].enabled && !DIRECTIVES.find(x=>x.id===d.id).isFlag);
    if (hasAny) {
      infos.push('No <code>default-src</code> is set. Browsers will not restrict resource types that lack an explicit directive. Consider adding <code>default-src \'self\'</code> as a fallback.');
    }
  }
  // Check object-src none recommendation
  if (state['default-src'].enabled && !state['object-src'].enabled) {
    infos.push('Consider setting <code>object-src \'none\'</code> to block plugins like Flash, which are a common attack vector.');
  }
  // Check frame-ancestors in meta
  if (state['frame-ancestors'] && state['frame-ancestors'].enabled && currentTab === 'meta') {
    warns.push('<code>frame-ancestors</code> is not supported in <code>&lt;meta&gt;</code> tags. Use an HTTP header instead.');
  }

  let html = '';
  warns.forEach(w => { html += '<div class="warning-item"><span class="wi">&#9888;</span><span class="warning-text">' + w + '</span></div>'; });
  infos.forEach(i => { html += '<div class="info-item"><span class="wi">&#8505;</span><span class="warning-text">' + i + '</span></div>'; });
  container.innerHTML = html;

  // Update card warning states
  DIRECTIVES.forEach(d => {
    const card = document.getElementById('card-' + d.id);
    const s = state[d.id];
    const hasWarn = s.enabled && d.warn && d.warn.some(w => s.selected.includes(w));
    card.classList.toggle('has-warning', hasWarn);
  });
}

/* ===== TAB SWITCHING ===== */
function switchTab(fmt, btn) {
  currentTab = fmt;
  document.querySelectorAll('.output-tab').forEach(t => t.classList.remove('active'));
  btn.classList.add('active');
  generate();
}

/* ===== COPY ===== */
function copyOutput() {
  const text = document.getElementById('outputCode').textContent;
  if (!text || text.startsWith('Enable directives')) { showToast('Nothing to copy'); return; }
  navigator.clipboard.writeText(text).then(() => showToast('Copied to clipboard'));
}

/* ===== PRESETS ===== */
const PRESETS = {
  strict: {
    'default-src': { enabled:true, selected:["'none'"], custom:'' },
    'script-src': { enabled:true, selected:["'self'"], custom:'' },
    'style-src': { enabled:true, selected:["'self'"], custom:'' },
    'img-src': { enabled:true, selected:["'self'"], custom:'' },
    'font-src': { enabled:true, selected:["'self'"], custom:'' },
    'connect-src': { enabled:true, selected:["'self'"], custom:'' },
    'frame-src': { enabled:true, selected:["'none'"], custom:'' },
    'object-src': { enabled:true, selected:["'none'"], custom:'' },
    'base-uri': { enabled:true, selected:["'self'"], custom:'' },
    'form-action': { enabled:true, selected:["'self'"], custom:'' },
    'frame-ancestors': { enabled:true, selected:["'none'"], custom:'' },
    'upgrade-insecure-requests': { enabled:true, selected:[], custom:'' }
  },
  moderate: {
    'default-src': { enabled:true, selected:["'self'"], custom:'' },
    'script-src': { enabled:true, selected:["'self'","https:"], custom:'' },
    'style-src': { enabled:true, selected:["'self'","'unsafe-inline'","https:"], custom:'' },
    'img-src': { enabled:true, selected:["'self'","data:","https:"], custom:'' },
    'font-src': { enabled:true, selected:["'self'","https:","data:"], custom:'' },
    'connect-src': { enabled:true, selected:["'self'","https:"], custom:'' },
    'object-src': { enabled:true, selected:["'none'"], custom:'' },
    'frame-ancestors': { enabled:true, selected:["'self'"], custom:'' },
    'upgrade-insecure-requests': { enabled:true, selected:[], custom:'' }
  },
  relaxed: {
    'default-src': { enabled:true, selected:["'self'","https:","data:"], custom:'' },
    'script-src': { enabled:true, selected:["'self'","'unsafe-inline'","'unsafe-eval'","https:"], custom:'' },
    'style-src': { enabled:true, selected:["'self'","'unsafe-inline'","https:"], custom:'' },
    'img-src': { enabled:true, selected:["'self'","data:","blob:","https:"], custom:'' },
    'font-src': { enabled:true, selected:["'self'","data:","https:"], custom:'' },
    'connect-src': { enabled:true, selected:["'self'","https:","wss:"], custom:'' },
    'frame-src': { enabled:true, selected:["'self'","https:"], custom:'' }
  },
  wordpress: {
    'default-src': { enabled:true, selected:["'self'"], custom:'' },
    'script-src': { enabled:true, selected:["'self'","'unsafe-inline'","'unsafe-eval'"], custom:'*.googleapis.com *.gstatic.com *.google.com *.wp.com' },
    'style-src': { enabled:true, selected:["'self'","'unsafe-inline'"], custom:'*.googleapis.com *.wp.com' },
    'img-src': { enabled:true, selected:["'self'","data:","https:"], custom:'*.wp.com *.gravatar.com *.w.org' },
    'font-src': { enabled:true, selected:["'self'","data:"], custom:'*.googleapis.com *.gstatic.com' },
    'connect-src': { enabled:true, selected:["'self'"], custom:'*.wordpress.org' },
    'frame-src': { enabled:true, selected:["'self'"], custom:'*.youtube.com *.vimeo.com' },
    'object-src': { enabled:true, selected:["'none'"], custom:'' },
    'upgrade-insecure-requests': { enabled:true, selected:[], custom:'' }
  },
  react: {
    'default-src': { enabled:true, selected:["'self'"], custom:'' },
    'script-src': { enabled:true, selected:["'self'"], custom:'' },
    'style-src': { enabled:true, selected:["'self'","'unsafe-inline'"], custom:'' },
    'img-src': { enabled:true, selected:["'self'","data:","blob:","https:"], custom:'' },
    'font-src': { enabled:true, selected:["'self'","data:"], custom:'*.googleapis.com *.gstatic.com' },
    'connect-src': { enabled:true, selected:["'self'","https:","wss:"], custom:'' },
    'object-src': { enabled:true, selected:["'none'"], custom:'' },
    'base-uri': { enabled:true, selected:["'self'"], custom:'' },
    'frame-ancestors': { enabled:true, selected:["'none'"], custom:'' },
    'upgrade-insecure-requests': { enabled:true, selected:[], custom:'' }
  },
  static: {
    'default-src': { enabled:true, selected:["'none'"], custom:'' },
    'script-src': { enabled:true, selected:["'self'"], custom:'' },
    'style-src': { enabled:true, selected:["'self'"], custom:'' },
    'img-src': { enabled:true, selected:["'self'"], custom:'' },
    'font-src': { enabled:true, selected:["'self'"], custom:'' },
    'connect-src': { enabled:true, selected:["'none'"], custom:'' },
    'frame-src': { enabled:true, selected:["'none'"], custom:'' },
    'object-src': { enabled:true, selected:["'none'"], custom:'' },
    'base-uri': { enabled:true, selected:["'self'"], custom:'' },
    'form-action': { enabled:true, selected:["'none'"], custom:'' },
    'frame-ancestors': { enabled:true, selected:["'none'"], custom:'' },
    'upgrade-insecure-requests': { enabled:true, selected:[], custom:'' }
  }
};

function applyPreset(name) {
  initState();
  const p = PRESETS[name];
  if (!p) return;
  for (const [dirId, cfg] of Object.entries(p)) {
    state[dirId] = { enabled: cfg.enabled, selected: [...cfg.selected], custom: cfg.custom || '' };
  }
  syncUI();
  generate();
  showToast('Applied ' + name.charAt(0).toUpperCase() + name.slice(1) + ' preset');
}

function resetAll() {
  initState();
  syncUI();
  generate();
  showToast('All directives reset');
}

function syncUI() {
  DIRECTIVES.forEach(d => {
    const s = state[d.id];
    // Toggle checkbox
    const cb = document.querySelector('[data-dir="' + d.id + '"][type="checkbox"]');
    if (cb) cb.checked = s.enabled;
    // Card class
    const card = document.getElementById('card-' + d.id);
    card.classList.toggle('active-directive', s.enabled);
    // Chips
    const chips = document.querySelectorAll('.source-chip[data-dir="' + d.id + '"]');
    chips.forEach(c => {
      c.classList.toggle('selected', s.selected.includes(c.dataset.src));
    });
    // Custom input
    const inp = document.querySelector('.custom-input[data-dir="' + d.id + '"]');
    if (inp) inp.value = s.custom;
  });
}

/* ===== UTILS ===== */
function escHtml(s) { return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }
function escJs(s) { return s.replace(/\\/g,'\\\\').replace(/'/g,"\\'"); }

function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2000);
}

/* ===== INIT ===== */
initState();
buildUI();
generate();

/* IntersectionObserver fade-in */
const observer = new IntersectionObserver(entries => {
  entries.forEach(entry => { if (entry.isIntersecting) { entry.target.classList.add('visible'); observer.unobserve(entry.target); }});
}, { threshold: 0.1 });
document.querySelectorAll('.fade-in').forEach(el => observer.observe(el));
</script>
<script src="/js/analytics-lite.js" defer></script>
<script src="/js/revenue.js" defer></script>
<script src="/js/lead-capture.js" defer></script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    {
      "@type": "Question",
      "name": "What is a Content Security Policy (CSP) header?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "A Content Security Policy (CSP) header is an HTTP response header that tells the browser which sources of content are allowed to load on your page. It helps prevent cross-site scripting (XSS), clickjacking, and other code injection attacks by restricting where scripts, styles, images, and other resources can come from."
      }
    },
    {
      "@type": "Question",
      "name": "Is this CSP generator free to use?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Yes, NexTool's CSP Header Generator is completely free. It runs entirely in your browser with no server calls, no signup required, and no usage limits. Your policy configuration never leaves your device."
      }
    },
    {
      "@type": "Question",
      "name": "Why should I avoid unsafe-inline and unsafe-eval in CSP?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Using 'unsafe-inline' allows any inline script or style to execute, which defeats the main purpose of CSP against XSS attacks. Similarly, 'unsafe-eval' permits eval() and similar functions that can execute arbitrary code. Both significantly weaken your security posture and should be avoided in production whenever possible."
      }
    },
    {
      "@type": "Question",
      "name": "Can I use CSP in a meta tag?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Yes, you can use a <meta http-equiv=\"Content-Security-Policy\"> tag in your HTML head. However, some directives like frame-ancestors, report-uri, and report-to are not supported in meta tags and must be delivered via HTTP headers. This tool shows you both options."
      }
    }
  ]
}
</script>
</body>
</html>
