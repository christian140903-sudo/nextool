<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Free Image Cropper — Crop Photos Online Instantly | NexTool</title>
<meta name="description" content="Free online image cropper tool. Crop, rotate, and resize photos with preset aspect ratios for social media. Download as PNG, JPG, or WebP. No signup needed.">
<meta name="keywords" content="image cropper online free, crop image online, photo cropper, image crop tool, crop photo for instagram, resize image, free image editor, NexTool">
<meta name="robots" content="index, follow">
<meta property="og:title" content="Free Image Cropper — Crop Photos Online | NexTool">
<meta property="og:description" content="Crop, rotate, and resize images instantly. Social media presets, aspect ratios, download as PNG/JPG/WebP. 100% free.">
<meta property="og:type" content="website">
<meta property="og:url" content="https://nextool.app/free-tools/image-cropper.html">
<meta property="og:image" content="https://nextool.app/assets/og-default.png">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<link rel="canonical" href="https://nextool.app/free-tools/image-cropper.html">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Free Image Cropper — Crop Photos Online | NexTool">
<meta name="twitter:description" content="Crop, rotate, flip and resize images online. Social media presets included. Free tool by NexTool.">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"SoftwareApplication","name":"NexTool Image Cropper","applicationCategory":"MultimediaApplication","operatingSystem":"Web","offers":{"@type":"Offer","price":"0","priceCurrency":"USD"},"description":"Free online image cropper with aspect ratio presets, social media sizes, rotate, flip, and export as PNG, JPG, or WebP."}
</script>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{--bg:#050508;--surface:#111118;--surface2:#1a1a24;--border:#2a2a3a;--text:#e4e4eb;--text2:#9494a8;--primary:#6366f1;--accent:#a855f7;--pink:#ec4899;--green:#22c55e;--red:#ef4444;--cyan:#22d3ee;--yellow:#eab308;--radius:12px;--glass:rgba(17,17,24,0.7)}
html{scroll-behavior:smooth}
body{font-family:'Inter',system-ui,sans-serif;background:var(--bg);color:var(--text);line-height:1.6;min-height:100vh;overflow-x:hidden}
.nav{position:sticky;top:0;z-index:100;background:rgba(5,5,8,0.85);backdrop-filter:blur(20px);border-bottom:1px solid var(--border);padding:0 2rem;height:64px;display:flex;align-items:center;justify-content:space-between}
.nav-logo{font-size:1.4rem;font-weight:800;background:linear-gradient(135deg,var(--primary),var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent;text-decoration:none}
.nav-links{display:flex;align-items:center;gap:1.5rem}
.nav-links a{color:var(--text2);text-decoration:none;font-size:.875rem;font-weight:500;transition:color .2s}
.nav-links a:hover{color:var(--text)}
.nav-cta{background:linear-gradient(135deg,var(--primary),var(--accent));color:#fff!important;padding:.5rem 1.2rem;border-radius:8px;font-weight:600;-webkit-text-fill-color:#fff!important}
.nav-cta:hover{opacity:.9}
.nav-toggle{display:none;background:none;border:none;color:var(--text);font-size:1.5rem;cursor:pointer}
.hero{text-align:center;padding:3rem 1.5rem 2rem;max-width:700px;margin:0 auto}
.hero h1{font-size:2.2rem;font-weight:800;line-height:1.2;margin-bottom:.75rem}
.hero h1 span{background:linear-gradient(135deg,var(--primary),var(--accent),var(--pink));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.hero p{color:var(--text2);font-size:1rem}
.tool-container{max-width:1200px;margin:0 auto;padding:0 1.5rem 3rem}
/* Upload Zone */
.upload-zone{border:2px dashed var(--border);border-radius:var(--radius);padding:4rem 2rem;text-align:center;cursor:pointer;transition:border-color .3s,background .3s;background:var(--glass);backdrop-filter:blur(16px)}
.upload-zone:hover,.upload-zone.dragover{border-color:var(--primary);background:rgba(99,102,241,.06)}
.upload-icon{font-size:3.5rem;margin-bottom:1rem;opacity:.7}
.upload-zone h3{font-size:1.1rem;font-weight:600;margin-bottom:.5rem}
.upload-zone p{color:var(--text2);font-size:.85rem;margin-bottom:.5rem}
.upload-btn{display:inline-block;background:linear-gradient(135deg,var(--primary),var(--accent));color:#fff;padding:.6rem 1.5rem;border-radius:8px;font-weight:600;font-size:.85rem;border:none;cursor:pointer;margin-top:.75rem;transition:opacity .2s}
.upload-btn:hover{opacity:.9}
.upload-hint{color:var(--text2);font-size:.75rem;margin-top:.75rem;opacity:.6}
/* Editor */
.editor{display:none}
.toolbar{display:flex;flex-wrap:wrap;gap:.5rem;margin-bottom:.75rem;align-items:center}
.toolbar button,.toolbar select{background:var(--surface2);border:1px solid var(--border);color:var(--text);padding:.4rem .75rem;border-radius:8px;font-size:.78rem;font-weight:500;cursor:pointer;transition:all .2s;font-family:inherit}
.toolbar button:hover{border-color:var(--primary);background:rgba(99,102,241,.12)}
.toolbar button.active{background:linear-gradient(135deg,var(--primary),var(--accent));border-color:transparent;color:#fff}
.toolbar select{appearance:none;padding-right:1.8rem;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%239494a8' viewBox='0 0 16 16'%3E%3Cpath d='M8 11L3 6h10z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right .6rem center}
.toolbar-sep{width:1px;height:24px;background:var(--border);margin:0 .25rem}
.toolbar label{color:var(--text2);font-size:.78rem;font-weight:500}
.toolbar input[type=number]{background:var(--surface2);border:1px solid var(--border);color:var(--text);padding:.35rem .5rem;border-radius:6px;font-size:.78rem;font-family:inherit;width:64px;text-align:center}
.toolbar input[type=number]:focus{outline:none;border-color:var(--primary)}
.toolbar input[type=range]{width:80px;accent-color:var(--primary);vertical-align:middle}
.toolbar .zoom-val{color:var(--text2);font-size:.75rem;min-width:36px;text-align:center}
/* Workspace */
.workspace-wrap{position:relative;width:100%;background:#0a0a12;border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;margin-bottom:.75rem}
.workspace-wrap canvas{display:block;touch-action:none}
/* Info Bar */
.info-bar{display:flex;flex-wrap:wrap;align-items:center;gap:1rem;font-size:.78rem;color:var(--text2);margin-bottom:.75rem;padding:.5rem .75rem;background:var(--glass);border:1px solid var(--border);border-radius:8px}
.info-bar .info-label{color:var(--text);font-weight:600}
.info-bar .info-sep{width:1px;height:16px;background:var(--border)}
/* Download Panel */
.download-panel{display:flex;flex-wrap:wrap;align-items:center;gap:.75rem;padding:.75rem 1rem;background:var(--glass);backdrop-filter:blur(16px);border:1px solid var(--border);border-radius:var(--radius)}
.download-panel label{color:var(--text2);font-size:.78rem;font-weight:500}
.download-panel select{background:var(--surface2);border:1px solid var(--border);color:var(--text);padding:.4rem .75rem;border-radius:6px;font-size:.78rem;font-family:inherit;appearance:none;padding-right:1.8rem;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%239494a8' viewBox='0 0 16 16'%3E%3Cpath d='M8 11L3 6h10z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right .6rem center}
.download-panel input[type=range]{width:100px;accent-color:var(--primary);vertical-align:middle}
.download-panel .quality-val{color:var(--text2);font-size:.75rem;min-width:32px}
.download-panel .dl-spacer{flex:1}
.download-panel .dl-info{color:var(--text2);font-size:.75rem}
.download-btn{background:linear-gradient(135deg,var(--primary),var(--accent));color:#fff;border:none;padding:.5rem 1.4rem;border-radius:8px;font-weight:600;font-size:.85rem;cursor:pointer;transition:opacity .2s,transform .2s;font-family:inherit}
.download-btn:hover{opacity:.9;transform:translateY(-1px)}
/* CTA */
.cta-section{text-align:center;padding:4rem 1.5rem;max-width:700px;margin:0 auto}
.cta-section h2{font-size:1.8rem;font-weight:800;margin-bottom:.75rem}
.cta-section h2 span{background:linear-gradient(135deg,var(--primary),var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.cta-section p{color:var(--text2);margin-bottom:1.5rem}
.cta-btn{display:inline-block;background:linear-gradient(135deg,var(--primary),var(--accent));color:#fff;padding:.75rem 2rem;border-radius:10px;font-weight:700;text-decoration:none;font-size:1rem;transition:transform .2s,box-shadow .2s}
.cta-btn:hover{transform:translateY(-2px);box-shadow:0 8px 30px rgba(99,102,241,.3)}
/* Footer */
.footer{border-top:1px solid var(--border);padding:3rem 2rem 2rem;max-width:1200px;margin:0 auto}
.footer-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:2rem;margin-bottom:2rem}
.footer-col h4{font-size:.85rem;font-weight:700;margin-bottom:.75rem;color:var(--text)}
.footer-col a{display:block;color:var(--text2);text-decoration:none;font-size:.8rem;margin-bottom:.4rem;transition:color .2s}
.footer-col a:hover{color:var(--primary)}
.footer-bottom{text-align:center;color:var(--text2);font-size:.75rem;padding-top:1.5rem;border-top:1px solid var(--border)}
/* Fade In */
.fade-in{opacity:0;transform:translateY(20px);transition:opacity .6s,transform .6s}
.fade-in.visible{opacity:1;transform:translateY(0)}
/* Toast */
.toast{position:fixed;bottom:2rem;left:50%;transform:translateX(-50%) translateY(80px);background:var(--surface2);border:1px solid var(--border);color:var(--text);padding:.6rem 1.2rem;border-radius:10px;font-size:.85rem;font-weight:500;z-index:200;transition:transform .3s;pointer-events:none}
.toast.show{transform:translateX(-50%) translateY(0)}
/* Responsive */
@media(max-width:768px){
  .nav-links{display:none;position:absolute;top:64px;left:0;right:0;background:var(--bg);border-bottom:1px solid var(--border);flex-direction:column;padding:1rem 2rem;gap:1rem}
  .nav-links.open{display:flex}
  .nav-toggle{display:block}
  .hero h1{font-size:1.6rem}
  .footer-grid{grid-template-columns:1fr}
  .toolbar{gap:.35rem}
  .toolbar-sep{display:none}
  .upload-zone{padding:2.5rem 1.5rem}
  .info-bar{gap:.5rem;font-size:.72rem}
  .download-panel{gap:.5rem}
  .download-panel input[type=range]{width:70px}
}
</style>
</head>
<body>

<nav class="nav">
  <a href="/" class="nav-logo">NexTool</a>
  <button class="nav-toggle" onclick="document.querySelector('.nav-links').classList.toggle('open')" aria-label="Menu">&#9776;</button>
  <div class="nav-links">
    <a href="/">Home</a>
    <a href="/free-tools/">Tools</a>
    <a href="/free-tools/">Free Tools</a>
    <a href="/blog/">Blog</a>
    <a href="/#contact" class="nav-cta">Get Pro &mdash; $29</a>
  </div>
</nav>

<section class="hero fade-in">
  <h1>Free <span>Image Cropper</span></h1>
  <p style="color:#94a3b8;font-size:15px;line-height:1.6;margin-bottom:24px;max-width:700px;margin-left:auto;margin-right:auto;">Crop, rotate, flip, and resize images directly in your browser. Choose from preset aspect ratios or social media sizes. Download as PNG, JPG, or WebP. No upload to any server &mdash; 100% private and free.</p>
</section>

<div class="tool-container fade-in">

  <!-- Upload Zone -->
  <div id="uploadZone" class="upload-zone">
    <div class="upload-icon">&#128247;</div>
    <h3>Drop your image here</h3>
    <p>or click to browse files</p>
    <button class="upload-btn" onclick="document.getElementById('fileInput').click()">Browse Files</button>
    <input type="file" id="fileInput" accept="image/*" hidden>
    <p class="upload-hint">Supports PNG, JPG, WebP, GIF, BMP, SVG &mdash; up to 50 MB</p>
  </div>

  <!-- Editor -->
  <div id="editor" class="editor">
    <!-- Toolbar Row 1: Image + Aspect Ratios -->
    <div class="toolbar">
      <button onclick="changeImage()" title="Load a different image">Change Image</button>
      <div class="toolbar-sep"></div>
      <button class="aspect-btn active" onclick="setRatio(null,this)">Free</button>
      <button class="aspect-btn" onclick="setRatio(1,this)">1:1</button>
      <button class="aspect-btn" onclick="setRatio(4/3,this)">4:3</button>
      <button class="aspect-btn" onclick="setRatio(16/9,this)">16:9</button>
      <button class="aspect-btn" onclick="setRatio(3/2,this)">3:2</button>
      <button class="aspect-btn" onclick="setRatio(9/16,this)">9:16</button>
      <div class="toolbar-sep"></div>
      <select id="socialPreset" onchange="setSocial(this.value)">
        <option value="">Social Presets</option>
        <option value="1080,1080">Instagram Post (1080x1080)</option>
        <option value="1080,1920">Instagram Story (1080x1920)</option>
        <option value="820,312">Facebook Cover (820x312)</option>
        <option value="1500,500">Twitter Header (1500x500)</option>
        <option value="1280,720">YouTube Thumbnail (1280x720)</option>
        <option value="1584,396">LinkedIn Banner (1584x396)</option>
      </select>
    </div>

    <!-- Toolbar Row 2: Custom Size + Transforms + Zoom -->
    <div class="toolbar">
      <label>Custom:</label>
      <input type="number" id="customW" placeholder="W" min="1" max="9999" oninput="setCustomSize()">
      <span style="color:var(--text2);font-size:.78rem">x</span>
      <input type="number" id="customH" placeholder="H" min="1" max="9999" oninput="setCustomSize()">
      <div class="toolbar-sep"></div>
      <button onclick="rotateImg(90)" title="Rotate 90 clockwise">&#8635; CW</button>
      <button onclick="rotateImg(-90)" title="Rotate 90 counter-clockwise">&#8634; CCW</button>
      <button onclick="flipImg('h')" title="Flip horizontal">&#8596; Flip H</button>
      <button onclick="flipImg('v')" title="Flip vertical">&#8597; Flip V</button>
      <div class="toolbar-sep"></div>
      <label>Zoom:</label>
      <input type="range" id="zoomSlider" min="25" max="300" value="100" step="5" oninput="setZoom(this.value)">
      <span class="zoom-val" id="zoomVal">100%</span>
      <div class="toolbar-sep"></div>
      <button onclick="resetCrop()" title="Reset crop to full image">Reset Crop</button>
    </div>

    <!-- Workspace Canvas -->
    <div class="workspace-wrap" id="workspaceWrap">
      <canvas id="workspace"></canvas>
    </div>

    <!-- Info Bar -->
    <div class="info-bar">
      <span><span class="info-label">Original:</span> <span id="infoOriginal">-</span></span>
      <span class="info-sep"></span>
      <span><span class="info-label">Crop:</span> <span id="infoCrop">-</span></span>
      <span class="info-sep"></span>
      <span><span class="info-label">Output:</span> <span id="infoOutput">-</span></span>
      <span class="info-sep"></span>
      <span><span class="info-label">Size:</span> <span id="infoSize">-</span></span>
    </div>

    <!-- Download Panel -->
    <div class="download-panel">
      <label>Format:</label>
      <select id="formatSelect" onchange="updateQualityVis()">
        <option value="png">PNG</option>
        <option value="jpeg">JPG</option>
        <option value="webp">WebP</option>
      </select>
      <label id="qualityLabel">Quality:</label>
      <input type="range" id="qualitySlider" min="10" max="100" value="92" step="1" oninput="document.getElementById('qualityVal').textContent=this.value+'%'">
      <span class="quality-val" id="qualityVal">92%</span>
      <span class="dl-spacer"></span>
      <span class="dl-info" id="dlInfo"></span>
      <button class="download-btn" onclick="downloadCrop()">Download</button>
    </div>
  </div>
</div>

<section class="cta-section fade-in">
  <h2>Need something <span>more powerful</span>?</h2>
  <p>Let us build it for you. Custom APIs, dashboards, automations &mdash; whatever you need.</p>
  <a href="/#contact" class="cta-btn">Start a Project &rarr;</a>
</section>

<!-- Cross Promo -->
<section style="max-width:900px;margin:40px auto;padding:0 24px;">
<div style="background:linear-gradient(135deg,rgba(99,102,241,0.1),rgba(168,85,247,0.08));border:1px solid rgba(99,102,241,0.15);border-radius:20px;padding:32px 28px;text-align:center;">
<div style="font-size:13px;color:#818cf8;font-weight:600;text-transform:uppercase;letter-spacing:1px;margin-bottom:8px;">Founding Member</div>
<h3 style="font-size:22px;font-weight:800;color:#fff;margin:0 0 8px;">Get NexTool Pro</h3>
<p style="color:#94a3b8;font-size:14px;margin:0 auto 20px;max-width:500px;">No banners, clean output, enhanced features on all 215+ tools. One-time payment.</p>
<div style="display:flex;align-items:center;justify-content:center;gap:12px;flex-wrap:wrap;">
<a href="/pro.html" style="display:inline-block;padding:12px 28px;background:linear-gradient(135deg,#6366f1,#a855f7,#ec4899);color:#fff;border-radius:10px;font-weight:700;font-size:15px;text-decoration:none;">$29 &mdash; Get Pro</a>
<a href="/free-tools/" style="color:#94a3b8;font-size:14px;text-decoration:none;">Browse 215+ Free Tools &rarr;</a>
</div>
</div>
</section>

<div style="margin:2rem auto;padding:1.5rem;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);max-width:900px">
<p style="font-weight:600;margin-bottom:.5rem">Related Tools</p>
<p><a href="/free-tools/image-compressor.html" style="color:var(--primary);text-decoration:none">Image Compressor</a> &middot; <a href="/free-tools/image-resizer.html" style="color:var(--primary);text-decoration:none">Image Resizer</a> &middot; <a href="/free-tools/image-to-base64.html" style="color:var(--primary);text-decoration:none">Image to Base64</a> &middot; <a href="/free-tools/color-palette-from-image.html" style="color:var(--primary);text-decoration:none">Color Palette from Image</a> &middot; <a href="/free-tools/og-image-generator.html" style="color:var(--primary);text-decoration:none">OG Image Generator</a></p>
</div>


<!-- AUTO-LINKED by NexTool Engine -->
<div style="margin:2rem 0;padding:1.5rem;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius)">
<p style="font-weight:600;margin-bottom:.5rem">Related Tools</p>
<p><a href="/free-tools/box-shadow-generator.html" style="color:var(--primary);text-decoration:none">CSS Box Shadow Generator</a> · <a href="/free-tools/base64.html" style="color:var(--primary);text-decoration:none">Free Base64 Encoder/Decoder</a> · <a href="/free-tools/color-palette.html" style="color:var(--primary);text-decoration:none">Free Color Palette Generator</a></p>
</div>
<footer class="footer fade-in">
  <div class="footer-grid">
    <div class="footer-col">
      <h4>Products</h4>
      <a href="/free-tools/">215+ Free Tools</a>
      <a href="/pro.html">NexTool Pro</a>
      <a href="/workspace.html">Workspace</a>
    </div>
    <div class="footer-col">
      <h4>Explore</h4>
      <a href="/free-tools/">Free Tools</a><a href="/blog/">Blog</a><a href="/pro.html">FAQ</a><a href="/pro.html">Pro &mdash; $29</a>
    </div>
    <div class="footer-col">
      <h4>Ecosystem</h4>
      <a href="/">NexTool Home</a><a href="/#contact">Contact</a><a href="https://github.com/christian140903-sudo/nextool" target="_blank">GitHub</a>
    </div>
  </div>
  <div class="footer-bottom">&copy; 2026 NexTool. AI-powered tools for everyone.</div>
</footer>

<div class="toast" id="toast"></div>

<script>
/* ============================================================
   NexTool Image Cropper — 100% Client-Side Canvas Implementation
   ============================================================ */

// DOM refs
const uploadZone = document.getElementById('uploadZone');
const editorEl = document.getElementById('editor');
const fileInput = document.getElementById('fileInput');
const canvas = document.getElementById('workspace');
const ctx = canvas.getContext('2d');
const workspaceWrap = document.getElementById('workspaceWrap');

// State
let originalImg = null;
let transformedCvs = null; // canvas holding the transformed image
let fileName = 'image';
let rotation = 0;
let isFlipH = false;
let isFlipV = false;
let zoomLevel = 1;
let aspectRatio = null;    // null = free, number = w/h
let targetW = 0;           // 0 = use native crop size
let targetH = 0;
let crop = { x: 0, y: 0, w: 100, h: 100 };

// Display metrics (CSS pixels on the canvas element)
let dScale = 1;
let dOffX = 0;
let dOffY = 0;
let cvsCSSW = 100;
let cvsCSSH = 100;

// Interaction state
let interaction = null; // { type, startMX, startMY, startCrop }

/* ---- Upload Handling ---- */

uploadZone.addEventListener('click', function(e) {
  if (e.target.tagName !== 'BUTTON') fileInput.click();
});

uploadZone.addEventListener('dragover', function(e) {
  e.preventDefault();
  uploadZone.classList.add('dragover');
});
uploadZone.addEventListener('dragleave', function() {
  uploadZone.classList.remove('dragover');
});
uploadZone.addEventListener('drop', function(e) {
  e.preventDefault();
  uploadZone.classList.remove('dragover');
  var files = e.dataTransfer.files;
  if (files.length > 0 && files[0].type.startsWith('image/')) {
    loadFile(files[0]);
  }
});

fileInput.addEventListener('change', function() {
  if (fileInput.files.length > 0) loadFile(fileInput.files[0]);
});

function loadFile(file) {
  fileName = file.name.replace(/\.[^.]+$/, '') || 'image';
  var reader = new FileReader();
  reader.onload = function(e) {
    var img = new Image();
    img.onload = function() {
      originalImg = img;
      rotation = 0;
      isFlipH = false;
      isFlipV = false;
      zoomLevel = 1;
      document.getElementById('zoomSlider').value = 100;
      document.getElementById('zoomVal').textContent = '100%';
      aspectRatio = null;
      targetW = 0;
      targetH = 0;
      document.getElementById('socialPreset').value = '';
      document.getElementById('customW').value = '';
      document.getElementById('customH').value = '';
      document.querySelectorAll('.aspect-btn').forEach(function(b, i) {
        b.classList.toggle('active', i === 0);
      });
      rebuildTransformed();
      initCrop();
      uploadZone.style.display = 'none';
      editorEl.style.display = 'block';
      setupCanvas();
      draw();
      updateInfo();
    };
    img.src = e.target.result;
  };
  reader.readAsDataURL(file);
}

function changeImage() {
  fileInput.value = '';
  fileInput.click();
}

/* ---- Transform Canvas ---- */

function rebuildTransformed() {
  if (!originalImg) return;
  var iw = originalImg.naturalWidth;
  var ih = originalImg.naturalHeight;
  var isRot = (rotation === 90 || rotation === 270);
  var tw = isRot ? ih : iw;
  var th = isRot ? iw : ih;
  var c = document.createElement('canvas');
  c.width = tw;
  c.height = th;
  var tctx = c.getContext('2d');
  tctx.translate(tw / 2, th / 2);
  if (isFlipH) tctx.scale(-1, 1);
  if (isFlipV) tctx.scale(1, -1);
  tctx.rotate(rotation * Math.PI / 180);
  tctx.drawImage(originalImg, -iw / 2, -ih / 2, iw, ih);
  transformedCvs = c;
}

/* ---- Crop Initialization ---- */

function initCrop() {
  if (!transformedCvs) return;
  var tw = transformedCvs.width;
  var th = transformedCvs.height;
  if (aspectRatio) {
    if (tw / th > aspectRatio) {
      crop.h = th;
      crop.w = th * aspectRatio;
    } else {
      crop.w = tw;
      crop.h = tw / aspectRatio;
    }
    crop.x = (tw - crop.w) / 2;
    crop.y = (th - crop.h) / 2;
  } else {
    crop.x = 0;
    crop.y = 0;
    crop.w = tw;
    crop.h = th;
  }
}

function resetCrop() {
  initCrop();
  draw();
  updateInfo();
}

/* ---- Canvas Setup & Drawing ---- */

function setupCanvas() {
  var wrapW = workspaceWrap.clientWidth;
  var wrapH = Math.min(Math.max(wrapW * 0.55, 300), 560);
  var dpr = window.devicePixelRatio || 1;
  cvsCSSW = wrapW;
  cvsCSSH = wrapH;
  canvas.width = wrapW * dpr;
  canvas.height = wrapH * dpr;
  canvas.style.width = wrapW + 'px';
  canvas.style.height = wrapH + 'px';
  ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
  computeDisplay();
}

function computeDisplay() {
  if (!transformedCvs) return;
  var tw = transformedCvs.width;
  var th = transformedCvs.height;
  var baseScale = Math.min(cvsCSSW / tw, cvsCSSH / th) * 0.92;
  dScale = baseScale * zoomLevel;
  var dispW = tw * dScale;
  var dispH = th * dScale;
  dOffX = (cvsCSSW - dispW) / 2;
  dOffY = (cvsCSSH - dispH) / 2;
}

function imgToCanvas(ix, iy) {
  return { x: ix * dScale + dOffX, y: iy * dScale + dOffY };
}
function canvasToImg(cx, cy) {
  return { x: (cx - dOffX) / dScale, y: (cy - dOffY) / dScale };
}

function draw() {
  if (!transformedCvs) return;
  computeDisplay();
  var tw = transformedCvs.width;
  var th = transformedCvs.height;
  var dispW = tw * dScale;
  var dispH = th * dScale;

  ctx.clearRect(0, 0, cvsCSSW, cvsCSSH);

  // Background
  ctx.fillStyle = '#0a0a12';
  ctx.fillRect(0, 0, cvsCSSW, cvsCSSH);

  // Checkerboard behind image (for transparency)
  var sz = 10;
  var sx = Math.max(0, Math.floor(dOffX));
  var sy = Math.max(0, Math.floor(dOffY));
  var ex = Math.min(cvsCSSW, Math.ceil(dOffX + dispW));
  var ey = Math.min(cvsCSSH, Math.ceil(dOffY + dispH));
  for (var bx = sx; bx < ex; bx += sz) {
    for (var by = sy; by < ey; by += sz) {
      var ci = Math.floor((bx - sx) / sz) + Math.floor((by - sy) / sz);
      ctx.fillStyle = ci % 2 === 0 ? '#14141e' : '#0e0e18';
      ctx.fillRect(bx, by, Math.min(sz, ex - bx), Math.min(sz, ey - by));
    }
  }

  // Draw image
  ctx.drawImage(transformedCvs, dOffX, dOffY, dispW, dispH);

  // Dark overlay outside crop
  var cx = crop.x * dScale + dOffX;
  var cy = crop.y * dScale + dOffY;
  var cw = crop.w * dScale;
  var ch = crop.h * dScale;
  ctx.fillStyle = 'rgba(0,0,0,0.55)';
  // Top
  ctx.fillRect(dOffX, dOffY, dispW, cy - dOffY);
  // Bottom
  ctx.fillRect(dOffX, cy + ch, dispW, dOffY + dispH - cy - ch);
  // Left
  ctx.fillRect(dOffX, cy, cx - dOffX, ch);
  // Right
  ctx.fillRect(cx + cw, cy, dOffX + dispW - cx - cw, ch);

  // Crop border
  ctx.strokeStyle = '#fff';
  ctx.lineWidth = 1.5;
  ctx.strokeRect(cx, cy, cw, ch);

  // Rule of thirds
  if (cw > 40 && ch > 40) {
    ctx.strokeStyle = 'rgba(255,255,255,0.2)';
    ctx.lineWidth = 0.5;
    ctx.beginPath();
    for (var i = 1; i <= 2; i++) {
      ctx.moveTo(cx + cw * i / 3, cy);
      ctx.lineTo(cx + cw * i / 3, cy + ch);
      ctx.moveTo(cx, cy + ch * i / 3);
      ctx.lineTo(cx + cw, cy + ch * i / 3);
    }
    ctx.stroke();
  }

  // Handles
  var HS = 7;
  ctx.fillStyle = '#fff';
  ctx.strokeStyle = '#6366f1';
  ctx.lineWidth = 1;
  var handles = getHandlePositions(cx, cy, cw, ch);
  handles.forEach(function(h) {
    ctx.fillRect(h.x - HS / 2, h.y - HS / 2, HS, HS);
    ctx.strokeRect(h.x - HS / 2, h.y - HS / 2, HS, HS);
  });

  // Dimension label inside crop
  if (cw > 80 && ch > 30) {
    var outW = targetW || Math.round(crop.w);
    var outH = targetH || Math.round(crop.h);
    var lbl = outW + ' x ' + outH;
    ctx.font = '500 11px Inter, sans-serif';
    ctx.textAlign = 'center';
    var lblW = ctx.measureText(lbl).width + 12;
    ctx.fillStyle = 'rgba(0,0,0,0.6)';
    ctx.fillRect(cx + cw / 2 - lblW / 2, cy + ch - 24, lblW, 20);
    ctx.fillStyle = '#fff';
    ctx.fillText(lbl, cx + cw / 2, cy + ch - 10);
  }
}

function getHandlePositions(cx, cy, cw, ch) {
  return [
    { x: cx, y: cy, id: 'nw' },
    { x: cx + cw / 2, y: cy, id: 'n' },
    { x: cx + cw, y: cy, id: 'ne' },
    { x: cx + cw, y: cy + ch / 2, id: 'e' },
    { x: cx + cw, y: cy + ch, id: 'se' },
    { x: cx + cw / 2, y: cy + ch, id: 's' },
    { x: cx, y: cy + ch, id: 'sw' },
    { x: cx, y: cy + ch / 2, id: 'w' }
  ];
}

/* ---- Pointer Interaction ---- */

function getPointerXY(e) {
  var rect = canvas.getBoundingClientRect();
  var clientX, clientY;
  if (e.touches && e.touches.length > 0) {
    clientX = e.touches[0].clientX;
    clientY = e.touches[0].clientY;
  } else {
    clientX = e.clientX;
    clientY = e.clientY;
  }
  return { x: clientX - rect.left, y: clientY - rect.top };
}

function hitTest(mx, my) {
  var cx = crop.x * dScale + dOffX;
  var cy = crop.y * dScale + dOffY;
  var cw = crop.w * dScale;
  var ch = crop.h * dScale;
  var HS = 10; // hit area slightly larger than visual handle

  var handles = getHandlePositions(cx, cy, cw, ch);
  for (var i = 0; i < handles.length; i++) {
    if (Math.abs(mx - handles[i].x) < HS && Math.abs(my - handles[i].y) < HS) {
      return handles[i].id;
    }
  }
  if (mx >= cx && mx <= cx + cw && my >= cy && my <= cy + ch) return 'move';
  return null;
}

function getCursor(type) {
  switch(type) {
    case 'nw': case 'se': return 'nwse-resize';
    case 'ne': case 'sw': return 'nesw-resize';
    case 'n': case 's': return 'ns-resize';
    case 'e': case 'w': return 'ew-resize';
    case 'move': return 'move';
    default: return 'crosshair';
  }
}

canvas.addEventListener('pointerdown', function(e) {
  e.preventDefault();
  canvas.setPointerCapture(e.pointerId);
  var p = getPointerXY(e);
  var hit = hitTest(p.x, p.y);
  if (hit) {
    interaction = {
      type: hit,
      startMX: p.x,
      startMY: p.y,
      startCrop: { x: crop.x, y: crop.y, w: crop.w, h: crop.h }
    };
  } else {
    // Start new crop selection from click point
    var ip = canvasToImg(p.x, p.y);
    if (ip.x >= 0 && ip.x <= transformedCvs.width && ip.y >= 0 && ip.y <= transformedCvs.height) {
      crop.x = ip.x;
      crop.y = ip.y;
      crop.w = 1;
      crop.h = 1;
      interaction = {
        type: 'se',
        startMX: p.x,
        startMY: p.y,
        startCrop: { x: crop.x, y: crop.y, w: crop.w, h: crop.h }
      };
    }
  }
});

canvas.addEventListener('pointermove', function(e) {
  var p = getPointerXY(e);
  if (!interaction) {
    var hit = hitTest(p.x, p.y);
    canvas.style.cursor = getCursor(hit);
    return;
  }
  e.preventDefault();
  var dx = (p.x - interaction.startMX) / dScale;
  var dy = (p.y - interaction.startMY) / dScale;
  var sc = interaction.startCrop;
  var tw = transformedCvs.width;
  var th = transformedCvs.height;
  var MIN = 10;

  if (interaction.type === 'move') {
    crop.x = clamp(sc.x + dx, 0, tw - sc.w);
    crop.y = clamp(sc.y + dy, 0, th - sc.h);
    crop.w = sc.w;
    crop.h = sc.h;
  } else {
    resizeCrop(interaction.type, dx, dy, sc, tw, th, MIN);
  }

  draw();
  updateInfo();
});

canvas.addEventListener('pointerup', function(e) {
  if (interaction && crop.w < 5 && crop.h < 5) {
    // Click without drag — reset to full crop
    initCrop();
  }
  interaction = null;
  draw();
  updateInfo();
});

function resizeCrop(type, dx, dy, sc, tw, th, MIN) {
  var r = aspectRatio;
  switch (type) {
    case 'se':
      crop.x = sc.x;
      crop.y = sc.y;
      crop.w = clamp(sc.w + dx, MIN, tw - sc.x);
      if (r) { crop.h = crop.w / r; } else { crop.h = clamp(sc.h + dy, MIN, th - sc.y); }
      if (r && sc.y + crop.h > th) { crop.h = th - sc.y; crop.w = crop.h * r; }
      break;
    case 'sw':
      crop.y = sc.y;
      crop.w = clamp(sc.w - dx, MIN, sc.x + sc.w);
      crop.x = sc.x + sc.w - crop.w;
      if (r) { crop.h = crop.w / r; } else { crop.h = clamp(sc.h + dy, MIN, th - sc.y); }
      if (r && sc.y + crop.h > th) { crop.h = th - sc.y; crop.w = crop.h * r; crop.x = sc.x + sc.w - crop.w; }
      break;
    case 'ne':
      crop.x = sc.x;
      crop.w = clamp(sc.w + dx, MIN, tw - sc.x);
      if (r) { crop.h = crop.w / r; } else { crop.h = clamp(sc.h - dy, MIN, sc.y + sc.h); }
      crop.y = sc.y + sc.h - crop.h;
      if (r && crop.y < 0) { crop.y = 0; crop.h = sc.y + sc.h; crop.w = crop.h * r; }
      break;
    case 'nw':
      crop.w = clamp(sc.w - dx, MIN, sc.x + sc.w);
      crop.x = sc.x + sc.w - crop.w;
      if (r) { crop.h = crop.w / r; } else { crop.h = clamp(sc.h - dy, MIN, sc.y + sc.h); }
      crop.y = sc.y + sc.h - crop.h;
      if (r && crop.y < 0) { crop.y = 0; crop.h = sc.y + sc.h; crop.w = crop.h * r; crop.x = sc.x + sc.w - crop.w; }
      break;
    case 'n':
      crop.x = sc.x;
      crop.w = sc.w;
      crop.h = clamp(sc.h - dy, MIN, sc.y + sc.h);
      crop.y = sc.y + sc.h - crop.h;
      if (r) { crop.w = crop.h * r; crop.x = sc.x + (sc.w - crop.w) / 2; }
      break;
    case 's':
      crop.x = sc.x;
      crop.y = sc.y;
      crop.w = sc.w;
      crop.h = clamp(sc.h + dy, MIN, th - sc.y);
      if (r) { crop.w = crop.h * r; crop.x = sc.x + (sc.w - crop.w) / 2; }
      break;
    case 'e':
      crop.y = sc.y;
      crop.h = sc.h;
      crop.x = sc.x;
      crop.w = clamp(sc.w + dx, MIN, tw - sc.x);
      if (r) { crop.h = crop.w / r; crop.y = sc.y + (sc.h - crop.h) / 2; }
      break;
    case 'w':
      crop.y = sc.y;
      crop.h = sc.h;
      crop.w = clamp(sc.w - dx, MIN, sc.x + sc.w);
      crop.x = sc.x + sc.w - crop.w;
      if (r) { crop.h = crop.w / r; crop.y = sc.y + (sc.h - crop.h) / 2; }
      break;
  }
  // Clamp to bounds
  crop.x = clamp(crop.x, 0, tw - crop.w);
  crop.y = clamp(crop.y, 0, th - crop.h);
}

function clamp(v, min, max) { return Math.max(min, Math.min(max, v)); }

/* ---- Aspect Ratio ---- */

function setRatio(ratio, btn) {
  aspectRatio = ratio;
  targetW = 0;
  targetH = 0;
  document.getElementById('socialPreset').value = '';
  document.getElementById('customW').value = '';
  document.getElementById('customH').value = '';
  document.querySelectorAll('.aspect-btn').forEach(function(b) { b.classList.remove('active'); });
  if (btn) btn.classList.add('active');
  if (ratio !== null && transformedCvs) {
    applyCropRatio();
  }
  draw();
  updateInfo();
}

function setSocial(val) {
  if (!val) { setRatio(null, document.querySelector('.aspect-btn')); return; }
  var parts = val.split(',');
  targetW = parseInt(parts[0]);
  targetH = parseInt(parts[1]);
  aspectRatio = targetW / targetH;
  document.getElementById('customW').value = targetW;
  document.getElementById('customH').value = targetH;
  document.querySelectorAll('.aspect-btn').forEach(function(b) { b.classList.remove('active'); });
  if (transformedCvs) applyCropRatio();
  draw();
  updateInfo();
}

function setCustomSize() {
  var w = parseInt(document.getElementById('customW').value);
  var h = parseInt(document.getElementById('customH').value);
  if (w > 0 && h > 0) {
    targetW = w;
    targetH = h;
    aspectRatio = w / h;
    document.getElementById('socialPreset').value = '';
    document.querySelectorAll('.aspect-btn').forEach(function(b) { b.classList.remove('active'); });
    if (transformedCvs) applyCropRatio();
    draw();
    updateInfo();
  } else if (w > 0 || h > 0) {
    // Only one dimension set — don't change ratio yet
  }
}

function applyCropRatio() {
  if (!transformedCvs || !aspectRatio) return;
  var tw = transformedCvs.width;
  var th = transformedCvs.height;
  // Maximize crop for this ratio within image
  var newW, newH;
  if (tw / th > aspectRatio) {
    newH = th;
    newW = th * aspectRatio;
  } else {
    newW = tw;
    newH = tw / aspectRatio;
  }
  // Center
  crop.w = newW;
  crop.h = newH;
  crop.x = (tw - newW) / 2;
  crop.y = (th - newH) / 2;
}

/* ---- Transforms ---- */

function rotateImg(deg) {
  if (!transformedCvs) return;
  var oldTW = transformedCvs.width;
  var oldTH = transformedCvs.height;

  // Remap crop BEFORE rebuilding
  var cx = crop.x, cy = crop.y, cw = crop.w, ch = crop.h;

  if (deg === 90) {
    rotation = (rotation + 90) % 360;
    crop.x = oldTH - cy - ch;
    crop.y = cx;
    crop.w = ch;
    crop.h = cw;
  } else {
    rotation = (rotation + 270) % 360;
    crop.x = cy;
    crop.y = oldTW - cx - cw;
    crop.w = ch;
    crop.h = cw;
  }

  rebuildTransformed();
  // Clamp
  crop.x = clamp(crop.x, 0, transformedCvs.width - crop.w);
  crop.y = clamp(crop.y, 0, transformedCvs.height - crop.h);
  setupCanvas();
  draw();
  updateInfo();
}

function flipImg(axis) {
  if (!transformedCvs) return;
  var tw = transformedCvs.width;
  var th = transformedCvs.height;

  if (axis === 'h') {
    isFlipH = !isFlipH;
    crop.x = tw - crop.x - crop.w;
  } else {
    isFlipV = !isFlipV;
    crop.y = th - crop.y - crop.h;
  }
  rebuildTransformed();
  draw();
  updateInfo();
}

/* ---- Zoom ---- */

function setZoom(val) {
  zoomLevel = parseInt(val) / 100;
  document.getElementById('zoomVal').textContent = val + '%';
  draw();
}

/* ---- Info Bar ---- */

function updateInfo() {
  if (!originalImg || !transformedCvs) return;
  document.getElementById('infoOriginal').textContent = originalImg.naturalWidth + ' x ' + originalImg.naturalHeight + ' px';
  document.getElementById('infoCrop').textContent = Math.round(crop.w) + ' x ' + Math.round(crop.h) + ' px';
  var outW = targetW || Math.round(crop.w);
  var outH = targetH || Math.round(crop.h);
  document.getElementById('infoOutput').textContent = outW + ' x ' + outH + ' px';
  var bytes = originalImg.naturalWidth * originalImg.naturalHeight * 4;
  document.getElementById('infoSize').textContent = formatBytes(bytes) + ' (raw)';
}

function formatBytes(b) {
  if (b === 0) return '0 B';
  var k = 1024, s = ['B', 'KB', 'MB', 'GB'];
  var i = Math.floor(Math.log(b) / Math.log(k));
  return parseFloat((b / Math.pow(k, i)).toFixed(1)) + ' ' + s[i];
}

/* ---- Download / Export ---- */

function updateQualityVis() {
  var fmt = document.getElementById('formatSelect').value;
  var show = fmt !== 'png';
  document.getElementById('qualityLabel').style.display = show ? '' : 'none';
  document.getElementById('qualitySlider').style.display = show ? '' : 'none';
  document.getElementById('qualityVal').style.display = show ? '' : 'none';
}

function downloadCrop() {
  if (!transformedCvs) { showToast('No image loaded'); return; }
  var fmt = document.getElementById('formatSelect').value;
  var quality = parseInt(document.getElementById('qualitySlider').value) / 100;
  var outW = targetW || Math.round(crop.w);
  var outH = targetH || Math.round(crop.h);

  var exportCvs = document.createElement('canvas');
  exportCvs.width = outW;
  exportCvs.height = outH;
  var ectx = exportCvs.getContext('2d');

  // Draw the cropped region scaled to output dimensions
  ectx.drawImage(transformedCvs, Math.round(crop.x), Math.round(crop.y), Math.round(crop.w), Math.round(crop.h), 0, 0, outW, outH);

  var mimeType = 'image/png';
  var ext = 'png';
  if (fmt === 'jpeg') { mimeType = 'image/jpeg'; ext = 'jpg'; ectx.globalCompositeOperation = 'destination-over'; ectx.fillStyle = '#fff'; ectx.fillRect(0, 0, outW, outH); }
  else if (fmt === 'webp') { mimeType = 'image/webp'; ext = 'webp'; }

  exportCvs.toBlob(function(blob) {
    if (!blob) { showToast('Export failed. Try a different format.'); return; }
    var url = URL.createObjectURL(blob);
    var a = document.createElement('a');
    a.href = url;
    a.download = fileName + '-cropped-' + outW + 'x' + outH + '.' + ext;
    a.click();
    setTimeout(function() { URL.revokeObjectURL(url); }, 3000);
    showToast('Downloaded ' + outW + 'x' + outH + ' ' + ext.toUpperCase());
  }, mimeType, fmt === 'png' ? undefined : quality);
}

/* ---- Toast ---- */

function showToast(msg) {
  var t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(function() { t.classList.remove('show'); }, 2500);
}

/* ---- Window Resize ---- */

var resizeTimer;
window.addEventListener('resize', function() {
  clearTimeout(resizeTimer);
  resizeTimer = setTimeout(function() {
    if (transformedCvs) {
      setupCanvas();
      draw();
    }
  }, 150);
});

/* ---- Fade In ---- */

var observer = new IntersectionObserver(function(entries) {
  entries.forEach(function(entry) {
    if (entry.isIntersecting) { entry.target.classList.add('visible'); observer.unobserve(entry.target); }
  });
}, { threshold: 0.1 });
document.querySelectorAll('.fade-in').forEach(function(el) { observer.observe(el); });

/* ---- Init ---- */
updateQualityVis();
</script>
<script src="/js/analytics-lite.js" defer></script>
<script src="/js/revenue.js" defer></script>
<script src="/js/lead-capture.js" defer></script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    {
      "@type": "Question",
      "name": "How do I crop an image online for free?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Upload your image to NexTool's free Image Cropper by dragging and dropping or clicking Browse Files. Then drag the crop handles to select the area you want to keep. Choose an aspect ratio or social media preset if needed, and click Download. Everything runs in your browser — no uploads to any server."
      }
    },
    {
      "@type": "Question",
      "name": "Can I crop images for Instagram and other social media?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Yes. NexTool's Image Cropper includes presets for Instagram Post (1080x1080), Instagram Story (1080x1920), Facebook Cover (820x312), Twitter Header (1500x500), YouTube Thumbnail (1280x720), and LinkedIn Banner (1584x396). Select a preset and the crop area adjusts automatically."
      }
    },
    {
      "@type": "Question",
      "name": "What image formats can I download?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "You can download your cropped image as PNG (lossless, supports transparency), JPG (smaller file size with adjustable quality), or WebP (modern format with great compression). Use the quality slider to control file size for JPG and WebP."
      }
    },
    {
      "@type": "Question",
      "name": "Is my image uploaded to a server?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "No. NexTool's Image Cropper is 100% client-side. Your image never leaves your device. All cropping, rotating, flipping, and exporting happens directly in your browser using the Canvas API."
      }
    }
  ]
}
</script>
</body>
</html>
