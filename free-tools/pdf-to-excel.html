<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Free PDF to Excel Converter Online — Extract Tables | ANIMA</title>
<meta name="description" content="Convert PDF to Excel (.xlsx) free online. Extract tables from PDF files with auto-detection, preview data, name sheets, and download. 100% client-side, no upload.">
<meta name="keywords" content="pdf to excel converter, pdf to xlsx, extract tables from pdf, convert pdf to spreadsheet, free pdf converter, pdf table extractor, ANIMA">
<meta name="robots" content="index, follow">
<meta property="og:title" content="Free PDF to Excel Converter — Extract Tables from PDF | ANIMA">
<meta property="og:description" content="Convert PDF to Excel instantly. Extract tables with auto-detection, preview data, download .xlsx. 100% free, no signup, runs in your browser.">
<meta property="og:type" content="website">
<meta property="og:url" content="https://nextool.app/free-tools/pdf-to-excel.html">
<meta property="og:image" content="https://nextool.app/img/og-image.png">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<link rel="canonical" href="https://nextool.app/free-tools/pdf-to-excel.html">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Free PDF to Excel Converter — Extract Tables | ANIMA">
<meta name="twitter:description" content="Convert PDF to Excel online. Auto-detect tables, preview data, download .xlsx. Free tool by ANIMA.">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"SoftwareApplication","name":"PDF to Excel Converter","applicationCategory":"UtilitiesApplication","operatingSystem":"Web","offers":{"@type":"Offer","price":"0","priceCurrency":"USD"},"description":"Free online PDF to Excel converter. Extract tables from PDF files, auto-detect table structures, preview data, and download as .xlsx spreadsheet."}
</script>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{--bg:#050508;--surface:#111118;--surface2:#1a1a24;--border:#2a2a3a;--text:#e4e4eb;--text2:#9494a8;--primary:#00d4ff;--accent:#a855f7;--pink:#ec4899;--green:#22c55e;--red:#ef4444;--cyan:#22d3ee;--yellow:#eab308;--radius:12px;--glass:rgba(17,17,24,0.7)}
html{scroll-behavior:smooth}
body{font-family:'Inter',system-ui,sans-serif;background:var(--bg);color:var(--text);line-height:1.6;min-height:100vh;overflow-x:hidden}
/* NAV */
.nav{position:sticky;top:0;z-index:100;background:rgba(5,5,8,0.85);backdrop-filter:blur(20px);border-bottom:1px solid var(--border);padding:0 2rem;height:64px;display:flex;align-items:center;justify-content:space-between}
.nav-logo{font-size:1.4rem;font-weight:800;background:linear-gradient(135deg,var(--primary),var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent;text-decoration:none}
.nav-links{display:flex;align-items:center;gap:1.5rem}
.nav-links a{color:var(--text2);text-decoration:none;font-size:.875rem;font-weight:500;transition:color .2s}
.nav-links a:hover{color:var(--text)}
.nav-cta{background:linear-gradient(135deg,var(--primary),var(--accent));color:#fff!important;padding:.5rem 1.2rem;border-radius:8px;font-weight:600;-webkit-text-fill-color:#fff!important}
.nav-cta:hover{opacity:.9}
.nav-toggle{display:none;background:none;border:none;color:var(--text);font-size:1.5rem;cursor:pointer}
/* HERO */
.hero{text-align:center;padding:3rem 1.5rem 2rem;max-width:700px;margin:0 auto}
.hero h1{font-size:2.2rem;font-weight:800;line-height:1.2;margin-bottom:.75rem}
.hero h1 span{background:linear-gradient(135deg,var(--primary),var(--accent),var(--pink));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.hero p{color:var(--text2);font-size:1rem}
/* TOOL */
.tool-container{max-width:1100px;margin:0 auto;padding:0 1.5rem 3rem}
/* DROP ZONE */
.drop-zone{border:2px dashed var(--border);border-radius:var(--radius);padding:3rem 2rem;text-align:center;cursor:pointer;transition:all .3s;background:var(--glass);backdrop-filter:blur(16px);position:relative}
.drop-zone:hover,.drop-zone.dragover{border-color:var(--primary);background:rgba(0,212,255,.06)}
.drop-zone svg{margin-bottom:1rem;color:var(--text2)}
.drop-zone h3{font-size:1.1rem;font-weight:700;margin-bottom:.4rem}
.drop-zone p{color:var(--text2);font-size:.85rem}
.drop-zone input{position:absolute;inset:0;opacity:0;cursor:pointer}
/* STATUS */
.status-bar{display:flex;align-items:center;gap:1rem;margin:1rem 0;font-size:.8rem;color:var(--text2);flex-wrap:wrap}
.status-dot{width:8px;height:8px;border-radius:50%;display:inline-block}
.status-dot.ready{background:var(--green)}
.status-dot.processing{background:var(--yellow);animation:pulse 1s infinite}
.status-dot.error{background:var(--red)}
.status-dot.empty{background:var(--border)}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}
/* TOOLBAR */
.toolbar{display:flex;flex-wrap:wrap;gap:.5rem;margin-bottom:1rem;align-items:center}
.toolbar button,.toolbar select,.toolbar input[type="text"]{background:var(--surface2);border:1px solid var(--border);color:var(--text);padding:.45rem .9rem;border-radius:8px;font-size:.8rem;font-weight:500;cursor:pointer;transition:all .2s;font-family:inherit}
.toolbar button:hover{border-color:var(--primary);background:rgba(0,212,255,.12)}
.toolbar button:disabled{opacity:.4;cursor:not-allowed}
.toolbar button.primary-btn{background:linear-gradient(135deg,var(--primary),var(--accent));border-color:transparent;color:#fff;font-weight:600}
.toolbar button.primary-btn:hover{opacity:.9}
.toolbar button.primary-btn:disabled{opacity:.4}
.toolbar select{appearance:none;padding-right:1.8rem;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%239494a8' viewBox='0 0 16 16'%3E%3Cpath d='M8 11L3 6h10z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right .6rem center}
.toolbar input[type="text"]{width:180px}
/* PROGRESS */
.progress-wrap{display:none;margin:1rem 0}
.progress-bar{height:6px;background:var(--surface2);border-radius:3px;overflow:hidden}
.progress-fill{height:100%;background:linear-gradient(135deg,var(--primary),var(--accent));border-radius:3px;transition:width .3s;width:0}
.progress-text{font-size:.75rem;color:var(--text2);margin-top:.3rem;text-align:center}
/* PREVIEW TABLE */
.preview-wrap{display:none;margin-top:1.5rem}
.preview-panel{background:var(--glass);backdrop-filter:blur(16px);border:1px solid var(--border);border-radius:var(--radius);overflow:hidden}
.preview-header{padding:.6rem 1rem;border-bottom:1px solid var(--border);font-size:.8rem;font-weight:600;color:var(--text2);display:flex;justify-content:space-between;align-items:center;background:rgba(26,26,36,0.5);flex-wrap:wrap;gap:.5rem}
.preview-tabs{display:flex;gap:.3rem;flex-wrap:wrap}
.preview-tab{padding:.3rem .7rem;border-radius:6px;font-size:.75rem;font-weight:500;cursor:pointer;color:var(--text2);background:transparent;border:1px solid transparent;transition:all .2s}
.preview-tab:hover{color:var(--text)}
.preview-tab.active{background:rgba(0,212,255,.15);color:var(--primary);border-color:rgba(0,212,255,.3)}
.preview-body{overflow:auto;max-height:500px}
.preview-table{width:100%;border-collapse:collapse;font-size:.8rem}
.preview-table th{background:rgba(0,212,255,.08);color:var(--primary);font-weight:600;text-align:left;padding:.5rem .6rem;border-bottom:1px solid var(--border);white-space:nowrap;position:sticky;top:0}
.preview-table td{padding:.4rem .6rem;border-bottom:1px solid rgba(42,42,58,.5);color:var(--text);white-space:nowrap;max-width:300px;overflow:hidden;text-overflow:ellipsis}
.preview-table tr:hover td{background:rgba(0,212,255,.04)}
.preview-info{padding:1rem;color:var(--text2);font-size:.85rem;text-align:center}
/* PAGE NAV */
.page-nav{display:flex;gap:.3rem;align-items:center;flex-wrap:wrap}
.page-nav button{background:var(--surface2);border:1px solid var(--border);color:var(--text2);padding:.25rem .5rem;border-radius:6px;font-size:.7rem;cursor:pointer;transition:all .2s;font-family:inherit}
.page-nav button:hover{border-color:var(--primary);color:var(--text)}
.page-nav button.active{background:rgba(0,212,255,.15);color:var(--primary);border-color:rgba(0,212,255,.3)}
/* CTA */
.cta-section{text-align:center;padding:4rem 1.5rem;max-width:700px;margin:0 auto}
.cta-section h2{font-size:1.8rem;font-weight:800;margin-bottom:.75rem}
.cta-section h2 span{background:linear-gradient(135deg,var(--primary),var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.cta-section p{color:var(--text2);margin-bottom:1.5rem}
.cta-btn{display:inline-block;background:linear-gradient(135deg,var(--primary),var(--accent));color:#fff;padding:.75rem 2rem;border-radius:10px;font-weight:700;text-decoration:none;font-size:1rem;transition:transform .2s,box-shadow .2s}
.cta-btn:hover{transform:translateY(-2px);box-shadow:0 8px 30px rgba(0,212,255,.3)}
/* FOOTER */
.footer{border-top:1px solid var(--border);padding:3rem 2rem 2rem;max-width:1200px;margin:0 auto}
.footer-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:2rem;margin-bottom:2rem}
.footer-col h4{font-size:.85rem;font-weight:700;margin-bottom:.75rem;color:var(--text)}
.footer-col a{display:block;color:var(--text2);text-decoration:none;font-size:.8rem;margin-bottom:.4rem;transition:color .2s}
.footer-col a:hover{color:var(--primary)}
.footer-bottom{text-align:center;color:var(--text2);font-size:.75rem;padding-top:1.5rem;border-top:1px solid var(--border)}
/* FADE IN */
.fade-in{opacity:0;transform:translateY(20px);transition:opacity .6s,transform .6s}
.fade-in.visible{opacity:1;transform:translateY(0)}
/* TOAST */
.toast{position:fixed;bottom:2rem;left:50%;transform:translateX(-50%) translateY(80px);background:var(--surface2);border:1px solid var(--border);color:var(--text);padding:.6rem 1.2rem;border-radius:10px;font-size:.85rem;font-weight:500;z-index:200;transition:transform .3s;pointer-events:none}
.toast.show{transform:translateX(-50%) translateY(0)}
/* RESPONSIVE */
@media(max-width:768px){
  .nav-links{display:none;position:absolute;top:64px;left:0;right:0;background:var(--bg);border-bottom:1px solid var(--border);flex-direction:column;padding:1rem 2rem;gap:1rem}
  .nav-links.open{display:flex}
  .nav-toggle{display:block}
  .hero h1{font-size:1.6rem}
  .footer-grid{grid-template-columns:1fr}
  .toolbar{gap:.35rem}
  .drop-zone{padding:2rem 1rem}
  .toolbar input[type="text"]{width:140px}
}
</style>
</head>
<body>

<nav class="nav">
  <a href="/" class="nav-logo">ANIMA</a>
  <button class="nav-toggle" onclick="document.querySelector('.nav-links').classList.toggle('open')" aria-label="Menu">&#9776;</button>
  <div class="nav-links">
    <a href="/">Home</a>
    <a href="/free-tools/">Tools</a>
    <a href="/free-tools/">Free Tools</a>
    <a href="/blog/">Blog</a>
    <a href="https://github.com/christian140903-sudo/nextool" class="nav-cta" target="_blank" rel="noopener">GitHub</a>
  </div>
</nav>

<section class="hero fade-in">
  <h1>Free <span>PDF to Excel</span> Converter</h1>
  <p class="tool-summary" style="color:#94a3b8;font-size:15px;line-height:1.6;margin-bottom:24px;max-width:700px;margin-left:auto;margin-right:auto;">Convert PDF files to Excel spreadsheets (.xlsx) instantly in your browser. Auto-detects tables, extracts rows and columns, lets you preview the data, rename sheets, and download a clean .xlsx file. No upload to any server &mdash; 100% client-side and free.</p>
</section>

<div class="tool-container fade-in">
  <div class="drop-zone" id="dropZone">
    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><path d="M12 18v-6"/><polyline points="9 15 12 12 15 15"/></svg>
    <h3>Drop your PDF file here</h3>
    <p>or click to browse &mdash; PDF files up to 50 MB</p>
    <input type="file" id="fileInput" accept=".pdf,application/pdf">
  </div>

  <div class="progress-wrap" id="progressWrap">
    <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
    <div class="progress-text" id="progressText">Processing...</div>
  </div>

  <div class="status-bar" id="statusBar" style="display:none">
    <span><span class="status-dot empty" id="statusDot"></span></span>
    <span id="statusText">Ready</span>
    <span id="fileInfo" style="margin-left:auto"></span>
  </div>

  <div class="preview-wrap" id="previewWrap">
    <div class="toolbar">
      <label style="font-size:.8rem;color:var(--text2);font-weight:500">Sheet name:</label>
      <input type="text" id="sheetName" value="Sheet1" placeholder="Sheet name">
      <select id="extractMode">
        <option value="auto">Auto-detect tables</option>
        <option value="all-text">All text (one column)</option>
        <option value="lines">Lines as rows</option>
      </select>
      <button onclick="reprocess()" title="Re-extract with current settings">Re-extract</button>
      <button class="primary-btn" onclick="downloadExcel()" id="downloadBtn" disabled title="Download .xlsx">Download .xlsx</button>
      <button onclick="resetTool()" title="Start over">Clear</button>
    </div>

    <div class="preview-panel">
      <div class="preview-header">
        <span id="previewLabel">Table Preview</span>
        <div class="page-nav" id="pageNav"></div>
        <span id="previewInfo"></span>
      </div>
      <div class="preview-body" id="previewBody">
        <div class="preview-info">No data yet. Upload a PDF to begin.</div>
      </div>
    </div>
  </div>
</div>

<section class="cta-section fade-in">
  <h2>Need something <span>more powerful</span>?</h2>
  <p>Let us build it for you. Custom APIs, dashboards, automations &mdash; whatever you need.</p>
  <a href="/#contact" class="cta-btn">Start a Project &rarr;</a>
</section>

<!-- Cross Promo -->
<section style="max-width:900px;margin:40px auto;padding:0 24px;">
<div style="background:linear-gradient(135deg,rgba(0,212,255,0.1),rgba(168,85,247,0.08));border:1px solid rgba(0,212,255,0.15);border-radius:20px;padding:32px 28px;text-align:center;">
<div style="font-size:13px;color:#818cf8;font-weight:600;text-transform:uppercase;letter-spacing:1px;margin-bottom:8px;">Founding Member</div>
<h3 style="font-size:22px;font-weight:800;color:#fff;margin:0 0 8px;">ANIMA on GitHub</h3>
<p style="color:#94a3b8;font-size:14px;margin:0 auto 20px;max-width:500px;">248+ free tools. No signup. Open source. Built by Christian Bucher.</p>
<div style="display:flex;align-items:center;justify-content:center;gap:12px;flex-wrap:wrap;">
<a href="/about/" style="display:inline-block;padding:12px 28px;background:linear-gradient(135deg,#00d4ff,#a855f7,#ec4899);color:#fff;border-radius:10px;font-weight:700;font-size:15px;text-decoration:none;">Open Source &mdash; Free Forever</a>
<a href="/free-tools/" style="color:#94a3b8;font-size:14px;text-decoration:none;">Browse 250+ Free Tools &rarr;</a>
</div>
</div>
</section>


<!-- AUTO-LINKED by ANIMA Engine -->
<div style="margin:2rem 0;padding:1.5rem;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius)">
<p style="font-weight:600;margin-bottom:.5rem">Related Tools</p>
<p><a href="/free-tools/box-shadow-generator.html" style="color:var(--primary);text-decoration:none">CSS Box Shadow Generator</a> · <a href="/free-tools/emoji-picker.html" style="color:var(--primary);text-decoration:none">Emoji Picker & Search</a> · <a href="/free-tools/json-to-yaml-converter.html" style="color:var(--primary);text-decoration:none">Free JSON to YAML Converter</a></p>
</div>
<footer class="footer fade-in">
  <div class="footer-grid">
    <div class="footer-col">
      <h4>Products</h4>
      <a href="/free-tools/">250+ Free Tools</a>
<a href="/about/">About</a>
<a href="/docs/">Documentation</a>
    </div>
    <div class="footer-col">
      <h4>Explore</h4>
      <a href="/free-tools/">Free Tools</a><a href="/blog/">Blog</a><a href="/about/">FAQ</a><a href="/about/">About</a>
    </div>
    <div class="footer-col">
      <h4>Ecosystem</h4>
      <a href="/">ANIMA Home</a><a href="/#contact">Contact</a><a href="https://github.com/christian140903-sudo/nextool" target="_blank">GitHub</a>
    </div>
  </div>
  <div class="footer-bottom">&copy; 2026 ANIMA. AI-powered tools for everyone.</div>
</footer>

<div class="toast" id="toast"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
<script>
/* ===== PDF to Excel Converter ===== */
pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

const dropZone = document.getElementById('dropZone');
const fileInput = document.getElementById('fileInput');
const progressWrap = document.getElementById('progressWrap');
const progressFill = document.getElementById('progressFill');
const progressText = document.getElementById('progressText');
const statusBar = document.getElementById('statusBar');
const statusDot = document.getElementById('statusDot');
const statusTextEl = document.getElementById('statusText');
const fileInfo = document.getElementById('fileInfo');
const previewWrap = document.getElementById('previewWrap');
const previewBody = document.getElementById('previewBody');
const previewLabel = document.getElementById('previewLabel');
const previewInfoEl = document.getElementById('previewInfo');
const pageNav = document.getElementById('pageNav');
const sheetNameInput = document.getElementById('sheetName');
const extractMode = document.getElementById('extractMode');
const downloadBtn = document.getElementById('downloadBtn');

let pdfDoc = null;
let allPagesData = []; // Array of {page, rows: [[cell, ...], ...]}
let currentPage = 0;
let pdfFileName = 'document';

/* Drag & drop */
dropZone.addEventListener('dragover', e => { e.preventDefault(); dropZone.classList.add('dragover'); });
dropZone.addEventListener('dragleave', () => dropZone.classList.remove('dragover'));
dropZone.addEventListener('drop', e => {
  e.preventDefault();
  dropZone.classList.remove('dragover');
  const file = e.dataTransfer.files[0];
  if (file && file.type === 'application/pdf') handleFile(file);
  else showToast('Please drop a PDF file');
});
fileInput.addEventListener('change', e => {
  if (e.target.files[0]) handleFile(e.target.files[0]);
});

async function handleFile(file) {
  if (file.size > 50 * 1024 * 1024) { showToast('File too large (max 50 MB)'); return; }
  pdfFileName = file.name.replace(/\.pdf$/i, '');
  sheetNameInput.value = pdfFileName.substring(0, 31) || 'Sheet1';
  showProgress(true);
  setStatus('processing', 'Loading PDF...');
  statusBar.style.display = 'flex';

  try {
    const arrayBuffer = await file.arrayBuffer();
    pdfDoc = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
    fileInfo.textContent = pdfDoc.numPages + ' page' + (pdfDoc.numPages !== 1 ? 's' : '') + ' | ' + formatBytes(file.size);
    await extractAllPages();
  } catch (err) {
    setStatus('error', 'Failed to load PDF: ' + err.message);
    showProgress(false);
  }
}

async function extractAllPages() {
  const mode = extractMode.value;
  allPagesData = [];
  const total = pdfDoc.numPages;

  for (let i = 1; i <= total; i++) {
    setProgress(Math.round((i / total) * 90), 'Extracting page ' + i + ' of ' + total + '...');
    const page = await pdfDoc.getPage(i);
    const content = await page.getTextContent();
    let rows;
    if (mode === 'auto') {
      rows = extractTableAuto(content);
    } else if (mode === 'all-text') {
      rows = extractAllText(content);
    } else {
      rows = extractLines(content);
    }
    allPagesData.push({ page: i, rows: rows });
  }

  setProgress(100, 'Done!');
  setTimeout(() => showProgress(false), 600);

  const totalRows = allPagesData.reduce((s, p) => s + p.rows.length, 0);
  const maxCols = allPagesData.reduce((s, p) => Math.max(s, ...p.rows.map(r => r.length)), 0);
  setStatus('ready', 'Extracted ' + totalRows + ' rows, ' + maxCols + ' columns from ' + total + ' pages');
  previewWrap.style.display = 'block';
  downloadBtn.disabled = false;
  buildPageNav();
  showPage(0);
}

/* TABLE EXTRACTION: Auto-detect using position clustering */
function extractTableAuto(content) {
  const items = content.items.filter(it => it.str.trim().length > 0);
  if (items.length === 0) return [];

  // Group items by Y position (same row = similar Y within tolerance)
  const yTolerance = 3;
  const rowGroups = [];
  const sorted = items.slice().sort((a, b) => {
    // PDF coordinate: y increases upward, so we reverse
    const dy = b.transform[5] - a.transform[5];
    if (Math.abs(dy) > yTolerance) return dy;
    return a.transform[4] - b.transform[4]; // left to right within row
  });

  let currentY = null;
  let currentRow = [];

  for (const item of sorted) {
    const y = item.transform[5];
    if (currentY === null || Math.abs(y - currentY) > yTolerance) {
      if (currentRow.length > 0) rowGroups.push(currentRow);
      currentRow = [];
      currentY = y;
    }
    currentRow.push(item);
  }
  if (currentRow.length > 0) rowGroups.push(currentRow);

  // Sort items within each row by X position (left to right)
  for (const row of rowGroups) {
    row.sort((a, b) => a.transform[4] - b.transform[4]);
  }

  // Detect column boundaries by finding consistent X positions across rows
  // Collect all X start positions
  const allXPositions = [];
  for (const row of rowGroups) {
    for (const item of row) {
      allXPositions.push(Math.round(item.transform[4]));
    }
  }

  // Cluster X positions to find column boundaries
  allXPositions.sort((a, b) => a - b);
  const colClusters = [];
  const xClusterTolerance = 8;

  for (const x of allXPositions) {
    let found = false;
    for (const cluster of colClusters) {
      if (Math.abs(x - cluster.center) < xClusterTolerance) {
        cluster.positions.push(x);
        cluster.center = cluster.positions.reduce((s, v) => s + v, 0) / cluster.positions.length;
        found = true;
        break;
      }
    }
    if (!found) {
      colClusters.push({ center: x, positions: [x] });
    }
  }

  // Only keep clusters that appear in multiple rows (likely table columns)
  const minOccurrence = Math.max(2, Math.floor(rowGroups.length * 0.15));
  let significantClusters = colClusters.filter(c => c.positions.length >= minOccurrence);

  // If we don't find consistent columns, fall back to per-row splitting
  if (significantClusters.length < 2) {
    // Fallback: use all clusters sorted by center
    significantClusters = colClusters.sort((a, b) => a.center - b.center);
  } else {
    significantClusters.sort((a, b) => a.center - b.center);
  }

  // Build column boundaries (midpoints between cluster centers)
  const colBoundaries = [];
  for (let i = 0; i < significantClusters.length - 1; i++) {
    colBoundaries.push((significantClusters[i].center + significantClusters[i + 1].center) / 2);
  }

  // Assign each item to a column
  const numCols = significantClusters.length;
  const result = [];

  for (const row of rowGroups) {
    const cells = new Array(numCols).fill('');
    for (const item of row) {
      const x = item.transform[4];
      let colIndex = numCols - 1;
      for (let i = 0; i < colBoundaries.length; i++) {
        if (x < colBoundaries[i]) {
          colIndex = i;
          break;
        }
      }
      // Append text to cell (may have multiple items per cell)
      if (cells[colIndex]) cells[colIndex] += ' ';
      cells[colIndex] += item.str.trim();
    }
    // Trim all cells
    const trimmed = cells.map(c => c.trim());
    // Skip completely empty rows
    if (trimmed.some(c => c.length > 0)) {
      result.push(trimmed);
    }
  }

  return result;
}

/* Extract all text as single column */
function extractAllText(content) {
  const text = content.items.map(it => it.str).join('');
  if (!text.trim()) return [];
  return [[text.trim()]];
}

/* Extract lines as individual rows */
function extractLines(content) {
  const items = content.items.filter(it => it.str.trim().length > 0);
  if (items.length === 0) return [];

  const yTolerance = 3;
  const sorted = items.slice().sort((a, b) => {
    const dy = b.transform[5] - a.transform[5];
    if (Math.abs(dy) > yTolerance) return dy;
    return a.transform[4] - b.transform[4];
  });

  const rows = [];
  let currentY = null;
  let currentLine = '';

  for (const item of sorted) {
    const y = item.transform[5];
    if (currentY === null || Math.abs(y - currentY) > yTolerance) {
      if (currentLine.trim()) rows.push([currentLine.trim()]);
      currentLine = '';
      currentY = y;
    }
    if (currentLine) currentLine += ' ';
    currentLine += item.str;
  }
  if (currentLine.trim()) rows.push([currentLine.trim()]);

  return rows;
}

/* Reprocess with new settings */
async function reprocess() {
  if (!pdfDoc) return;
  showProgress(true);
  setStatus('processing', 'Re-extracting...');
  downloadBtn.disabled = true;
  // Use setTimeout to allow UI to update
  setTimeout(async () => {
    await extractAllPages();
  }, 50);
}

/* PAGE NAVIGATION */
function buildPageNav() {
  pageNav.innerHTML = '';
  if (allPagesData.length <= 1) return;

  // "All" button
  const allBtn = document.createElement('button');
  allBtn.textContent = 'All';
  allBtn.className = currentPage === -1 ? 'active' : '';
  allBtn.onclick = () => showPage(-1);
  pageNav.appendChild(allBtn);

  for (let i = 0; i < allPagesData.length; i++) {
    const btn = document.createElement('button');
    btn.textContent = 'P' + (i + 1);
    btn.className = currentPage === i ? 'active' : '';
    btn.onclick = () => showPage(i);
    pageNav.appendChild(btn);
  }
}

function showPage(idx) {
  currentPage = idx;
  buildPageNav();

  let rows;
  if (idx === -1) {
    // Show all pages combined
    rows = allPagesData.flatMap(p => p.rows);
    previewLabel.textContent = 'All Pages (' + allPagesData.length + ')';
  } else {
    rows = allPagesData[idx].rows;
    previewLabel.textContent = 'Page ' + (idx + 1);
  }

  if (rows.length === 0) {
    previewBody.innerHTML = '<div class="preview-info">No data found on this page.</div>';
    previewInfoEl.textContent = '0 rows';
    return;
  }

  const maxCols = Math.max(...rows.map(r => r.length));
  previewInfoEl.textContent = rows.length + ' rows, ' + maxCols + ' cols';

  // Build table
  let html = '<table class="preview-table"><thead><tr>';
  for (let c = 0; c < maxCols; c++) {
    html += '<th>' + colLetter(c) + '</th>';
  }
  html += '</tr></thead><tbody>';

  // Limit preview to first 200 rows for performance
  const previewRows = rows.slice(0, 200);
  for (const row of previewRows) {
    html += '<tr>';
    for (let c = 0; c < maxCols; c++) {
      const val = (row[c] || '').replace(/</g, '&lt;').replace(/>/g, '&gt;');
      html += '<td title="' + val.replace(/"/g, '&quot;') + '">' + val + '</td>';
    }
    html += '</tr>';
  }
  html += '</tbody></table>';

  if (rows.length > 200) {
    html += '<div class="preview-info">Showing first 200 of ' + rows.length + ' rows. Full data will be in the downloaded .xlsx file.</div>';
  }

  previewBody.innerHTML = html;
}

function colLetter(idx) {
  let s = '';
  idx++;
  while (idx > 0) {
    idx--;
    s = String.fromCharCode(65 + (idx % 26)) + s;
    idx = Math.floor(idx / 26);
  }
  return s;
}

/* DOWNLOAD EXCEL */
function downloadExcel() {
  if (allPagesData.length === 0) return;

  const wb = XLSX.utils.book_new();
  const name = (sheetNameInput.value.trim() || 'Sheet1').substring(0, 31);

  // Combine all pages into one sheet
  const allRows = allPagesData.flatMap(p => p.rows);
  if (allRows.length === 0) {
    showToast('No data to export');
    return;
  }

  // Normalize row lengths
  const maxCols = Math.max(...allRows.map(r => r.length));
  const normalized = allRows.map(r => {
    const row = [...r];
    while (row.length < maxCols) row.push('');
    return row;
  });

  // Try to detect numeric values
  const typedRows = normalized.map(row =>
    row.map(cell => {
      if (cell === '') return '';
      // Check if it looks like a number
      const num = Number(cell.replace(/,/g, ''));
      if (!isNaN(num) && cell.trim() !== '' && !/^0\d/.test(cell.trim())) return num;
      return cell;
    })
  );

  const ws = XLSX.utils.aoa_to_sheet(typedRows);

  // Set column widths based on content
  const colWidths = [];
  for (let c = 0; c < maxCols; c++) {
    let maxLen = 8;
    for (const row of typedRows) {
      const val = String(row[c] || '');
      if (val.length > maxLen) maxLen = Math.min(val.length, 50);
    }
    colWidths.push({ wch: maxLen + 2 });
  }
  ws['!cols'] = colWidths;

  XLSX.utils.book_append_sheet(wb, ws, name);

  // If multi-page PDF, also create per-page sheets
  if (allPagesData.length > 1) {
    for (let i = 0; i < allPagesData.length; i++) {
      const pageRows = allPagesData[i].rows;
      if (pageRows.length === 0) continue;
      const pgMaxCols = Math.max(...pageRows.map(r => r.length));
      const pgNorm = pageRows.map(r => {
        const row = [...r];
        while (row.length < pgMaxCols) row.push('');
        return row.map(cell => {
          if (cell === '') return '';
          const num = Number(cell.replace(/,/g, ''));
          if (!isNaN(num) && cell.trim() !== '' && !/^0\d/.test(cell.trim())) return num;
          return cell;
        });
      });
      const pgWs = XLSX.utils.aoa_to_sheet(pgNorm);
      const pgName = ('Page ' + (i + 1)).substring(0, 31);
      XLSX.utils.book_append_sheet(wb, pgWs, pgName);
    }
  }

  XLSX.writeFile(wb, pdfFileName + '.xlsx');
  showToast('Downloaded ' + pdfFileName + '.xlsx');
}

/* RESET */
function resetTool() {
  pdfDoc = null;
  allPagesData = [];
  currentPage = 0;
  pdfFileName = 'document';
  fileInput.value = '';
  sheetNameInput.value = 'Sheet1';
  extractMode.value = 'auto';
  statusBar.style.display = 'none';
  previewWrap.style.display = 'none';
  downloadBtn.disabled = true;
  showProgress(false);
  previewBody.innerHTML = '<div class="preview-info">No data yet. Upload a PDF to begin.</div>';
  pageNav.innerHTML = '';
}

/* HELPERS */
function setStatus(type, text) {
  statusDot.className = 'status-dot ' + type;
  statusTextEl.textContent = text;
}

function showProgress(show) {
  progressWrap.style.display = show ? 'block' : 'none';
  if (!show) { progressFill.style.width = '0'; progressText.textContent = ''; }
}

function setProgress(pct, text) {
  progressFill.style.width = pct + '%';
  progressText.textContent = text;
}

function formatBytes(bytes) {
  if (bytes === 0) return '0 B';
  const k = 1024, sizes = ['B', 'KB', 'MB'];
  const i = Math.floor(Math.log(bytes) / Math.log(k));
  return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
}

function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2500);
}

/* IntersectionObserver fade-in */
const observer = new IntersectionObserver(entries => {
  entries.forEach(entry => { if (entry.isIntersecting) { entry.target.classList.add('visible'); observer.unobserve(entry.target); }});
}, { threshold: 0.1 });
document.querySelectorAll('.fade-in').forEach(el => observer.observe(el));
</script>
<script src="/js/analytics-lite.js" defer></script>
<script src="/js/revenue.js" defer></script>
<script src="/js/lead-capture.js" defer></script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    {
      "@type": "Question",
      "name": "How do I convert a PDF to Excel for free?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Simply drag and drop your PDF file onto ANIMA's PDF to Excel Converter. The tool automatically detects tables in your PDF, extracts rows and columns, and lets you download the data as an .xlsx Excel file. It runs entirely in your browser with no upload to any server."
      }
    },
    {
      "@type": "Question",
      "name": "Can this tool extract tables from scanned PDFs?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "This tool works with text-based PDFs where the text is selectable. Scanned PDFs (image-only) require OCR processing first. If your PDF has selectable text, the table auto-detection will identify and extract structured data into columns and rows."
      }
    },
    {
      "@type": "Question",
      "name": "Is my PDF data safe when using this converter?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Yes, your data is completely safe. ANIMA's PDF to Excel Converter processes everything locally in your browser using JavaScript. Your PDF file is never uploaded to any server. No data leaves your device."
      }
    },
    {
      "@type": "Question",
      "name": "What extraction modes are available?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Three modes are available: Auto-detect tables (analyzes text positions to identify columns and rows), All text (extracts all text into a single column), and Lines as rows (each line of text becomes a separate row). Auto-detect works best for PDFs with tabular data."
      }
    },
    {
      "@type": "Question",
      "name": "Can I convert a multi-page PDF to Excel?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Yes. The tool processes all pages of your PDF. You can preview each page individually or view all data combined. The downloaded .xlsx file includes a combined sheet plus individual sheets for each page, so you can work with the data however you prefer."
      }
    }
  ]
}
</script>
</body>
</html>
