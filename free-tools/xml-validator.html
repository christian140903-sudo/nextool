<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Free XML Validator &amp; Formatter — Validate, Format XML | NexTool</title>
<meta name="description" content="Free online XML validator, formatter, and minifier. Check XML syntax, prettify with indentation, view tree structure, and get error details with line numbers.">
<meta name="keywords" content="XML validator, XML formatter, XML prettifier, XML minifier, XML tree view, well-formed XML, free online tool, NexTool">
<meta name="robots" content="index, follow">
<meta property="og:title" content="Free XML Validator & Formatter | NexTool">
<meta property="og:description" content="Validate, format, and minify XML instantly. Tree view, error detection with line numbers. 100% free.">
<meta property="og:type" content="website">
<meta property="og:url" content="https://nextool.app/free-tools/xml-validator.html">
<meta property="og:image" content="https://nextool.app/assets/og-default.png">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<link rel="canonical" href="https://nextool.app/free-tools/xml-validator.html">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Free XML Validator & Formatter | NexTool">
<meta name="twitter:description" content="Validate, format, and minify XML instantly. Free online tool by NexTool.">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"SoftwareApplication","name":"NexTool XML Validator & Formatter","applicationCategory":"DeveloperApplication","operatingSystem":"Web","offers":{"@type":"Offer","price":"0","priceCurrency":"USD"},"description":"Free online XML validator, formatter, and minifier with tree view and detailed error messages."}
</script>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{--bg:#050508;--surface:#111118;--surface2:#1a1a24;--border:#2a2a3a;--text:#e4e4eb;--text2:#9494a8;--primary:#6366f1;--accent:#a855f7;--pink:#ec4899;--green:#22c55e;--red:#ef4444;--cyan:#22d3ee;--yellow:#eab308;--orange:#f97316;--radius:12px;--glass:rgba(17,17,24,0.7)}
html{scroll-behavior:smooth}
body{font-family:'Inter',system-ui,sans-serif;background:var(--bg);color:var(--text);line-height:1.6;min-height:100vh;overflow-x:hidden}
/* NAV */
.nav{position:sticky;top:0;z-index:100;background:rgba(5,5,8,0.85);backdrop-filter:blur(20px);border-bottom:1px solid var(--border);padding:0 2rem;height:64px;display:flex;align-items:center;justify-content:space-between}
.nav-logo{font-size:1.4rem;font-weight:800;background:linear-gradient(135deg,var(--primary),var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent;text-decoration:none}
.nav-links{display:flex;align-items:center;gap:1.5rem}
.nav-links a{color:var(--text2);text-decoration:none;font-size:.875rem;font-weight:500;transition:color .2s}
.nav-links a:hover{color:var(--text)}
.nav-cta{background:linear-gradient(135deg,var(--primary),var(--accent));color:#fff!important;padding:.5rem 1.2rem;border-radius:8px;font-weight:600;-webkit-text-fill-color:#fff!important}
.nav-cta:hover{opacity:.9}
.nav-toggle{display:none;background:none;border:none;color:var(--text);font-size:1.5rem;cursor:pointer}
/* HERO */
.hero{text-align:center;padding:3rem 1.5rem 2rem;max-width:700px;margin:0 auto}
.hero h1{font-size:2.2rem;font-weight:800;line-height:1.2;margin-bottom:.75rem}
.hero h1 span{background:linear-gradient(135deg,var(--primary),var(--accent),var(--pink));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.hero p{color:var(--text2);font-size:1rem}
/* TOOL */
.tool-container{max-width:1200px;margin:0 auto;padding:0 1.5rem 3rem}
.toolbar{display:flex;flex-wrap:wrap;gap:.5rem;margin-bottom:1rem;align-items:center}
.toolbar button,.toolbar select{background:var(--surface2);border:1px solid var(--border);color:var(--text);padding:.45rem .9rem;border-radius:8px;font-size:.8rem;font-weight:500;cursor:pointer;transition:all .2s;font-family:inherit}
.toolbar button:hover{border-color:var(--primary);background:rgba(99,102,241,.12)}
.toolbar button.active{background:linear-gradient(135deg,var(--primary),var(--accent));border-color:transparent;color:#fff}
.toolbar select{appearance:none;padding-right:1.8rem;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%239494a8' viewBox='0 0 16 16'%3E%3Cpath d='M8 11L3 6h10z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right .6rem center}
.status-bar{display:flex;align-items:center;gap:1rem;margin-bottom:1rem;font-size:.8rem;color:var(--text2)}
.status-dot{width:8px;height:8px;border-radius:50%;display:inline-block}
.status-dot.valid{background:var(--green)}
.status-dot.invalid{background:var(--red)}
.status-dot.empty{background:var(--border)}
.panels{display:grid;grid-template-columns:1fr 1fr;gap:1rem;min-height:500px}
.panel{background:var(--glass);backdrop-filter:blur(16px);border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;display:flex;flex-direction:column}
.panel-header{padding:.6rem 1rem;border-bottom:1px solid var(--border);font-size:.8rem;font-weight:600;color:var(--text2);display:flex;justify-content:space-between;align-items:center;background:rgba(26,26,36,0.5)}
.panel-body{flex:1;position:relative;overflow:auto}
#xmlInput{width:100%;height:100%;min-height:400px;background:transparent;border:none;color:var(--text);font-family:'Courier New',monospace;font-size:.85rem;padding:1rem;resize:none;outline:none;line-height:1.7;tab-size:2}
#xmlInput::placeholder{color:var(--text2);opacity:.5}
.output-area{padding:1rem;font-family:'Courier New',monospace;font-size:.85rem;line-height:1.7;white-space:pre-wrap;word-break:break-all;min-height:400px}
/* SYNTAX HIGHLIGHTING */
.hl-tag{color:#c084fc}.hl-attr{color:var(--cyan)}.hl-val{color:#4ade80}.hl-text{color:var(--text)}.hl-comment{color:#6b7280;font-style:italic}.hl-cdata{color:var(--yellow)}.hl-decl{color:var(--orange)}.hl-entity{color:var(--pink)}
/* TREE VIEW */
.tree{padding:1rem;font-size:.85rem}
.tree-item{margin-left:1.2rem;border-left:1px solid var(--border);padding-left:.6rem}
.tree-key{color:#c084fc;font-weight:600;cursor:default}
.tree-toggle{cursor:pointer;user-select:none;display:inline-flex;align-items:center;gap:.3rem;padding:2px 0}
.tree-toggle::before{content:'';display:inline-block;width:0;height:0;border-left:5px solid var(--text2);border-top:4px solid transparent;border-bottom:4px solid transparent;transition:transform .15s}
.tree-toggle.open::before{transform:rotate(90deg)}
.tree-children{overflow:hidden;transition:max-height .2s}
.tree-children.collapsed{max-height:0!important;overflow:hidden}
.tree-bracket{color:var(--text2);font-size:.75rem;margin-left:.3rem}
.tree-val{color:#4ade80}
.tree-attr{color:var(--cyan);font-size:.8rem;margin-left:.4rem}
/* ERROR */
.error-display{padding:1rem;color:var(--red);font-size:.85rem;font-family:'Courier New',monospace;white-space:pre-wrap}
.error-display .error-line{background:rgba(239,68,68,.1);border-left:3px solid var(--red);padding:.3rem .6rem;margin:.3rem 0;border-radius:4px}
/* STATS BAR */
.stats-bar{display:flex;flex-wrap:wrap;gap:1rem;margin-bottom:1rem;padding:.6rem 1rem;background:var(--surface);border:1px solid var(--border);border-radius:8px;font-size:.75rem;color:var(--text2)}
.stats-bar .stat{display:flex;align-items:center;gap:.3rem}
.stats-bar .stat-val{color:var(--text);font-weight:600}
/* CTA */
.cta-section{text-align:center;padding:4rem 1.5rem;max-width:700px;margin:0 auto}
.cta-section h2{font-size:1.8rem;font-weight:800;margin-bottom:.75rem}
.cta-section h2 span{background:linear-gradient(135deg,var(--primary),var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.cta-section p{color:var(--text2);margin-bottom:1.5rem}
.cta-btn{display:inline-block;background:linear-gradient(135deg,var(--primary),var(--accent));color:#fff;padding:.75rem 2rem;border-radius:10px;font-weight:700;text-decoration:none;font-size:1rem;transition:transform .2s,box-shadow .2s}
.cta-btn:hover{transform:translateY(-2px);box-shadow:0 8px 30px rgba(99,102,241,.3)}
/* FOOTER */
.footer{border-top:1px solid var(--border);padding:3rem 2rem 2rem;max-width:1200px;margin:0 auto}
.footer-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:2rem;margin-bottom:2rem}
.footer-col h4{font-size:.85rem;font-weight:700;margin-bottom:.75rem;color:var(--text)}
.footer-col a{display:block;color:var(--text2);text-decoration:none;font-size:.8rem;margin-bottom:.4rem;transition:color .2s}
.footer-col a:hover{color:var(--primary)}
.footer-bottom{text-align:center;color:var(--text2);font-size:.75rem;padding-top:1.5rem;border-top:1px solid var(--border)}
/* FADE IN */
.fade-in{opacity:0;transform:translateY(20px);transition:opacity .6s,transform .6s}
.fade-in.visible{opacity:1;transform:translateY(0)}
/* TOAST */
.toast{position:fixed;bottom:2rem;left:50%;transform:translateX(-50%) translateY(80px);background:var(--surface2);border:1px solid var(--border);color:var(--text);padding:.6rem 1.2rem;border-radius:10px;font-size:.85rem;font-weight:500;z-index:200;transition:transform .3s;pointer-events:none}
.toast.show{transform:translateX(-50%) translateY(0)}
/* RESPONSIVE */
@media(max-width:768px){
  .panels{grid-template-columns:1fr}
  .nav-links{display:none;position:absolute;top:64px;left:0;right:0;background:var(--bg);border-bottom:1px solid var(--border);flex-direction:column;padding:1rem 2rem;gap:1rem}
  .nav-links.open{display:flex}
  .nav-toggle{display:block}
  .hero h1{font-size:1.6rem}
  .footer-grid{grid-template-columns:1fr}
  .toolbar{gap:.35rem}
  .stats-bar{gap:.5rem}
}
</style>
</head>
<body>

<nav class="nav">
  <a href="/" class="nav-logo">NexTool</a>
  <button class="nav-toggle" onclick="document.querySelector('.nav-links').classList.toggle('open')" aria-label="Menu">&#9776;</button>
  <div class="nav-links">
    <a href="/">Home</a>
    <a href="/free-tools/">Tools</a>
    <a href="/free-tools/">Free Tools</a>
    <a href="/blog/">Blog</a>
    <a href="/pro.html" class="nav-cta">Get Pro &mdash; $29</a>
  </div>
</nav>

<section class="hero fade-in">
  <h1>Free <span>XML Validator</span> &amp; Formatter</h1>
  <p class="tool-summary" style="color:#94a3b8;font-size:15px;line-height:1.6;margin-bottom:24px;max-width:700px;margin-left:auto;margin-right:auto;">NexTool's XML Validator checks your XML for well-formedness, formats it with proper indentation, minifies it, and displays an interactive tree structure. Get detailed error messages with line numbers. No signup, 100% client-side.</p>
</section>

<div class="tool-container fade-in">
  <div class="toolbar">
    <button onclick="validateXML()" title="Validate well-formedness">Validate</button>
    <button onclick="formatXML()" title="Pretty print XML">Format</button>
    <button onclick="minifyXML()" title="Remove whitespace">Minify</button>
    <button onclick="copyOutput()" title="Copy to clipboard">Copy</button>
    <button onclick="downloadXML()" title="Download .xml">Download</button>
    <select id="indentSelect" onchange="formatXML()">
      <option value="2">2 spaces</option>
      <option value="4">4 spaces</option>
      <option value="tab">Tab</option>
    </select>
    <button id="viewToggle" onclick="toggleView()" title="Toggle tree view">Tree View</button>
    <button onclick="clearAll()" title="Clear input and output">Clear</button>
    <button onclick="loadSample()" title="Load sample XML">Sample</button>
  </div>

  <div class="status-bar">
    <span><span class="status-dot empty" id="statusDot"></span></span>
    <span id="statusText">Paste XML to begin</span>
    <span id="sizeInfo" style="margin-left:auto"></span>
  </div>

  <div id="statsBar" class="stats-bar" style="display:none">
    <div class="stat">Elements: <span class="stat-val" id="statElements">0</span></div>
    <div class="stat">Attributes: <span class="stat-val" id="statAttrs">0</span></div>
    <div class="stat">Text nodes: <span class="stat-val" id="statText">0</span></div>
    <div class="stat">Comments: <span class="stat-val" id="statComments">0</span></div>
    <div class="stat">Depth: <span class="stat-val" id="statDepth">0</span></div>
  </div>

  <div class="panels">
    <div class="panel">
      <div class="panel-header"><span>Input</span><span id="lineCount"></span></div>
      <div class="panel-body">
        <textarea id="xmlInput" placeholder='Paste your XML here...&#10;&#10;Example:&#10;<?xml version="1.0" encoding="UTF-8"?>&#10;<catalog>&#10;  <book id="1">&#10;    <title>NexTool Guide</title>&#10;  </book>&#10;</catalog>' spellcheck="false"></textarea>
      </div>
    </div>
    <div class="panel">
      <div class="panel-header"><span id="outputLabel">Output</span><span id="outputInfo"></span></div>
      <div class="panel-body" id="outputPanel">
        <div class="output-area" id="formattedOutput"></div>
        <div class="tree" id="treeOutput" style="display:none"></div>
        <div class="error-display" id="errorOutput" style="display:none"></div>
      </div>
    </div>
  </div>
</div>

<section class="cta-section fade-in">
  <h2>Need something <span>more powerful</span>?</h2>
  <p>Let us build it for you. Custom APIs, dashboards, automations &mdash; whatever you need.</p>
  <a href="/#contact" class="cta-btn">Start a Project &rarr;</a>
</section>

<!-- Cross Promo -->
<section style="max-width:900px;margin:40px auto;padding:0 24px;">
<div style="background:linear-gradient(135deg,rgba(99,102,241,0.1),rgba(168,85,247,0.08));border:1px solid rgba(99,102,241,0.15);border-radius:20px;padding:32px 28px;text-align:center;">
<div style="font-size:13px;color:#818cf8;font-weight:600;text-transform:uppercase;letter-spacing:1px;margin-bottom:8px;">Founding Member</div>
<h3 style="font-size:22px;font-weight:800;color:#fff;margin:0 0 8px;">Get NexTool Pro</h3>
<p style="color:#94a3b8;font-size:14px;margin:0 auto 20px;max-width:500px;">No banners, clean output, enhanced features on all 250+ tools. One-time payment.</p>
<div style="display:flex;align-items:center;justify-content:center;gap:12px;flex-wrap:wrap;">
<a href="/pro.html" style="display:inline-block;padding:12px 28px;background:linear-gradient(135deg,#6366f1,#a855f7,#ec4899);color:#fff;border-radius:10px;font-weight:700;font-size:15px;text-decoration:none;">$29 &mdash; Get Pro</a>
<a href="/free-tools/" style="color:#94a3b8;font-size:14px;text-decoration:none;">Browse 250+ Free Tools &rarr;</a>
</div>
</div>
</section>


<!-- AUTO-LINKED by NexTool Engine -->
<div style="margin:2rem 0;padding:1.5rem;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius)">
<p style="font-weight:600;margin-bottom:.5rem">Related Tools</p>
<p><a href="/free-tools/xml-formatter.html" style="color:var(--primary);text-decoration:none">XML Formatter &amp; Validator</a> · <a href="/free-tools/box-shadow-generator.html" style="color:var(--primary);text-decoration:none">CSS Box Shadow Generator</a> · <a href="/free-tools/emoji-picker.html" style="color:var(--primary);text-decoration:none">Emoji Picker & Search</a></p>
</div>

<!-- AUTO-LINKED by NexTool Engine -->
<div style="margin:2rem 0;padding:1.5rem;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius)">
<p style="font-weight:600;margin-bottom:.5rem">Related Tools</p>
<p><a href="/free-tools/git-diff-viewer.html" style="color:var(--primary);text-decoration:none">Free Git Diff Viewer</a> · <a href="/free-tools/json-to-yaml-converter.html" style="color:var(--primary);text-decoration:none">Free JSON to YAML Converter</a> · <a href="/free-tools/accessibility-checker.html" style="color:var(--primary);text-decoration:none">Free Accessibility Checker</a></p>
</div>

<!-- AUTO-LINKED by NexTool Engine -->
<div style="margin:2rem 0;padding:1.5rem;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius)">
<p style="font-weight:600;margin-bottom:.5rem">Related Tools</p>
<p><a href="/free-tools/json-to-yaml.html" style="color:var(--primary);text-decoration:none">Free JSON to YAML Converter</a> · <a href="/free-tools/yaml-to-json.html" style="color:var(--primary);text-decoration:none">YAML to JSON Converter</a> · <a href="/free-tools/api-request-builder.html" style="color:var(--primary);text-decoration:none">Free API Request Builder</a></p>
</div>
<footer class="footer fade-in">
  <div class="footer-grid">
    <div class="footer-col">
      <h4>Products</h4>
      <a href="/free-tools/">250+ Free Tools</a>
<a href="/pro.html">NexTool Pro</a>
<a href="/workspace.html">Workspace</a>
    </div>
    <div class="footer-col">
      <h4>Explore</h4>
      <a href="/free-tools/">Free Tools</a><a href="/blog/">Blog</a><a href="/pro.html">FAQ</a><a href="/pro.html">Pro &mdash; $29</a>
    </div>
    <div class="footer-col">
      <h4>Ecosystem</h4>
      <a href="/">NexTool Home</a><a href="/#contact">Contact</a><a href="https://github.com/christian140903-sudo/nextool" target="_blank">GitHub</a>
    </div>
  </div>
  <div class="footer-bottom">&copy; 2026 NexTool. AI-powered tools for everyone.</div>
</footer>

<div class="toast" id="toast"></div>

<script>
const input = document.getElementById('xmlInput');
const formattedOutput = document.getElementById('formattedOutput');
const treeOutput = document.getElementById('treeOutput');
const errorOutput = document.getElementById('errorOutput');
const statusDot = document.getElementById('statusDot');
const statusText = document.getElementById('statusText');
const sizeInfo = document.getElementById('sizeInfo');
const lineCount = document.getElementById('lineCount');
const outputLabel = document.getElementById('outputLabel');
const outputInfo = document.getElementById('outputInfo');
const viewToggle = document.getElementById('viewToggle');
const statsBar = document.getElementById('statsBar');
let isTreeView = false;
let lastParsedDoc = null;
let lastFormatted = '';

input.addEventListener('input', debounce(autoProcess, 300));
input.addEventListener('input', updateLineCount);

function debounce(fn, ms) { let t; return (...a) => { clearTimeout(t); t = setTimeout(() => fn(...a), ms); }; }

function updateLineCount() {
  const lines = input.value.split('\n').length;
  lineCount.textContent = lines + ' line' + (lines !== 1 ? 's' : '');
}

function parseXML(str) {
  const parser = new DOMParser();
  const doc = parser.parseFromString(str, 'application/xml');
  const errNode = doc.querySelector('parsererror');
  if (errNode) {
    let errText = errNode.textContent || errNode.innerText || '';
    throw new Error(errText);
  }
  return doc;
}

function autoProcess() {
  const raw = input.value.trim();
  if (!raw) {
    clearOutputs();
    statusDot.className = 'status-dot empty';
    statusText.textContent = 'Paste XML to begin';
    sizeInfo.textContent = '';
    statsBar.style.display = 'none';
    return;
  }
  sizeInfo.textContent = formatBytes(new Blob([raw]).size);
  try {
    lastParsedDoc = parseXML(raw);
    statusDot.className = 'status-dot valid';
    statusText.textContent = 'Valid XML (well-formed)';
    updateStats(lastParsedDoc);
    if (isTreeView) renderTree(lastParsedDoc);
    else formatXML();
  } catch (e) {
    statusDot.className = 'status-dot invalid';
    statusText.textContent = 'Invalid XML';
    statsBar.style.display = 'none';
    showError(e, raw);
    lastParsedDoc = null;
  }
}

function validateXML() {
  const raw = input.value.trim();
  if (!raw) { showToast('Paste XML first'); return; }
  try {
    lastParsedDoc = parseXML(raw);
    statusDot.className = 'status-dot valid';
    statusText.textContent = 'Valid XML (well-formed)';
    updateStats(lastParsedDoc);
    let html = '<span style="color:var(--green);font-weight:600">XML is well-formed</span>\n\n';
    html += 'Document parsed successfully with no errors.\n\n';
    const root = lastParsedDoc.documentElement;
    html += 'Root element: <span class="hl-tag">&lt;' + escapeHtml(root.tagName) + '&gt;</span>\n';
    html += 'Namespace: ' + (root.namespaceURI || '(none)') + '\n';
    const elCount = lastParsedDoc.getElementsByTagName('*').length;
    html += 'Total elements: ' + elCount + '\n';
    formattedOutput.innerHTML = html;
    showPanel('formatted');
    showToast('XML is valid');
  } catch (e) {
    statusDot.className = 'status-dot invalid';
    statusText.textContent = 'Invalid XML';
    statsBar.style.display = 'none';
    showError(e, raw);
    lastParsedDoc = null;
  }
}

function formatXML() {
  const raw = input.value.trim();
  if (!raw) return;
  try {
    const doc = parseXML(raw);
    lastParsedDoc = doc;
    const sel = document.getElementById('indentSelect').value;
    const indent = sel === 'tab' ? '\t' : ' '.repeat(parseInt(sel));
    const formatted = prettyPrintXML(doc, indent);
    lastFormatted = formatted;
    if (isTreeView) { renderTree(doc); return; }
    formattedOutput.innerHTML = highlightXML(escapeHtml(formatted));
    showPanel('formatted');
    statusDot.className = 'status-dot valid';
    statusText.textContent = 'Valid XML \u2014 Formatted';
    outputInfo.textContent = formatted.split('\n').length + ' lines';
    updateStats(doc);
  } catch (e) {
    statusDot.className = 'status-dot invalid';
    statusText.textContent = 'Invalid XML';
    statsBar.style.display = 'none';
    showError(e, raw);
  }
}

function prettyPrintXML(doc, indent) {
  let result = '';
  const piMatch = input.value.trim().match(/^<\?xml[^?]*\?>/);
  if (piMatch) {
    result += piMatch[0] + '\n';
  }
  result += serializeNode(doc.documentElement, 0, indent);
  return result.trim();
}

function serializeNode(node, level, indent) {
  let out = '';
  const pad = indent.repeat(level);

  if (node.nodeType === Node.ELEMENT_NODE) {
    out += pad + '<' + node.tagName;
    for (let i = 0; i < node.attributes.length; i++) {
      const attr = node.attributes[i];
      out += ' ' + attr.name + '="' + attr.value + '"';
    }
    const children = [];
    for (let i = 0; i < node.childNodes.length; i++) {
      const child = node.childNodes[i];
      if (child.nodeType === Node.TEXT_NODE) {
        const txt = child.textContent;
        if (txt.trim()) children.push(child);
      } else {
        children.push(child);
      }
    }
    if (children.length === 0) {
      out += '/>\n';
    } else if (children.length === 1 && children[0].nodeType === Node.TEXT_NODE) {
      out += '>' + escapeXmlText(children[0].textContent.trim()) + '</' + node.tagName + '>\n';
    } else {
      out += '>\n';
      for (const child of children) {
        out += serializeNode(child, level + 1, indent);
      }
      out += pad + '</' + node.tagName + '>\n';
    }
  } else if (node.nodeType === Node.TEXT_NODE) {
    const txt = node.textContent.trim();
    if (txt) out += pad + escapeXmlText(txt) + '\n';
  } else if (node.nodeType === Node.COMMENT_NODE) {
    out += pad + '<!--' + node.textContent + '-->\n';
  } else if (node.nodeType === Node.CDATA_SECTION_NODE) {
    out += pad + '<![CDATA[' + node.textContent + ']]>\n';
  } else if (node.nodeType === Node.PROCESSING_INSTRUCTION_NODE) {
    out += pad + '<?' + node.target + ' ' + node.data + '?>\n';
  }
  return out;
}

function escapeXmlText(s) {
  return s.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
}

function minifyXML() {
  const raw = input.value.trim();
  if (!raw) return;
  try {
    const doc = parseXML(raw);
    lastParsedDoc = doc;
    const serializer = new XMLSerializer();
    let minified = serializer.serializeToString(doc);
    // Remove unnecessary whitespace between tags
    minified = minified.replace(/>\s+</g, '><').replace(/\n/g, '').replace(/\s{2,}/g, ' ');
    lastFormatted = minified;
    formattedOutput.innerHTML = highlightXML(escapeHtml(minified));
    showPanel('formatted');
    statusDot.className = 'status-dot valid';
    statusText.textContent = 'Valid XML \u2014 Minified';
    outputInfo.textContent = formatBytes(new Blob([minified]).size);
    updateStats(doc);
    if (isTreeView) { isTreeView = false; viewToggle.classList.remove('active'); }
  } catch (e) {
    statusDot.className = 'status-dot invalid';
    statusText.textContent = 'Invalid XML';
    statsBar.style.display = 'none';
    showError(e, raw);
  }
}

function highlightXML(escaped) {
  // Highlight XML processing instructions
  let html = escaped.replace(/&lt;\?(.+?)\?&gt;/g, '<span class="hl-decl">&lt;?$1?&gt;</span>');
  // Highlight comments
  html = html.replace(/&lt;!--(.+?)--&gt;/gs, '<span class="hl-comment">&lt;!--$1--&gt;</span>');
  // Highlight CDATA
  html = html.replace(/&lt;!\[CDATA\[(.+?)\]\]&gt;/gs, '<span class="hl-cdata">&lt;![CDATA[$1]]&gt;</span>');
  // Highlight self-closing tags
  html = html.replace(/&lt;(\w[\w:.-]*)(\s[^&]*?)\/&gt;/g, function(m, tag, attrs) {
    return '&lt;<span class="hl-tag">' + tag + '</span>' + highlightAttrs(attrs) + '/&gt;';
  });
  // Highlight closing tags
  html = html.replace(/&lt;\/(\w[\w:.-]*)&gt;/g, '&lt;/<span class="hl-tag">$1</span>&gt;');
  // Highlight opening tags with attributes
  html = html.replace(/&lt;(\w[\w:.-]*)(\s[^&]*?)&gt;/g, function(m, tag, attrs) {
    return '&lt;<span class="hl-tag">' + tag + '</span>' + highlightAttrs(attrs) + '&gt;';
  });
  // Highlight opening tags without attributes
  html = html.replace(/&lt;(\w[\w:.-]*)&gt;/g, '&lt;<span class="hl-tag">$1</span>&gt;');
  return html;
}

function highlightAttrs(attrStr) {
  return attrStr.replace(/(\w[\w:.-]*)=&quot;([^&]*?)&quot;/g,
    '<span class="hl-attr">$1</span>=&quot;<span class="hl-val">$2</span>&quot;');
}

function showError(e, raw) {
  const msg = e.message;
  let lineNum = null;
  // Try to extract line number from parser error message
  const lineMatch = msg.match(/line\s+(\d+)/i);
  if (lineMatch) {
    lineNum = parseInt(lineMatch[1]);
  }
  // Also try column
  const colMatch = msg.match(/column\s+(\d+)/i);
  const col = colMatch ? parseInt(colMatch[1]) : null;

  let html = '<strong>XML Validation Error</strong>\n\n';

  // Clean up the error message (remove XML-specific noise)
  let cleanMsg = msg.replace(/^[\s\S]*?This page contains the following errors:/, '').trim();
  cleanMsg = cleanMsg.replace(/Below is a rendering of the page.*$/s, '').trim();
  if (!cleanMsg) cleanMsg = msg;

  html += '<div class="error-line">' + escapeHtml(cleanMsg) + '</div>\n';

  if (lineNum) {
    html += '\nError near line ' + lineNum;
    if (col) html += ', column ' + col;
    html += ':\n';
    const lines = raw.split('\n');
    const start = Math.max(0, lineNum - 3);
    const end = Math.min(lines.length, lineNum + 2);
    for (let i = start; i < end; i++) {
      const marker = i === lineNum - 1 ? ' >>> ' : '     ';
      html += '<span style="color:' + (i === lineNum - 1 ? 'var(--red)' : 'var(--text2)') + '">' + marker + (i + 1) + ' | ' + escapeHtml(lines[i]) + '</span>\n';
    }
    if (col && lineNum - 1 < lines.length) {
      html += '     ' + ' '.repeat(String(lineNum).length) + ' | ' + ' '.repeat(Math.max(0, col - 1)) + '<span style="color:var(--red)">^</span>\n';
    }
  }
  errorOutput.innerHTML = html;
  showPanel('error');
}

function escapeHtml(s) { return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

/* TREE VIEW */
function toggleView() {
  isTreeView = !isTreeView;
  viewToggle.classList.toggle('active', isTreeView);
  outputLabel.textContent = isTreeView ? 'Tree View' : 'Output';
  if (isTreeView && lastParsedDoc !== null) renderTree(lastParsedDoc);
  else if (!isTreeView && lastParsedDoc !== null) formatXML();
}

function renderTree(doc) {
  treeOutput.innerHTML = '';
  treeOutput.appendChild(buildTreeNode(doc.documentElement, true));
  showPanel('tree');
}

function buildTreeNode(node, isRoot) {
  const wrap = document.createElement('div');
  if (!isRoot) wrap.className = 'tree-item';

  if (node.nodeType === Node.ELEMENT_NODE) {
    const children = [];
    for (let i = 0; i < node.childNodes.length; i++) {
      const child = node.childNodes[i];
      if (child.nodeType === Node.TEXT_NODE && !child.textContent.trim()) continue;
      children.push(child);
    }
    const hasSubElements = children.some(c => c.nodeType === Node.ELEMENT_NODE || c.nodeType === Node.COMMENT_NODE || c.nodeType === Node.CDATA_SECTION_NODE);

    if (hasSubElements || children.length > 1) {
      const toggle = document.createElement('span');
      toggle.className = 'tree-toggle open';
      let label = '<span class="tree-key">&lt;' + escapeHtml(node.tagName) + '&gt;</span>';
      if (node.attributes.length > 0) {
        let attrs = [];
        for (let i = 0; i < node.attributes.length; i++) {
          attrs.push(node.attributes[i].name + '="' + escapeHtml(node.attributes[i].value) + '"');
        }
        label += '<span class="tree-attr">[' + attrs.join(', ') + ']</span>';
      }
      label += '<span class="tree-bracket">' + children.length + (children.length === 1 ? ' child' : ' children') + '</span>';
      toggle.innerHTML = label;
      wrap.appendChild(toggle);

      const childDiv = document.createElement('div');
      childDiv.className = 'tree-children';
      for (const child of children) {
        childDiv.appendChild(buildTreeNode(child, false));
      }
      wrap.appendChild(childDiv);

      toggle.addEventListener('click', () => {
        toggle.classList.toggle('open');
        childDiv.classList.toggle('collapsed');
      });
    } else if (children.length === 1 && children[0].nodeType === Node.TEXT_NODE) {
      let html = '<span class="tree-key">&lt;' + escapeHtml(node.tagName) + '&gt;</span>';
      if (node.attributes.length > 0) {
        let attrs = [];
        for (let i = 0; i < node.attributes.length; i++) {
          attrs.push(node.attributes[i].name + '="' + escapeHtml(node.attributes[i].value) + '"');
        }
        html += '<span class="tree-attr">[' + attrs.join(', ') + ']</span>';
      }
      html += ': <span class="tree-val">"' + escapeHtml(children[0].textContent.trim()) + '"</span>';
      wrap.innerHTML = html;
    } else {
      let html = '<span class="tree-key">&lt;' + escapeHtml(node.tagName) + '/&gt;</span>';
      if (node.attributes.length > 0) {
        let attrs = [];
        for (let i = 0; i < node.attributes.length; i++) {
          attrs.push(node.attributes[i].name + '="' + escapeHtml(node.attributes[i].value) + '"');
        }
        html += '<span class="tree-attr">[' + attrs.join(', ') + ']</span>';
      }
      wrap.innerHTML = html;
    }
  } else if (node.nodeType === Node.TEXT_NODE) {
    wrap.innerHTML = '<span class="tree-val">"' + escapeHtml(node.textContent.trim()) + '"</span>';
  } else if (node.nodeType === Node.COMMENT_NODE) {
    wrap.innerHTML = '<span style="color:#6b7280;font-style:italic">&lt;!-- ' + escapeHtml(node.textContent.trim()) + ' --&gt;</span>';
  } else if (node.nodeType === Node.CDATA_SECTION_NODE) {
    wrap.innerHTML = '<span style="color:var(--yellow)">&lt;![CDATA[ ' + escapeHtml(node.textContent.trim()) + ' ]]&gt;</span>';
  }
  return wrap;
}

function updateStats(doc) {
  const allElements = doc.getElementsByTagName('*');
  let attrCount = 0;
  let textCount = 0;
  let commentCount = 0;
  let maxDepth = 0;

  for (let i = 0; i < allElements.length; i++) {
    attrCount += allElements[i].attributes.length;
  }

  function walkNodes(node, depth) {
    if (depth > maxDepth) maxDepth = depth;
    for (let i = 0; i < node.childNodes.length; i++) {
      const child = node.childNodes[i];
      if (child.nodeType === Node.TEXT_NODE && child.textContent.trim()) textCount++;
      else if (child.nodeType === Node.COMMENT_NODE) commentCount++;
      else if (child.nodeType === Node.ELEMENT_NODE) walkNodes(child, depth + 1);
    }
  }
  walkNodes(doc.documentElement, 1);

  document.getElementById('statElements').textContent = allElements.length;
  document.getElementById('statAttrs').textContent = attrCount;
  document.getElementById('statText').textContent = textCount;
  document.getElementById('statComments').textContent = commentCount;
  document.getElementById('statDepth').textContent = maxDepth;
  statsBar.style.display = 'flex';
}

function showPanel(which) {
  formattedOutput.style.display = which === 'formatted' ? '' : 'none';
  treeOutput.style.display = which === 'tree' ? '' : 'none';
  errorOutput.style.display = which === 'error' ? '' : 'none';
}

function clearOutputs() {
  formattedOutput.innerHTML = '';
  treeOutput.innerHTML = '';
  errorOutput.innerHTML = '';
  outputInfo.textContent = '';
  formattedOutput.style.display = '';
  treeOutput.style.display = 'none';
  errorOutput.style.display = 'none';
}

function clearAll() {
  input.value = '';
  lastParsedDoc = null;
  lastFormatted = '';
  clearOutputs();
  statusDot.className = 'status-dot empty';
  statusText.textContent = 'Paste XML to begin';
  sizeInfo.textContent = '';
  lineCount.textContent = '';
  statsBar.style.display = 'none';
  if (isTreeView) { isTreeView = false; viewToggle.classList.remove('active'); outputLabel.textContent = 'Output'; }
}

function copyOutput() {
  if (!lastFormatted && !lastParsedDoc) { showToast('Nothing to copy'); return; }
  const text = lastFormatted || new XMLSerializer().serializeToString(lastParsedDoc);
  navigator.clipboard.writeText(text).then(() => showToast('Copied to clipboard'));
}

function downloadXML() {
  if (!lastParsedDoc) { showToast('No valid XML to download'); return; }
  const text = lastFormatted || new XMLSerializer().serializeToString(lastParsedDoc);
  const blob = new Blob([text], { type: 'application/xml' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'formatted.xml';
  a.click();
  URL.revokeObjectURL(a.href);
  showToast('Downloaded formatted.xml');
}

function loadSample() {
  input.value = '<?xml version="1.0" encoding="UTF-8"?>\n<catalog>\n  <book id="bk101" lang="en">\n    <author>Gambardella, Matthew</author>\n    <title>XML Developer\'s Guide</title>\n    <genre>Computer</genre>\n    <price currency="USD">44.95</price>\n    <publish_date>2026-01-15</publish_date>\n    <description>An in-depth look at creating applications with XML.</description>\n  </book>\n  <book id="bk102" lang="en">\n    <author>Ralls, Kim</author>\n    <title>Midnight Rain</title>\n    <genre>Fantasy</genre>\n    <price currency="USD">5.95</price>\n    <publish_date>2025-12-16</publish_date>\n    <description>A former architect battles corporate zombies and an evil sorceress.</description>\n  </book>\n  <book id="bk103" lang="de">\n    <author>Corets, Eva</author>\n    <title>Maeve Ascendant</title>\n    <genre>Fantasy</genre>\n    <price currency="EUR">5.95</price>\n    <publish_date>2025-11-17</publish_date>\n    <description>After the collapse of a nanotechnology society, the young survivors lay the foundation for a new society.</description>\n  </book>\n  <!-- More books can be added here -->\n</catalog>';
  updateLineCount();
  autoProcess();
}

function formatBytes(bytes) {
  if (bytes === 0) return '0 B';
  const k = 1024, sizes = ['B', 'KB', 'MB'];
  const i = Math.floor(Math.log(bytes) / Math.log(k));
  return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
}

function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2000);
}

/* INPUT: Tab key support */
input.addEventListener('keydown', e => {
  if (e.key === 'Tab') {
    e.preventDefault();
    const start = input.selectionStart, end = input.selectionEnd;
    input.value = input.value.substring(0, start) + '  ' + input.value.substring(end);
    input.selectionStart = input.selectionEnd = start + 2;
  }
});

/* IntersectionObserver fade-in */
const observer = new IntersectionObserver(entries => {
  entries.forEach(entry => { if (entry.isIntersecting) { entry.target.classList.add('visible'); observer.unobserve(entry.target); }});
}, { threshold: 0.1 });
document.querySelectorAll('.fade-in').forEach(el => observer.observe(el));
</script>
<script src="/js/analytics-lite.js" defer></script>
<script src="/js/revenue.js" defer></script>
<script src="/js/lead-capture.js" defer></script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    {
      "@type": "Question",
      "name": "What is an XML validator?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "An XML validator checks whether your XML document is well-formed, meaning it follows the syntactic rules of XML such as properly nested tags, correct attribute quoting, and a single root element. NexTool's XML Validator also shows detailed error messages with line and column numbers."
      }
    },
    {
      "@type": "Question",
      "name": "Is NexTool's XML validator free?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Yes, NexTool's XML Validator is completely free to use. No signup, no download, and no limits. It runs entirely in your browser for maximum privacy and speed."
      }
    },
    {
      "@type": "Question",
      "name": "Can I format and minify XML with this tool?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Yes, NexTool's XML Validator includes one-click format and minify buttons. Format pretty-prints your XML with configurable indentation (2 spaces, 4 spaces, or tabs). Minify removes all unnecessary whitespace to reduce file size."
      }
    },
    {
      "@type": "Question",
      "name": "Does the XML validator support tree view?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Yes, you can toggle between formatted text output and an interactive tree view. The tree view lets you expand and collapse elements, see attributes, and explore complex XML structures visually."
      }
    }
  ]
}
</script>
</body>
</html>
