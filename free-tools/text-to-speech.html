<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Text to Speech - Read Text Aloud Online | NexTool</title>
<meta name="description" content="Free Text to Speech tool. Paste any text and hear it spoken aloud with adjustable voice, speed, and pitch. Word highlighting, character count, and estimated duration. No signup.">
<meta name="keywords" content="text to speech, TTS, read aloud, speech synthesis, voice reader, free TTS, NexTool">
<link rel="canonical" href="https://nextool.app/free-tools/text-to-speech.html">
<meta property="og:title" content="Text to Speech - Read Text Aloud Online | NexTool">
<meta property="og:description" content="Free Text to Speech with multiple voices, speed/pitch control, word highlighting, and more. No signup required.">
<meta property="og:type" content="website">
<meta property="og:url" content="https://nextool.app/free-tools/text-to-speech.html">
<meta property="og:image" content="https://nextool.app/free-tools/og/text-to-speech.png">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Text to Speech - Read Text Aloud Online | NexTool">
<meta name="twitter:description" content="Free Text to Speech with multiple voices, speed/pitch control, and word highlighting.">
<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@type":"BreadcrumbList",
  "itemListElement":[
    {"@type":"ListItem","position":1,"name":"Home","item":"https://nextool.app/"},
    {"@type":"ListItem","position":2,"name":"Free Tools","item":"https://nextool.app/free-tools/"},
    {"@type":"ListItem","position":3,"name":"Text to Speech","item":"https://nextool.app/free-tools/text-to-speech.html"}
  ]
}
</script>
<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@type":"SoftwareApplication",
  "name":"Text to Speech",
  "applicationCategory":"MultimediaApplication",
  "operatingSystem":"Web",
  "description":"Free Text to Speech tool with multiple voices, adjustable speed and pitch, word highlighting, and estimated duration.",
  "url":"https://nextool.app/free-tools/text-to-speech.html",
  "offers":{"@type":"Offer","price":"0","priceCurrency":"USD"},
  "author":{"@type":"Organization","name":"NexTool","url":"https://nextool.app"}
}
</script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{--bg:#050508;--surface:#111118;--surface2:#1a1a24;--surface3:#22222f;--primary:#6366f1;--accent:#a855f7;--pink:#ec4899;--text:#e2e8f0;--text-dim:#94a3b8;--text-muted:#64748b;--gradient:linear-gradient(135deg,#6366f1,#a855f7,#ec4899);--green:#22c55e;--red:#ef4444;--yellow:#eab308;--radius:12px;--radius-lg:20px}
html{scroll-behavior:smooth}
body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--text);line-height:1.6;-webkit-font-smoothing:antialiased;min-height:100vh}
.nav{position:fixed;top:0;left:0;right:0;z-index:1000;padding:0 2rem;height:64px;display:flex;align-items:center;justify-content:space-between;background:rgba(5,5,8,.75);backdrop-filter:blur(20px);border-bottom:1px solid rgba(99,102,241,.1)}
.nav-logo{display:flex;align-items:center;gap:.5rem;font-weight:800;font-size:1.15rem;text-decoration:none;color:var(--text)}
.nav-logo .ico{width:28px;height:28px;border-radius:7px;background:var(--gradient);display:flex;align-items:center;justify-content:center;font-size:.75rem;font-weight:900;color:#fff}
.nav-logo span{background:var(--gradient);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.nav-links{display:flex;gap:1.5rem;align-items:center}
.nav-links a{color:var(--text-dim);font-size:.85rem;font-weight:500;text-decoration:none;transition:color .2s}
.nav-links a:hover{color:var(--text)}
.breadcrumb{max-width:800px;margin:0 auto;padding:80px 1.5rem 0;font-size:.8rem}
.breadcrumb a{color:var(--text-muted);text-decoration:none;transition:color .2s}
.breadcrumb a:hover{color:var(--text)}
.breadcrumb span{color:var(--text-muted);margin:0 .4rem}
.breadcrumb .current{color:var(--text-dim)}
.main{max-width:800px;margin:0 auto;padding:1rem 1.5rem 3rem}
.tool-header{text-align:center;margin-bottom:2.5rem}
.tool-badge{display:inline-flex;align-items:center;gap:.4rem;padding:.3rem .8rem;border-radius:100px;background:rgba(99,102,241,.1);border:1px solid rgba(99,102,241,.15);font-size:.72rem;font-weight:600;color:var(--primary);text-transform:uppercase;letter-spacing:.06em;margin-bottom:1rem}
.tool-header h1{font-size:clamp(1.75rem,4vw,2.5rem);font-weight:800;margin-bottom:.5rem}
.tool-header h1 .gr{background:var(--gradient);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.tool-header p{color:var(--text-dim);font-size:1rem;max-width:560px;margin:0 auto}
.card{background:var(--surface);border:1px solid rgba(99,102,241,.1);border-radius:var(--radius-lg);padding:2rem;position:relative;overflow:hidden;margin-bottom:1.5rem}
.card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:var(--gradient)}
.card h3{font-size:1rem;font-weight:700;margin-bottom:1.25rem;display:flex;align-items:center;gap:.5rem}

/* Textarea */
.text-area-wrap{position:relative;margin-bottom:1rem}
.text-input{width:100%;min-height:200px;padding:1rem;border-radius:var(--radius);border:1px solid var(--surface3);background:var(--surface2);color:var(--text);font-family:'Inter',sans-serif;font-size:.95rem;line-height:1.7;resize:vertical;outline:none;transition:border-color .2s}
.text-input:focus{border-color:var(--primary)}
.text-input::placeholder{color:var(--text-muted)}

/* Highlighted text display */
.highlight-display{width:100%;min-height:200px;padding:1rem;border-radius:var(--radius);border:1px solid var(--surface3);background:var(--surface2);color:var(--text);font-family:'Inter',sans-serif;font-size:.95rem;line-height:1.7;white-space:pre-wrap;word-wrap:break-word;overflow-y:auto;max-height:400px}
.highlight-display .word-active{background:rgba(99,102,241,.3);border-radius:3px;padding:0 2px;color:#fff;transition:background .1s}

.hidden{display:none !important}

/* Stats row */
.stats-row{display:flex;gap:.75rem;margin-bottom:1.5rem;flex-wrap:wrap}
.stat-chip{background:var(--surface2);border:1px solid var(--surface3);border-radius:8px;padding:.5rem .85rem;display:flex;align-items:center;gap:.5rem;font-size:.8rem}
.stat-chip .stat-label{color:var(--text-muted)}
.stat-chip .stat-val{font-family:'JetBrains Mono',monospace;font-weight:600;color:var(--text)}

/* Controls grid */
.controls-grid{display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin-bottom:1.5rem}
.form-group{display:flex;flex-direction:column;gap:.35rem}
.form-group label{font-size:.8rem;font-weight:600;color:var(--text-dim)}
.form-input{padding:.55rem .75rem;border-radius:8px;border:1px solid var(--surface3);background:var(--surface2);color:var(--text);font-family:'Inter',sans-serif;font-size:.9rem;outline:none;transition:border-color .2s;width:100%}
.form-input:focus{border-color:var(--primary)}
select.form-input{cursor:pointer}

/* Sliders */
.slider-group{margin-bottom:.75rem}
.slider-group label{display:flex;justify-content:space-between;font-size:.8rem;font-weight:600;color:var(--text-dim);margin-bottom:.5rem}
.slider-group label span{color:var(--text);font-family:'JetBrains Mono',monospace}
.slider{-webkit-appearance:none;appearance:none;width:100%;height:6px;border-radius:3px;background:var(--surface3);outline:none;cursor:pointer}
.slider::-webkit-slider-thumb{-webkit-appearance:none;width:18px;height:18px;border-radius:50%;background:var(--gradient);cursor:pointer;border:none;box-shadow:0 2px 8px rgba(99,102,241,.4)}
.slider::-moz-range-thumb{width:18px;height:18px;border-radius:50%;background:var(--primary);cursor:pointer;border:none}

/* Playback controls */
.playback-controls{display:flex;gap:.75rem;align-items:center;justify-content:center;margin-bottom:1.5rem;flex-wrap:wrap}
.play-btn{width:56px;height:56px;border-radius:50%;border:none;background:var(--gradient);color:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:transform .2s,box-shadow .2s;flex-shrink:0}
.play-btn:hover{transform:scale(1.08);box-shadow:0 4px 24px rgba(99,102,241,.5)}
.play-btn:disabled{opacity:.35;cursor:not-allowed;transform:none;box-shadow:none}
.play-btn svg{width:24px;height:24px}
.ctrl-btn{width:44px;height:44px;border-radius:50%;border:1px solid var(--surface3);background:var(--surface2);color:var(--text-dim);cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s}
.ctrl-btn:hover{border-color:var(--primary);color:var(--text)}
.ctrl-btn:disabled{opacity:.35;cursor:not-allowed}
.ctrl-btn svg{width:18px;height:18px}

/* Progress bar */
.progress-wrap{margin-bottom:1.5rem}
.progress-bar{width:100%;height:6px;background:var(--surface3);border-radius:3px;overflow:hidden;margin-bottom:.35rem}
.progress-fill{height:100%;background:var(--gradient);border-radius:3px;transition:width .3s linear;width:0}
.progress-meta{display:flex;justify-content:space-between;font-size:.72rem;color:var(--text-muted);font-family:'JetBrains Mono',monospace}

/* Status indicator */
.status-indicator{display:flex;align-items:center;gap:.5rem;justify-content:center;margin-bottom:1rem;font-size:.85rem;color:var(--text-dim);min-height:24px}
.status-dot{width:8px;height:8px;border-radius:50%;background:var(--text-muted);flex-shrink:0}
.status-dot.speaking{background:var(--green);animation:pulse 1s ease infinite}
.status-dot.paused{background:var(--yellow)}
@keyframes pulse{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.5;transform:scale(1.3)}}

/* Note */
.info-note{padding:.75rem 1rem;background:rgba(99,102,241,.06);border:1px solid rgba(99,102,241,.12);border-radius:8px;font-size:.8rem;color:var(--text-dim);line-height:1.5;margin-top:1rem}
.info-note strong{color:var(--text)}

/* Footer */
.footer{border-top:1px solid rgba(99,102,241,.06);padding:2rem 0;text-align:center}
.footer-inner{max-width:800px;margin:0 auto;padding:0 1.5rem;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:1rem}
.footer-logo{display:flex;align-items:center;gap:.4rem;font-weight:700;font-size:.9rem}
.footer-logo .ico{width:20px;height:20px;border-radius:5px;background:var(--gradient);display:flex;align-items:center;justify-content:center;font-size:.5rem;font-weight:900;color:#fff}
.footer-logo span{color:var(--text-dim)}
.footer-links{display:flex;gap:1.25rem}
.footer-links a{color:var(--text-muted);font-size:.8rem;text-decoration:none;transition:color .2s}
.footer-links a:hover{color:var(--text)}
.footer-copy{color:var(--text-muted);font-size:.75rem;width:100%;text-align:center;margin-top:.5rem}

@media(max-width:600px){
  .main{padding:1rem 1rem 2rem}
  .breadcrumb{padding:80px 1rem 0}
  .nav-links{display:none}
  .controls-grid{grid-template-columns:1fr}
  .footer-inner{flex-direction:column;text-align:center}
}
</style>
</head>
<body>
<nav class="nav">
  <a class="nav-logo" href="/"><div class="ico">N</div><span>NexTool</span></a>
  <div class="nav-links">
    <a href="/">Home</a>
    <a href="/free-tools/">Free Tools</a>
    <a href="/pro.html">Pro</a>
    <a href="/blog/">Blog</a>
  </div>
</nav>

<div class="breadcrumb">
  <a href="/">Home</a><span>/</span><a href="/free-tools/">Free Tools</a><span>/</span><span class="current">Text to Speech</span>
</div>

<div class="main">
  <div class="tool-header">
    <div class="tool-badge">Free Tool</div>
    <h1><span class="gr">Text to</span> Speech</h1>
    <p>Type or paste any text, pick a voice, and listen. Words are highlighted as they are spoken. Runs entirely in your browser.</p>
  </div>

  <!-- Input Card -->
  <div class="card">
    <h3>
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="8" y1="23" x2="16" y2="23"/></svg>
      Your Text
    </h3>

    <!-- Editable textarea (shown when not speaking) -->
    <div class="text-area-wrap" id="inputWrap">
      <textarea class="text-input" id="textInput" placeholder="Type or paste your text here..." spellcheck="false">The quick brown fox jumps over the lazy dog. This is a demonstration of the NexTool Text to Speech tool. You can adjust the voice, speed, and pitch using the controls below.</textarea>
    </div>

    <!-- Highlighted display (shown while speaking) -->
    <div class="highlight-display hidden" id="highlightDisplay"></div>

    <div class="stats-row">
      <div class="stat-chip">
        <span class="stat-label">Characters</span>
        <span class="stat-val" id="charCount">0</span>
      </div>
      <div class="stat-chip">
        <span class="stat-label">Words</span>
        <span class="stat-val" id="wordCount">0</span>
      </div>
      <div class="stat-chip">
        <span class="stat-label">Est. Duration</span>
        <span class="stat-val" id="estDuration">0:00</span>
      </div>
    </div>
  </div>

  <!-- Controls Card -->
  <div class="card">
    <h3>
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
      Voice Settings
    </h3>

    <div class="controls-grid">
      <div class="form-group">
        <label>Voice</label>
        <select class="form-input" id="voiceSelect">
          <option>Loading voices...</option>
        </select>
      </div>
      <div class="form-group">
        <label>Language Filter</label>
        <select class="form-input" id="langFilter">
          <option value="all">All Languages</option>
        </select>
      </div>
    </div>

    <div class="slider-group">
      <label>Speed <span id="speedVal">1.0x</span></label>
      <input type="range" class="slider" id="speedSlider" min="0.5" max="2" step="0.1" value="1">
    </div>

    <div class="slider-group">
      <label>Pitch <span id="pitchVal">1.0</span></label>
      <input type="range" class="slider" id="pitchSlider" min="0.5" max="2" step="0.1" value="1">
    </div>
  </div>

  <!-- Playback Card -->
  <div class="card">
    <h3>
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18"><polygon points="5 3 19 12 5 21 5 3"/></svg>
      Playback
    </h3>

    <div class="status-indicator" id="statusIndicator">
      <div class="status-dot" id="statusDot"></div>
      <span id="statusText">Ready</span>
    </div>

    <div class="progress-wrap">
      <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
      <div class="progress-meta">
        <span id="progressTime">0:00</span>
        <span id="progressTotal">0:00</span>
      </div>
    </div>

    <div class="playback-controls">
      <button class="ctrl-btn" id="stopBtn" title="Stop" disabled>
        <svg viewBox="0 0 24 24" fill="currentColor"><rect x="6" y="6" width="12" height="12" rx="1"/></svg>
      </button>
      <button class="play-btn" id="playBtn" title="Play">
        <svg viewBox="0 0 24 24" fill="currentColor" id="playIcon"><polygon points="6 3 20 12 6 21 6 3"/></svg>
      </button>
      <button class="ctrl-btn" id="pauseBtn" title="Pause" disabled>
        <svg viewBox="0 0 24 24" fill="currentColor"><rect x="6" y="5" width="4" height="14" rx="1"/><rect x="14" y="5" width="4" height="14" rx="1"/></svg>
      </button>
    </div>

    <div class="info-note">
      <strong>Note:</strong> The Web Speech API runs speech synthesis natively in your browser. Audio download is not supported by this API. For downloadable audio, a server-side TTS service would be required.
    </div>
  </div>
</div>


<!-- AUTO-LINKED by NexTool Engine -->
<div style="margin:2rem 0;padding:1.5rem;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius)">
<p style="font-weight:600;margin-bottom:.5rem">Related Tools</p>
<p><a href="/free-tools/box-shadow-generator.html" style="color:var(--primary);text-decoration:none">CSS Box Shadow Generator</a> · <a href="/free-tools/emoji-picker.html" style="color:var(--primary);text-decoration:none">Emoji Picker & Search</a> · <a href="/free-tools/meta-tag-generator.html" style="color:var(--primary);text-decoration:none">Meta Tag Generator</a> · <a href="/free-tools/color-palette.html" style="color:var(--primary);text-decoration:none">Free Color Palette Generator</a> · <a href="/free-tools/css-animation-generator.html" style="color:var(--primary);text-decoration:none">CSS Animation Generator - Free Tool</a></p>
</div>
<footer class="footer">
  <div class="footer-inner">
    <div class="footer-logo"><div class="ico">N</div><span>NexTool</span></div>
    <div class="footer-links">
      <a href="/">Home</a>
      <a href="/free-tools/">Free Tools</a>
      <a href="/pro.html">Pro</a>
      <a href="/blog/">Blog</a>
    </div>
    <div class="footer-copy">&copy; 2026 NexTool. All rights reserved.</div>
  </div>
</footer>

<script>
const textInput = document.getElementById('textInput');
const inputWrap = document.getElementById('inputWrap');
const highlightDisplay = document.getElementById('highlightDisplay');
const charCount = document.getElementById('charCount');
const wordCount = document.getElementById('wordCount');
const estDuration = document.getElementById('estDuration');
const voiceSelect = document.getElementById('voiceSelect');
const langFilter = document.getElementById('langFilter');
const speedSlider = document.getElementById('speedSlider');
const speedVal = document.getElementById('speedVal');
const pitchSlider = document.getElementById('pitchSlider');
const pitchVal = document.getElementById('pitchVal');
const playBtn = document.getElementById('playBtn');
const pauseBtn = document.getElementById('pauseBtn');
const stopBtn = document.getElementById('stopBtn');
const playIcon = document.getElementById('playIcon');
const statusDot = document.getElementById('statusDot');
const statusText = document.getElementById('statusText');
const progressFill = document.getElementById('progressFill');
const progressTime = document.getElementById('progressTime');
const progressTotal = document.getElementById('progressTotal');

let voices = [];
let allVoices = [];
let synth = window.speechSynthesis;
let utterance = null;
let isSpeaking = false;
let isPaused = false;
let startTime = 0;
let progressInterval = null;
let totalDuration = 0;
let words = [];
let currentWordIndex = -1;

// Load voices
function loadVoices() {
  allVoices = synth.getVoices();
  if (allVoices.length === 0) return;

  // Extract unique languages
  const langs = new Map();
  allVoices.forEach(v => {
    const code = v.lang.split('-')[0];
    if (!langs.has(code)) {
      const name = new Intl.DisplayNames(['en'], { type: 'language' });
      try { langs.set(code, name.of(code)); } catch (e) { langs.set(code, code); }
    }
  });

  langFilter.innerHTML = '<option value="all">All Languages</option>';
  [...langs.entries()].sort((a, b) => a[1].localeCompare(b[1])).forEach(([code, name]) => {
    const opt = document.createElement('option');
    opt.value = code;
    opt.textContent = name + ' (' + code + ')';
    langFilter.appendChild(opt);
  });

  filterVoices();
}

function filterVoices() {
  const filter = langFilter.value;
  voices = filter === 'all' ? allVoices : allVoices.filter(v => v.lang.startsWith(filter));

  voiceSelect.innerHTML = '';
  if (voices.length === 0) {
    voiceSelect.innerHTML = '<option>No voices available</option>';
    return;
  }
  voices.forEach((v, i) => {
    const opt = document.createElement('option');
    opt.value = i;
    opt.textContent = v.name + ' (' + v.lang + ')' + (v.default ? ' — Default' : '');
    voiceSelect.appendChild(opt);
  });

  // Select default voice
  const defaultIdx = voices.findIndex(v => v.default);
  if (defaultIdx >= 0) voiceSelect.value = defaultIdx;
}

synth.onvoiceschanged = loadVoices;
loadVoices();
langFilter.addEventListener('change', filterVoices);

// Sliders
speedSlider.addEventListener('input', () => {
  speedVal.textContent = parseFloat(speedSlider.value).toFixed(1) + 'x';
  updateEstDuration();
});
pitchSlider.addEventListener('input', () => {
  pitchVal.textContent = parseFloat(pitchSlider.value).toFixed(1);
});

// Text stats
function updateStats() {
  const text = textInput.value;
  const chars = text.length;
  const wds = text.trim() ? text.trim().split(/\s+/).length : 0;
  charCount.textContent = chars.toLocaleString();
  wordCount.textContent = wds.toLocaleString();
  updateEstDuration();
}

function updateEstDuration() {
  const wds = textInput.value.trim() ? textInput.value.trim().split(/\s+/).length : 0;
  const speed = parseFloat(speedSlider.value);
  // Average speaking rate ~150 words/min at 1x speed
  const seconds = Math.round((wds / (150 * speed)) * 60);
  estDuration.textContent = formatTime(seconds);
  progressTotal.textContent = formatTime(seconds);
  totalDuration = seconds;
}

function formatTime(s) {
  const m = Math.floor(s / 60);
  const sec = s % 60;
  return m + ':' + String(sec).padStart(2, '0');
}

textInput.addEventListener('input', updateStats);
updateStats();

// Word highlighting
function buildHighlightedText(text) {
  words = [];
  let result = '';
  let idx = 0;
  const regex = /\S+/g;
  let match;
  while ((match = regex.exec(text)) !== null) {
    // Add any whitespace before this word
    if (match.index > idx) {
      result += escapeHtml(text.substring(idx, match.index));
    }
    result += '<span class="word" data-idx="' + words.length + '">' + escapeHtml(match[0]) + '</span>';
    words.push({ start: match.index, end: match.index + match[0].length, text: match[0] });
    idx = match.index + match[0].length;
  }
  if (idx < text.length) result += escapeHtml(text.substring(idx));
  return result;
}

function escapeHtml(str) {
  return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
}

function highlightWord(charIndex) {
  // Find which word this character index falls within
  let wordIdx = -1;
  for (let i = 0; i < words.length; i++) {
    if (charIndex >= words[i].start && charIndex < words[i].end) {
      wordIdx = i;
      break;
    }
    // If between words, pick next
    if (charIndex < words[i].start) {
      wordIdx = i;
      break;
    }
  }

  if (wordIdx === currentWordIndex) return;
  currentWordIndex = wordIdx;

  // Remove old highlight
  const oldActive = highlightDisplay.querySelector('.word-active');
  if (oldActive) oldActive.classList.remove('word-active');

  if (wordIdx >= 0) {
    const el = highlightDisplay.querySelector('[data-idx="' + wordIdx + '"]');
    if (el) {
      el.classList.add('word-active');
      // Scroll into view if needed
      el.scrollIntoView({ block: 'nearest', behavior: 'smooth' });
    }
  }
}

// Playback
function speak() {
  const text = textInput.value.trim();
  if (!text) return;

  if (isPaused) {
    synth.resume();
    isPaused = false;
    setStatus('speaking', 'Speaking...');
    startProgressTimer();
    updateButtons('speaking');
    return;
  }

  // Stop any existing
  synth.cancel();

  utterance = new SpeechSynthesisUtterance(text);
  const selectedVoice = voices[parseInt(voiceSelect.value)];
  if (selectedVoice) utterance.voice = selectedVoice;
  utterance.rate = parseFloat(speedSlider.value);
  utterance.pitch = parseFloat(pitchSlider.value);

  // Build highlighted version
  highlightDisplay.innerHTML = buildHighlightedText(text);
  inputWrap.classList.add('hidden');
  highlightDisplay.classList.remove('hidden');

  utterance.onboundary = (e) => {
    if (e.name === 'word') {
      highlightWord(e.charIndex);
    }
  };

  utterance.onend = () => {
    stopSpeaking(false);
  };

  utterance.onerror = (e) => {
    if (e.error !== 'canceled') {
      stopSpeaking(false);
    }
  };

  synth.speak(utterance);
  isSpeaking = true;
  isPaused = false;
  startTime = Date.now();
  currentWordIndex = -1;
  setStatus('speaking', 'Speaking...');
  startProgressTimer();
  updateButtons('speaking');
}

function pauseSpeaking() {
  if (!isSpeaking) return;
  synth.pause();
  isPaused = true;
  clearInterval(progressInterval);
  setStatus('paused', 'Paused');
  updateButtons('paused');
}

function stopSpeaking(cancel = true) {
  if (cancel) synth.cancel();
  isSpeaking = false;
  isPaused = false;
  clearInterval(progressInterval);
  progressFill.style.width = '0';
  progressTime.textContent = '0:00';
  currentWordIndex = -1;
  setStatus('ready', 'Ready');
  updateButtons('ready');

  // Show textarea again
  inputWrap.classList.remove('hidden');
  highlightDisplay.classList.add('hidden');
}

function setStatus(state, text) {
  statusDot.className = 'status-dot' + (state === 'speaking' ? ' speaking' : state === 'paused' ? ' paused' : '');
  statusText.textContent = text;
}

function updateButtons(state) {
  playBtn.disabled = state === 'speaking';
  pauseBtn.disabled = state !== 'speaking';
  stopBtn.disabled = state === 'ready';
}

function startProgressTimer() {
  clearInterval(progressInterval);
  progressInterval = setInterval(() => {
    if (!isSpeaking || isPaused) return;
    const elapsed = (Date.now() - startTime) / 1000;
    const pct = totalDuration > 0 ? Math.min((elapsed / totalDuration) * 100, 100) : 0;
    progressFill.style.width = pct + '%';
    progressTime.textContent = formatTime(Math.round(elapsed));
  }, 250);
}

// Button handlers
playBtn.addEventListener('click', speak);
pauseBtn.addEventListener('click', pauseSpeaking);
stopBtn.addEventListener('click', () => stopSpeaking(true));

// Keyboard shortcuts
document.addEventListener('keydown', (e) => {
  if (e.target.tagName === 'TEXTAREA' || e.target.tagName === 'INPUT' || e.target.tagName === 'SELECT') return;
  if (e.code === 'Space') {
    e.preventDefault();
    if (isSpeaking && !isPaused) pauseSpeaking();
    else speak();
  }
  if (e.code === 'Escape') {
    stopSpeaking(true);
  }
});

// Chrome bug: long text speech stops. Workaround: chunk and resume
(function chromePatch() {
  if (!synth) return;
  let resumeTimer;
  const keepAlive = () => {
    if (synth.speaking && !synth.paused) {
      synth.pause();
      synth.resume();
    }
    resumeTimer = setTimeout(keepAlive, 10000);
  };
  const origSpeak = synth.speak.bind(synth);
  synth.speak = function (u) {
    clearTimeout(resumeTimer);
    resumeTimer = setTimeout(keepAlive, 10000);
    origSpeak(u);
  };
})();
</script>
<script src="/js/revenue.js" defer></script>
<script src="/js/lead-capture.js" defer></script>
<script src="/js/analytics-lite.js" defer></script>
</body>
</html>