<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tool Pipeline Builder — Chain Tools Together | NexTool</title>
<meta name="description" content="Chain multiple tools together like Unix pipes. JSON formatting, Base64 encoding, URL encoding, hashing, text transforms — all in one pipeline. Free online tool.">
<meta property="og:title" content="Tool Pipeline Builder | NexTool">
<meta property="og:description" content="Chain tools together like Unix pipes for the browser. Build custom pipelines with 20+ transformations.">
<meta property="og:type" content="website">
<meta property="og:url" content="https://nextool.app/free-tools/tool-pipeline.html">
<meta property="og:image" content="https://nextool.app/assets/og-default.png">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<link rel="canonical" href="https://nextool.app/free-tools/tool-pipeline.html">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Tool Pipeline Builder | NexTool">
<meta name="twitter:description" content="Chain tools together like Unix pipes. Build custom pipelines with 20+ transformations. Free.">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"SoftwareApplication","name":"NexTool Tool Pipeline Builder","applicationCategory":"DeveloperApplication","operatingSystem":"Web","offers":{"@type":"Offer","price":"0","priceCurrency":"USD"},"description":"Chain multiple developer tools together like Unix pipes. Build custom pipelines with 20+ transformations."}
</script>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{--bg:#050508;--surface:#111118;--surface2:#1a1a24;--surface3:#0a0a12;--border:#252535;--border2:rgba(99,102,241,.15);--text:#e2e8f0;--text2:#94a3b8;--text3:#64748b;--primary:#6366f1;--accent:#a855f7;--pink:#ec4899;--green:#22c55e;--red:#ef4444;--cyan:#22d3ee;--yellow:#eab308;--radius:12px;--glass:rgba(17,17,24,.72)}
html{scroll-behavior:smooth}
body{font-family:'Inter',system-ui,sans-serif;background:var(--bg);color:var(--text);line-height:1.6;min-height:100vh;overflow-x:hidden}
::selection{background:var(--primary);color:#fff}
/* NAV */
.nav{position:sticky;top:0;z-index:100;backdrop-filter:blur(20px);background:rgba(5,5,8,.85);border-bottom:1px solid var(--border2);padding:0 1.5rem}
.nav-inner{max-width:1200px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;height:64px}
.nav-logo{font-size:1.35rem;font-weight:800;background:linear-gradient(135deg,var(--primary),var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent;text-decoration:none}
.nav-links{display:flex;align-items:center;gap:1.75rem}
.nav-links a{color:var(--text2);text-decoration:none;font-size:.875rem;font-weight:500;transition:color .2s}
.nav-links a:hover{color:var(--text)}
.nav-cta{background:linear-gradient(135deg,var(--primary),var(--accent));color:#fff!important;padding:.5rem 1.15rem;border-radius:8px;font-weight:600;font-size:.85rem;-webkit-text-fill-color:#fff!important}
.nav-toggle{display:none;background:none;border:none;color:var(--text);font-size:1.5rem;cursor:pointer}
/* HERO */
.hero{text-align:center;padding:3rem 1.5rem 2rem;max-width:720px;margin:0 auto}
.hero-badge{display:inline-flex;align-items:center;gap:6px;font-size:.75rem;font-weight:600;color:var(--accent);background:rgba(168,85,247,.1);border:1px solid rgba(168,85,247,.2);border-radius:99px;padding:.3rem .9rem;margin-bottom:1rem;letter-spacing:.03em}
.hero-badge .pulse{width:6px;height:6px;border-radius:50%;background:var(--green);animation:pulse 2s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}
.hero h1{font-size:clamp(1.75rem,4.5vw,2.5rem);font-weight:800;line-height:1.15;margin-bottom:.75rem}
.hero h1 span{background:linear-gradient(135deg,var(--primary),var(--accent),var(--pink));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.hero p{color:var(--text2);font-size:1.05rem;max-width:560px;margin:0 auto}
/* MAIN LAYOUT */
.main-wrap{max-width:1100px;margin:0 auto;padding:0 1.5rem 3rem}
/* TEMPLATES */
.templates{display:flex;flex-wrap:wrap;gap:.5rem;margin-bottom:1.5rem;justify-content:center}
.tpl-btn{padding:7px 14px;background:var(--surface);border:1px solid var(--border);border-radius:8px;color:var(--text2);font-size:.78rem;font-weight:600;cursor:pointer;transition:all .2s;font-family:inherit;display:flex;align-items:center;gap:5px}
.tpl-btn:hover{border-color:var(--primary);color:var(--text);background:rgba(99,102,241,.06)}
.tpl-btn .tpl-icon{font-size:.85rem}
/* PIPELINE AREA */
.pipe-grid{display:grid;grid-template-columns:1fr 1fr;gap:1.25rem;margin-bottom:1.5rem}
.glass-card{background:var(--glass);border:1px solid var(--border2);border-radius:var(--radius);backdrop-filter:blur(12px);overflow:hidden}
.card-head{padding:12px 16px;border-bottom:1px solid var(--border2);display:flex;align-items:center;justify-content:space-between}
.card-title{font-size:.78rem;font-weight:700;color:var(--text2);text-transform:uppercase;letter-spacing:.04em;display:flex;align-items:center;gap:6px}
.card-title .icon{font-size:1rem}
.card-meta{font-size:.72rem;color:var(--text3);font-weight:500}
.card-body{padding:16px}
textarea.pipe-input{width:100%;min-height:180px;background:var(--surface3);border:1px solid var(--border);border-radius:8px;padding:12px;color:var(--text);font-family:'Courier New',monospace;font-size:.84rem;line-height:1.6;resize:vertical;outline:none;transition:border-color .2s}
textarea.pipe-input:focus{border-color:var(--primary)}
textarea.pipe-input::placeholder{color:var(--text3)}
.output-area{width:100%;min-height:180px;background:var(--surface3);border:1px solid var(--border);border-radius:8px;padding:12px;color:var(--text);font-family:'Courier New',monospace;font-size:.84rem;line-height:1.6;white-space:pre-wrap;word-break:break-all;overflow:auto;max-height:400px}
.output-area.empty{color:var(--text3);font-style:italic;font-family:inherit}
/* PIPELINE STEPS */
.pipe-steps{margin-bottom:1.5rem}
.pipe-steps-title{font-size:.78rem;font-weight:700;color:var(--text2);text-transform:uppercase;letter-spacing:.04em;margin-bottom:.75rem;display:flex;align-items:center;gap:6px}
.steps-flow{display:flex;flex-wrap:wrap;align-items:center;gap:8px;min-height:52px;padding:12px;background:var(--surface);border:1px solid var(--border2);border-radius:var(--radius)}
.step-chip{display:flex;align-items:center;gap:6px;padding:8px 12px;background:var(--surface2);border:1px solid var(--border);border-radius:8px;font-size:.8rem;font-weight:600;color:var(--text);cursor:default;transition:all .2s;position:relative}
.step-chip:hover{border-color:var(--primary)}
.step-chip .step-name{white-space:nowrap}
.step-chip .step-remove{width:18px;height:18px;border-radius:50%;background:transparent;border:none;color:var(--text3);font-size:14px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .15s;line-height:1}
.step-chip .step-remove:hover{background:rgba(239,68,68,.15);color:var(--red)}
.step-chip.running{border-color:var(--primary);box-shadow:0 0 12px rgba(99,102,241,.3)}
.step-chip.done{border-color:var(--green)}
.step-chip.error{border-color:var(--red)}
.step-arrow{color:var(--text3);font-size:1.1rem;font-weight:700;flex-shrink:0}
.step-arrow.active{color:var(--primary)}
.add-step-btn{padding:8px 14px;background:transparent;border:1px dashed var(--border);border-radius:8px;color:var(--text3);font-size:.8rem;font-weight:600;cursor:pointer;transition:all .2s;font-family:inherit;display:flex;align-items:center;gap:5px}
.add-step-btn:hover{border-color:var(--primary);color:var(--primary);background:rgba(99,102,241,.04)}
.empty-steps{color:var(--text3);font-size:.82rem;text-align:center;padding:8px 0}
/* ADD STEP DROPDOWN */
.add-dropdown{position:fixed;z-index:200;width:300px;max-height:400px;background:var(--surface);border:1px solid var(--border2);border-radius:var(--radius);box-shadow:0 20px 60px rgba(0,0,0,.6);overflow:hidden;display:none}
.add-dropdown.open{display:block}
.add-dropdown .dd-search{width:100%;padding:10px 14px;background:var(--surface3);border:none;border-bottom:1px solid var(--border2);color:var(--text);font-size:.85rem;font-family:inherit;outline:none}
.add-dropdown .dd-search::placeholder{color:var(--text3)}
.add-dropdown .dd-list{overflow-y:auto;max-height:340px;padding:6px}
.add-dropdown .dd-cat{padding:6px 10px 4px;font-size:.68rem;font-weight:700;color:var(--primary);text-transform:uppercase;letter-spacing:.5px}
.add-dropdown .dd-item{padding:8px 10px;border-radius:6px;cursor:pointer;font-size:.82rem;font-weight:500;color:var(--text2);transition:all .15s;display:flex;align-items:center;gap:8px}
.add-dropdown .dd-item:hover{background:rgba(99,102,241,.1);color:var(--text)}
.add-dropdown .dd-item .dd-icon{width:24px;height:24px;border-radius:6px;background:var(--surface2);display:flex;align-items:center;justify-content:center;font-size:.7rem;font-weight:700;color:var(--text3);flex-shrink:0}
/* ACTION BAR */
.action-bar{display:flex;flex-wrap:wrap;gap:.6rem;margin-bottom:1.5rem}
.btn{padding:10px 20px;border:none;border-radius:8px;font-family:inherit;font-size:.85rem;font-weight:600;cursor:pointer;transition:all .2s;display:inline-flex;align-items:center;gap:6px}
.btn-run{background:linear-gradient(135deg,var(--primary),var(--accent));color:#fff}
.btn-run:hover{opacity:.88;transform:translateY(-1px);box-shadow:0 4px 20px rgba(99,102,241,.3)}
.btn-run:active{transform:translateY(0)}
.btn-run:disabled{opacity:.4;cursor:not-allowed;transform:none}
.btn-secondary{background:var(--surface2);border:1px solid var(--border);color:var(--text)}
.btn-secondary:hover{border-color:var(--primary);color:var(--primary)}
.btn-copy.copied{background:var(--green);color:#fff;border-color:var(--green)}
/* STEP DETAILS */
.step-details{margin-bottom:2rem}
.step-detail-card{background:var(--glass);border:1px solid var(--border2);border-radius:10px;padding:14px 16px;margin-bottom:.75rem;transition:all .3s}
.step-detail-card.active{border-color:rgba(99,102,241,.4);box-shadow:0 0 20px rgba(99,102,241,.08)}
.sd-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
.sd-label{font-size:.75rem;font-weight:700;color:var(--text2);text-transform:uppercase;letter-spacing:.04em;display:flex;align-items:center;gap:6px}
.sd-label .sd-num{width:22px;height:22px;border-radius:6px;background:var(--surface2);display:flex;align-items:center;justify-content:center;font-size:.7rem;color:var(--primary);font-weight:800}
.sd-meta{font-size:.7rem;color:var(--text3)}
.sd-preview{background:var(--surface3);border-radius:6px;padding:8px 10px;font-family:'Courier New',monospace;font-size:.78rem;color:var(--text2);max-height:80px;overflow:auto;white-space:pre-wrap;word-break:break-all;line-height:1.5}
/* SHARE PIPELINE */
.share-bar{display:flex;align-items:center;gap:8px;padding:12px 16px;background:var(--surface);border:1px solid var(--border2);border-radius:10px;margin-bottom:2rem}
.share-bar input{flex:1;background:var(--surface3);border:1px solid var(--border);border-radius:6px;padding:8px 10px;color:var(--text);font-size:.8rem;font-family:'Courier New',monospace;outline:none}
.share-bar input:focus{border-color:var(--primary)}
.share-bar .share-label{font-size:.75rem;font-weight:700;color:var(--text2);white-space:nowrap;display:flex;align-items:center;gap:4px}
/* CTA */
.cta-section{text-align:center;padding:3rem 1.5rem;max-width:640px;margin:0 auto}
.cta-section h2{font-size:1.6rem;font-weight:800;margin-bottom:.75rem}
.cta-section h2 span{background:linear-gradient(135deg,var(--primary),var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.cta-section p{color:var(--text2);margin-bottom:1.5rem;font-size:.95rem}
.cta-btn{display:inline-block;background:linear-gradient(135deg,var(--primary),var(--accent));color:#fff;padding:.75rem 2rem;border-radius:10px;font-weight:700;text-decoration:none;font-size:1rem;transition:transform .2s,box-shadow .2s}
.cta-btn:hover{transform:translateY(-2px);box-shadow:0 8px 30px rgba(99,102,241,.3)}
/* CROSS-PROMO */
.cross-promo{max-width:1100px;margin:0 auto;padding:0 1.5rem 2rem}
.cross-promo h3{font-size:1rem;font-weight:700;margin-bottom:1rem;color:var(--text)}
.promo-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:.75rem}
.promo-grid a{display:block;padding:14px;background:var(--surface);border:1px solid var(--border2);border-radius:10px;color:var(--text);text-decoration:none;font-size:.85rem;font-weight:500;transition:border-color .2s,transform .2s}
.promo-grid a:hover{border-color:rgba(99,102,241,.4);transform:translateY(-2px)}
.promo-grid a span{display:block;color:var(--text3);font-size:.75rem;margin-top:3px}
/* FOOTER */
footer{border-top:1px solid var(--border);padding:3rem 1.5rem 2rem;max-width:1200px;margin:0 auto}
.footer-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:2rem;margin-bottom:2rem}
.footer-col h4{font-size:.85rem;font-weight:700;margin-bottom:.75rem}
.footer-col a{display:block;color:var(--text2);text-decoration:none;font-size:.8rem;margin-bottom:.4rem;transition:color .2s}
.footer-col a:hover{color:var(--primary)}
.footer-bottom{text-align:center;color:var(--text3);font-size:.75rem;padding-top:1.5rem;border-top:1px solid var(--border)}
/* ANIMATIONS */
@keyframes fadeIn{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
.fade-in{opacity:0;transform:translateY(20px);transition:opacity .6s,transform .6s}
.fade-in.visible{opacity:1;transform:translateY(0)}
/* RESPONSIVE */
@media(max-width:768px){
  .pipe-grid{grid-template-columns:1fr}
  .nav-links{display:none}
  .nav-toggle{display:block}
  .hero h1{font-size:1.6rem}
  .templates{justify-content:flex-start}
  .footer-grid{grid-template-columns:1fr 1fr}
  .share-bar{flex-direction:column;align-items:stretch}
}
@media(max-width:480px){
  .steps-flow{flex-direction:column;align-items:stretch}
  .step-arrow{transform:rotate(90deg);text-align:center}
  .footer-grid{grid-template-columns:1fr}
}
</style>
</head>
<body>

<!-- NAV -->
<nav class="nav">
  <div class="nav-inner">
    <a href="/" class="nav-logo">NexTool</a>
    <div class="nav-links">
      <a href="/free-tools/">Tools</a>
      <a href="/blog/">Blog</a>
      <a href="/pro.html" class="nav-cta">Get Pro</a>
    </div>
    <button class="nav-toggle" onclick="document.querySelector('.nav-links').classList.toggle('show')" aria-label="Menu">&#9776;</button>
  </div>
</nav>

<!-- HERO -->
<section class="hero">
  <div class="hero-badge"><span class="pulse"></span> World's First</div>
  <h1>Tool <span>Pipeline Builder</span></h1>
  <p>Chain multiple tools together like Unix pipes. Output from one transformation feeds into the next. Build, run, and share custom pipelines.</p>
</section>

<!-- MAIN -->
<div class="main-wrap">

  <!-- TEMPLATE PIPELINES -->
  <div class="templates fade-in" id="templates">
    <button class="tpl-btn" data-pipe="json-format,base64-encode"><span class="tpl-icon">{}</span> JSON &rarr; Base64</button>
    <button class="tpl-btn" data-pipe="base64-decode,json-format"><span class="tpl-icon">B64</span> Base64 &rarr; JSON</button>
    <button class="tpl-btn" data-pipe="json-format,sha256"><span class="tpl-icon">#</span> JSON &rarr; SHA-256</button>
    <button class="tpl-btn" data-pipe="uppercase,base64-encode,url-encode"><span class="tpl-icon">ABC</span> Upper &rarr; B64 &rarr; URL</button>
    <button class="tpl-btn" data-pipe="sort-lines,remove-duplicates,trim-lines"><span class="tpl-icon">&#9776;</span> Sort &rarr; Dedup &rarr; Trim</button>
    <button class="tpl-btn" data-pipe="html-entity-encode,base64-encode"><span class="tpl-icon">&amp;</span> HTML Escape &rarr; B64</button>
    <button class="tpl-btn" data-pipe="json-minify,url-encode"><span class="tpl-icon">{}</span> JSON Minify &rarr; URL</button>
    <button class="tpl-btn" data-pipe="remove-empty-lines,add-line-numbers"><span class="tpl-icon">#</span> Clean &rarr; Number Lines</button>
  </div>

  <!-- PIPELINE STEPS -->
  <div class="pipe-steps fade-in">
    <div class="pipe-steps-title"><span>&#x26D3;&#xFE0F;</span> Pipeline</div>
    <div class="steps-flow" id="steps-flow">
      <div class="empty-steps" id="empty-msg">Click <strong>+ Add Step</strong> or choose a template above to start building your pipeline</div>
      <!-- Steps get injected here -->
      <button class="add-step-btn" id="add-step-btn">+ Add Step</button>
    </div>
  </div>

  <!-- ACTION BAR -->
  <div class="action-bar fade-in">
    <button class="btn btn-run" id="run-btn" disabled>&#9654; Run Pipeline</button>
    <button class="btn btn-secondary" id="clear-btn">Clear All</button>
    <button class="btn btn-secondary btn-copy" id="copy-btn">Copy Output</button>
  </div>

  <!-- INPUT / OUTPUT -->
  <div class="pipe-grid fade-in">
    <div class="glass-card">
      <div class="card-head">
        <div class="card-title"><span class="icon">&#x1F4E5;</span> Input</div>
        <div class="card-meta" id="input-meta">0 chars</div>
      </div>
      <div class="card-body">
        <textarea class="pipe-input" id="input-area" placeholder="Paste or type your input text here...&#10;&#10;The pipeline will transform this text through each step." spellcheck="false"></textarea>
      </div>
    </div>
    <div class="glass-card">
      <div class="card-head">
        <div class="card-title"><span class="icon">&#x1F4E4;</span> Output</div>
        <div class="card-meta" id="output-meta">0 chars</div>
      </div>
      <div class="card-body">
        <div class="output-area empty" id="output-area">Run the pipeline to see output here</div>
      </div>
    </div>
  </div>

  <!-- STEP DETAILS -->
  <div class="step-details fade-in" id="step-details" style="display:none">
    <div class="pipe-steps-title"><span>&#x1F50D;</span> Step-by-Step Results</div>
    <div id="step-details-list"></div>
  </div>

  <!-- SHARE PIPELINE URL -->
  <div class="share-bar fade-in" id="share-bar" style="display:none">
    <span class="share-label">&#x1F517; Share Pipeline</span>
    <input type="text" id="share-url" readonly onclick="this.select()">
    <button class="btn btn-secondary" id="share-copy-btn" style="padding:8px 12px;font-size:.78rem">Copy</button>
  </div>

</div>

<!-- CTA -->
<section class="cta-section fade-in">
  <h2>Explore <span>150+ Free Tools</span></h2>
  <p>Each tool in the pipeline is also available as a standalone tool with full features.</p>
  <a href="/free-tools/" class="cta-btn">Browse All Tools</a>
</section>

<!-- CROSS-PROMO -->
<div class="cross-promo fade-in">
  <h3>Popular tools used in pipelines</h3>
  <div class="promo-grid">
    <a href="/free-tools/json-formatter.html">JSON Formatter<span>Format, validate, minify</span></a>
    <a href="/free-tools/base64.html">Base64 Encoder<span>Encode &amp; decode text/files</span></a>
    <a href="/free-tools/url-encoder.html">URL Encoder<span>Encode &amp; decode URLs</span></a>
    <a href="/free-tools/hash-generator.html">Hash Generator<span>MD5, SHA-1, SHA-256</span></a>
    <a href="/free-tools/diff-checker.html">Diff Checker<span>Compare text side by side</span></a>
    <a href="/free-tools/css-formatter.html">CSS Formatter<span>Beautify CSS code</span></a>
  </div>
</div>

<!-- FOOTER -->
<footer>
  <div class="footer-grid">
    <div class="footer-col">
      <h4>NexTool</h4>
      <a href="/">Home</a>
      <a href="/free-tools/">All Tools</a>
      <a href="/blog/">Blog</a>
      <a href="/pro.html">NexTool Pro</a>
    </div>
    <div class="footer-col">
      <h4>Popular Tools</h4>
      <a href="/free-tools/json-formatter.html">JSON Formatter</a>
      <a href="/free-tools/password-generator.html">Password Generator</a>
      <a href="/free-tools/base64.html">Base64 Encoder</a>
      <a href="/free-tools/regex-tester.html">Regex Tester</a>
    </div>
    <div class="footer-col">
      <h4>Legal</h4>
      <a href="/terms.html">Terms of Service</a>
      <a href="/imprint.html">Imprint</a>
      <a href="mailto:christianjunbucher@gmail.com">Contact</a>
    </div>
  </div>
  <div class="footer-bottom">&copy; 2026 NexTool. All tools run client-side. Your data never leaves the browser.</div>
</footer>

<!-- ADD STEP DROPDOWN -->
<div class="add-dropdown" id="add-dropdown">
  <input class="dd-search" id="dd-search" placeholder="Search transformations..." type="text">
  <div class="dd-list" id="dd-list"></div>
</div>

<script src="/js/revenue.js" defer></script>
<script src="/js/lead-capture.js" defer></script>
<script src="/js/analytics-lite.js" defer></script>
<script>
(function(){
'use strict';

// ============================
// TRANSFORMATION REGISTRY
// ============================
// Each: { id, name, icon, category, fn(input) → output }
// fn can return string or Promise<string>

var TRANSFORMS = [
  // --- Encoding ---
  { id:'base64-encode', n:'Base64 Encode', i:'B64', c:'Encoding', fn:function(s){ return btoa(unescape(encodeURIComponent(s))); }},
  { id:'base64-decode', n:'Base64 Decode', i:'B64', c:'Encoding', fn:function(s){ try{ return decodeURIComponent(escape(atob(s.trim()))); }catch(e){ return '[Error: Invalid Base64]'; }}},
  { id:'url-encode', n:'URL Encode', i:'%', c:'Encoding', fn:function(s){ return encodeURIComponent(s); }},
  { id:'url-decode', n:'URL Decode', i:'%', c:'Encoding', fn:function(s){ try{ return decodeURIComponent(s); }catch(e){ return '[Error: Invalid URL encoding]'; }}},
  { id:'html-entity-encode', n:'HTML Entity Encode', i:'&amp;', c:'Encoding', fn:function(s){ var d=document.createElement('div');d.textContent=s;return d.innerHTML; }},
  { id:'html-entity-decode', n:'HTML Entity Decode', i:'&amp;', c:'Encoding', fn:function(s){ var d=document.createElement('div');d.innerHTML=s;return d.textContent; }},
  { id:'unicode-escape', n:'Unicode Escape', i:'U+', c:'Encoding', fn:function(s){ return Array.from(s).map(function(c){var cp=c.codePointAt(0);return cp>127?'\\u'+cp.toString(16).padStart(4,'0'):c;}).join(''); }},

  // --- Hashing ---
  { id:'sha256', n:'SHA-256 Hash', i:'#', c:'Hashing', fn:function(s){ return crypto.subtle.digest('SHA-256',new TextEncoder().encode(s)).then(function(buf){return Array.from(new Uint8Array(buf)).map(function(b){return b.toString(16).padStart(2,'0')}).join('');}); }},
  { id:'sha1', n:'SHA-1 Hash', i:'#', c:'Hashing', fn:function(s){ return crypto.subtle.digest('SHA-1',new TextEncoder().encode(s)).then(function(buf){return Array.from(new Uint8Array(buf)).map(function(b){return b.toString(16).padStart(2,'0')}).join('');}); }},

  // --- JSON ---
  { id:'json-format', n:'JSON Format (Pretty)', i:'{}', c:'JSON', fn:function(s){ try{ return JSON.stringify(JSON.parse(s),null,2); }catch(e){ return '[Error: Invalid JSON] '+e.message; }}},
  { id:'json-minify', n:'JSON Minify', i:'{}', c:'JSON', fn:function(s){ try{ return JSON.stringify(JSON.parse(s)); }catch(e){ return '[Error: Invalid JSON] '+e.message; }}},
  { id:'json-to-csv', n:'JSON to CSV', i:'CSV', c:'JSON', fn:function(s){
    try{
      var arr=JSON.parse(s);
      if(!Array.isArray(arr))return '[Error: Input must be a JSON array]';
      if(!arr.length)return '';
      var keys=Object.keys(arr[0]);
      var rows=[keys.join(',')];
      arr.forEach(function(obj){rows.push(keys.map(function(k){var v=obj[k]==null?'':String(obj[k]);return v.indexOf(',')!==-1||v.indexOf('"')!==-1?'"'+v.replace(/"/g,'""')+'"':v;}).join(','));});
      return rows.join('\n');
    }catch(e){return '[Error: Invalid JSON] '+e.message;}
  }},
  { id:'json-extract-keys', n:'JSON Extract Keys', i:'{}', c:'JSON', fn:function(s){ try{ return Object.keys(JSON.parse(s)).join('\n'); }catch(e){ return '[Error: Invalid JSON] '+e.message; }}},

  // --- Text Case ---
  { id:'uppercase', n:'UPPERCASE', i:'AA', c:'Text Case', fn:function(s){ return s.toUpperCase(); }},
  { id:'lowercase', n:'lowercase', i:'aa', c:'Text Case', fn:function(s){ return s.toLowerCase(); }},
  { id:'title-case', n:'Title Case', i:'Aa', c:'Text Case', fn:function(s){ return s.replace(/\b\w/g,function(c){return c.toUpperCase();}); }},
  { id:'camel-case', n:'camelCase', i:'cC', c:'Text Case', fn:function(s){ return s.toLowerCase().replace(/[^a-zA-Z0-9]+(.)/g,function(_,c){return c.toUpperCase();}); }},
  { id:'snake-case', n:'snake_case', i:'s_c', c:'Text Case', fn:function(s){ return s.replace(/([a-z])([A-Z])/g,'$1_$2').replace(/[\s\-]+/g,'_').toLowerCase(); }},
  { id:'kebab-case', n:'kebab-case', i:'k-c', c:'Text Case', fn:function(s){ return s.replace(/([a-z])([A-Z])/g,'$1-$2').replace(/[\s_]+/g,'-').toLowerCase(); }},

  // --- Text Lines ---
  { id:'sort-lines', n:'Sort Lines (A-Z)', i:'AZ', c:'Lines', fn:function(s){ return s.split('\n').sort().join('\n'); }},
  { id:'sort-lines-reverse', n:'Sort Lines (Z-A)', i:'ZA', c:'Lines', fn:function(s){ return s.split('\n').sort().reverse().join('\n'); }},
  { id:'remove-duplicates', n:'Remove Duplicate Lines', i:'-D', c:'Lines', fn:function(s){ var seen={};return s.split('\n').filter(function(l){if(seen[l])return false;seen[l]=true;return true;}).join('\n'); }},
  { id:'remove-empty-lines', n:'Remove Empty Lines', i:'-E', c:'Lines', fn:function(s){ return s.split('\n').filter(function(l){return l.trim()!=='';}).join('\n'); }},
  { id:'trim-lines', n:'Trim Lines', i:'><', c:'Lines', fn:function(s){ return s.split('\n').map(function(l){return l.trim();}).join('\n'); }},
  { id:'reverse-lines', n:'Reverse Line Order', i:'&#8597;', c:'Lines', fn:function(s){ return s.split('\n').reverse().join('\n'); }},
  { id:'add-line-numbers', n:'Add Line Numbers', i:'1.', c:'Lines', fn:function(s){ return s.split('\n').map(function(l,i){return(i+1)+'. '+l;}).join('\n'); }},
  { id:'shuffle-lines', n:'Shuffle Lines', i:'&#x1F3B2;', c:'Lines', fn:function(s){ var a=s.split('\n');for(var i=a.length-1;i>0;i--){var j=Math.floor(Math.random()*(i+1));var t=a[i];a[i]=a[j];a[j]=t;}return a.join('\n'); }},

  // --- Text Transform ---
  { id:'reverse-text', n:'Reverse Text', i:'&#8596;', c:'Text', fn:function(s){ return Array.from(s).reverse().join(''); }},
  { id:'count-stats', n:'Count Words/Chars', i:'#', c:'Text', fn:function(s){ var w=s.trim()?s.trim().split(/\s+/).length:0;var l=s.split('\n').length;return 'Characters: '+s.length+'\nWords: '+w+'\nLines: '+l+'\nSentences: '+(s.match(/[.!?]+/g)||[]).length+'\nParagraphs: '+s.split(/\n\n+/).filter(function(p){return p.trim();}).length; }},
  { id:'wrap-lines', n:'Wrap at 80 chars', i:'W', c:'Text', fn:function(s){ return s.split('\n').map(function(line){if(line.length<=80)return line;var out='',i=0;while(i<line.length){out+=line.substr(i,80)+'\n';i+=80;}return out.trim();}).join('\n'); }},
  { id:'escape-json-string', n:'Escape JSON String', i:'\\', c:'Text', fn:function(s){ return JSON.stringify(s); }},
  { id:'unescape-json-string', n:'Unescape JSON String', i:'\\', c:'Text', fn:function(s){ try{return JSON.parse(s);}catch(e){return '[Error: Not a valid JSON string]';}}},
];

// Build lookup
var TX_MAP={};
TRANSFORMS.forEach(function(t){TX_MAP[t.id]=t;});

// ============================
// PIPELINE STATE
// ============================
var pipeline = []; // Array of transform IDs
var results = [];  // Array of { input, output, ms }

// ============================
// DOM REFS
// ============================
var $stepsFlow = document.getElementById('steps-flow');
var $emptyMsg = document.getElementById('empty-msg');
var $addBtn = document.getElementById('add-step-btn');
var $addDD = document.getElementById('add-dropdown');
var $ddSearch = document.getElementById('dd-search');
var $ddList = document.getElementById('dd-list');
var $runBtn = document.getElementById('run-btn');
var $clearBtn = document.getElementById('clear-btn');
var $copyBtn = document.getElementById('copy-btn');
var $inputArea = document.getElementById('input-area');
var $outputArea = document.getElementById('output-area');
var $inputMeta = document.getElementById('input-meta');
var $outputMeta = document.getElementById('output-meta');
var $stepDetails = document.getElementById('step-details');
var $stepDetailsList = document.getElementById('step-details-list');
var $shareBar = document.getElementById('share-bar');
var $shareUrl = document.getElementById('share-url');
var $shareCopyBtn = document.getElementById('share-copy-btn');

// ============================
// RENDER
// ============================
function renderSteps() {
  // Remove all step chips and arrows (keep empty msg and add btn)
  var children = Array.from($stepsFlow.children);
  children.forEach(function(c) {
    if (c !== $emptyMsg && c !== $addBtn) c.remove();
  });

  $emptyMsg.style.display = pipeline.length ? 'none' : '';
  $runBtn.disabled = !pipeline.length;

  pipeline.forEach(function(id, idx) {
    var tx = TX_MAP[id];
    if (!tx) return;

    // Arrow before (except first)
    if (idx > 0) {
      var arrow = document.createElement('span');
      arrow.className = 'step-arrow';
      arrow.textContent = '\u2192';
      $stepsFlow.insertBefore(arrow, $addBtn);
    }

    // Step chip
    var chip = document.createElement('div');
    chip.className = 'step-chip';
    chip.dataset.idx = idx;
    chip.innerHTML = '<span class="step-name">' + tx.n + '</span>' +
      '<button class="step-remove" data-idx="' + idx + '" title="Remove step">&times;</button>';
    $stepsFlow.insertBefore(chip, $addBtn);
  });

  // Update share URL
  updateShareUrl();
}

function updateShareUrl() {
  if (!pipeline.length) {
    $shareBar.style.display = 'none';
    return;
  }
  $shareBar.style.display = '';
  var base = location.origin + location.pathname;
  var params = '?pipe=' + pipeline.join(',');
  var input = $inputArea.value;
  if (input && input.length < 500) {
    params += '&input=' + encodeURIComponent(input);
  }
  $shareUrl.value = base + params;
}

function renderDetails() {
  if (!results.length) {
    $stepDetails.style.display = 'none';
    return;
  }
  $stepDetails.style.display = '';
  var html = '';
  results.forEach(function(r, idx) {
    var tx = TX_MAP[pipeline[idx]];
    var name = tx ? tx.n : pipeline[idx];
    html += '<div class="step-detail-card">' +
      '<div class="sd-head"><div class="sd-label"><span class="sd-num">' + (idx + 1) + '</span> ' + escHTML(name) + '</div>' +
      '<div class="sd-meta">' + r.ms + 'ms</div></div>' +
      '<div class="sd-preview">' + escHTML(truncate(r.output, 500)) + '</div></div>';
  });
  $stepDetailsList.innerHTML = html;
}

function truncate(s, max) {
  return s.length > max ? s.substring(0, max) + '...' : s;
}

function escHTML(s) {
  return String(s).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
}

// ============================
// ADD STEP DROPDOWN
// ============================
function buildDropdownHTML() {
  var cats = {};
  TRANSFORMS.forEach(function(tx) {
    if (!cats[tx.c]) cats[tx.c] = [];
    cats[tx.c].push(tx);
  });
  var html = '';
  var catOrder = ['Encoding', 'Hashing', 'JSON', 'Text Case', 'Lines', 'Text'];
  catOrder.forEach(function(cat) {
    if (!cats[cat]) return;
    html += '<div class="dd-cat">' + cat + '</div>';
    cats[cat].forEach(function(tx) {
      html += '<div class="dd-item" data-id="' + tx.id + '">' +
        '<div class="dd-icon">' + tx.i + '</div>' + tx.n + '</div>';
    });
  });
  return html;
}

function showDropdown() {
  $ddList.innerHTML = buildDropdownHTML();
  $ddSearch.value = '';
  var rect = $addBtn.getBoundingClientRect();
  $addDD.style.left = Math.min(rect.left, window.innerWidth - 320) + 'px';
  $addDD.style.top = (rect.bottom + 8) + 'px';
  if (rect.bottom + 420 > window.innerHeight) {
    $addDD.style.top = '';
    $addDD.style.bottom = (window.innerHeight - rect.top + 8) + 'px';
  }
  $addDD.classList.add('open');
  setTimeout(function() { $ddSearch.focus(); }, 50);
}

function hideDropdown() {
  $addDD.classList.remove('open');
}

// ============================
// PIPELINE EXECUTION
// ============================
async function runPipeline() {
  if (!pipeline.length) return;
  var input = $inputArea.value;
  if (!input.trim()) { $inputArea.focus(); return; }

  results = [];
  $runBtn.disabled = true;
  $runBtn.textContent = '\u23F3 Running...';

  var current = input;
  var chips = $stepsFlow.querySelectorAll('.step-chip');

  for (var i = 0; i < pipeline.length; i++) {
    var tx = TX_MAP[pipeline[i]];
    if (!tx) continue;

    // Highlight current step
    if (chips[i]) { chips[i].classList.add('running'); chips[i].classList.remove('done', 'error'); }

    var start = performance.now();
    var output;
    try {
      var result = tx.fn(current);
      // Handle async (hashing)
      output = result instanceof Promise ? await result : result;
    } catch (e) {
      output = '[Error in ' + tx.n + '] ' + e.message;
      if (chips[i]) { chips[i].classList.remove('running'); chips[i].classList.add('error'); }
      results.push({ input: current, output: output, ms: Math.round(performance.now() - start) });
      break;
    }
    var ms = Math.round(performance.now() - start);

    results.push({ input: current, output: output, ms: ms });
    if (chips[i]) { chips[i].classList.remove('running'); chips[i].classList.add('done'); }
    current = output;

    // Small delay for visual feedback
    if (pipeline.length > 1) await new Promise(function(r) { setTimeout(r, 150); });
  }

  // Show output
  $outputArea.textContent = current;
  $outputArea.classList.remove('empty');
  $outputMeta.textContent = current.length.toLocaleString() + ' chars';

  // Render step details
  renderDetails();

  $runBtn.disabled = false;
  $runBtn.innerHTML = '&#9654; Run Pipeline';
}

// ============================
// EVENTS
// ============================

// Add Step button
$addBtn.addEventListener('click', function(e) {
  e.stopPropagation();
  if ($addDD.classList.contains('open')) hideDropdown();
  else showDropdown();
});

// Dropdown item click
$addDD.addEventListener('click', function(e) {
  var item = e.target.closest('.dd-item');
  if (!item) return;
  var id = item.dataset.id;
  pipeline.push(id);
  hideDropdown();
  renderSteps();
});

// Dropdown search
$ddSearch.addEventListener('input', function() {
  var q = this.value.toLowerCase().trim();
  var items = $ddList.querySelectorAll('.dd-item');
  var cats = $ddList.querySelectorAll('.dd-cat');
  items.forEach(function(item) {
    var name = item.textContent.toLowerCase();
    item.style.display = !q || name.indexOf(q) !== -1 ? '' : 'none';
  });
  cats.forEach(function(cat) {
    var next = cat.nextElementSibling;
    var hasVisible = false;
    while (next && !next.classList.contains('dd-cat')) {
      if (next.classList.contains('dd-item') && next.style.display !== 'none') hasVisible = true;
      next = next.nextElementSibling;
    }
    cat.style.display = hasVisible ? '' : 'none';
  });
});

// Close dropdown on outside click
document.addEventListener('click', function(e) {
  if (!$addDD.contains(e.target) && e.target !== $addBtn) hideDropdown();
});

// Remove step
$stepsFlow.addEventListener('click', function(e) {
  var rm = e.target.closest('.step-remove');
  if (!rm) return;
  var idx = parseInt(rm.dataset.idx);
  pipeline.splice(idx, 1);
  results = [];
  renderSteps();
  $stepDetails.style.display = 'none';
});

// Run button
$runBtn.addEventListener('click', runPipeline);

// Clear button
$clearBtn.addEventListener('click', function() {
  pipeline = [];
  results = [];
  $inputArea.value = '';
  $outputArea.textContent = 'Run the pipeline to see output here';
  $outputArea.classList.add('empty');
  $outputMeta.textContent = '0 chars';
  $inputMeta.textContent = '0 chars';
  $stepDetails.style.display = 'none';
  // Reset step chips
  var chips = $stepsFlow.querySelectorAll('.step-chip');
  chips.forEach(function(c) { c.classList.remove('running', 'done', 'error'); });
  renderSteps();
});

// Copy output
$copyBtn.addEventListener('click', function() {
  var text = $outputArea.textContent;
  if (!text || $outputArea.classList.contains('empty')) return;
  navigator.clipboard.writeText(text).then(function() {
    $copyBtn.textContent = '\u2713 Copied!';
    $copyBtn.classList.add('copied');
    setTimeout(function() {
      $copyBtn.textContent = 'Copy Output';
      $copyBtn.classList.remove('copied');
    }, 2000);
  });
});

// Share copy
$shareCopyBtn.addEventListener('click', function() {
  $shareUrl.select();
  navigator.clipboard.writeText($shareUrl.value).then(function() {
    $shareCopyBtn.textContent = '\u2713 Copied!';
    setTimeout(function() { $shareCopyBtn.textContent = 'Copy'; }, 2000);
  });
});

// Input meta
$inputArea.addEventListener('input', function() {
  $inputMeta.textContent = this.value.length.toLocaleString() + ' chars';
  updateShareUrl();
});

// Template buttons
document.getElementById('templates').addEventListener('click', function(e) {
  var btn = e.target.closest('.tpl-btn');
  if (!btn) return;
  var pipeStr = btn.dataset.pipe;
  if (!pipeStr) return;
  pipeline = pipeStr.split(',').filter(function(id) { return TX_MAP[id]; });
  results = [];
  renderSteps();
  $stepDetails.style.display = 'none';
});

// Keyboard: Enter to run
document.addEventListener('keydown', function(e) {
  if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
    e.preventDefault();
    runPipeline();
  }
});

// ============================
// URL PARAMS (shareable pipelines)
// ============================
function loadFromURL() {
  var params = new URLSearchParams(location.search);
  var pipeParam = params.get('pipe');
  var inputParam = params.get('input');

  if (pipeParam) {
    pipeline = pipeParam.split(',').filter(function(id) { return TX_MAP[id]; });
    renderSteps();
  }
  if (inputParam) {
    $inputArea.value = inputParam;
    $inputMeta.textContent = inputParam.length.toLocaleString() + ' chars';
  }
  if (pipeline.length && inputParam) {
    // Auto-run if both pipe and input are provided
    setTimeout(runPipeline, 500);
  }
}

// ============================
// FADE-IN OBSERVER
// ============================
function initFadeIn() {
  var els = document.querySelectorAll('.fade-in');
  if ('IntersectionObserver' in window) {
    var obs = new IntersectionObserver(function(entries) {
      entries.forEach(function(entry) {
        if (entry.isIntersecting) {
          entry.target.classList.add('visible');
          obs.unobserve(entry.target);
        }
      });
    }, { threshold: 0.1 });
    els.forEach(function(el) { obs.observe(el); });
  } else {
    els.forEach(function(el) { el.classList.add('visible'); });
  }
}

// ============================
// INIT
// ============================
renderSteps();
loadFromURL();
initFadeIn();

})();
</script>
</body>
</html>
