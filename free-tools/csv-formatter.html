<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>CSV Formatter &amp; Viewer — Parse, Format &amp; Convert CSV Data | NexTool</title>
<meta name="description" content="Parse and view CSV data as a formatted table. Auto-detect delimiters, sort columns, transpose, export as formatted CSV or Markdown. Free online tool by NexTool.">
<meta name="keywords" content="CSV formatter, CSV viewer, CSV to table, CSV to markdown, parse CSV, format CSV, NexTool">
<meta property="og:title" content="Free CSV Formatter & Viewer | NexTool">
<meta property="og:description" content="Parse CSV data into formatted tables. Sort, transpose, export as CSV or Markdown. Free online tool.">
<meta property="og:type" content="website">
<meta property="og:url" content="https://nextool.app/free-tools/csv-formatter.html">
<meta property="og:image" content="https://nextool.app/free-tools/og/csv-formatter.png">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<link rel="canonical" href="https://nextool.app/free-tools/csv-formatter.html">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Free CSV Formatter & Viewer | NexTool">
<meta name="twitter:description" content="Parse and view CSV data as formatted tables. Free online tool by NexTool.">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"https://nextool.app/"},{"@type":"ListItem","position":2,"name":"Free Tools","item":"https://nextool.app/free-tools/"},{"@type":"ListItem","position":3,"name":"CSV Formatter","item":"https://nextool.app/free-tools/csv-formatter.html"}]}
</script>
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"SoftwareApplication","name":"NexTool CSV Formatter & Viewer","applicationCategory":"DeveloperApplication","operatingSystem":"Web","offers":{"@type":"Offer","price":"0","priceCurrency":"USD"},"description":"Parse and view CSV data as formatted tables. Auto-detect delimiters, sort columns, transpose, export as CSV or Markdown."}
</script>
<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#050508;--surface:#111118;--surface2:#1a1a24;--border:#252533;--primary:#6366f1;--accent:#a855f7;--pink:#ec4899;--text:#e2e8f0;--text2:#94a3b8;--radius:12px;--glass:rgba(17,17,24,.7)}
html{scroll-behavior:smooth}
body{font-family:'Inter',system-ui,sans-serif;background:var(--bg);color:var(--text);line-height:1.6;overflow-x:hidden}
a{color:var(--primary);text-decoration:none}
.nav{position:sticky;top:0;z-index:100;backdrop-filter:blur(20px);background:rgba(5,5,8,.85);border-bottom:1px solid var(--border);padding:0 24px}
.nav-inner{max-width:1200px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;height:64px}
.logo{font-weight:800;font-size:1.35rem;background:linear-gradient(135deg,var(--primary),var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.nav-links{display:flex;gap:28px;align-items:center}
.nav-links a{color:var(--text2);font-size:.9rem;font-weight:500;transition:color .2s}
.nav-links a:hover{color:var(--text)}
.nav-links a.active{color:var(--primary)}
.btn-cta{background:linear-gradient(135deg,var(--primary),var(--accent));color:#fff;padding:9px 22px;border-radius:8px;font-weight:600;font-size:.85rem;border:none;cursor:pointer;transition:transform .2s,box-shadow .2s}
.btn-cta:hover{transform:translateY(-1px);box-shadow:0 4px 20px rgba(99,102,241,.4)}
.mobile-toggle{display:none;background:none;border:none;color:var(--text);font-size:1.5rem;cursor:pointer}
.breadcrumb{max-width:1200px;margin:0 auto;padding:16px 24px 0;font-size:.82rem;color:var(--text2)}
.breadcrumb a{color:var(--text2);transition:color .2s}
.breadcrumb a:hover{color:var(--primary)}
.breadcrumb span{margin:0 8px;opacity:.5}
.hero{text-align:center;padding:60px 24px 40px;max-width:800px;margin:0 auto}
.hero .badge{display:inline-block;padding:6px 16px;border-radius:20px;background:var(--surface);border:1px solid var(--border);font-size:.8rem;color:var(--accent);font-weight:600;margin-bottom:20px}
.hero h1{font-size:clamp(2rem,5vw,3rem);font-weight:800;line-height:1.15;margin-bottom:16px}
.hero h1 .grad{background:linear-gradient(135deg,var(--primary),var(--accent),var(--pink));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.hero p{color:var(--text2);font-size:1.05rem;max-width:560px;margin:0 auto}
.tool-section{max-width:1200px;margin:0 auto;padding:0 24px 60px}
.glass-card{background:var(--glass);backdrop-filter:blur(16px);border:1px solid var(--border);border-radius:var(--radius);padding:32px;transition:transform .3s,box-shadow .3s}
.glass-card:hover{box-shadow:0 8px 40px rgba(99,102,241,.1)}
.controls{display:flex;gap:10px;margin-bottom:20px;flex-wrap:wrap;align-items:center}
.controls .action-btn{padding:10px 22px;border-radius:8px;font-weight:600;font-size:.85rem;cursor:pointer;border:1px solid var(--border);background:var(--surface2);color:var(--text);transition:all .2s;font-family:inherit}
.controls .action-btn:hover{border-color:var(--primary);color:var(--primary)}
.controls .action-btn.primary{background:linear-gradient(135deg,var(--primary),var(--accent));border:none;color:#fff}
.controls .action-btn.primary:hover{transform:translateY(-1px);box-shadow:0 4px 16px rgba(99,102,241,.35)}
.controls .action-btn.active{border-color:var(--primary);color:var(--primary);background:rgba(99,102,241,.1)}
.controls .spacer{flex:1}
.stats{font-size:.8rem;color:var(--text2);padding:4px 12px;background:var(--surface2);border-radius:6px;display:flex;gap:16px;align-items:center}
.stats span{white-space:nowrap}
.options-bar{display:flex;gap:10px;margin-bottom:16px;flex-wrap:wrap;align-items:center}
.opt-group{display:flex;align-items:center;gap:6px;font-size:.8rem;color:var(--text2)}
.opt-group label{cursor:pointer;white-space:nowrap}
.opt-group select,.opt-group input[type="checkbox"]{background:var(--surface2);color:var(--text);border:1px solid var(--border);border-radius:6px;padding:4px 8px;font-size:.78rem;font-family:inherit;cursor:pointer}
.opt-group select:focus{outline:none;border-color:var(--primary)}
.opt-group input[type="checkbox"]{width:16px;height:16px;accent-color:var(--primary)}
.input-section{margin-bottom:24px}
.input-section label{font-weight:600;font-size:.82rem;margin-bottom:8px;color:var(--text2);display:flex;justify-content:space-between;align-items:center}
.input-section label .label-actions{display:flex;gap:8px}
.label-btn{background:none;border:none;color:var(--text2);cursor:pointer;font-size:.78rem;font-weight:600;font-family:inherit;padding:2px 6px;border-radius:4px;transition:color .2s}
.label-btn:hover{color:var(--primary)}
textarea.code-input{width:100%;min-height:200px;background:var(--surface2);border:1px solid var(--border);border-radius:8px;padding:16px;color:var(--text);font-size:.85rem;font-family:'SF Mono','Fira Code','Cascadia Code',Consolas,monospace;line-height:1.65;resize:vertical;tab-size:4;transition:border-color .2s}
textarea.code-input:focus{outline:none;border-color:var(--primary)}
.table-wrap{width:100%;overflow-x:auto;margin-top:16px;border:1px solid var(--border);border-radius:8px;background:var(--surface2)}
.data-table{width:100%;border-collapse:collapse;font-size:.85rem}
.data-table th{background:var(--surface);color:var(--text);font-weight:600;padding:12px 16px;text-align:left;border-bottom:2px solid var(--border);position:sticky;top:0;cursor:pointer;user-select:none;white-space:nowrap;transition:background .2s}
.data-table th:hover{background:var(--surface2);color:var(--primary)}
.data-table th .sort-icon{margin-left:6px;font-size:.7rem;opacity:.5}
.data-table th.sorted .sort-icon{opacity:1;color:var(--primary)}
.data-table td{padding:10px 16px;border-bottom:1px solid var(--border);color:var(--text);font-family:'SF Mono','Fira Code','Cascadia Code',Consolas,monospace;font-size:.82rem;white-space:nowrap}
.data-table tr:hover td{background:rgba(99,102,241,.04)}
.data-table tr:nth-child(even) td{background:rgba(255,255,255,.01)}
.data-table tr:nth-child(even):hover td{background:rgba(99,102,241,.06)}
.row-num{color:var(--text2);font-size:.75rem;text-align:right;padding-right:12px!important;opacity:.6;min-width:40px}
.detected-info{display:inline-flex;align-items:center;gap:8px;padding:4px 12px;border-radius:6px;font-size:.8rem;font-weight:500;background:rgba(99,102,241,.08);color:var(--primary);border:1px solid rgba(99,102,241,.15)}
.empty-state{text-align:center;padding:60px 24px;color:var(--text2)}
.empty-state .icon{font-size:3rem;margin-bottom:16px;opacity:.3}
.empty-state p{font-size:.95rem}
.cta-bottom{text-align:center;padding:80px 24px;max-width:700px;margin:0 auto}
.cta-bottom h2{font-size:clamp(1.5rem,3.5vw,2.2rem);font-weight:800;margin-bottom:14px}
.cta-bottom h2 .grad{background:linear-gradient(135deg,var(--primary),var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.cta-bottom p{color:var(--text2);margin-bottom:28px;font-size:1rem}
footer{border-top:1px solid var(--border);padding:60px 24px 32px;max-width:1200px;margin:0 auto}
.footer-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:40px;margin-bottom:40px}
.footer-col h4{font-size:.85rem;font-weight:700;margin-bottom:16px;color:var(--text)}
.footer-col a{display:block;color:var(--text2);font-size:.85rem;margin-bottom:10px;transition:color .2s}
.footer-col a:hover{color:var(--primary)}
.footer-bottom{text-align:center;color:var(--text2);font-size:.8rem;padding-top:24px;border-top:1px solid var(--border)}
@keyframes fadeUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
.fade-in{opacity:0;transform:translateY(24px);transition:opacity .6s,transform .6s}.fade-in.visible{opacity:1;transform:translateY(0)}
.toast{position:fixed;bottom:32px;left:50%;transform:translateX(-50%) translateY(80px);background:var(--primary);color:#fff;padding:12px 28px;border-radius:10px;font-weight:600;font-size:.9rem;z-index:200;transition:transform .35s cubic-bezier(.4,0,.2,1);pointer-events:none}
.toast.show{transform:translateX(-50%) translateY(0)}
@media(max-width:768px){
  .nav-links{display:none;position:absolute;top:64px;left:0;right:0;background:var(--surface);flex-direction:column;padding:20px;gap:16px;border-bottom:1px solid var(--border)}
  .nav-links.open{display:flex}
  .mobile-toggle{display:block}
  .footer-grid{grid-template-columns:1fr 1fr}
  .glass-card{padding:24px 18px}
  .controls{flex-direction:column;align-items:stretch}
  .controls .spacer{display:none}
  .stats{justify-content:center}
  .options-bar{flex-direction:column;align-items:flex-start}
  .data-table td,.data-table th{padding:8px 10px;font-size:.78rem}
}
</style>
</head>
<body>
<nav class="nav"><div class="nav-inner">
  <a href="/" class="logo">NexTool</a>
  <button class="mobile-toggle" onclick="document.querySelector('.nav-links').classList.toggle('open')" aria-label="Menu">&#9776;</button>
  <div class="nav-links">
    <a href="/">Home</a><a href="/free-tools/" class="active">Free Tools</a><a href="/blog/">Blog</a>
    <a href="/pro.html" class="btn-cta">Get Pro</a>
  </div>
</div></nav>

<div class="breadcrumb">
  <a href="/">Home</a><span>/</span><a href="/free-tools/">Free Tools</a><span>/</span>CSV Formatter
</div>

<section class="hero fade-in">
  <div class="badge">Free Tool</div>
  <h1>CSV <span class="grad">Formatter &amp; Viewer</span></h1>
  <p>Parse CSV data into a sortable table. Auto-detect delimiters, transpose rows and columns, export as formatted CSV or Markdown.</p>
</section>

<section class="tool-section">
  <div class="glass-card fade-in">
    <div class="controls">
      <button class="action-btn primary" onclick="parseCSV()">Parse &amp; Format</button>
      <button class="action-btn" id="btn-transpose" onclick="transposeData()">Transpose</button>
      <div id="delimiter-info"></div>
      <div class="spacer"></div>
      <div class="stats" id="stats">
        <span>Rows: <strong id="stat-rows">0</strong></span>
        <span>Columns: <strong id="stat-cols">0</strong></span>
        <span>Cells: <strong id="stat-cells">0</strong></span>
      </div>
    </div>
    <div class="options-bar">
      <div class="opt-group">
        <label for="opt-delimiter">Delimiter:</label>
        <select id="opt-delimiter">
          <option value="auto">Auto-detect</option>
          <option value=",">Comma (,)</option>
          <option value=";">Semicolon (;)</option>
          <option value="\t">Tab</option>
          <option value="|">Pipe (|)</option>
        </select>
      </div>
      <div class="opt-group">
        <input type="checkbox" id="opt-header" checked>
        <label for="opt-header">First row is header</label>
      </div>
    </div>
    <div class="input-section">
      <label>
        Input CSV
        <div class="label-actions">
          <button class="label-btn" onclick="loadSample('basic')">Basic</button>
          <button class="label-btn" onclick="loadSample('large')">Large</button>
          <button class="label-btn" onclick="loadSample('semicolon')">Semicolon</button>
          <button class="label-btn" onclick="clearAll()">Clear</button>
        </div>
      </label>
      <textarea class="code-input" id="input" placeholder="Paste your CSV data here..." spellcheck="false"></textarea>
    </div>
    <div class="controls" style="margin-bottom:0">
      <button class="action-btn" onclick="copyCSV()">Copy CSV</button>
      <button class="action-btn" onclick="copyMarkdown()">Copy as Markdown</button>
      <button class="action-btn" onclick="downloadCSV()">Download .csv</button>
    </div>
    <div id="table-container">
      <div class="empty-state">
        <div class="icon">&#9783;</div>
        <p>Paste CSV data above and click "Parse & Format" to see the table.</p>
      </div>
    </div>
  </div>
</section>

<section class="cta-bottom fade-in">
  <h2>Explore <span class="grad">150+ Free Tools</span></h2>
  <p>NexTool is your all-in-one developer toolkit. Formatters, generators, converters, and more — all free, all instant.</p>
  <a href="/free-tools/" class="btn-cta" style="display:inline-block;padding:14px 36px;font-size:1rem">Browse All Tools</a>
</section>

<section style="max-width:900px;margin:40px auto;padding:0 24px;">
<div style="background:linear-gradient(135deg,rgba(99,102,241,0.1),rgba(168,85,247,0.08));border:1px solid rgba(99,102,241,0.15);border-radius:20px;padding:32px 28px;text-align:center;">
<div style="font-size:13px;color:#818cf8;font-weight:600;text-transform:uppercase;letter-spacing:1px;margin-bottom:8px;">Founding Member</div>
<h3 style="font-size:22px;font-weight:800;color:#fff;margin:0 0 8px;">Get NexTool Pro</h3>
<p style="color:#94a3b8;font-size:14px;margin:0 auto 20px;max-width:500px;">No banners, clean output, enhanced features on all 150+ tools. One-time payment.</p>
<div style="display:flex;align-items:center;justify-content:center;gap:12px;flex-wrap:wrap;">
<a href="/pro.html" style="display:inline-block;padding:12px 28px;background:linear-gradient(135deg,#6366f1,#a855f7,#ec4899);color:#fff;border-radius:10px;font-weight:700;font-size:15px;text-decoration:none;transition:transform 0.2s;" onmouseenter="this.style.transform='translateY(-2px)'" onmouseleave="this.style.transform='translateY(0)'">$29 — Get Pro</a>
<a href="/free-tools/" style="color:#94a3b8;font-size:14px;text-decoration:none;transition:color 0.2s;" onmouseenter="this.style.color='#e2e8f0'" onmouseleave="this.style.color='#94a3b8'">Browse 150+ Free Tools &rarr;</a>
</div>
</div>
</section>


<!-- AUTO-LINKED by NexTool Engine -->
<div style="margin:2rem 0;padding:1.5rem;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius)">
<p style="font-weight:600;margin-bottom:.5rem">Related Tools</p>
<p><a href="/free-tools/box-shadow-generator.html" style="color:var(--primary);text-decoration:none">CSS Box Shadow Generator</a> · <a href="/free-tools/emoji-picker.html" style="color:var(--primary);text-decoration:none">Emoji Picker & Search</a> · <a href="/free-tools/favicon-generator.html" style="color:var(--primary);text-decoration:none">Favicon Generator</a> · <a href="/free-tools/meta-tag-generator.html" style="color:var(--primary);text-decoration:none">Meta Tag Generator</a> · <a href="/free-tools/base64.html" style="color:var(--primary);text-decoration:none">Free Base64 Encoder/Decoder</a></p>
</div>
<footer>
  <div class="footer-grid">
    <div class="footer-col"><h4>Tools</h4>
      <a href="/free-tools/">All Free Tools</a><a href="/free-tools/html-formatter.html">HTML Formatter</a><a href="/free-tools/javascript-formatter.html">JS Formatter</a><a href="/free-tools/css-formatter.html">CSS Formatter</a><a href="/free-tools/yaml-formatter.html">YAML Formatter</a>
    </div>
    <div class="footer-col"><h4>Resources</h4>
      <a href="/free-tools/">Free Tools</a><a href="/blog/">Blog</a><a href="/pro.html">NexTool Pro</a>
    </div>
    <div class="footer-col"><h4>Legal</h4>
      <a href="/terms.html">Privacy Policy</a><a href="/terms.html">Terms of Service</a>
    </div>
    <div class="footer-col"><h4>Product</h4>
      <a href="/">Home</a><a href="/pro.html">Pro</a><a href="/blog/">Blog</a>
    </div>
  </div>
  <div class="footer-bottom">&copy; 2026 NexTool. All rights reserved.</div>
</footer>

<div class="toast" id="toast">Copied!</div>

<script>
const inputEl=document.getElementById('input');
const statRows=document.getElementById('stat-rows');
const statCols=document.getElementById('stat-cols');
const statCells=document.getElementById('stat-cells');
let parsedData=[];
let headers=[];
let sortCol=-1;
let sortAsc=true;
let isTransposed=false;

function showToast(msg){
  const t=document.getElementById('toast');
  t.textContent=msg;t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'),2000);
}

// ========== CSV PARSER ==========
function detectDelimiter(text){
  const firstLines=text.split('\n').slice(0,5).join('\n');
  const delimiters=[{char:',',name:'Comma'},{char:';',name:'Semicolon'},{char:'\t',name:'Tab'},{char:'|',name:'Pipe'}];
  let best=delimiters[0];
  let bestCount=0;

  for(const d of delimiters){
    let count=0;
    for(const ch of firstLines){
      if(ch===d.char)count++;
    }
    if(count>bestCount){bestCount=count;best=d}
  }
  return best;
}

function parseCSVLine(line,delimiter){
  const cells=[];
  let current='';
  let inQuotes=false;
  let i=0;

  while(i<line.length){
    if(inQuotes){
      if(line[i]==='"'){
        if(line[i+1]==='"'){
          current+='"';i+=2;continue;
        }
        inQuotes=false;i++;continue;
      }
      current+=line[i];i++;
    }else{
      if(line[i]==='"'){
        inQuotes=true;i++;continue;
      }
      if(line[i]===delimiter){
        cells.push(current.trim());
        current='';i++;continue;
      }
      current+=line[i];i++;
    }
  }
  cells.push(current.trim());
  return cells;
}

function parseCSV(){
  const input=inputEl.value;
  if(!input.trim()){showToast('Paste some CSV data first');return}

  isTransposed=false;
  document.getElementById('btn-transpose').classList.remove('active');

  const delimOpt=document.getElementById('opt-delimiter').value;
  let delimiter;
  let delimName;

  if(delimOpt==='auto'){
    const detected=detectDelimiter(input);
    delimiter=detected.char;
    delimName=detected.name;
  }else{
    delimiter=delimOpt==='\t'?'\t':delimOpt;
    delimName={',':'Comma',';':'Semicolon','\t':'Tab','|':'Pipe'}[delimiter]||delimiter;
  }

  document.getElementById('delimiter-info').innerHTML=
    '<span class="detected-info">Delimiter: '+delimName+'</span>';

  const lines=input.split('\n').filter(l=>l.trim());
  const hasHeader=document.getElementById('opt-header').checked;
  const allRows=lines.map(l=>parseCSVLine(l,delimiter));

  // Normalize column count
  const maxCols=Math.max(...allRows.map(r=>r.length));
  for(const row of allRows){
    while(row.length<maxCols)row.push('');
  }

  if(hasHeader&&allRows.length>1){
    headers=allRows[0];
    parsedData=allRows.slice(1);
  }else{
    headers=Array.from({length:maxCols},(_, i)=>'Col '+(i+1));
    parsedData=allRows;
  }

  sortCol=-1;
  renderTable();
  updateStats();
}

function renderTable(){
  const container=document.getElementById('table-container');

  if(!parsedData.length){
    container.innerHTML='<div class="empty-state"><div class="icon">&#9783;</div><p>No data to display.</p></div>';
    return;
  }

  let html='<div class="table-wrap"><table class="data-table"><thead><tr>';
  html+='<th class="row-num">#</th>';

  for(let c=0;c<headers.length;c++){
    const isSorted=sortCol===c;
    const arrow=isSorted?(sortAsc?'&#9650;':'&#9660;'):'&#9650;';
    html+='<th class="'+(isSorted?'sorted':'')+'" onclick="sortByColumn('+c+')">';
    html+=escHTML(headers[c]);
    html+='<span class="sort-icon">'+arrow+'</span></th>';
  }
  html+='</tr></thead><tbody>';

  for(let r=0;r<parsedData.length;r++){
    html+='<tr>';
    html+='<td class="row-num">'+(r+1)+'</td>';
    for(let c=0;c<headers.length;c++){
      html+='<td>'+escHTML(parsedData[r][c]||'')+'</td>';
    }
    html+='</tr>';
  }

  html+='</tbody></table></div>';
  container.innerHTML=html;
}

function escHTML(s){
  return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

function updateStats(){
  const rows=parsedData.length;
  const cols=headers.length;
  statRows.textContent=rows.toLocaleString();
  statCols.textContent=cols.toLocaleString();
  statCells.textContent=(rows*cols).toLocaleString();
}

// ========== SORT ==========
function sortByColumn(col){
  if(sortCol===col){
    sortAsc=!sortAsc;
  }else{
    sortCol=col;
    sortAsc=true;
  }

  parsedData.sort((a,b)=>{
    let va=a[col]||'';
    let vb=b[col]||'';

    // Try numeric sort
    const na=parseFloat(va);
    const nb=parseFloat(vb);
    if(!isNaN(na)&&!isNaN(nb)){
      return sortAsc?na-nb:nb-na;
    }

    // String sort
    va=va.toLowerCase();
    vb=vb.toLowerCase();
    if(va<vb)return sortAsc?-1:1;
    if(va>vb)return sortAsc?1:-1;
    return 0;
  });

  renderTable();
}

// ========== TRANSPOSE ==========
function transposeData(){
  if(!parsedData.length){showToast('Parse CSV data first');return}

  isTransposed=!isTransposed;
  const btn=document.getElementById('btn-transpose');
  btn.classList.toggle('active',isTransposed);

  // Combine headers + data into a matrix
  const matrix=[headers,...parsedData];
  const rows=matrix.length;
  const cols=matrix[0].length;

  const transposed=[];
  for(let c=0;c<cols;c++){
    const newRow=[];
    for(let r=0;r<rows;r++){
      newRow.push(matrix[r][c]||'');
    }
    transposed.push(newRow);
  }

  // First column of transposed becomes new headers
  headers=transposed.map(r=>r[0]);
  parsedData=[];
  const newColCount=transposed[0].length-1;

  for(let c=1;c<=newColCount;c++){
    const row=[];
    for(let r=0;r<transposed.length;r++){
      row.push(transposed[r][c]||'');
    }
    parsedData.push(row);
  }

  sortCol=-1;
  renderTable();
  updateStats();
}

// ========== EXPORT ==========
function buildCSV(){
  const lines=[];
  lines.push(headers.map(h=>quoteCSV(h)).join(','));
  for(const row of parsedData){
    lines.push(row.map(c=>quoteCSV(c)).join(','));
  }
  return lines.join('\n');
}

function quoteCSV(val){
  if(!val)return '';
  if(val.includes(',')||val.includes('"')||val.includes('\n')){
    return '"'+val.replace(/"/g,'""')+'"';
  }
  return val;
}

function buildMarkdown(){
  if(!headers.length)return '';
  const colWidths=headers.map((h,i)=>{
    let max=h.length;
    for(const row of parsedData){
      if((row[i]||'').length>max)max=(row[i]||'').length;
    }
    return Math.max(max,3);
  });

  let md='| '+headers.map((h,i)=>h.padEnd(colWidths[i])).join(' | ')+' |\n';
  md+='| '+colWidths.map(w=>'-'.repeat(w)).join(' | ')+' |\n';
  for(const row of parsedData){
    md+='| '+headers.map((_, i)=>(row[i]||'').padEnd(colWidths[i])).join(' | ')+' |\n';
  }
  return md;
}

function copyCSV(){
  if(!parsedData.length){showToast('No data to copy');return}
  const csv=buildCSV();
  navigator.clipboard.writeText(csv).then(()=>showToast('CSV copied!')).catch(()=>showToast('Copy failed'));
}

function copyMarkdown(){
  if(!parsedData.length){showToast('No data to copy');return}
  const md=buildMarkdown();
  navigator.clipboard.writeText(md).then(()=>showToast('Markdown copied!')).catch(()=>showToast('Copy failed'));
}

function downloadCSV(){
  if(!parsedData.length){showToast('No data to download');return}
  const csv=buildCSV();
  const blob=new Blob([csv],{type:'text/csv'});
  const a=document.createElement('a');
  a.href=URL.createObjectURL(blob);
  a.download='formatted.csv';
  a.click();
  URL.revokeObjectURL(a.href);
  showToast('Downloaded!');
}

function clearAll(){
  inputEl.value='';
  parsedData=[];headers=[];
  document.getElementById('table-container').innerHTML='<div class="empty-state"><div class="icon">&#9783;</div><p>Paste CSV data above and click "Parse & Format" to see the table.</p></div>';
  document.getElementById('delimiter-info').innerHTML='';
  statRows.textContent='0';statCols.textContent='0';statCells.textContent='0';
  isTransposed=false;
  document.getElementById('btn-transpose').classList.remove('active');
}

function loadSample(type){
  const samples={
    basic:`Name,Age,City,Role,Salary
Alice Johnson,32,New York,Engineer,125000
Bob Smith,28,San Francisco,Designer,95000
Carol Williams,45,Chicago,Manager,145000
David Brown,37,Austin,Developer,115000
Eva Martinez,29,Seattle,Analyst,88000
Frank Lee,41,Boston,Architect,155000
Grace Kim,34,Denver,Product Manager,130000`,
    large:`Product,Category,Price,Stock,Rating,Reviews,SKU,Weight_kg
MacBook Pro 16",Laptops,2499.99,142,4.8,2341,MBPRO16-M3,2.14
iPhone 15 Pro,Phones,1199.00,567,4.7,8923,IP15PRO-256,0.187
AirPods Pro 2,Audio,249.00,2341,4.6,15234,APP2-USB-C,0.051
iPad Air M2,Tablets,599.00,834,4.5,4521,IPAM2-256,0.462
Apple Watch Ultra 2,Wearables,799.00,321,4.7,3456,AWU2-49,0.062
iMac 24",Desktops,1299.00,98,4.4,1234,IMAC24-M3,4.48
Mac Mini M2,Desktops,599.00,456,4.6,2890,MMINI-M2,0.59
Studio Display,Monitors,1599.00,67,4.2,876,STDISP-27,6.3
Magic Keyboard,Accessories,299.00,1234,4.3,5670,MKBD-TCID,0.71
AirTag 4-Pack,Accessories,99.00,3456,4.5,23456,ATAG-4PK,0.044`,
    semicolon:`Name;Email;Department;Start Date;Location
Max Mueller;max@example.com;Engineering;2023-01-15;Berlin
Sophie Laurent;sophie@example.com;Design;2022-06-01;Paris
Luca Rossi;luca@example.com;Marketing;2024-03-10;Milan
Anna Kowalski;anna@example.com;Finance;2021-11-20;Warsaw
Erik Johansson;erik@example.com;Engineering;2023-08-05;Stockholm`
  };
  inputEl.value=samples[type]||samples.basic;
  parseCSV();
}

const obs=new IntersectionObserver(entries=>{entries.forEach(e=>{if(e.isIntersecting){e.target.classList.add('visible');obs.unobserve(e.target)}})},{threshold:.15});
document.querySelectorAll('.fade-in').forEach(el=>obs.observe(el));
</script>
<script src="/js/revenue.js" defer></script>
<script src="/js/lead-capture.js" defer></script>
<script src="/js/analytics-lite.js" defer></script>
</body>
</html>