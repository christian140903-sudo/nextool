<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>JWT Token Generator &amp; Debugger — Free Online Tool | NexTool</title>
<meta name="description" content="Generate and debug JWT tokens. Build custom claims, set expiration, encode with HMAC, and decode existing tokens with visual color-coded breakdown.">
<meta name="keywords" content="jwt generator, jwt debugger, jwt token, json web token, jwt claims, jwt encode, jwt decode">
<meta property="og:title" content="JWT Token Generator & Debugger — NexTool">
<meta property="og:description" content="Generate JWT tokens with custom claims, decode existing tokens, and inspect header/payload/signature with visual breakdowns.">
<meta property="og:image" content="https://nextool.app/assets/og/jwt-generator.png">
<meta property="og:url" content="https://nextool.app/free-tools/jwt-generator.html">
<meta property="og:type" content="website">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="JWT Token Generator & Debugger — NexTool">
<meta name="twitter:description" content="Generate JWT tokens with custom claims, decode existing tokens, and inspect header/payload/signature.">
<meta name="twitter:image" content="https://nextool.app/assets/og/jwt-generator.png">
<link rel="canonical" href="https://nextool.app/free-tools/jwt-generator.html">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@type":"BreadcrumbList",
  "itemListElement":[
    {"@type":"ListItem","position":1,"name":"Home","item":"https://nextool.app/"},
    {"@type":"ListItem","position":2,"name":"Free Tools","item":"https://nextool.app/free-tools/"},
    {"@type":"ListItem","position":3,"name":"JWT Token Generator","item":"https://nextool.app/free-tools/jwt-generator.html"}
  ]
}
</script>
<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@type":"FAQPage",
  "mainEntity":[
    {"@type":"Question","name":"What is a JWT token?","acceptedAnswer":{"@type":"Answer","text":"A JSON Web Token (JWT) is a compact, URL-safe token format used for securely transmitting information between parties. It consists of three parts: header, payload, and signature, separated by dots."}},
    {"@type":"Question","name":"How does JWT signing work?","acceptedAnswer":{"@type":"Answer","text":"The header and payload are Base64URL-encoded and joined with a dot. This string is then signed using a secret key (HMAC) or a private key (RSA/ECDSA). The signature verifies the token has not been tampered with."}},
    {"@type":"Question","name":"What are common JWT claims?","acceptedAnswer":{"@type":"Answer","text":"Common registered claims include: iss (issuer), sub (subject), aud (audience), exp (expiration), nbf (not before), iat (issued at), and jti (JWT ID). Custom claims can hold any JSON data."}},
    {"@type":"Question","name":"Can this tool sign real JWT tokens?","acceptedAnswer":{"@type":"Answer","text":"This tool generates structurally valid JWTs with HMAC-SHA256 signing using the Web Crypto API in your browser. For HS384/HS512 and RS256, it produces the correct structure. All processing happens client-side."}}
  ]
}
</script>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{--bg:#050508;--surface:#111118;--primary:#6366f1;--accent:#a855f7;--text:#e2e8f0;--text2:#94a3b8;--border:rgba(255,255,255,0.06);--radius:16px;--red:#f87171;--blue:#60a5fa;--green:#4ade80;--purple:#c084fc}
body{font-family:'Inter',system-ui,-apple-system,sans-serif;background:var(--bg);color:var(--text);min-height:100vh;line-height:1.6;-webkit-font-smoothing:antialiased}
a{color:var(--primary);text-decoration:none}a:hover{color:#818cf8}
.nav{position:sticky;top:0;z-index:100;background:rgba(5,5,8,0.85);backdrop-filter:blur(20px);border-bottom:1px solid var(--border);padding:0 24px}
.nav-inner{max-width:1200px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;height:60px}
.nav-logo{font-size:20px;font-weight:800;color:#fff;letter-spacing:-0.5px}
.nav-logo span{background:linear-gradient(135deg,var(--primary),var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.nav-links{display:flex;gap:24px;align-items:center}
.nav-links a{color:var(--text2);font-size:14px;font-weight:500;transition:color 0.2s}
.nav-links a:hover{color:#fff}
.hero{text-align:center;padding:56px 24px 32px;max-width:700px;margin:0 auto}
.hero-badge{display:inline-block;padding:6px 14px;background:rgba(99,102,241,0.1);border:1px solid rgba(99,102,241,0.2);border-radius:20px;font-size:12px;font-weight:600;color:#818cf8;margin-bottom:16px;text-transform:uppercase;letter-spacing:1px}
.hero h1{font-size:clamp(28px,5vw,42px);font-weight:900;line-height:1.15;margin-bottom:12px;color:#fff}
.hero p{font-size:17px;color:var(--text2);max-width:540px;margin:0 auto}
.tool-container{max-width:1000px;margin:0 auto;padding:0 24px 40px}

.tabs{display:flex;gap:4px;margin-bottom:24px;background:rgba(255,255,255,0.02);border-radius:12px;padding:4px}
.tab-btn{flex:1;padding:12px 16px;background:transparent;border:none;border-radius:8px;color:var(--text2);font-size:14px;font-weight:600;cursor:pointer;transition:all 0.2s;font-family:inherit}
.tab-btn.active{background:rgba(99,102,241,0.15);color:#fff}
.tab-btn:hover:not(.active){color:#fff}
.tab-panel{display:none}.tab-panel.active{display:block}

.panel{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;margin-bottom:24px}
.panel-header{padding:16px 20px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:8px}
.panel-title{font-size:14px;font-weight:700;color:#fff;text-transform:uppercase;letter-spacing:0.5px}
.panel-body{padding:20px}

.json-editor{width:100%;min-height:120px;padding:16px;background:rgba(0,0,0,0.3);border:1px solid var(--border);border-radius:12px;color:#c4b5fd;font-family:'SF Mono','Fira Code',monospace;font-size:13px;line-height:1.6;resize:vertical;outline:none;transition:border-color 0.2s}
.json-editor:focus{border-color:var(--primary)}

.form-row{display:flex;gap:12px;margin-bottom:14px;align-items:end;flex-wrap:wrap}
.form-group{flex:1;min-width:160px}
.form-group label{display:block;font-size:12px;font-weight:600;color:var(--text2);margin-bottom:6px;text-transform:uppercase;letter-spacing:0.5px}
.form-group input,.form-group select{width:100%;padding:10px 14px;background:rgba(255,255,255,0.04);border:1px solid var(--border);border-radius:10px;color:#fff;font-size:13px;font-family:inherit;outline:none;transition:border-color 0.2s}
.form-group input:focus,.form-group select:focus{border-color:var(--primary)}

.btn-primary{padding:10px 20px;background:linear-gradient(135deg,var(--primary),var(--accent));color:#fff;border:none;border-radius:10px;font-size:14px;font-weight:700;cursor:pointer;transition:opacity 0.2s;font-family:inherit}
.btn-primary:hover{opacity:0.9}
.btn-secondary{padding:10px 20px;background:rgba(99,102,241,0.1);border:1px solid rgba(99,102,241,0.2);color:#818cf8;border-radius:10px;font-size:14px;font-weight:600;cursor:pointer;transition:all 0.2s;font-family:inherit}
.btn-secondary:hover{background:rgba(99,102,241,0.2)}

/* Token display */
.token-display{padding:20px;background:rgba(0,0,0,0.3);border:1px solid var(--border);border-radius:12px;word-break:break-all;font-family:'SF Mono','Fira Code',monospace;font-size:14px;line-height:1.8;position:relative;min-height:60px}
.token-header{color:var(--red)}
.token-payload{color:var(--purple)}
.token-signature{color:var(--blue)}
.token-dot{color:var(--text2)}

.copy-btn{padding:6px 14px;background:rgba(99,102,241,0.15);border:1px solid rgba(99,102,241,0.3);border-radius:8px;color:#818cf8;font-size:12px;font-weight:600;cursor:pointer;transition:all 0.2s;font-family:inherit}
.copy-btn:hover{background:rgba(99,102,241,0.25)}
.copy-btn.copied{background:rgba(34,197,94,0.15);border-color:rgba(34,197,94,0.3);color:#4ade80}

/* Legend */
.token-legend{display:flex;gap:20px;margin-top:12px;flex-wrap:wrap}
.token-legend span{font-size:12px;font-weight:600;display:flex;align-items:center;gap:6px}
.legend-dot{width:10px;height:10px;border-radius:3px;display:inline-block}

/* Validation badges */
.badge{display:inline-block;padding:4px 10px;border-radius:6px;font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:0.5px}
.badge-valid{background:rgba(34,197,94,0.12);color:#4ade80;border:1px solid rgba(34,197,94,0.2)}
.badge-expired{background:rgba(239,68,68,0.12);color:#f87171;border:1px solid rgba(239,68,68,0.2)}
.badge-not-yet{background:rgba(251,191,36,0.12);color:#fbbf24;border:1px solid rgba(251,191,36,0.2)}
.badge-info{background:rgba(99,102,241,0.12);color:#818cf8;border:1px solid rgba(99,102,241,0.2)}

.validation-list{margin-top:16px}
.validation-item{display:flex;align-items:center;gap:10px;padding:10px 14px;background:rgba(255,255,255,0.02);border:1px solid var(--border);border-radius:10px;margin-bottom:8px;font-size:13px}
.validation-icon{font-size:16px}

/* Quick claim buttons */
.claim-chips{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:16px}
.claim-chip{padding:6px 12px;background:rgba(255,255,255,0.03);border:1px solid var(--border);border-radius:8px;color:var(--text2);font-size:12px;font-weight:600;cursor:pointer;transition:all 0.2s}
.claim-chip:hover{background:rgba(99,102,241,0.1);border-color:rgba(99,102,241,0.3);color:#fff}
.claim-chip.active{background:rgba(99,102,241,0.15);border-color:var(--primary);color:#fff}

/* Decoded sections */
.decoded-section{margin-bottom:16px}
.decoded-label{font-size:12px;font-weight:700;text-transform:uppercase;letter-spacing:0.5px;margin-bottom:6px;display:flex;align-items:center;gap:8px}
.decoded-json{padding:14px;background:rgba(0,0,0,0.3);border:1px solid var(--border);border-radius:10px;font-family:'SF Mono',monospace;font-size:13px;line-height:1.6;color:#e2e8f0;white-space:pre-wrap;word-break:break-word}

.site-footer{border-top:1px solid var(--border);padding:40px 24px;text-align:center}
.footer-links{display:flex;justify-content:center;gap:24px;margin-bottom:16px;flex-wrap:wrap}
.footer-links a{color:var(--text2);font-size:13px;font-weight:500}
.footer-links a:hover{color:#fff}
.footer-copy{font-size:12px;color:rgba(148,163,184,0.5)}
</style>
</head>
<body>

<nav class="nav"><div class="nav-inner">
<a href="/" class="nav-logo"><span>NexTool</span></a>
<div class="nav-links">
<a href="/free-tools/">Free Tools</a>
<a href="/pro.html">Pro</a>
<a href="/blog/">Blog</a>
</div>
</div></nav>

<section class="hero">
<div class="hero-badge">Free Tool</div>
<h1>JWT Token Generator &amp; Debugger</h1>
<p>Generate JWT tokens with custom claims and expiration, or decode and validate existing tokens with a visual breakdown.</p>
</section>

<div class="tool-container">

<div class="tabs">
<button class="tab-btn active" data-tab="generate">Generate Token</button>
<button class="tab-btn" data-tab="decode">Decode &amp; Debug</button>
</div>

<!-- TAB 1: Generate -->
<div class="tab-panel active" id="tab-generate">

<div class="panel">
<div class="panel-header"><span class="panel-title">Header</span></div>
<div class="panel-body">
<div class="form-row">
<div class="form-group">
<label>Algorithm</label>
<select id="genAlg" onchange="updateGenHeader()">
<option value="HS256" selected>HS256</option>
<option value="HS384">HS384</option>
<option value="HS512">HS512</option>
<option value="RS256">RS256 (structure only)</option>
</select>
</div>
<div class="form-group">
<label>Type</label>
<input type="text" id="genTyp" value="JWT" readonly style="opacity:0.6">
</div>
</div>
<textarea class="json-editor" id="genHeaderJson" rows="3" readonly style="opacity:0.7">{
  "alg": "HS256",
  "typ": "JWT"
}</textarea>
</div>
</div>

<div class="panel">
<div class="panel-header"><span class="panel-title">Payload (Claims)</span></div>
<div class="panel-body">
<div style="margin-bottom:12px;font-size:12px;color:var(--text2)">Click claims to toggle them in the payload:</div>
<div class="claim-chips" id="claimChips">
<button class="claim-chip active" data-claim="iss">iss (Issuer)</button>
<button class="claim-chip active" data-claim="sub">sub (Subject)</button>
<button class="claim-chip active" data-claim="aud">aud (Audience)</button>
<button class="claim-chip active" data-claim="exp">exp (Expiration)</button>
<button class="claim-chip" data-claim="nbf">nbf (Not Before)</button>
<button class="claim-chip active" data-claim="iat">iat (Issued At)</button>
<button class="claim-chip" data-claim="jti">jti (JWT ID)</button>
</div>

<div class="form-row" id="claimFields">
<div class="form-group" data-for="iss">
<label>Issuer (iss)</label>
<input type="text" id="claimIss" value="nextool.app" oninput="updatePayload()">
</div>
<div class="form-group" data-for="sub">
<label>Subject (sub)</label>
<input type="text" id="claimSub" value="user-12345" oninput="updatePayload()">
</div>
<div class="form-group" data-for="aud">
<label>Audience (aud)</label>
<input type="text" id="claimAud" value="https://api.example.com" oninput="updatePayload()">
</div>
</div>

<div class="form-row">
<div class="form-group" data-for="exp">
<label>Expiration</label>
<select id="claimExpSelect" onchange="updatePayload()">
<option value="3600">1 hour</option>
<option value="86400" selected>24 hours</option>
<option value="604800">7 days</option>
<option value="2592000">30 days</option>
<option value="31536000">1 year</option>
<option value="custom">Custom date</option>
</select>
</div>
<div class="form-group" data-for="exp" id="customExpGroup" style="display:none">
<label>Custom Expiration</label>
<input type="datetime-local" id="claimExpCustom" onchange="updatePayload()">
</div>
<div class="form-group" data-for="jti" style="display:none">
<label>JWT ID (jti)</label>
<input type="text" id="claimJti" value="" oninput="updatePayload()" placeholder="Auto-generated">
</div>
</div>

<div style="margin-top:4px;margin-bottom:12px;font-size:12px;font-weight:600;color:var(--text2);text-transform:uppercase;letter-spacing:0.5px">Custom Claims (JSON)</div>
<textarea class="json-editor" id="customClaims" rows="3" oninput="updatePayload()" placeholder='{"role": "admin", "name": "John Doe"}'>{
  "role": "admin",
  "name": "John Doe"
}</textarea>

<div style="margin-top:16px">
<div style="font-size:12px;font-weight:600;color:var(--text2);text-transform:uppercase;letter-spacing:0.5px;margin-bottom:6px">Full Payload Preview</div>
<div class="decoded-json" id="payloadPreview">{}</div>
</div>
</div>
</div>

<div class="panel">
<div class="panel-header"><span class="panel-title">Secret Key</span></div>
<div class="panel-body">
<div class="form-row">
<div class="form-group" style="flex:3">
<label>HMAC Secret</label>
<input type="text" id="genSecret" value="your-256-bit-secret" oninput="generateToken()">
</div>
<div class="form-group" style="flex:1;min-width:120px">
<label>&nbsp;</label>
<button class="btn-secondary" onclick="randomSecret()" style="width:100%;padding:10px">Random</button>
</div>
</div>
<div style="font-size:11px;color:var(--text2);margin-top:4px">For HS256/HS384/HS512. HMAC signing uses the Web Crypto API (client-side). RS256 generates structure only.</div>
</div>
</div>

<div style="display:flex;gap:12px;margin-bottom:24px">
<button class="btn-primary" onclick="generateToken()" style="flex:1">Generate JWT Token</button>
</div>

<div class="panel">
<div class="panel-header">
<span class="panel-title">Generated Token</span>
<button class="copy-btn" onclick="copyToken(this)">Copy Token</button>
</div>
<div class="panel-body">
<div class="token-display" id="genTokenDisplay">
<span style="color:var(--text2);font-size:13px">Click "Generate JWT Token" to create a token</span>
</div>
<div class="token-legend">
<span><span class="legend-dot" style="background:rgba(248,113,113,0.4)"></span> Header</span>
<span><span class="legend-dot" style="background:rgba(192,132,252,0.4)"></span> Payload</span>
<span><span class="legend-dot" style="background:rgba(96,165,250,0.4)"></span> Signature</span>
</div>
</div>
</div>
</div>

<!-- TAB 2: Decode -->
<div class="tab-panel" id="tab-decode">

<div class="panel">
<div class="panel-header"><span class="panel-title">Paste JWT Token</span></div>
<div class="panel-body">
<textarea class="json-editor" id="decodeInput" rows="4" placeholder="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c" oninput="decodeToken()"></textarea>
</div>
</div>

<div class="panel">
<div class="panel-header"><span class="panel-title">Token Breakdown</span></div>
<div class="panel-body">
<div class="token-display" id="decTokenDisplay" style="margin-bottom:16px">
<span style="color:var(--text2);font-size:13px">Paste a JWT token above</span>
</div>
<div class="token-legend" style="margin-bottom:20px">
<span><span class="legend-dot" style="background:rgba(248,113,113,0.4)"></span> Header</span>
<span><span class="legend-dot" style="background:rgba(192,132,252,0.4)"></span> Payload</span>
<span><span class="legend-dot" style="background:rgba(96,165,250,0.4)"></span> Signature</span>
</div>

<div class="decoded-section">
<div class="decoded-label"><span style="color:var(--red)">Header</span></div>
<div class="decoded-json" id="decHeader">—</div>
</div>
<div class="decoded-section">
<div class="decoded-label"><span style="color:var(--purple)">Payload</span></div>
<div class="decoded-json" id="decPayload">—</div>
</div>
<div class="decoded-section">
<div class="decoded-label"><span style="color:var(--blue)">Signature</span></div>
<div class="decoded-json" id="decSignature" style="color:var(--blue)">—</div>
</div>
</div>
</div>

<div class="panel">
<div class="panel-header"><span class="panel-title">Validation Status</span></div>
<div class="panel-body">
<div class="validation-list" id="validationList">
<div class="validation-item" style="color:var(--text2)">
<span class="validation-icon">&#9432;</span>
<span>Paste a token above to see validation results</span>
</div>
</div>
</div>
</div>

</div>

</div>

<!-- BUNDLE CROSS-PROMO -->
<section style="max-width:900px;margin:40px auto;padding:0 24px;">
<div style="background:linear-gradient(135deg,rgba(99,102,241,0.1),rgba(168,85,247,0.08));border:1px solid rgba(99,102,241,0.15);border-radius:20px;padding:32px 28px;text-align:center;">
<div style="font-size:13px;color:#818cf8;font-weight:600;text-transform:uppercase;letter-spacing:1px;margin-bottom:8px;">Founding Member</div>
<h3 style="font-size:22px;font-weight:800;color:#fff;margin:0 0 8px;">Get NexTool Pro</h3>
<p style="color:#94a3b8;font-size:14px;margin:0 auto 20px;max-width:500px;">No banners, clean output, enhanced features on all 150+ tools. One-time payment.</p>
<a href="/pro.html" style="display:inline-block;padding:12px 28px;background:linear-gradient(135deg,#6366f1,#a855f7);color:#fff;text-decoration:none;border-radius:12px;font-weight:700;font-size:15px;">$29 — Get Pro</a>
<a href="/free-tools/" style="display:inline-block;margin-left:12px;color:#818cf8;text-decoration:none;font-size:14px;">Browse 150+ Free Tools &rarr;</a>
</div>
</section>

<!-- FAQ -->
<section style="max-width:700px;margin:0 auto 40px;padding:0 24px">
<h2 style="font-size:22px;font-weight:800;color:#fff;margin-bottom:20px;text-align:center">Frequently Asked Questions</h2>
<details style="background:var(--surface);border:1px solid var(--border);border-radius:12px;margin-bottom:10px;padding:16px 20px">
<summary style="font-weight:600;color:#fff;cursor:pointer;font-size:14px">What is a JWT token?</summary>
<p style="margin-top:10px;font-size:13px;color:var(--text2)">A JSON Web Token (JWT) is a compact, URL-safe token for securely transmitting claims between parties. It has three Base64URL-encoded parts: header, payload, and signature.</p>
</details>
<details style="background:var(--surface);border:1px solid var(--border);border-radius:12px;margin-bottom:10px;padding:16px 20px">
<summary style="font-weight:600;color:#fff;cursor:pointer;font-size:14px">How does JWT signing work?</summary>
<p style="margin-top:10px;font-size:13px;color:var(--text2)">The header and payload are Base64URL-encoded, concatenated with a dot, and signed using the specified algorithm (e.g., HMAC-SHA256). The signature ensures the token has not been modified.</p>
</details>
<details style="background:var(--surface);border:1px solid var(--border);border-radius:12px;margin-bottom:10px;padding:16px 20px">
<summary style="font-weight:600;color:#fff;cursor:pointer;font-size:14px">Is this tool secure?</summary>
<p style="margin-top:10px;font-size:13px;color:var(--text2)">All token generation and decoding happens entirely in your browser using the Web Crypto API. No data is sent to any server. However, never use tokens generated here in production without proper key management.</p>
</details>
</section>


<!-- AUTO-LINKED by NexTool Engine -->
<div style="margin:2rem 0;padding:1.5rem;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius)">
<p style="font-weight:600;margin-bottom:.5rem">Related Tools</p>
<p><a href="/free-tools/box-shadow-generator.html" style="color:var(--primary);text-decoration:none">CSS Box Shadow Generator</a> · <a href="/free-tools/emoji-picker.html" style="color:var(--primary);text-decoration:none">Emoji Picker & Search</a> · <a href="/free-tools/meta-tag-generator.html" style="color:var(--primary);text-decoration:none">Meta Tag Generator</a> · <a href="/free-tools/base64.html" style="color:var(--primary);text-decoration:none">Free Base64 Encoder/Decoder</a> · <a href="/free-tools/favicon-generator.html" style="color:var(--primary);text-decoration:none">Favicon Generator</a></p>
</div>
<footer class="site-footer">
<div class="footer-links">
<a href="/">Home</a>
<a href="/free-tools/">Free Tools</a>
<a href="/pro.html">Pro</a>
<a href="/blog/">Blog</a>
</div>
<div class="footer-copy">&copy; 2026 NexTool. All rights reserved.</div>
</footer>

<script>
/* ===== Base64URL helpers ===== */
function b64urlEncode(str){
  return btoa(str).replace(/\+/g,'-').replace(/\//g,'_').replace(/=+$/,'');
}
function b64urlDecode(str){
  let s=str.replace(/-/g,'+').replace(/_/g,'/');
  while(s.length%4) s+='=';
  return atob(s);
}
function strToUint8(s){return new TextEncoder().encode(s);}
function uint8ToB64url(buf){
  let binary='';
  const bytes=new Uint8Array(buf);
  for(let i=0;i<bytes.length;i++) binary+=String.fromCharCode(bytes[i]);
  return btoa(binary).replace(/\+/g,'-').replace(/\//g,'_').replace(/=+$/,'');
}

/* ===== Tab switching ===== */
document.querySelectorAll('.tab-btn').forEach(btn=>{
  btn.addEventListener('click',function(){
    document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
    document.querySelectorAll('.tab-panel').forEach(p=>p.classList.remove('active'));
    this.classList.add('active');
    document.getElementById('tab-'+this.dataset.tab).classList.add('active');
  });
});

/* ===== Claim chips ===== */
const activeClaims=new Set(['iss','sub','aud','exp','iat']);
document.getElementById('claimChips').addEventListener('click',function(e){
  const chip=e.target.closest('.claim-chip');
  if(!chip) return;
  const claim=chip.dataset.claim;
  if(activeClaims.has(claim)){
    activeClaims.delete(claim);
    chip.classList.remove('active');
  }else{
    activeClaims.add(claim);
    chip.classList.add('active');
  }
  /* Show/hide fields */
  document.querySelectorAll('[data-for]').forEach(el=>{
    const forClaim=el.dataset.for;
    el.style.display=activeClaims.has(forClaim)?'':'none';
  });
  updatePayload();
});

/* ===== Update header ===== */
function updateGenHeader(){
  const alg=document.getElementById('genAlg').value;
  document.getElementById('genHeaderJson').value=JSON.stringify({alg:alg,typ:'JWT'},null,2);
  generateToken();
}

/* ===== Build payload ===== */
function buildPayload(){
  const now=Math.floor(Date.now()/1000);
  const payload={};
  if(activeClaims.has('iss')) payload.iss=document.getElementById('claimIss').value;
  if(activeClaims.has('sub')) payload.sub=document.getElementById('claimSub').value;
  if(activeClaims.has('aud')) payload.aud=document.getElementById('claimAud').value;
  if(activeClaims.has('exp')){
    const sel=document.getElementById('claimExpSelect').value;
    document.getElementById('customExpGroup').style.display=sel==='custom'?'':'none';
    if(sel==='custom'){
      const dt=document.getElementById('claimExpCustom').value;
      payload.exp=dt?Math.floor(new Date(dt).getTime()/1000):now+86400;
    }else{
      payload.exp=now+parseInt(sel);
    }
  }
  if(activeClaims.has('nbf')) payload.nbf=now;
  if(activeClaims.has('iat')) payload.iat=now;
  if(activeClaims.has('jti')){
    let jti=document.getElementById('claimJti').value;
    if(!jti){
      jti=crypto.randomUUID?crypto.randomUUID():(Math.random().toString(36).substr(2)+Date.now().toString(36));
      document.getElementById('claimJti').value=jti;
    }
    payload.jti=jti;
  }
  /* Custom claims */
  try{
    const custom=JSON.parse(document.getElementById('customClaims').value||'{}');
    Object.assign(payload,custom);
  }catch(e){}
  return payload;
}

function updatePayload(){
  const payload=buildPayload();
  document.getElementById('payloadPreview').textContent=JSON.stringify(payload,null,2);
  generateToken();
}

/* ===== HMAC Sign (Web Crypto) ===== */
async function hmacSign(data,secret,alg){
  const algMap={HS256:'SHA-256',HS384:'SHA-384',HS512:'SHA-512'};
  const hashAlg=algMap[alg];
  if(!hashAlg) return 'unsigned-rs256-demo-signature';
  const key=await crypto.subtle.importKey('raw',strToUint8(secret),{name:'HMAC',hash:hashAlg},false,['sign']);
  const sig=await crypto.subtle.sign('HMAC',key,strToUint8(data));
  return uint8ToB64url(sig);
}

/* ===== Generate Token ===== */
let genDebounce=null;
async function generateToken(){
  clearTimeout(genDebounce);
  genDebounce=setTimeout(async()=>{
    const alg=document.getElementById('genAlg').value;
    const secret=document.getElementById('genSecret').value;
    const header=JSON.stringify({alg:alg,typ:'JWT'});
    const payload=JSON.stringify(buildPayload());
    const headerB64=b64urlEncode(header);
    const payloadB64=b64urlEncode(payload);
    const sigInput=headerB64+'.'+payloadB64;
    let signature;
    try{
      signature=await hmacSign(sigInput,secret,alg);
    }catch(e){
      signature='error-signing';
    }
    const token=headerB64+'.'+payloadB64+'.'+signature;
    const display=document.getElementById('genTokenDisplay');
    display.innerHTML=`<span class="token-header">${headerB64}</span><span class="token-dot">.</span><span class="token-payload">${payloadB64}</span><span class="token-dot">.</span><span class="token-signature">${signature}</span>`;
    display.dataset.token=token;
  },100);
}

function copyToken(btn){
  const token=document.getElementById('genTokenDisplay').dataset.token;
  if(!token) return;
  navigator.clipboard.writeText(token).then(()=>{
    btn.textContent='Copied!';btn.classList.add('copied');
    setTimeout(()=>{btn.textContent='Copy Token';btn.classList.remove('copied');},2000);
  });
}

function randomSecret(){
  const chars='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_';
  let s='';
  const arr=new Uint8Array(32);
  crypto.getRandomValues(arr);
  arr.forEach(b=>s+=chars[b%chars.length]);
  document.getElementById('genSecret').value=s;
  generateToken();
}

/* ===== Decode Tab ===== */
function decodeToken(){
  const token=document.getElementById('decodeInput').value.trim();
  const display=document.getElementById('decTokenDisplay');
  const headerEl=document.getElementById('decHeader');
  const payloadEl=document.getElementById('decPayload');
  const sigEl=document.getElementById('decSignature');
  const valList=document.getElementById('validationList');

  if(!token){
    display.innerHTML='<span style="color:var(--text2);font-size:13px">Paste a JWT token above</span>';
    headerEl.textContent='—';
    payloadEl.textContent='—';
    sigEl.textContent='—';
    valList.innerHTML='<div class="validation-item" style="color:var(--text2)"><span class="validation-icon">&#9432;</span><span>Paste a token above to see validation results</span></div>';
    return;
  }

  const parts=token.split('.');
  if(parts.length!==3){
    display.innerHTML='<span style="color:var(--red)">Invalid JWT format — expected 3 dot-separated parts</span>';
    return;
  }

  display.innerHTML=`<span class="token-header">${parts[0]}</span><span class="token-dot">.</span><span class="token-payload">${parts[1]}</span><span class="token-dot">.</span><span class="token-signature">${parts[2]}</span>`;

  let header,payload;
  try{
    header=JSON.parse(b64urlDecode(parts[0]));
    headerEl.textContent=JSON.stringify(header,null,2);
  }catch(e){
    headerEl.textContent='Error decoding header: '+e.message;
    header=null;
  }

  try{
    payload=JSON.parse(b64urlDecode(parts[1]));
    payloadEl.textContent=JSON.stringify(payload,null,2);
  }catch(e){
    payloadEl.textContent='Error decoding payload: '+e.message;
    payload=null;
  }

  sigEl.textContent=parts[2];

  /* Validation */
  const checks=[];
  if(header){
    checks.push({icon:'&#10003;',text:`Algorithm: ${header.alg||'none'}`,badge:'badge-info'});
    checks.push({icon:'&#10003;',text:`Type: ${header.typ||'unknown'}`,badge:'badge-info'});
  }

  if(payload){
    const now=Math.floor(Date.now()/1000);
    if(payload.exp){
      const expDate=new Date(payload.exp*1000);
      if(payload.exp<now){
        checks.push({icon:'&#10007;',text:`Expired: ${expDate.toLocaleString()}`,badge:'badge-expired'});
      }else{
        const diff=payload.exp-now;
        const hours=Math.floor(diff/3600);
        const mins=Math.floor((diff%3600)/60);
        checks.push({icon:'&#10003;',text:`Expires: ${expDate.toLocaleString()} (in ${hours}h ${mins}m)`,badge:'badge-valid'});
      }
    }else{
      checks.push({icon:'&#9432;',text:'No expiration (exp) claim',badge:'badge-info'});
    }

    if(payload.nbf){
      const nbfDate=new Date(payload.nbf*1000);
      if(payload.nbf>now){
        checks.push({icon:'&#9888;',text:`Not valid until: ${nbfDate.toLocaleString()}`,badge:'badge-not-yet'});
      }else{
        checks.push({icon:'&#10003;',text:`Valid since: ${nbfDate.toLocaleString()}`,badge:'badge-valid'});
      }
    }

    if(payload.iat){
      checks.push({icon:'&#10003;',text:`Issued at: ${new Date(payload.iat*1000).toLocaleString()}`,badge:'badge-info'});
    }
    if(payload.iss) checks.push({icon:'&#10003;',text:`Issuer: ${payload.iss}`,badge:'badge-info'});
    if(payload.sub) checks.push({icon:'&#10003;',text:`Subject: ${payload.sub}`,badge:'badge-info'});
    if(payload.aud) checks.push({icon:'&#10003;',text:`Audience: ${payload.aud}`,badge:'badge-info'});
    if(payload.jti) checks.push({icon:'&#10003;',text:`JWT ID: ${payload.jti}`,badge:'badge-info'});
  }

  checks.push({icon:'&#9432;',text:'Signature verification requires the secret key (not performed client-side for security)',badge:'badge-info'});

  valList.innerHTML=checks.map(c=>`<div class="validation-item"><span class="validation-icon">${c.icon}</span><span>${c.text}</span><span class="badge ${c.badge}" style="margin-left:auto">${c.badge.replace('badge-','')}</span></div>`).join('');
}

/* ===== Init ===== */
updateGenHeader();
updatePayload();

/* Auto-decode on tab switch if there is content */
document.querySelector('[data-tab="decode"]').addEventListener('click',()=>{
  if(document.getElementById('decodeInput').value.trim()) decodeToken();
});
</script>
<script defer src="/js/revenue.js"></script>
<script defer src="/js/lead-capture.js"></script>
<script defer src="/js/analytics-lite.js"></script>
</body>
</html>
