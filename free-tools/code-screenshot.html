<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Code Screenshot Generator - Beautiful Code Images | NexTool</title>
<meta name="description" content="Free Code Screenshot Generator. Create beautiful code images with syntax highlighting, themes, gradients, and window controls. Export as PNG or copy to clipboard.">
<meta name="keywords" content="code screenshot, code image, code to image, syntax highlighting, code snippet, carbon alternative, NexTool">
<link rel="canonical" href="https://nextool.app/free-tools/code-screenshot.html">
<meta property="og:title" content="Code Screenshot Generator - Beautiful Code Images | NexTool">
<meta property="og:description" content="Create beautiful code screenshots with syntax highlighting, multiple themes, gradient backgrounds. Export as PNG.">
<meta property="og:type" content="website">
<meta property="og:url" content="https://nextool.app/free-tools/code-screenshot.html">
<meta property="og:image" content="https://nextool.app/free-tools/og/code-screenshot.png">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Code Screenshot Generator - Beautiful Code Images | NexTool">
<meta name="twitter:description" content="Create beautiful code screenshots with syntax highlighting and gradient backgrounds.">
<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@type":"BreadcrumbList",
  "itemListElement":[
    {"@type":"ListItem","position":1,"name":"Home","item":"https://nextool.app/"},
    {"@type":"ListItem","position":2,"name":"Free Tools","item":"https://nextool.app/free-tools/"},
    {"@type":"ListItem","position":3,"name":"Code Screenshot","item":"https://nextool.app/free-tools/code-screenshot.html"}
  ]
}
</script>
<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@type":"SoftwareApplication",
  "name":"Code Screenshot Generator",
  "applicationCategory":"DeveloperApplication",
  "operatingSystem":"Web",
  "description":"Create beautiful code screenshots with syntax highlighting, themes, gradient backgrounds, and PNG export.",
  "url":"https://nextool.app/free-tools/code-screenshot.html",
  "offers":{"@type":"Offer","price":"0","priceCurrency":"USD"},
  "author":{"@type":"Organization","name":"NexTool","url":"https://nextool.app"}
}
</script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{--bg:#050508;--surface:#111118;--surface2:#1a1a24;--surface3:#22222f;--primary:#6366f1;--accent:#a855f7;--pink:#ec4899;--text:#e2e8f0;--text-dim:#94a3b8;--text-muted:#64748b;--gradient:linear-gradient(135deg,#6366f1,#a855f7,#ec4899);--green:#22c55e;--red:#ef4444;--yellow:#eab308;--radius:12px;--radius-lg:20px}
html{scroll-behavior:smooth}
body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--text);line-height:1.6;-webkit-font-smoothing:antialiased;min-height:100vh}
.nav{position:fixed;top:0;left:0;right:0;z-index:1000;padding:0 2rem;height:64px;display:flex;align-items:center;justify-content:space-between;background:rgba(5,5,8,.75);backdrop-filter:blur(20px);border-bottom:1px solid rgba(99,102,241,.1)}
.nav-logo{display:flex;align-items:center;gap:.5rem;font-weight:800;font-size:1.15rem;text-decoration:none;color:var(--text)}
.nav-logo .ico{width:28px;height:28px;border-radius:7px;background:var(--gradient);display:flex;align-items:center;justify-content:center;font-size:.75rem;font-weight:900;color:#fff}
.nav-logo span{background:var(--gradient);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.nav-links{display:flex;gap:1.5rem;align-items:center}
.nav-links a{color:var(--text-dim);font-size:.85rem;font-weight:500;text-decoration:none;transition:color .2s}
.nav-links a:hover{color:var(--text)}
.breadcrumb{max-width:960px;margin:0 auto;padding:80px 1.5rem 0;font-size:.8rem}
.breadcrumb a{color:var(--text-muted);text-decoration:none;transition:color .2s}
.breadcrumb a:hover{color:var(--text)}
.breadcrumb span{color:var(--text-muted);margin:0 .4rem}
.breadcrumb .current{color:var(--text-dim)}
.main{max-width:960px;margin:0 auto;padding:1rem 1.5rem 3rem}
.tool-header{text-align:center;margin-bottom:2.5rem}
.tool-badge{display:inline-flex;align-items:center;gap:.4rem;padding:.3rem .8rem;border-radius:100px;background:rgba(99,102,241,.1);border:1px solid rgba(99,102,241,.15);font-size:.72rem;font-weight:600;color:var(--primary);text-transform:uppercase;letter-spacing:.06em;margin-bottom:1rem}
.tool-header h1{font-size:clamp(1.75rem,4vw,2.5rem);font-weight:800;margin-bottom:.5rem}
.tool-header h1 .gr{background:var(--gradient);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.tool-header p{color:var(--text-dim);font-size:1rem;max-width:600px;margin:0 auto}
.card{background:var(--surface);border:1px solid rgba(99,102,241,.1);border-radius:var(--radius-lg);padding:2rem;position:relative;overflow:hidden;margin-bottom:1.5rem}
.card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:var(--gradient)}
.card h3{font-size:1rem;font-weight:700;margin-bottom:1.25rem;display:flex;align-items:center;gap:.5rem}

/* Layout */
.editor-layout{display:grid;grid-template-columns:280px 1fr;gap:1.5rem}

/* Sidebar controls */
.controls{display:flex;flex-direction:column;gap:1rem}
.ctrl-group{display:flex;flex-direction:column;gap:.3rem}
.ctrl-group label{font-size:.78rem;font-weight:600;color:var(--text-dim)}
.ctrl-select{padding:.45rem .6rem;border-radius:8px;border:1px solid var(--surface3);background:var(--surface2);color:var(--text);font-family:'Inter',sans-serif;font-size:.82rem;outline:none;width:100%;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%2394a3b8' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right .5rem center;padding-right:1.8rem;transition:border-color .2s}
.ctrl-select:focus{border-color:var(--primary)}
.ctrl-input{padding:.45rem .6rem;border-radius:8px;border:1px solid var(--surface3);background:var(--surface2);color:var(--text);font-family:'Inter',sans-serif;font-size:.82rem;outline:none;width:100%;transition:border-color .2s}
.ctrl-input:focus{border-color:var(--primary)}

/* Range slider */
.range-wrap{display:flex;align-items:center;gap:.5rem}
.range-wrap input[type="range"]{flex:1;-webkit-appearance:none;background:var(--surface3);height:4px;border-radius:2px;outline:none}
.range-wrap input[type="range"]::-webkit-slider-thumb{-webkit-appearance:none;width:14px;height:14px;border-radius:50%;background:var(--primary);cursor:pointer}
.range-val{font-family:'JetBrains Mono',monospace;font-size:.75rem;color:var(--text-dim);min-width:28px;text-align:right}

/* Toggle */
.toggle-row{display:flex;align-items:center;justify-content:space-between}
.toggle{position:relative;width:36px;height:20px;cursor:pointer}
.toggle input{opacity:0;width:0;height:0}
.toggle-track{position:absolute;top:0;left:0;right:0;bottom:0;background:var(--surface3);border-radius:10px;transition:background .2s}
.toggle-track::after{content:'';position:absolute;width:16px;height:16px;left:2px;top:2px;background:#fff;border-radius:50%;transition:transform .2s}
.toggle input:checked+.toggle-track{background:var(--primary)}
.toggle input:checked+.toggle-track::after{transform:translateX(16px)}

/* Background presets */
.bg-presets{display:grid;grid-template-columns:repeat(4,1fr);gap:6px}
.bg-preset{width:100%;aspect-ratio:1;border-radius:8px;cursor:pointer;border:2px solid transparent;transition:border-color .2s}
.bg-preset.active{border-color:var(--primary)}
.bg-preset:hover{border-color:var(--text-muted)}

/* Code input */
.code-input{width:100%;min-height:200px;padding:1rem;border-radius:var(--radius);border:1px solid var(--surface3);background:var(--surface2);color:var(--text);font-family:'JetBrains Mono',monospace;font-size:.85rem;line-height:1.6;resize:vertical;outline:none;tab-size:2;transition:border-color .2s}
.code-input:focus{border-color:var(--primary)}

/* Preview area */
.preview-area{display:flex;align-items:center;justify-content:center;min-height:300px;border-radius:var(--radius);overflow:hidden;position:relative}

/* The screenshot frame */
.screenshot-frame{display:inline-block;position:relative}
.ss-bg{border-radius:12px;overflow:hidden}

/* Window */
.code-window{border-radius:10px;overflow:hidden;box-shadow:0 20px 68px rgba(0,0,0,.55)}
.window-header{display:flex;align-items:center;padding:12px 16px;gap:8px}
.window-dots{display:flex;gap:6px}
.window-dot{width:12px;height:12px;border-radius:50%}
.window-title{flex:1;text-align:center;font-size:12px;font-weight:500;opacity:.6;font-family:'Inter',sans-serif}
.code-body{padding:16px 20px;font-family:'JetBrains Mono',monospace;line-height:1.7;overflow-x:auto;white-space:pre}
.code-body .line-num{display:inline-block;width:2.5em;text-align:right;margin-right:1.2em;opacity:.35;user-select:none}

/* Action buttons */
.actions{display:flex;gap:.75rem;justify-content:center;flex-wrap:wrap;margin-top:1.5rem}
.action-btn{padding:.55rem 1.5rem;border-radius:8px;border:none;font-weight:700;font-size:.85rem;cursor:pointer;font-family:'Inter',sans-serif;transition:transform .2s,box-shadow .2s;display:flex;align-items:center;gap:.4rem}
.action-btn:hover{transform:translateY(-2px)}
.action-primary{background:var(--gradient);color:#fff;box-shadow:0 2px 12px rgba(99,102,241,.3)}
.action-primary:hover{box-shadow:0 4px 20px rgba(99,102,241,.5)}
.action-secondary{background:var(--surface2);color:var(--text-dim);border:1px solid var(--surface3)}
.action-secondary:hover{border-color:var(--primary);color:var(--text)}

.toast{position:fixed;bottom:2rem;left:50%;transform:translateX(-50%) translateY(80px);background:var(--surface);border:1px solid rgba(99,102,241,.2);border-radius:var(--radius);padding:.6rem 1.25rem;font-size:.85rem;font-weight:600;color:var(--text);opacity:0;transition:all .3s ease;z-index:9999;pointer-events:none}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}

/* CTA & Footer */
.cta-section{text-align:center;padding:3rem 0;margin-top:1rem}
.cta-section h2{font-size:1.5rem;font-weight:800;margin-bottom:.5rem}
.cta-section p{color:var(--text-dim);margin-bottom:1.5rem;font-size:.95rem}
.cta-btn{display:inline-block;padding:.7rem 2rem;border-radius:var(--radius);background:var(--gradient);color:#fff;font-weight:700;font-size:.95rem;text-decoration:none;transition:transform .2s,box-shadow .2s}
.cta-btn:hover{transform:translateY(-2px);box-shadow:0 4px 20px rgba(99,102,241,.4)}

.footer{border-top:1px solid rgba(99,102,241,.06);padding:2rem 0;text-align:center}
.footer-inner{max-width:960px;margin:0 auto;padding:0 1.5rem;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:1rem}
.footer-logo{display:flex;align-items:center;gap:.4rem;font-weight:700;font-size:.9rem}
.footer-logo .ico{width:20px;height:20px;border-radius:5px;background:var(--gradient);display:flex;align-items:center;justify-content:center;font-size:.5rem;font-weight:900;color:#fff}
.footer-logo span{color:var(--text-dim)}
.footer-links{display:flex;gap:1.25rem}
.footer-links a{color:var(--text-muted);font-size:.8rem;text-decoration:none;transition:color .2s}
.footer-links a:hover{color:var(--text)}
.footer-copy{color:var(--text-muted);font-size:.75rem;width:100%;text-align:center;margin-top:.5rem}

@media(max-width:768px){
  .editor-layout{grid-template-columns:1fr}
  .main{padding:1rem 1rem 2rem}
  .breadcrumb{padding:80px 1rem 0}
  .nav-links{display:none}
  .bg-presets{grid-template-columns:repeat(6,1fr)}
  .footer-inner{flex-direction:column;text-align:center}
}
</style>
</head>
<body>
<nav class="nav">
  <a class="nav-logo" href="/"><div class="ico">N</div><span>NexTool</span></a>
  <div class="nav-links">
    <a href="/">Home</a>
    <a href="/free-tools/">Free Tools</a>
    <a href="/pro.html">Pro</a>
    <a href="/blog/">Blog</a>
  </div>
</nav>

<div class="breadcrumb">
  <a href="/">Home</a><span>/</span><a href="/free-tools/">Free Tools</a><span>/</span><span class="current">Code Screenshot</span>
</div>

<div class="main">
  <div class="tool-header">
    <div class="tool-badge">Free Tool</div>
    <h1><span class="gr">Code Screenshot</span> Generator</h1>
    <p>Create beautiful code images with syntax highlighting, themes, and gradient backgrounds. Export as PNG or copy to clipboard.</p>
  </div>

  <div class="card">
    <div class="editor-layout">
      <!-- Controls sidebar -->
      <div class="controls">
        <div class="ctrl-group">
          <label>Language</label>
          <select class="ctrl-select" id="lang" onchange="updatePreview()">
            <option value="javascript">JavaScript</option>
            <option value="typescript">TypeScript</option>
            <option value="python">Python</option>
            <option value="html">HTML</option>
            <option value="css">CSS</option>
            <option value="go">Go</option>
            <option value="rust">Rust</option>
            <option value="java">Java</option>
            <option value="cpp">C++</option>
            <option value="php">PHP</option>
            <option value="ruby">Ruby</option>
            <option value="swift">Swift</option>
            <option value="sql">SQL</option>
            <option value="bash">Bash</option>
            <option value="json">JSON</option>
          </select>
        </div>

        <div class="ctrl-group">
          <label>Theme</label>
          <select class="ctrl-select" id="theme" onchange="updatePreview()">
            <option value="dark">Dark</option>
            <option value="light">Light</option>
            <option value="monokai">Monokai</option>
            <option value="dracula">Dracula</option>
            <option value="nord">Nord</option>
            <option value="solarized">Solarized Dark</option>
          </select>
        </div>

        <div class="ctrl-group">
          <label>Background</label>
          <div class="bg-presets" id="bg-presets"></div>
        </div>

        <div class="ctrl-group">
          <label>Filename / Title</label>
          <input type="text" class="ctrl-input" id="filename" placeholder="app.js" value="app.js" oninput="updatePreview()">
        </div>

        <div class="ctrl-group">
          <label>Padding</label>
          <div class="range-wrap">
            <input type="range" id="padding" min="16" max="80" value="40" oninput="updatePreview();document.getElementById('pad-val').textContent=this.value+'px'">
            <span class="range-val" id="pad-val">40px</span>
          </div>
        </div>

        <div class="ctrl-group">
          <label>Border Radius</label>
          <div class="range-wrap">
            <input type="range" id="border-radius" min="0" max="24" value="10" oninput="updatePreview();document.getElementById('br-val').textContent=this.value+'px'">
            <span class="range-val" id="br-val">10px</span>
          </div>
        </div>

        <div class="ctrl-group">
          <label>Font Size</label>
          <div class="range-wrap">
            <input type="range" id="font-size" min="12" max="24" value="14" oninput="updatePreview();document.getElementById('fs-val').textContent=this.value+'px'">
            <span class="range-val" id="fs-val">14px</span>
          </div>
        </div>

        <div class="ctrl-group">
          <div class="toggle-row">
            <label>Window Controls</label>
            <label class="toggle"><input type="checkbox" id="show-dots" checked onchange="updatePreview()"><span class="toggle-track"></span></label>
          </div>
        </div>

        <div class="ctrl-group">
          <div class="toggle-row">
            <label>Shadow</label>
            <label class="toggle"><input type="checkbox" id="show-shadow" checked onchange="updatePreview()"><span class="toggle-track"></span></label>
          </div>
        </div>

        <div class="ctrl-group">
          <div class="toggle-row">
            <label>Line Numbers</label>
            <label class="toggle"><input type="checkbox" id="show-lines" checked onchange="updatePreview()"><span class="toggle-track"></span></label>
          </div>
        </div>
      </div>

      <!-- Right side: code input + preview -->
      <div>
        <div class="ctrl-group" style="margin-bottom:1rem">
          <label>Code</label>
          <textarea class="code-input" id="code-input" spellcheck="false" oninput="updatePreview()">function fibonacci(n) {
  if (n <= 1) return n;

  let a = 0, b = 1;
  for (let i = 2; i <= n; i++) {
    [a, b] = [b, a + b];
  }

  return b;
}

// Calculate first 10 numbers
const results = Array.from(
  { length: 10 },
  (_, i) => fibonacci(i)
);

console.log(results);</textarea>
        </div>

        <label style="font-size:.78rem;font-weight:600;color:var(--text-dim);margin-bottom:.5rem;display:block">Preview</label>
        <div class="preview-area" id="preview-area">
          <div class="screenshot-frame" id="screenshot-frame"></div>
        </div>

        <div class="actions">
          <button class="action-btn action-primary" onclick="exportPNG()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" width="15" height="15"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
            Export PNG
          </button>
          <button class="action-btn action-secondary" onclick="copyToClipboard()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="15" height="15"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
            Copy to Clipboard
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="cta-section">
    <h2>Unlock All NexTool <span style="background:var(--gradient);-webkit-background-clip:text;-webkit-text-fill-color:transparent">Pro Tools</span></h2>
    <p>Get access to premium features, no limits, and priority support.</p>
    <a href="/pro.html" class="cta-btn">Explore Pro</a>
  </div>
</div>

<footer class="footer">
  <div class="footer-inner">
    <div class="footer-logo"><div class="ico">N</div><span>NexTool</span></div>
    <div class="footer-links">
      <a href="/">Home</a>
      <a href="/free-tools/">Tools</a>
      <a href="/blog/">Blog</a>
      <a href="/pro.html">Pro</a>
    </div>
    <div class="footer-copy">&copy; 2025 NexTool. All rights reserved.</div>
  </div>
</footer>

<div class="toast" id="toast"></div>

<script>
// ---- Themes ----
const themes = {
  dark: {
    bg: '#1e1e2e', headerBg: '#181825', text: '#cdd6f4',
    keyword: '#cba6f7', string: '#a6e3a1', comment: '#6c7086',
    number: '#fab387', func: '#89b4fa', operator: '#89dceb', tag: '#f38ba8', attr: '#f9e2af', headerDot: ['#f38ba8','#a6e3a1','#f9e2af']
  },
  light: {
    bg: '#ffffff', headerBg: '#f0f0f0', text: '#383a42',
    keyword: '#a626a4', string: '#50a14f', comment: '#a0a1a7',
    number: '#986801', func: '#4078f2', operator: '#0184bc', tag: '#e45649', attr: '#986801', headerDot: ['#ec6a5e','#f4bf4f','#61c554']
  },
  monokai: {
    bg: '#272822', headerBg: '#1e1f1a', text: '#f8f8f2',
    keyword: '#f92672', string: '#e6db74', comment: '#75715e',
    number: '#ae81ff', func: '#a6e22e', operator: '#f8f8f2', tag: '#f92672', attr: '#a6e22e', headerDot: ['#ff5f56','#ffbd2e','#27c93f']
  },
  dracula: {
    bg: '#282a36', headerBg: '#21222c', text: '#f8f8f2',
    keyword: '#ff79c6', string: '#f1fa8c', comment: '#6272a4',
    number: '#bd93f9', func: '#50fa7b', operator: '#ff79c6', tag: '#ff79c6', attr: '#50fa7b', headerDot: ['#ff5555','#f1fa8c','#50fa7b']
  },
  nord: {
    bg: '#2e3440', headerBg: '#272c36', text: '#d8dee9',
    keyword: '#81a1c1', string: '#a3be8c', comment: '#616e88',
    number: '#b48ead', func: '#88c0d0', operator: '#81a1c1', tag: '#bf616a', attr: '#ebcb8b', headerDot: ['#bf616a','#ebcb8b','#a3be8c']
  },
  solarized: {
    bg: '#002b36', headerBg: '#002028', text: '#839496',
    keyword: '#859900', string: '#2aa198', comment: '#586e75',
    number: '#d33682', func: '#268bd2', operator: '#93a1a1', tag: '#cb4b16', attr: '#b58900', headerDot: ['#dc322f','#b58900','#859900']
  }
};

// ---- Background presets ----
const bgPresets = [
  { id: 'sunset', css: 'linear-gradient(135deg, #667eea, #764ba2)' },
  { id: 'ocean', css: 'linear-gradient(135deg, #0093E9, #80D0C7)' },
  { id: 'fire', css: 'linear-gradient(135deg, #f093fb, #f5576c)' },
  { id: 'forest', css: 'linear-gradient(135deg, #11998e, #38ef7d)' },
  { id: 'midnight', css: 'linear-gradient(135deg, #0f0c29, #302b63, #24243e)' },
  { id: 'candy', css: 'linear-gradient(135deg, #a855f7, #ec4899)' },
  { id: 'slate', css: 'linear-gradient(135deg, #334155, #1e293b)' },
  { id: 'none', css: 'transparent' }
];

let activeBg = 'sunset';

function initBgPresets() {
  const wrap = document.getElementById('bg-presets');
  bgPresets.forEach(p => {
    const div = document.createElement('div');
    div.className = 'bg-preset' + (p.id === activeBg ? ' active' : '');
    div.style.background = p.css === 'transparent' ? 'repeating-conic-gradient(var(--surface3) 0% 25%, var(--surface2) 0% 50%) 50% / 12px 12px' : p.css;
    div.dataset.id = p.id;
    div.onclick = () => { activeBg = p.id; document.querySelectorAll('.bg-preset').forEach(b => b.classList.toggle('active', b.dataset.id === p.id)); updatePreview(); };
    wrap.appendChild(div);
  });
}

// ---- Syntax highlighting (regex-based) ----
function highlight(code, lang) {
  const t = themes[document.getElementById('theme').value];
  const esc = s => s.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');

  // Build patterns per language
  const kwSets = {
    javascript: 'const|let|var|function|return|if|else|for|while|do|switch|case|break|continue|new|this|class|extends|import|export|default|from|async|await|try|catch|throw|finally|typeof|instanceof|in|of|yield|void|delete|null|undefined|true|false',
    typescript: 'const|let|var|function|return|if|else|for|while|do|switch|case|break|continue|new|this|class|extends|import|export|default|from|async|await|try|catch|throw|finally|typeof|instanceof|in|of|yield|void|delete|null|undefined|true|false|interface|type|enum|implements|namespace|declare|as|is|keyof|readonly|abstract',
    python: 'def|class|return|if|elif|else|for|while|break|continue|import|from|as|try|except|finally|raise|with|yield|lambda|pass|global|nonlocal|assert|del|True|False|None|and|or|not|in|is',
    html: 'div|span|html|head|body|script|style|link|meta|title|section|article|nav|header|footer|main|p|a|img|ul|ol|li|h1|h2|h3|h4|h5|h6|form|input|button|table|tr|td|th',
    css: 'color|background|margin|padding|border|display|flex|grid|position|width|height|font|text|align|justify|content|items|gap|overflow|transition|transform|opacity|z-index|top|left|right|bottom|max|min|box|shadow|radius|none|auto|inherit|initial|important',
    go: 'func|package|import|return|if|else|for|range|switch|case|break|continue|type|struct|interface|map|chan|go|defer|select|var|const|nil|true|false|string|int|float64|bool|error|make|len|append|fmt',
    rust: 'fn|let|mut|const|if|else|for|while|loop|match|return|struct|enum|impl|trait|use|pub|mod|self|super|crate|where|async|await|move|ref|true|false|Some|None|Ok|Err|String|Vec|Box|Option|Result',
    java: 'public|private|protected|static|final|class|interface|extends|implements|return|if|else|for|while|do|switch|case|break|continue|new|this|super|try|catch|throw|throws|finally|import|package|void|int|long|double|float|boolean|char|String|null|true|false|abstract|synchronized',
    cpp: 'int|long|double|float|char|bool|void|class|struct|enum|union|public|private|protected|virtual|override|static|const|return|if|else|for|while|do|switch|case|break|continue|new|delete|this|namespace|using|include|define|template|typename|auto|nullptr|true|false|throw|try|catch',
    php: 'function|class|return|if|else|elseif|for|foreach|while|do|switch|case|break|continue|new|this|public|private|protected|static|echo|print|var|const|null|true|false|array|use|namespace|extends|implements|interface|abstract|try|catch|throw|finally|require|include',
    ruby: 'def|class|module|return|if|elsif|else|unless|for|while|do|end|begin|rescue|ensure|raise|yield|block|proc|lambda|attr|require|include|extend|self|super|nil|true|false|puts|print',
    swift: 'func|class|struct|enum|protocol|return|if|else|for|while|switch|case|break|continue|let|var|guard|import|self|super|nil|true|false|throws|throw|try|catch|async|await|public|private|internal|open|override|static|mutating|init|deinit',
    sql: 'SELECT|FROM|WHERE|INSERT|INTO|VALUES|UPDATE|SET|DELETE|CREATE|TABLE|ALTER|DROP|INDEX|JOIN|LEFT|RIGHT|INNER|OUTER|ON|AND|OR|NOT|NULL|AS|ORDER|BY|GROUP|HAVING|LIMIT|OFFSET|UNION|DISTINCT|COUNT|SUM|AVG|MAX|MIN|LIKE|IN|BETWEEN|EXISTS|CASE|WHEN|THEN|ELSE|END|PRIMARY|KEY|FOREIGN|REFERENCES',
    bash: 'if|then|else|elif|fi|for|while|do|done|case|esac|function|return|echo|exit|export|source|alias|local|readonly|declare|set|unset|shift|true|false|cd|ls|grep|awk|sed|cat|mkdir|rm|cp|mv|chmod|chown',
    json: ''
  };

  const kw = kwSets[lang] || kwSets.javascript;
  let result = esc(code);

  // Comments (single-line) â€” must go first
  if (lang === 'python' || lang === 'ruby' || lang === 'bash') {
    result = result.replace(/(#.*?)$/gm, '<span style="color:' + t.comment + ';font-style:italic">$1</span>');
  } else if (lang === 'sql') {
    result = result.replace(/(--.*?)$/gm, '<span style="color:' + t.comment + ';font-style:italic">$1</span>');
  } else if (lang === 'html') {
    result = result.replace(/(&lt;!--[\s\S]*?--&gt;)/g, '<span style="color:' + t.comment + ';font-style:italic">$1</span>');
  } else {
    result = result.replace(/(\/\/.*?)$/gm, '<span style="color:' + t.comment + ';font-style:italic">$1</span>');
    result = result.replace(/(\/\*[\s\S]*?\*\/)/g, '<span style="color:' + t.comment + ';font-style:italic">$1</span>');
  }

  // Strings
  result = result.replace(/("(?:[^"\\]|\\.)*")/g, '<span style="color:' + t.string + '">$1</span>');
  result = result.replace(/('(?:[^'\\]|\\.)*')/g, '<span style="color:' + t.string + '">$1</span>');
  result = result.replace(/(`(?:[^`\\]|\\.)*`)/g, '<span style="color:' + t.string + '">$1</span>');

  // Numbers
  result = result.replace(/\b(\d+\.?\d*)\b/g, '<span style="color:' + t.number + '">$1</span>');

  // Keywords
  if (kw) {
    const kwRe = new RegExp('\\b(' + kw + ')\\b', 'g');
    result = result.replace(kwRe, '<span style="color:' + t.keyword + ';font-weight:500">$1</span>');
  }

  // HTML tags
  if (lang === 'html') {
    result = result.replace(/(&lt;\/?)([\w-]+)/g, '$1<span style="color:' + t.tag + '">$2</span>');
    result = result.replace(/\b([\w-]+)(=)/g, '<span style="color:' + t.attr + '">$1</span>$2');
  }

  // Function calls (word followed by parenthesis)
  result = result.replace(/\b([a-zA-Z_]\w*)\s*(?=\()/g, function(m, name) {
    // Don't re-color keywords
    if (kw && new RegExp('\\b' + name + '\\b').test(kw)) return m;
    return '<span style="color:' + t.func + '">' + name + '</span>';
  });

  return result;
}

function updatePreview() {
  const code = document.getElementById('code-input').value;
  const lang = document.getElementById('lang').value;
  const themeId = document.getElementById('theme').value;
  const t = themes[themeId];
  const padding = document.getElementById('padding').value;
  const br = document.getElementById('border-radius').value;
  const fs = document.getElementById('font-size').value;
  const showDots = document.getElementById('show-dots').checked;
  const showShadow = document.getElementById('show-shadow').checked;
  const showLines = document.getElementById('show-lines').checked;
  const filename = document.getElementById('filename').value;

  const bgObj = bgPresets.find(b => b.id === activeBg);
  const bgCss = bgObj ? bgObj.css : bgPresets[0].css;

  const lines = code.split('\n');
  const highlighted = highlight(code, lang);
  const hlLines = highlighted.split('\n');

  let codeHTML = '';
  hlLines.forEach((line, i) => {
    if (showLines) {
      codeHTML += '<span class="line-num">' + (i + 1) + '</span>' + line + '\n';
    } else {
      codeHTML += line + '\n';
    }
  });

  const shadow = showShadow ? 'box-shadow:0 20px 68px rgba(0,0,0,.55);' : '';

  let dotsHTML = '';
  if (showDots) {
    dotsHTML = '<div class="window-header" style="background:' + t.headerBg + '">' +
      '<div class="window-dots">' +
      '<div class="window-dot" style="background:' + t.headerDot[0] + '"></div>' +
      '<div class="window-dot" style="background:' + t.headerDot[1] + '"></div>' +
      '<div class="window-dot" style="background:' + t.headerDot[2] + '"></div>' +
      '</div>' +
      '<div class="window-title" style="color:' + t.text + '">' + escHtml(filename) + '</div>' +
      '<div style="width:56px"></div>' +
      '</div>';
  }

  const frame = document.getElementById('screenshot-frame');
  frame.innerHTML =
    '<div class="ss-bg" style="background:' + bgCss + ';padding:' + padding + 'px;' + (bgCss === 'transparent' ? '' : 'border-radius:12px') + '">' +
    '<div class="code-window" style="border-radius:' + br + 'px;' + shadow + '">' +
    dotsHTML +
    '<div class="code-body" style="background:' + t.bg + ';color:' + t.text + ';font-size:' + fs + 'px;' + (!showDots ? 'border-radius:' + br + 'px' : 'border-radius:0 0 ' + br + 'px ' + br + 'px') + '">' +
    codeHTML +
    '</div></div></div>';
}

function escHtml(s) { return s.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;'); }

function showToast(msg) {
  const el = document.getElementById('toast');
  el.textContent = msg;
  el.classList.add('show');
  setTimeout(() => el.classList.remove('show'), 2500);
}

// ---- Export as PNG using Canvas ----
function exportPNG() {
  const frame = document.getElementById('screenshot-frame');
  const ssEl = frame.querySelector('.ss-bg');
  if (!ssEl) return;

  // Use a temporary offscreen approach with html-to-canvas-like rendering
  domToCanvas(ssEl).then(canvas => {
    const link = document.createElement('a');
    link.download = (document.getElementById('filename').value || 'code') + '.png';
    link.href = canvas.toDataURL('image/png');
    link.click();
    showToast('PNG downloaded!');
  }).catch(() => showToast('Export failed. Try a simpler layout.'));
}

function copyToClipboard() {
  const frame = document.getElementById('screenshot-frame');
  const ssEl = frame.querySelector('.ss-bg');
  if (!ssEl) return;

  domToCanvas(ssEl).then(canvas => {
    canvas.toBlob(blob => {
      if (blob && navigator.clipboard && navigator.clipboard.write) {
        navigator.clipboard.write([new ClipboardItem({ 'image/png': blob })]).then(() => {
          showToast('Copied to clipboard!');
        }).catch(() => showToast('Copy failed. Try downloading instead.'));
      } else {
        showToast('Clipboard not supported. Try downloading.');
      }
    }, 'image/png');
  }).catch(() => showToast('Copy failed.'));
}

// ---- Minimal DOM-to-Canvas renderer ----
function domToCanvas(el) {
  return new Promise((resolve, reject) => {
    try {
      const rect = el.getBoundingClientRect();
      const scale = 2; // Retina
      const w = Math.ceil(rect.width);
      const h = Math.ceil(rect.height);

      // Serialize DOM to SVG foreignObject
      const clone = el.cloneNode(true);
      // Inline all computed styles
      inlineStyles(el, clone);

      const svgData = '<svg xmlns="http://www.w3.org/2000/svg" width="' + w + '" height="' + h + '">' +
        '<foreignObject width="100%" height="100%">' +
        '<div xmlns="http://www.w3.org/1999/xhtml" style="width:' + w + 'px;height:' + h + 'px;overflow:hidden">' +
        new XMLSerializer().serializeToString(clone) +
        '</div></foreignObject></svg>';

      const img = new Image();
      img.onload = function() {
        const canvas = document.createElement('canvas');
        canvas.width = w * scale;
        canvas.height = h * scale;
        const ctx = canvas.getContext('2d');
        ctx.scale(scale, scale);
        ctx.drawImage(img, 0, 0, w, h);
        resolve(canvas);
      };
      img.onerror = reject;
      img.src = 'data:image/svg+xml;charset=utf-8,' + encodeURIComponent(svgData);
    } catch(e) { reject(e); }
  });
}

function inlineStyles(source, target) {
  const sourceChildren = source.children;
  const targetChildren = target.children;
  const computed = window.getComputedStyle(source);

  // Important properties to inline
  const props = [
    'background', 'background-color', 'background-image',
    'color', 'font-family', 'font-size', 'font-weight', 'font-style',
    'line-height', 'letter-spacing', 'white-space', 'tab-size',
    'padding', 'margin', 'border', 'border-radius',
    'display', 'flex-direction', 'align-items', 'justify-content', 'gap',
    'width', 'height', 'min-width', 'min-height', 'max-width',
    'text-align', 'text-decoration', 'overflow', 'box-shadow',
    'opacity', 'box-sizing', 'position',
    'padding-left', 'padding-right', 'padding-top', 'padding-bottom',
    'margin-left', 'margin-right', 'margin-top', 'margin-bottom'
  ];

  let style = '';
  for (const p of props) {
    const v = computed.getPropertyValue(p);
    if (v && v !== 'none' && v !== 'normal' && v !== '0px' && v !== 'auto' && v !== 'rgba(0, 0, 0, 0)') {
      style += p + ':' + v + ';';
    }
  }
  // Ensure background and color always set
  style += 'background:' + computed.background + ';';
  style += 'color:' + computed.color + ';';

  target.setAttribute('style', (target.getAttribute('style') || '') + ';' + style);

  for (let i = 0; i < sourceChildren.length && i < targetChildren.length; i++) {
    inlineStyles(sourceChildren[i], targetChildren[i]);
  }
}

// ---- Init ----
initBgPresets();
updatePreview();
</script>
<script src="/js/revenue.js" defer></script>
</body>
</html>