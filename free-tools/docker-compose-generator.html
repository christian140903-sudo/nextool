<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Docker Compose Generator — NexTool Free Tools</title>
<meta name="description" content="Build docker-compose.yml files visually. Add services, configure ports, volumes, env vars, restart policies, commands. Presets for LAMP, MEAN, WordPress. 100% free.">
<meta property="og:title" content="Docker Compose Generator — NexTool Free Tools">
<meta property="og:description" content="Build docker-compose.yml files visually. Add services, configure ports, volumes, environment variables. Common presets included.">
<meta property="og:type" content="website">
<meta property="og:url" content="https://nextool.app/free-tools/docker-compose-generator.html">
<meta property="og:image" content="https://nextool.app/assets/og-default.png">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Docker Compose Generator — NexTool Free Tools">
<meta name="twitter:description" content="Build docker-compose.yml files visually. Add services, configure ports, volumes, environment variables. Common presets included.">
<link rel="canonical" href="https://nextool.app/free-tools/docker-compose-generator.html">
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"SoftwareApplication","name":"Docker Compose Generator","description":"Build docker-compose.yml files visually with presets for LAMP, MEAN, WordPress and more.","url":"https://nextool.app/free-tools/docker-compose-generator.html","applicationCategory":"DeveloperApplication","operatingSystem":"Web","offers":{"@type":"Offer","price":"0","priceCurrency":"USD"},"author":{"@type":"Organization","name":"NexTool"}}
</script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{--bg:#050508;--surface:#111118;--surface2:#1a1a24;--primary:#6366f1;--accent:#a855f7;--pink:#ec4899;--text:#e2e8f0;--text-dim:#94a3b8;--radius:12px;--radius-lg:20px;--gradient:linear-gradient(135deg,#6366f1,#a855f7,#ec4899)}
body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--text);line-height:1.6;min-height:100vh}
nav{position:fixed;top:0;left:0;right:0;z-index:100;background:rgba(5,5,8,.85);backdrop-filter:blur(20px);border-bottom:1px solid rgba(99,102,241,.15);padding:0 24px;height:60px;display:flex;align-items:center;justify-content:space-between}
.nav-left{display:flex;align-items:center;gap:24px}
.nav-logo{display:flex;align-items:center;gap:10px;text-decoration:none;font-weight:800;font-size:1.2rem;color:var(--text)}
.nav-logo span{background:var(--gradient);color:#fff;font-size:1.4rem;width:32px;height:32px;display:flex;align-items:center;justify-content:center;border-radius:8px;font-weight:800}
.nav-links{display:flex;gap:16px}
.nav-links a{color:var(--text-dim);text-decoration:none;font-size:.9rem;font-weight:500;transition:color .2s}
.nav-links a:hover{color:var(--text)}
.nav-badge{background:var(--gradient);color:#fff;padding:6px 14px;border-radius:20px;font-size:.8rem;font-weight:600;text-decoration:none;transition:opacity .2s}
.nav-badge:hover{opacity:.85}
main{max-width:1280px;margin:0 auto;padding:84px 24px 40px}
h1{font-size:2.4rem;font-weight:800;margin-bottom:8px}
h1 em{font-style:normal;background:var(--gradient);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.subtitle{color:var(--text-dim);font-size:1.1rem;margin-bottom:24px}
.toolbar{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:24px;align-items:center}
.preset-btn{padding:6px 14px;border-radius:20px;border:1px solid rgba(99,102,241,.25);background:transparent;color:var(--text-dim);font-size:.82rem;font-weight:500;cursor:pointer;transition:all .2s;font-family:inherit}
.preset-btn:hover{background:var(--primary);color:#fff;border-color:var(--primary)}
.preset-btn.active{background:var(--primary);color:#fff;border-color:var(--primary)}
.version-select{padding:6px 12px;border-radius:var(--radius);background:var(--surface2);border:1px solid rgba(99,102,241,.2);color:var(--text);font-family:inherit;font-size:.82rem;outline:none;cursor:pointer}
.stats-row{display:flex;gap:20px;margin-bottom:16px;padding:10px 16px;background:var(--surface);border-radius:var(--radius);border:1px solid rgba(99,102,241,.08)}
.stat{font-size:.82rem;color:var(--text-dim)}.stat strong{color:var(--text);font-weight:700}
.layout{display:grid;grid-template-columns:1fr 1fr;gap:24px}
.panel{background:var(--surface);border-radius:var(--radius-lg);border:1px solid rgba(99,102,241,.12);padding:24px;display:flex;flex-direction:column}
.panel-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
.panel-title{font-size:1rem;font-weight:700}
.btn{padding:8px 18px;border-radius:var(--radius);border:none;font-family:inherit;font-weight:600;font-size:.85rem;cursor:pointer;transition:all .2s;display:inline-flex;align-items:center;gap:6px}
.btn-primary{background:var(--primary);color:#fff}
.btn-primary:hover{opacity:.85}
.btn-outline{background:transparent;border:1px solid rgba(99,102,241,.3);color:var(--text-dim)}
.btn-outline:hover{border-color:var(--primary);color:var(--text)}
.btn-sm{padding:5px 12px;font-size:.78rem}
.btn-danger{background:rgba(239,68,68,.15);color:#f87171;border:1px solid rgba(239,68,68,.2)}
.btn-danger:hover{background:rgba(239,68,68,.25)}
.btn-ghost{background:transparent;color:var(--text-dim);border:none;padding:4px 8px;font-size:.75rem}
.btn-ghost:hover{color:var(--text)}
.services-list{display:flex;flex-direction:column;gap:12px;max-height:calc(100vh - 360px);overflow-y:auto;padding-right:4px}
.services-list::-webkit-scrollbar{width:6px}
.services-list::-webkit-scrollbar-thumb{background:var(--surface2);border-radius:3px}
.service-card{background:var(--surface2);border-radius:var(--radius);padding:16px;border:1px solid rgba(99,102,241,.1);transition:border-color .2s}
.service-card:hover{border-color:rgba(99,102,241,.25)}
.service-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.service-name{font-weight:700;font-size:.95rem;display:flex;align-items:center;gap:8px}
.service-icon{width:20px;height:20px;background:var(--gradient);border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:.7rem;color:#fff;flex-shrink:0}
.service-fields{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.field{display:flex;flex-direction:column;gap:4px}
.field.full{grid-column:1/-1}
.field label{font-size:.75rem;font-weight:600;color:var(--text-dim);text-transform:uppercase;letter-spacing:.5px}
.field-hint{font-size:.68rem;color:var(--text-dim);opacity:.7;font-style:italic;margin-top:1px}
.field input,.field textarea,.field select{padding:7px 10px;background:var(--bg);border:1px solid rgba(99,102,241,.12);border-radius:8px;color:var(--text);font-family:'JetBrains Mono',monospace;font-size:.8rem;outline:none;transition:border-color .2s}
.field input:focus,.field textarea:focus,.field select:focus{border-color:var(--primary)}
.field textarea{min-height:60px;resize:vertical}
.field select{cursor:pointer;font-family:inherit}
.warnings{margin-top:12px}
.warning{display:flex;align-items:flex-start;gap:8px;background:rgba(234,179,8,.08);color:#facc15;padding:10px 14px;border-radius:8px;font-size:.8rem;margin-bottom:6px;border-left:3px solid #facc15}
.warning svg{flex-shrink:0;margin-top:1px}
.warning-error{background:rgba(239,68,68,.08);color:#f87171;border-left-color:#f87171}
.output-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.btn-group{display:flex;gap:8px}
.yaml-output{flex:1;background:var(--bg);border-radius:var(--radius);padding:16px;font-family:'JetBrains Mono',monospace;font-size:.82rem;line-height:1.7;overflow-y:auto;white-space:pre;min-height:400px;border:1px solid rgba(99,102,241,.08)}
.yk{color:#c084fc}.yv{color:#6ee7b7}.yc{color:#64748b}.ys{color:#fbbf24}.yn{color:#f87171}
.line-count{font-size:.75rem;color:var(--text-dim);margin-top:8px;text-align:right}
.empty-state{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px 20px;color:var(--text-dim);text-align:center;gap:12px}
.empty-state svg{opacity:.4}
.empty-state p{font-size:.9rem}
.tips-box{background:var(--surface2);border-radius:var(--radius);padding:14px 16px;margin-top:16px;border:1px solid rgba(99,102,241,.08)}
.tips-title{font-size:.8rem;font-weight:700;color:var(--accent);margin-bottom:8px}
.tips-list{list-style:none;padding:0;margin:0}
.tips-list li{font-size:.78rem;color:var(--text-dim);padding:3px 0;padding-left:16px;position:relative}
.tips-list li::before{content:'';position:absolute;left:0;top:10px;width:6px;height:6px;background:var(--primary);border-radius:50%}
.toast{position:fixed;bottom:24px;left:50%;transform:translateX(-50%) translateY(80px);background:var(--primary);color:#fff;padding:10px 24px;border-radius:var(--radius);font-weight:600;font-size:.9rem;opacity:0;transition:all .3s;z-index:200;pointer-events:none}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
.cta-section{background:var(--surface);border-radius:var(--radius-lg);border:1px solid rgba(99,102,241,.12);padding:48px;text-align:center;margin-top:48px}
.cta-section h2{font-size:1.8rem;font-weight:800;margin-bottom:12px}
.cta-section p{color:var(--text-dim);margin-bottom:24px;max-width:500px;margin-left:auto;margin-right:auto}
.cta-buttons{display:flex;gap:16px;justify-content:center;flex-wrap:wrap}
.cta-btn{padding:12px 28px;border-radius:var(--radius);text-decoration:none;font-weight:700;font-size:.95rem;transition:all .2s}
.cta-btn.gradient{background:var(--gradient);color:#fff}
.cta-btn.gradient:hover{opacity:.85}
.cta-btn.outline{border:1px solid rgba(99,102,241,.3);color:var(--text-dim)}
.cta-btn.outline:hover{border-color:var(--primary);color:var(--text)}
footer{max-width:1280px;margin:0 auto;padding:40px 24px;border-top:1px solid rgba(99,102,241,.08);display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:16px}
footer a{color:var(--text-dim);text-decoration:none;font-size:.85rem;transition:color .2s}
footer a:hover{color:var(--text)}
.footer-links{display:flex;gap:20px}
.footer-copy{color:var(--text-dim);font-size:.8rem}
@media(max-width:768px){.layout{grid-template-columns:1fr}h1{font-size:1.6rem}.nav-links{display:none}.service-fields{grid-template-columns:1fr}.cta-section{padding:32px 20px}footer{flex-direction:column;text-align:center}.stats-row{flex-wrap:wrap;gap:10px}}
</style>
</head>
<body>
<nav>
  <div class="nav-left">
    <a href="/" class="nav-logo"><span>N</span>NexTool</a>
    <div class="nav-links"><a href="/">Home</a><a href="/free-tools/">Free Tools</a></div>
  </div>
  <a href="/pro.html" class="nav-badge">Get Pro</a>
</nav>
<main>
  <h1><em>Docker Compose</em> Generator</h1>
  <p class="subtitle">Visually build docker-compose.yml files. Add services, ports, volumes, env vars, restart policies. Use presets or start from scratch.</p>
  <div class="toolbar">
    <span style="font-size:.85rem;font-weight:600;color:var(--text-dim);margin-right:4px">Presets:</span>
    <button class="preset-btn" onclick="loadPreset('lamp',this)">LAMP</button>
    <button class="preset-btn" onclick="loadPreset('mean',this)">MEAN</button>
    <button class="preset-btn" onclick="loadPreset('wordpress',this)">WordPress</button>
    <button class="preset-btn" onclick="loadPreset('redis-node',this)">Redis + Node</button>
    <button class="preset-btn" onclick="loadPreset('pg-django',this)">PostgreSQL + Django</button>
    <button class="preset-btn" onclick="loadPreset('nginx-express',this)">Nginx + Express</button>
    <button class="preset-btn" onclick="loadPreset('fullstack',this)">Full Stack</button>
    <button class="preset-btn" onclick="loadPreset('monitoring',this)">Monitoring</button>
    <select class="version-select" id="versionSelect" onchange="generateYaml()">
      <option value="3.9">v3.9</option>
      <option value="3.8">v3.8</option>
      <option value="3.7">v3.7</option>
      <option value="3.6">v3.6</option>
      <option value="2.4">v2.4</option>
    </select>
  </div>
  <div class="stats-row">
    <div class="stat">Services: <strong id="statServices">0</strong></div>
    <div class="stat">Ports: <strong id="statPorts">0</strong></div>
    <div class="stat">Volumes: <strong id="statVolumes">0</strong></div>
    <div class="stat">Networks: <strong id="statNetworks">0</strong></div>
    <div class="stat">Lines: <strong id="statLines">0</strong></div>
  </div>
  <div class="layout">
    <div class="panel">
      <div class="panel-header">
        <div class="panel-title">Services</div>
        <div class="btn-group">
          <button class="btn btn-outline btn-sm" onclick="clearAll()">Clear All</button>
          <button class="btn btn-primary btn-sm" onclick="addService()">+ Add Service</button>
        </div>
      </div>
      <div class="services-list" id="servicesList">
        <div class="empty-state" id="emptyState">
          <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="2" y="2" width="20" height="8" rx="2"/><rect x="2" y="14" width="20" height="8" rx="2"/><circle cx="6" cy="6" r="1"/><circle cx="6" cy="18" r="1"/></svg>
          <p>No services yet. Click "Add Service" or use a preset to get started.</p>
        </div>
      </div>
      <div class="warnings" id="warnings"></div>
      <div class="tips-box">
        <div class="tips-title">Quick Tips</div>
        <ul class="tips-list">
          <li>Separate multiple ports with commas: <code>8080:80, 443:443</code></li>
          <li>Use named volumes for persistent data: <code>pgdata:/var/lib/postgresql/data</code></li>
          <li>Set restart policy to <code>unless-stopped</code> for production services</li>
          <li>Add depends_on to control startup order between services</li>
          <li>Networks isolate service groups for better security</li>
        </ul>
      </div>
    </div>
    <div class="panel">
      <div class="output-header">
        <div class="panel-title">docker-compose.yml</div>
        <div class="btn-group">
          <button class="btn btn-outline btn-sm" onclick="copyOutput()">Copy</button>
          <button class="btn btn-primary btn-sm" onclick="downloadOutput()">Download</button>
        </div>
      </div>
      <div class="yaml-output" id="output"></div>
      <div class="line-count" id="lineCount"></div>
    </div>
  </div>
  <section class="cta-section">
    <h2>Containerize Everything</h2>
    <p>Get the NexTool Pro with templates, workflows, and AI prompts for just $29.</p>
    <div class="cta-buttons">
      <a href="/pro.html" class="cta-btn gradient">Get Pro — $29</a>
      <a href="/free-tools/" class="cta-btn outline">Browse 150+ Free Tools &rarr;</a>
    </div>
  </section>
</main>

<!-- AUTO-LINKED by NexTool Engine -->
<div style="margin:2rem 0;padding:1.5rem;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius)">
<p style="font-weight:600;margin-bottom:.5rem">Related Tools</p>
<p><a href="/free-tools/box-shadow-generator.html" style="color:var(--primary);text-decoration:none">CSS Box Shadow Generator</a> · <a href="/free-tools/emoji-picker.html" style="color:var(--primary);text-decoration:none">Emoji Picker & Search</a> · <a href="/free-tools/meta-tag-generator.html" style="color:var(--primary);text-decoration:none">Meta Tag Generator</a> · <a href="/free-tools/color-palette.html" style="color:var(--primary);text-decoration:none">Free Color Palette Generator</a> · <a href="/free-tools/favicon-generator.html" style="color:var(--primary);text-decoration:none">Favicon Generator</a></p>
</div>

<!-- AUTO-LINKED by NexTool Engine -->
<div style="margin:2rem 0;padding:1.5rem;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius)">
<p style="font-weight:600;margin-bottom:.5rem">Related Tools</p>
<p><a href="/free-tools/icon-generator.html" style="color:var(--primary);text-decoration:none">Free Icon Generator</a> · <a href="/free-tools/git-diff-viewer.html" style="color:var(--primary);text-decoration:none">Free Git Diff Viewer</a> · <a href="/free-tools/http-status-codes.html" style="color:var(--primary);text-decoration:none">HTTP Status Code Reference</a></p>
</div>
<footer>
  <div class="footer-links"><a href="/">Home</a><a href="/free-tools/">Tools</a><a href="/blog/">Blog</a><a href="/pro.html">Pro</a><a href="/#contact">Contact</a></div>
  <div class="footer-copy">&copy; 2026 NexTool. All rights reserved.</div>
</footer>
<div class="toast" id="toast">Copied!</div>
<script>
let services = [];
let sid = 0;
const warnSvg = '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>';
const errSvg = '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>';

function makeService(name,image,ports,volumes,env,depends,network,restart,command,healthcheck) {
  return {id:sid++,name:name||'',image:image||'',ports:ports||'',volumes:volumes||'',env:env||'',depends:depends||'',network:network||'',restart:restart||'no',command:command||'',healthcheck:healthcheck||''};
}

function addService(name,image,ports,volumes,env,depends,network,restart,command,healthcheck) {
  services.push(makeService(name,image,ports,volumes,env,depends,network,restart,command,healthcheck));
  renderServices();
  generateYaml();
}

function removeService(id) {
  services = services.filter(s=>s.id!==id);
  renderServices();
  generateYaml();
}

function duplicateService(id) {
  const src = services.find(s=>s.id===id);
  if(!src) return;
  services.push(makeService(src.name+'-copy',src.image,src.ports,src.volumes,src.env,src.depends,src.network,src.restart,src.command,src.healthcheck));
  renderServices();
  generateYaml();
}

function clearAll() {
  services = [];
  sid = 0;
  renderServices();
  generateYaml();
}

function renderServices() {
  const list = document.getElementById('servicesList');
  const empty = document.getElementById('emptyState');
  list.innerHTML = '';
  if(services.length === 0) {
    list.appendChild(empty.cloneNode(true));
    return;
  }
  services.forEach((s,idx) => {
    const card = document.createElement('div');
    card.className = 'service-card';
    card.innerHTML = `
      <div class="service-header">
        <span class="service-name"><span class="service-icon">${idx+1}</span>${s.name||'New Service'}</span>
        <div class="btn-group">
          <button class="btn btn-ghost btn-sm" onclick="duplicateService(${s.id})" title="Duplicate">Clone</button>
          <button class="btn btn-danger btn-sm" onclick="removeService(${s.id})">Remove</button>
        </div>
      </div>
      <div class="service-fields">
        <div class="field"><label>Service Name</label><input value="${esc(s.name)}" placeholder="web" data-id="${s.id}" data-key="name" oninput="updateField(this)"><div class="field-hint">Unique identifier for this service</div></div>
        <div class="field"><label>Image</label><input value="${esc(s.image)}" placeholder="nginx:latest" data-id="${s.id}" data-key="image" oninput="updateField(this)"><div class="field-hint">Docker Hub image name:tag</div></div>
        <div class="field"><label>Ports (host:container)</label><input value="${esc(s.ports)}" placeholder="8080:80, 443:443" data-id="${s.id}" data-key="ports" oninput="updateField(this)"><div class="field-hint">Comma-separated port mappings</div></div>
        <div class="field"><label>Volumes (host:container)</label><input value="${esc(s.volumes)}" placeholder="./data:/var/lib/data" data-id="${s.id}" data-key="volumes" oninput="updateField(this)"><div class="field-hint">Named or bind mount volumes</div></div>
        <div class="field full"><label>Environment (KEY=VALUE)</label><input value="${esc(s.env)}" placeholder="NODE_ENV=production, DB_HOST=db" data-id="${s.id}" data-key="env" oninput="updateField(this)"><div class="field-hint">Comma-separated environment variables</div></div>
        <div class="field"><label>Depends On</label><input value="${esc(s.depends)}" placeholder="db, redis" data-id="${s.id}" data-key="depends" oninput="updateField(this)"></div>
        <div class="field"><label>Networks</label><input value="${esc(s.network)}" placeholder="frontend, backend" data-id="${s.id}" data-key="network" oninput="updateField(this)"></div>
        <div class="field"><label>Restart Policy</label><select data-id="${s.id}" data-key="restart" onchange="updateField(this)"><option value="no" ${s.restart==='no'?'selected':''}>no</option><option value="always" ${s.restart==='always'?'selected':''}>always</option><option value="on-failure" ${s.restart==='on-failure'?'selected':''}>on-failure</option><option value="unless-stopped" ${s.restart==='unless-stopped'?'selected':''}>unless-stopped</option></select></div>
        <div class="field full"><label>Command (override)</label><input value="${esc(s.command)}" placeholder="npm start" data-id="${s.id}" data-key="command" oninput="updateField(this)"><div class="field-hint">Override the default container CMD</div></div>
      </div>`;
    list.appendChild(card);
  });
}

function esc(s){return s.replace(/"/g,'&quot;').replace(/</g,'&lt;')}
function updateField(el) {
  const id = parseInt(el.dataset.id);
  const key = el.dataset.key;
  const svc = services.find(s=>s.id===id);
  if(svc) {
    svc[key] = el.value;
    if(key==='name') {
      el.closest('.service-card').querySelector('.service-name').innerHTML =
        `<span class="service-icon">${services.indexOf(svc)+1}</span>${el.value||'New Service'}`;
    }
    generateYaml();
  }
}

function splitComma(s){return s.split(',').map(x=>x.trim()).filter(Boolean)}

function detectNamedVolumes(services) {
  const named = new Set();
  services.forEach(s => {
    if(!s.volumes) return;
    splitComma(s.volumes).forEach(v => {
      const host = v.split(':')[0];
      if(host && !host.startsWith('.') && !host.startsWith('/') && !host.startsWith('~')) {
        named.add(host);
      }
    });
  });
  return named;
}

function generateYaml() {
  const ver = document.getElementById('versionSelect').value;
  let y = '';
  const h = (t,c) => `<span class="${c}">${t}</span>`;
  y += h('# Generated by NexTool Docker Compose Generator','yc') + '\n';
  y += h('# https://nextool.app/free-tools/docker-compose-generator.html','yc') + '\n';
  y += h('version:','yk') + ' ' + h(`"${ver}"`,'ys') + '\n\n';
  y += h('services:','yk') + '\n';
  const allNetworks = new Set();
  const namedVolumes = detectNamedVolumes(services);
  const warnings = [];
  const errors = [];
  const usedPorts = {};
  const usedNames = {};
  let totalPorts = 0;

  services.forEach(s => {
    if(!s.name) { errors.push('A service has no name defined'); return; }
    if(usedNames[s.name]) { errors.push(`Duplicate service name: "${s.name}"`); }
    usedNames[s.name] = true;

    y += '  ' + h(s.name+':','yk') + '\n';
    if(s.image) y += '    ' + h('image:','yk') + ' ' + h(s.image,'yv') + '\n';
    if(s.command) y += '    ' + h('command:','yk') + ' ' + h(s.command,'yv') + '\n';
    if(s.restart && s.restart !== 'no') y += '    ' + h('restart:','yk') + ' ' + h(s.restart,'yv') + '\n';
    if(s.ports) {
      y += '    ' + h('ports:','yk') + '\n';
      splitComma(s.ports).forEach(p => {
        y += '      - ' + h(`"${p}"`,'ys') + '\n';
        const host = p.split(':')[0];
        if(usedPorts[host]) { warnings.push(`Port ${host} is mapped by both "${usedPorts[host]}" and "${s.name}"`); }
        usedPorts[host] = s.name;
        totalPorts++;
      });
    }
    if(s.volumes) {
      y += '    ' + h('volumes:','yk') + '\n';
      splitComma(s.volumes).forEach(v => { y += '      - ' + h(v,'yv') + '\n'; });
    }
    if(s.env) {
      y += '    ' + h('environment:','yk') + '\n';
      splitComma(s.env).forEach(e => {
        const [k,...rest] = e.split('=');
        const val = rest.join('=');
        if(!val) warnings.push(`${s.name}: env var "${k.trim()}" has no value`);
        y += '      - ' + h(k.trim()+'='+(val||''),'yv') + '\n';
      });
    }
    if(s.depends) {
      y += '    ' + h('depends_on:','yk') + '\n';
      splitComma(s.depends).forEach(d => {
        y += '      - ' + h(d,'yv') + '\n';
        if(!services.find(x=>x.name===d)) errors.push(`"${s.name}" depends on "${d}" which is not defined as a service`);
      });
    }
    if(s.network) {
      y += '    ' + h('networks:','yk') + '\n';
      splitComma(s.network).forEach(n => { y += '      - ' + h(n,'yv') + '\n'; allNetworks.add(n); });
    }
    if(!s.image) warnings.push(`Service "${s.name}" has no image specified`);
    if(s.restart === 'no' && s.depends) warnings.push(`"${s.name}" has dependencies but restart=no; it won't restart if it crashes`);
    y += '\n';
  });

  if(namedVolumes.size > 0) {
    y += h('volumes:','yk') + '\n';
    namedVolumes.forEach(n => { y += '  ' + h(n+':','yk') + '\n'; });
    y += '\n';
  }

  if(allNetworks.size > 0) {
    y += h('networks:','yk') + '\n';
    allNetworks.forEach(n => { y += '  ' + h(n+':','yk') + '\n    ' + h('driver:','yk') + ' ' + h('bridge','yv') + '\n'; });
  }

  document.getElementById('output').innerHTML = y || h('# Add a service to get started','yc');

  const rawLines = getRawYaml().split('\n').length;
  document.getElementById('lineCount').textContent = `${rawLines} lines`;
  document.getElementById('statServices').textContent = services.filter(s=>s.name).length;
  document.getElementById('statPorts').textContent = totalPorts;
  document.getElementById('statVolumes').textContent = namedVolumes.size;
  document.getElementById('statNetworks').textContent = allNetworks.size;
  document.getElementById('statLines').textContent = rawLines;

  const wEl = document.getElementById('warnings');
  wEl.innerHTML = '';
  errors.forEach(w => {
    const d = document.createElement('div');
    d.className = 'warning warning-error';
    d.innerHTML = errSvg + '<span>' + w + '</span>';
    wEl.appendChild(d);
  });
  warnings.forEach(w => {
    const d = document.createElement('div');
    d.className = 'warning';
    d.innerHTML = warnSvg + '<span>' + w + '</span>';
    wEl.appendChild(d);
  });
}

function getRawYaml() {
  const ver = document.getElementById('versionSelect').value;
  let y = `# Generated by NexTool Docker Compose Generator\n# https://nextool.app/free-tools/docker-compose-generator.html\nversion: "${ver}"\n\nservices:\n`;
  const allNets = new Set();
  const namedVols = detectNamedVolumes(services);
  services.forEach(s => {
    if(!s.name) return;
    y += `  ${s.name}:\n`;
    if(s.image) y += `    image: ${s.image}\n`;
    if(s.command) y += `    command: ${s.command}\n`;
    if(s.restart && s.restart !== 'no') y += `    restart: ${s.restart}\n`;
    if(s.ports) { y+='    ports:\n'; splitComma(s.ports).forEach(p=>{y+=`      - "${p}"\n`;}); }
    if(s.volumes) { y+='    volumes:\n'; splitComma(s.volumes).forEach(v=>{y+=`      - ${v}\n`;}); }
    if(s.env) { y+='    environment:\n'; splitComma(s.env).forEach(e=>{y+=`      - ${e.trim()}\n`;}); }
    if(s.depends) { y+='    depends_on:\n'; splitComma(s.depends).forEach(d=>{y+=`      - ${d}\n`;}); }
    if(s.network) { y+='    networks:\n'; splitComma(s.network).forEach(n=>{y+=`      - ${n}\n`; allNets.add(n);}); }
    y += '\n';
  });
  if(namedVols.size>0){y+='volumes:\n';namedVols.forEach(n=>{y+=`  ${n}:\n`;});y+='\n';}
  if(allNets.size>0){y+='networks:\n';allNets.forEach(n=>{y+=`  ${n}:\n    driver: bridge\n`;});}
  return y;
}

function copyOutput(){navigator.clipboard.writeText(getRawYaml()).then(()=>showToast('Copied to clipboard!'))}
function downloadOutput(){const b=new Blob([getRawYaml()],{type:'text/yaml'});const a=document.createElement('a');a.href=URL.createObjectURL(b);a.download='docker-compose.yml';a.click();URL.revokeObjectURL(a.href);showToast('Downloaded docker-compose.yml')}
function showToast(m){const t=document.getElementById('toast');t.textContent=m;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),2000)}

const PRESETS = {
  lamp:[
    {name:'apache',image:'php:8.2-apache',ports:'8080:80',volumes:'./src:/var/www/html',env:'',depends:'db',network:'',restart:'unless-stopped',command:''},
    {name:'db',image:'mysql:8.0',ports:'3306:3306',volumes:'mysql_data:/var/lib/mysql',env:'MYSQL_ROOT_PASSWORD=secret,MYSQL_DATABASE=app,MYSQL_USER=user,MYSQL_PASSWORD=password',depends:'',network:'',restart:'unless-stopped',command:''},
    {name:'phpmyadmin',image:'phpmyadmin:latest',ports:'8081:80',volumes:'',env:'PMA_HOST=db,PMA_PORT=3306',depends:'db',network:'',restart:'unless-stopped',command:''}
  ],
  mean:[
    {name:'app',image:'node:20-alpine',ports:'3000:3000',volumes:'./:/app,/app/node_modules',env:'MONGO_URI=mongodb://mongo:27017/app,NODE_ENV=development',depends:'mongo',network:'',restart:'on-failure',command:'npm start'},
    {name:'mongo',image:'mongo:7',ports:'27017:27017',volumes:'mongo_data:/data/db',env:'',depends:'',network:'',restart:'unless-stopped',command:''}
  ],
  wordpress:[
    {name:'wordpress',image:'wordpress:latest',ports:'8080:80',volumes:'wp_data:/var/www/html',env:'WORDPRESS_DB_HOST=db,WORDPRESS_DB_USER=wp,WORDPRESS_DB_PASSWORD=secret,WORDPRESS_DB_NAME=wordpress',depends:'db',network:'',restart:'unless-stopped',command:''},
    {name:'db',image:'mysql:8.0',ports:'',volumes:'db_data:/var/lib/mysql',env:'MYSQL_ROOT_PASSWORD=rootsecret,MYSQL_DATABASE=wordpress,MYSQL_USER=wp,MYSQL_PASSWORD=secret',depends:'',network:'',restart:'unless-stopped',command:''}
  ],
  'redis-node':[
    {name:'app',image:'node:20-alpine',ports:'3000:3000',volumes:'./:/app,/app/node_modules',env:'REDIS_URL=redis://redis:6379,NODE_ENV=production',depends:'redis',network:'',restart:'on-failure',command:'npm start'},
    {name:'redis',image:'redis:7-alpine',ports:'6379:6379',volumes:'redis_data:/data',env:'',depends:'',network:'',restart:'unless-stopped',command:'redis-server --appendonly yes'}
  ],
  'pg-django':[
    {name:'web',image:'python:3.12-slim',ports:'8000:8000',volumes:'./:/app',env:'DATABASE_URL=postgres://user:pass@db:5432/app,DEBUG=1',depends:'db',network:'',restart:'on-failure',command:'python manage.py runserver 0.0.0.0:8000'},
    {name:'db',image:'postgres:16-alpine',ports:'5432:5432',volumes:'pg_data:/var/lib/postgresql/data',env:'POSTGRES_USER=user,POSTGRES_PASSWORD=pass,POSTGRES_DB=app',depends:'',network:'',restart:'unless-stopped',command:''}
  ],
  'nginx-express':[
    {name:'nginx',image:'nginx:alpine',ports:'80:80,443:443',volumes:'./nginx.conf:/etc/nginx/nginx.conf:ro',env:'',depends:'api',network:'',restart:'unless-stopped',command:''},
    {name:'api',image:'node:20-alpine',ports:'',volumes:'./:/app,/app/node_modules',env:'NODE_ENV=production,PORT=3000',depends:'',network:'',restart:'on-failure',command:'npm start'}
  ],
  fullstack:[
    {name:'frontend',image:'node:20-alpine',ports:'3000:3000',volumes:'./frontend:/app',env:'NEXT_PUBLIC_API_URL=http://localhost:4000',depends:'api',network:'app-net',restart:'on-failure',command:'npm run dev'},
    {name:'api',image:'node:20-alpine',ports:'4000:4000',volumes:'./backend:/app',env:'DATABASE_URL=postgres://user:pass@db:5432/app,REDIS_URL=redis://redis:6379',depends:'db, redis',network:'app-net',restart:'on-failure',command:'npm run dev'},
    {name:'db',image:'postgres:16-alpine',ports:'5432:5432',volumes:'pg_data:/var/lib/postgresql/data',env:'POSTGRES_USER=user,POSTGRES_PASSWORD=pass,POSTGRES_DB=app',depends:'',network:'app-net',restart:'unless-stopped',command:''},
    {name:'redis',image:'redis:7-alpine',ports:'',volumes:'redis_data:/data',env:'',depends:'',network:'app-net',restart:'unless-stopped',command:''}
  ],
  monitoring:[
    {name:'prometheus',image:'prom/prometheus:latest',ports:'9090:9090',volumes:'./prometheus.yml:/etc/prometheus/prometheus.yml:ro,prom_data:/prometheus',env:'',depends:'',network:'monitor',restart:'unless-stopped',command:''},
    {name:'grafana',image:'grafana/grafana:latest',ports:'3000:3000',volumes:'grafana_data:/var/lib/grafana',env:'GF_SECURITY_ADMIN_PASSWORD=admin,GF_USERS_ALLOW_SIGN_UP=false',depends:'prometheus',network:'monitor',restart:'unless-stopped',command:''},
    {name:'node-exporter',image:'prom/node-exporter:latest',ports:'9100:9100',volumes:'',env:'',depends:'',network:'monitor',restart:'unless-stopped',command:''}
  ]
};

function loadPreset(key, btnEl) {
  services = [];
  sid = 0;
  PRESETS[key].forEach(s => services.push(makeService(s.name,s.image,s.ports,s.volumes,s.env,s.depends,s.network,s.restart,s.command,s.healthcheck)));
  document.querySelectorAll('.preset-btn').forEach(b => b.classList.remove('active'));
  if(btnEl) btnEl.classList.add('active');
  renderServices();
  generateYaml();
}

/* Initialize with a default service */
addService('web','nginx:alpine','8080:80','./html:/usr/share/nginx/html','','','','unless-stopped','','');
</script>
<script src="/js/revenue.js" defer></script>
<script src="/js/lead-capture.js" defer></script>
<script src="/js/analytics-lite.js" defer></script>
</body>
</html>
