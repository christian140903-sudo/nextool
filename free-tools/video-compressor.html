<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Free Video Compressor Online — Reduce File Size | NexTool</title>
<meta name="description" content="Compress videos online for free. Reduce MP4, WebM, MOV file size up to 90% in your browser. No upload to servers, 100% private. Adjust quality and preview before download.">
<meta name="keywords" content="video compressor, compress video online, reduce video size, free video compressor, MP4 compressor, WebM compressor, video size reducer, NexTool">
<meta name="robots" content="index, follow">
<meta property="og:title" content="Free Video Compressor Online — Reduce File Size | NexTool">
<meta property="og:description" content="Compress videos up to 90% smaller in your browser. No upload, no signup. Supports MP4, WebM, MOV.">
<meta property="og:type" content="website">
<meta property="og:url" content="https://nextool.app/free-tools/video-compressor.html">
<meta property="og:image" content="https://nextool.app/assets/og-default.png">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<link rel="canonical" href="https://nextool.app/free-tools/video-compressor.html">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Free Video Compressor Online — Reduce File Size | NexTool">
<meta name="twitter:description" content="Compress videos up to 90% smaller in your browser. No upload, no signup. 100% free.">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"SoftwareApplication","name":"NexTool Video Compressor","applicationCategory":"MultimediaApplication","operatingSystem":"Web","offers":{"@type":"Offer","price":"0","priceCurrency":"USD"},"description":"Free online video compressor. Reduce video file size up to 90% directly in your browser. Supports MP4, WebM, MOV. No upload required."}
</script>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{--bg:#050508;--surface:#111118;--surface2:#1a1a24;--border:#2a2a3a;--text:#e4e4eb;--text2:#9494a8;--primary:#6366f1;--accent:#a855f7;--pink:#ec4899;--green:#22c55e;--red:#ef4444;--cyan:#22d3ee;--yellow:#eab308;--radius:12px;--glass:rgba(17,17,24,0.7)}
html{scroll-behavior:smooth}
body{font-family:'Inter',system-ui,sans-serif;background:var(--bg);color:var(--text);line-height:1.6;min-height:100vh;overflow-x:hidden}
/* NAV */
.nav{position:sticky;top:0;z-index:100;background:rgba(5,5,8,0.85);backdrop-filter:blur(20px);border-bottom:1px solid var(--border);padding:0 2rem;height:64px;display:flex;align-items:center;justify-content:space-between}
.nav-logo{font-size:1.4rem;font-weight:800;background:linear-gradient(135deg,var(--primary),var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent;text-decoration:none}
.nav-links{display:flex;align-items:center;gap:1.5rem}
.nav-links a{color:var(--text2);text-decoration:none;font-size:.875rem;font-weight:500;transition:color .2s}
.nav-links a:hover{color:var(--text)}
.nav-cta{background:linear-gradient(135deg,var(--primary),var(--accent));color:#fff!important;padding:.5rem 1.2rem;border-radius:8px;font-weight:600;-webkit-text-fill-color:#fff!important}
.nav-cta:hover{opacity:.9}
.nav-toggle{display:none;background:none;border:none;color:var(--text);font-size:1.5rem;cursor:pointer}
/* HERO */
.hero{text-align:center;padding:3rem 1.5rem 2rem;max-width:700px;margin:0 auto}
.hero h1{font-size:2.2rem;font-weight:800;line-height:1.2;margin-bottom:.75rem}
.hero h1 span{background:linear-gradient(135deg,var(--primary),var(--accent),var(--pink));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.hero p{color:var(--text2);font-size:1rem}
/* TOOL */
.tool-container{max-width:1000px;margin:0 auto;padding:0 1.5rem 3rem}
/* DROP ZONE */
.drop-zone{border:2px dashed var(--border);border-radius:var(--radius);padding:3rem 2rem;text-align:center;cursor:pointer;transition:all .3s;background:var(--glass);backdrop-filter:blur(16px)}
.drop-zone:hover,.drop-zone.dragover{border-color:var(--primary);background:rgba(99,102,241,.06)}
.drop-zone-icon{font-size:3rem;margin-bottom:1rem;opacity:.6}
.drop-zone h3{font-size:1.1rem;font-weight:600;margin-bottom:.5rem}
.drop-zone p{color:var(--text2);font-size:.85rem}
.drop-zone input{display:none}
/* SETTINGS */
.settings-panel{background:var(--glass);backdrop-filter:blur(16px);border:1px solid var(--border);border-radius:var(--radius);padding:1.5rem;margin-top:1.5rem;display:none}
.settings-panel.active{display:block}
.settings-grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:1.5rem;margin-bottom:1.5rem}
.setting-group label{display:block;font-size:.8rem;font-weight:600;color:var(--text2);margin-bottom:.5rem;text-transform:uppercase;letter-spacing:.5px}
.setting-group select,.setting-group input[type="number"]{width:100%;background:var(--surface2);border:1px solid var(--border);color:var(--text);padding:.5rem .75rem;border-radius:8px;font-size:.875rem;font-family:inherit;outline:none;transition:border-color .2s}
.setting-group select:focus,.setting-group input[type="number"]:focus{border-color:var(--primary)}
.setting-group select{appearance:none;padding-right:2rem;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%239494a8' viewBox='0 0 16 16'%3E%3Cpath d='M8 11L3 6h10z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right .6rem center}
.quality-hint{font-size:.75rem;color:var(--text2);margin-top:.3rem}
/* BUTTONS */
.btn-row{display:flex;gap:.75rem;flex-wrap:wrap}
.btn{padding:.6rem 1.5rem;border-radius:8px;font-size:.875rem;font-weight:600;cursor:pointer;border:none;font-family:inherit;transition:all .2s}
.btn-primary{background:linear-gradient(135deg,var(--primary),var(--accent));color:#fff}
.btn-primary:hover{opacity:.9;transform:translateY(-1px)}
.btn-primary:disabled{opacity:.4;cursor:not-allowed;transform:none}
.btn-secondary{background:var(--surface2);border:1px solid var(--border);color:var(--text)}
.btn-secondary:hover{border-color:var(--primary)}
.btn-danger{background:rgba(239,68,68,.15);border:1px solid rgba(239,68,68,.3);color:var(--red)}
.btn-danger:hover{background:rgba(239,68,68,.25)}
/* PROGRESS */
.progress-section{margin-top:1.5rem;display:none}
.progress-section.active{display:block}
.progress-bar-bg{width:100%;height:8px;background:var(--surface2);border-radius:4px;overflow:hidden;margin-bottom:.5rem}
.progress-bar-fill{height:100%;background:linear-gradient(90deg,var(--primary),var(--accent));border-radius:4px;width:0%;transition:width .3s}
.progress-text{font-size:.8rem;color:var(--text2);display:flex;justify-content:space-between}
/* RESULTS */
.results-section{margin-top:1.5rem;display:none}
.results-section.active{display:block}
.stats-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:1rem;margin-bottom:1.5rem}
.stat-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:1rem;text-align:center}
.stat-value{font-size:1.4rem;font-weight:800;margin-bottom:.25rem}
.stat-value.green{color:var(--green)}
.stat-value.primary{color:var(--primary)}
.stat-value.accent{color:var(--accent)}
.stat-value.pink{color:var(--pink)}
.stat-label{font-size:.75rem;color:var(--text2);text-transform:uppercase;letter-spacing:.5px}
/* PREVIEW */
.preview-grid{display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin-bottom:1.5rem}
.preview-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);overflow:hidden}
.preview-header{padding:.6rem 1rem;border-bottom:1px solid var(--border);font-size:.8rem;font-weight:600;color:var(--text2);display:flex;justify-content:space-between;align-items:center;background:rgba(26,26,36,0.5)}
.preview-card video{width:100%;display:block;background:#000;max-height:360px}
/* CTA */
.cta-section{text-align:center;padding:4rem 1.5rem;max-width:700px;margin:0 auto}
.cta-section h2{font-size:1.8rem;font-weight:800;margin-bottom:.75rem}
.cta-section h2 span{background:linear-gradient(135deg,var(--primary),var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.cta-section p{color:var(--text2);margin-bottom:1.5rem}
.cta-btn{display:inline-block;background:linear-gradient(135deg,var(--primary),var(--accent));color:#fff;padding:.75rem 2rem;border-radius:10px;font-weight:700;text-decoration:none;font-size:1rem;transition:transform .2s,box-shadow .2s}
.cta-btn:hover{transform:translateY(-2px);box-shadow:0 8px 30px rgba(99,102,241,.3)}
/* FOOTER */
.footer{border-top:1px solid var(--border);padding:3rem 2rem 2rem;max-width:1200px;margin:0 auto}
.footer-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:2rem;margin-bottom:2rem}
.footer-col h4{font-size:.85rem;font-weight:700;margin-bottom:.75rem;color:var(--text)}
.footer-col a{display:block;color:var(--text2);text-decoration:none;font-size:.8rem;margin-bottom:.4rem;transition:color .2s}
.footer-col a:hover{color:var(--primary)}
.footer-bottom{text-align:center;color:var(--text2);font-size:.75rem;padding-top:1.5rem;border-top:1px solid var(--border)}
/* FADE IN */
.fade-in{opacity:0;transform:translateY(20px);transition:opacity .6s,transform .6s}
.fade-in.visible{opacity:1;transform:translateY(0)}
/* TOAST */
.toast{position:fixed;bottom:2rem;left:50%;transform:translateX(-50%) translateY(80px);background:var(--surface2);border:1px solid var(--border);color:var(--text);padding:.6rem 1.2rem;border-radius:10px;font-size:.85rem;font-weight:500;z-index:200;transition:transform .3s;pointer-events:none}
.toast.show{transform:translateX(-50%) translateY(0)}
/* SPINNER */
@keyframes spin{to{transform:rotate(360deg)}}
.spinner{display:inline-block;width:16px;height:16px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:spin .6s linear infinite;margin-right:.5rem;vertical-align:middle}
/* RESPONSIVE */
@media(max-width:768px){
  .nav-links{display:none;position:absolute;top:64px;left:0;right:0;background:var(--bg);border-bottom:1px solid var(--border);flex-direction:column;padding:1rem 2rem;gap:1rem}
  .nav-links.open{display:flex}
  .nav-toggle{display:block}
  .hero h1{font-size:1.6rem}
  .settings-grid{grid-template-columns:1fr}
  .stats-grid{grid-template-columns:1fr 1fr}
  .preview-grid{grid-template-columns:1fr}
  .footer-grid{grid-template-columns:1fr}
  .drop-zone{padding:2rem 1rem}
}
</style>
</head>
<body>

<nav class="nav">
  <a href="/" class="nav-logo">NexTool</a>
  <button class="nav-toggle" onclick="document.querySelector('.nav-links').classList.toggle('open')" aria-label="Menu">&#9776;</button>
  <div class="nav-links">
    <a href="/">Home</a>
    <a href="/free-tools/">Tools</a>
    <a href="/free-tools/">Free Tools</a>
    <a href="/blog/">Blog</a>
    <a href="/pro.html" class="nav-cta">Get Pro — $29</a>
  </div>
</nav>

<section class="hero fade-in">
  <h1>Free <span>Video Compressor</span> Online</h1>
  <p class="tool-summary" style="color:#94a3b8;font-size:15px;line-height:1.6;margin-bottom:24px;max-width:700px;margin-left:auto;margin-right:auto;">Compress video files up to 90% smaller directly in your browser. Supports MP4, WebM, MOV, and AVI. Choose your quality level, preview the result, and download -- all without uploading to any server. 100% private, 100% free.</p>
</section>

<div class="tool-container fade-in">
  <!-- Drop Zone -->
  <div class="drop-zone" id="dropZone">
    <div class="drop-zone-icon">
      <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><polygon points="23 7 16 12 23 17 23 7"/><rect x="1" y="5" width="15" height="14" rx="2" ry="2"/></svg>
    </div>
    <h3>Drop your video here or click to browse</h3>
    <p>Supports MP4, WebM, MOV, AVI -- up to 500MB</p>
    <input type="file" id="fileInput" accept="video/mp4,video/webm,video/quicktime,video/x-msvideo,video/avi,.mp4,.webm,.mov,.avi">
  </div>

  <!-- Settings -->
  <div class="settings-panel" id="settingsPanel">
    <div class="settings-grid">
      <div class="setting-group">
        <label>Quality</label>
        <select id="qualitySelect">
          <option value="high">High (best quality)</option>
          <option value="medium" selected>Medium (balanced)</option>
          <option value="low">Low (smallest file)</option>
        </select>
        <div class="quality-hint" id="qualityHint">~2.5 Mbps video bitrate</div>
      </div>
      <div class="setting-group">
        <label>Resolution</label>
        <select id="resolutionSelect">
          <option value="original">Original</option>
          <option value="1080">1080p</option>
          <option value="720" selected>720p</option>
          <option value="480">480p</option>
          <option value="360">360p</option>
        </select>
        <div class="quality-hint">Downscaling reduces file size</div>
      </div>
      <div class="setting-group">
        <label>Frame Rate</label>
        <select id="fpsSelect">
          <option value="original">Original</option>
          <option value="30" selected>30 fps</option>
          <option value="24">24 fps</option>
          <option value="15">15 fps</option>
        </select>
        <div class="quality-hint">Lower FPS = smaller file</div>
      </div>
    </div>
    <div class="btn-row">
      <button class="btn btn-primary" id="compressBtn" onclick="startCompression()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align:middle;margin-right:6px"><polyline points="16 16 12 12 8 16"/><line x1="12" y1="12" x2="12" y2="21"/><path d="M20.39 18.39A5 5 0 0 0 18 9h-1.26A8 8 0 1 0 3 16.3"/></svg>
        Compress Video
      </button>
      <button class="btn btn-secondary" onclick="resetAll()">Clear</button>
    </div>
  </div>

  <!-- Progress -->
  <div class="progress-section" id="progressSection">
    <div class="progress-bar-bg">
      <div class="progress-bar-fill" id="progressFill"></div>
    </div>
    <div class="progress-text">
      <span id="progressLabel">Preparing...</span>
      <span id="progressPercent">0%</span>
    </div>
  </div>

  <!-- Results -->
  <div class="results-section" id="resultsSection">
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-value primary" id="statOriginal">--</div>
        <div class="stat-label">Original Size</div>
      </div>
      <div class="stat-card">
        <div class="stat-value green" id="statCompressed">--</div>
        <div class="stat-label">Compressed Size</div>
      </div>
      <div class="stat-card">
        <div class="stat-value accent" id="statReduction">--</div>
        <div class="stat-label">Reduction</div>
      </div>
      <div class="stat-card">
        <div class="stat-value pink" id="statTime">--</div>
        <div class="stat-label">Time Taken</div>
      </div>
    </div>

    <div class="preview-grid">
      <div class="preview-card">
        <div class="preview-header">
          <span>Original</span>
          <span id="originalMeta"></span>
        </div>
        <video id="originalVideo" controls playsinline></video>
      </div>
      <div class="preview-card">
        <div class="preview-header">
          <span>Compressed</span>
          <span id="compressedMeta"></span>
        </div>
        <video id="compressedVideo" controls playsinline></video>
      </div>
    </div>

    <div class="btn-row">
      <button class="btn btn-primary" id="downloadBtn" onclick="downloadCompressed()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align:middle;margin-right:6px"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
        Download Compressed Video
      </button>
      <button class="btn btn-secondary" onclick="startCompression()">Re-compress</button>
      <button class="btn btn-danger" onclick="resetAll()">Start Over</button>
    </div>
  </div>
</div>

<section class="cta-section fade-in">
  <h2>Need something <span>more powerful</span>?</h2>
  <p>Let us build it for you. Custom APIs, dashboards, automations &mdash; whatever you need.</p>
  <a href="/#contact" class="cta-btn">Start a Project &rarr;</a>
</section>

<!-- Cross Promo -->
<section style="max-width:900px;margin:40px auto;padding:0 24px;">
<div style="background:linear-gradient(135deg,rgba(99,102,241,0.1),rgba(168,85,247,0.08));border:1px solid rgba(99,102,241,0.15);border-radius:20px;padding:32px 28px;text-align:center;">
<div style="font-size:13px;color:#818cf8;font-weight:600;text-transform:uppercase;letter-spacing:1px;margin-bottom:8px;">Founding Member</div>
<h3 style="font-size:22px;font-weight:800;color:#fff;margin:0 0 8px;">Get NexTool Pro</h3>
<p style="color:#94a3b8;font-size:14px;margin:0 auto 20px;max-width:500px;">No banners, clean output, enhanced features on all 250+ tools. One-time payment.</p>
<div style="display:flex;align-items:center;justify-content:center;gap:12px;flex-wrap:wrap;">
<a href="/pro.html" style="display:inline-block;padding:12px 28px;background:linear-gradient(135deg,#6366f1,#a855f7,#ec4899);color:#fff;border-radius:10px;font-weight:700;font-size:15px;text-decoration:none;">$29 — Get Pro</a>
<a href="/free-tools/" style="color:#94a3b8;font-size:14px;text-decoration:none;">Browse 250+ Free Tools &rarr;</a>
</div>
</div>
</section>

<footer class="footer fade-in">
  <div class="footer-grid">
    <div class="footer-col">
      <h4>Products</h4>
      <a href="/free-tools/">250+ Free Tools</a>
<a href="/pro.html">NexTool Pro</a>
<a href="/workspace.html">Workspace</a>
    </div>
    <div class="footer-col">
      <h4>Explore</h4>
      <a href="/free-tools/">Free Tools</a><a href="/blog/">Blog</a><a href="/pro.html">FAQ</a><a href="/pro.html">Pro — $29</a>
    </div>
    <div class="footer-col">
      <h4>Ecosystem</h4>
      <a href="/">NexTool Home</a><a href="/#contact">Contact</a><a href="https://github.com/christian140903-sudo/nextool" target="_blank">GitHub</a>
    </div>
  </div>
  <div class="footer-bottom">&copy; 2026 NexTool. AI-powered tools for everyone.</div>
</footer>

<div class="toast" id="toast"></div>

<script>
/* ========== STATE ========== */
let originalFile = null;
let originalUrl = null;
let compressedBlob = null;
let compressedUrl = null;
let isCompressing = false;

const dropZone = document.getElementById('dropZone');
const fileInput = document.getElementById('fileInput');
const settingsPanel = document.getElementById('settingsPanel');
const progressSection = document.getElementById('progressSection');
const resultsSection = document.getElementById('resultsSection');
const progressFill = document.getElementById('progressFill');
const progressLabel = document.getElementById('progressLabel');
const progressPercent = document.getElementById('progressPercent');
const qualitySelect = document.getElementById('qualitySelect');
const qualityHint = document.getElementById('qualityHint');
const resolutionSelect = document.getElementById('resolutionSelect');
const fpsSelect = document.getElementById('fpsSelect');
const compressBtn = document.getElementById('compressBtn');

/* ========== QUALITY PRESETS ========== */
const PRESETS = {
  high: { videoBitrate: 5000000, audioBitrate: 128000, label: '~5 Mbps video bitrate' },
  medium: { videoBitrate: 2500000, audioBitrate: 96000, label: '~2.5 Mbps video bitrate' },
  low: { videoBitrate: 1000000, audioBitrate: 64000, label: '~1 Mbps video bitrate' }
};

qualitySelect.addEventListener('change', function() {
  qualityHint.textContent = PRESETS[this.value].label;
});

/* ========== DROP ZONE ========== */
dropZone.addEventListener('click', function() { fileInput.click(); });
dropZone.addEventListener('dragover', function(e) { e.preventDefault(); dropZone.classList.add('dragover'); });
dropZone.addEventListener('dragleave', function() { dropZone.classList.remove('dragover'); });
dropZone.addEventListener('drop', function(e) {
  e.preventDefault();
  dropZone.classList.remove('dragover');
  if (e.dataTransfer.files.length) handleFile(e.dataTransfer.files[0]);
});
fileInput.addEventListener('change', function() {
  if (this.files.length) handleFile(this.files[0]);
});

function handleFile(file) {
  if (!file.type.startsWith('video/') && !file.name.match(/\.(mp4|webm|mov|avi)$/i)) {
    showToast('Please select a video file (MP4, WebM, MOV, AVI)');
    return;
  }
  if (file.size > 500 * 1024 * 1024) {
    showToast('File too large. Maximum 500MB.');
    return;
  }
  originalFile = file;
  if (originalUrl) URL.revokeObjectURL(originalUrl);
  originalUrl = URL.createObjectURL(file);

  dropZone.innerHTML = '<div class="drop-zone-icon"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="' + getComputedStyle(document.documentElement).getPropertyValue('--green').trim() + '" stroke-width="1.5"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg></div>' +
    '<h3>' + escapeHtml(file.name) + '</h3>' +
    '<p>' + formatBytes(file.size) + ' -- Click or drop to change file</p>';
  dropZone.onclick = function() { fileInput.click(); };

  settingsPanel.classList.add('active');
  resultsSection.classList.remove('active');
  progressSection.classList.remove('active');

  // Auto-detect resolution and set default
  var v = document.createElement('video');
  v.preload = 'metadata';
  v.onloadedmetadata = function() {
    var h = v.videoHeight;
    if (h >= 1080) resolutionSelect.value = '720';
    else if (h >= 720) resolutionSelect.value = '480';
    else resolutionSelect.value = 'original';
    URL.revokeObjectURL(v.src);
  };
  v.src = URL.createObjectURL(file);
}

/* ========== COMPRESSION ENGINE ========== */
function startCompression() {
  if (!originalFile || isCompressing) return;
  isCompressing = true;
  compressBtn.disabled = true;
  compressBtn.innerHTML = '<span class="spinner"></span>Compressing...';

  progressSection.classList.add('active');
  resultsSection.classList.remove('active');
  progressFill.style.width = '0%';
  progressLabel.textContent = 'Loading video...';
  progressPercent.textContent = '0%';

  var preset = PRESETS[qualitySelect.value];
  var targetRes = resolutionSelect.value;
  var targetFps = fpsSelect.value;
  var startTime = Date.now();

  // Load video into hidden element
  var sourceVideo = document.createElement('video');
  sourceVideo.muted = true;
  sourceVideo.playsInline = true;
  sourceVideo.preload = 'auto';

  sourceVideo.onloadedmetadata = function() {
    var origW = sourceVideo.videoWidth;
    var origH = sourceVideo.videoHeight;
    var origDuration = sourceVideo.duration;

    // Determine output dimensions
    var outW = origW;
    var outH = origH;
    if (targetRes !== 'original') {
      var targetH = parseInt(targetRes);
      if (origH > targetH) {
        var scale = targetH / origH;
        outW = Math.round(origW * scale);
        outH = targetH;
        // Ensure even dimensions (required by many codecs)
        outW = outW % 2 === 0 ? outW : outW + 1;
        outH = outH % 2 === 0 ? outH : outH + 1;
      }
    }

    // Determine FPS
    var fps = targetFps === 'original' ? 30 : parseInt(targetFps);

    progressLabel.textContent = 'Setting up canvas (' + outW + 'x' + outH + ')...';
    progressFill.style.width = '5%';
    progressPercent.textContent = '5%';

    // Create canvas for re-encoding
    var canvas = document.createElement('canvas');
    canvas.width = outW;
    canvas.height = outH;
    var ctx = canvas.getContext('2d');

    // Get canvas stream
    var canvasStream = canvas.captureStream(fps);

    // Try to capture audio from the source video
    var combinedStream;
    try {
      var audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      var source = audioCtx.createMediaElementSource(sourceVideo);
      var dest = audioCtx.createMediaStreamDestination();
      source.connect(dest);
      source.connect(audioCtx.destination); // keep audio playing
      var audioTrack = dest.stream.getAudioTracks()[0];
      if (audioTrack) {
        combinedStream = new MediaStream([
          canvasStream.getVideoTracks()[0],
          audioTrack
        ]);
      } else {
        combinedStream = canvasStream;
      }
    } catch(e) {
      combinedStream = canvasStream;
    }

    // Determine supported MIME type
    var mimeType = 'video/webm;codecs=vp8,opus';
    if (MediaRecorder.isTypeSupported('video/webm;codecs=vp9,opus')) {
      mimeType = 'video/webm;codecs=vp9,opus';
    } else if (MediaRecorder.isTypeSupported('video/webm;codecs=vp8,opus')) {
      mimeType = 'video/webm;codecs=vp8,opus';
    } else if (MediaRecorder.isTypeSupported('video/webm')) {
      mimeType = 'video/webm';
    }

    var recorder;
    try {
      recorder = new MediaRecorder(combinedStream, {
        mimeType: mimeType,
        videoBitsPerSecond: preset.videoBitrate,
        audioBitsPerSecond: preset.audioBitrate
      });
    } catch(e) {
      // Fallback without audio bitrate
      try {
        recorder = new MediaRecorder(combinedStream, {
          mimeType: 'video/webm',
          videoBitsPerSecond: preset.videoBitrate
        });
      } catch(e2) {
        recorder = new MediaRecorder(combinedStream);
      }
    }

    var chunks = [];
    recorder.ondataavailable = function(e) {
      if (e.data.size > 0) chunks.push(e.data);
    };

    recorder.onstop = function() {
      var elapsed = ((Date.now() - startTime) / 1000).toFixed(1);

      if (compressedUrl) URL.revokeObjectURL(compressedUrl);
      compressedBlob = new Blob(chunks, { type: 'video/webm' });
      compressedUrl = URL.createObjectURL(compressedBlob);

      progressFill.style.width = '100%';
      progressPercent.textContent = '100%';
      progressLabel.textContent = 'Done!';

      // Stats
      var origSize = originalFile.size;
      var compSize = compressedBlob.size;
      var reduction = ((1 - compSize / origSize) * 100).toFixed(1);

      document.getElementById('statOriginal').textContent = formatBytes(origSize);
      document.getElementById('statCompressed').textContent = formatBytes(compSize);
      document.getElementById('statReduction').textContent = reduction + '%';
      document.getElementById('statTime').textContent = elapsed + 's';

      // Preview
      var origVid = document.getElementById('originalVideo');
      origVid.src = originalUrl;
      document.getElementById('originalMeta').textContent = formatBytes(origSize);

      var compVid = document.getElementById('compressedVideo');
      compVid.src = compressedUrl;
      document.getElementById('compressedMeta').textContent = formatBytes(compSize) + ' (WebM)';

      resultsSection.classList.add('active');

      isCompressing = false;
      compressBtn.disabled = false;
      compressBtn.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align:middle;margin-right:6px"><polyline points="16 16 12 12 8 16"/><line x1="12" y1="12" x2="12" y2="21"/><path d="M20.39 18.39A5 5 0 0 0 18 9h-1.26A8 8 0 1 0 3 16.3"/></svg>Compress Video';

      if (parseFloat(reduction) < 0) {
        showToast('Compressed file is larger than original. Try a lower quality setting.');
      } else {
        showToast('Compressed! Saved ' + reduction + '% (' + formatBytes(origSize - compSize) + ')');
      }
    };

    // Start recording
    recorder.start(100); // collect data every 100ms

    progressLabel.textContent = 'Compressing video...';
    progressFill.style.width = '10%';
    progressPercent.textContent = '10%';

    // Play video and draw frames to canvas
    sourceVideo.currentTime = 0;
    sourceVideo.play().then(function() {
      var frameInterval = 1000 / fps;
      var lastFrameTime = 0;

      function drawFrame(timestamp) {
        if (sourceVideo.ended || sourceVideo.paused) {
          // Stop recording after a brief delay to flush
          setTimeout(function() { recorder.stop(); }, 200);
          return;
        }

        // Update progress
        if (origDuration > 0) {
          var pct = Math.min(95, 10 + (sourceVideo.currentTime / origDuration) * 85);
          progressFill.style.width = pct.toFixed(1) + '%';
          progressPercent.textContent = Math.round(pct) + '%';
          progressLabel.textContent = 'Compressing... ' + formatTime(sourceVideo.currentTime) + ' / ' + formatTime(origDuration);
        }

        ctx.drawImage(sourceVideo, 0, 0, outW, outH);
        requestAnimationFrame(drawFrame);
      }

      requestAnimationFrame(drawFrame);
    }).catch(function(err) {
      progressLabel.textContent = 'Error: Could not play video. Try a different file.';
      isCompressing = false;
      compressBtn.disabled = false;
      compressBtn.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align:middle;margin-right:6px"><polyline points="16 16 12 12 8 16"/><line x1="12" y1="12" x2="12" y2="21"/><path d="M20.39 18.39A5 5 0 0 0 18 9h-1.26A8 8 0 1 0 3 16.3"/></svg>Compress Video';
      showToast('Error playing video: ' + err.message);
    });

    // Stop when video ends
    sourceVideo.onended = function() {
      // recorder.stop() is handled in drawFrame
    };
  };

  sourceVideo.onerror = function() {
    progressLabel.textContent = 'Error loading video. Format may not be supported by this browser.';
    isCompressing = false;
    compressBtn.disabled = false;
    compressBtn.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align:middle;margin-right:6px"><polyline points="16 16 12 12 8 16"/><line x1="12" y1="12" x2="12" y2="21"/><path d="M20.39 18.39A5 5 0 0 0 18 9h-1.26A8 8 0 1 0 3 16.3"/></svg>Compress Video';
    showToast('Error loading video. Try MP4 or WebM format.');
  };

  sourceVideo.src = originalUrl;
}

/* ========== DOWNLOAD ========== */
function downloadCompressed() {
  if (!compressedBlob) return;
  var baseName = originalFile.name.replace(/\.[^.]+$/, '');
  var a = document.createElement('a');
  a.href = compressedUrl;
  a.download = baseName + '-compressed.webm';
  a.click();
  showToast('Downloaded ' + baseName + '-compressed.webm');
}

/* ========== RESET ========== */
function resetAll() {
  if (isCompressing) {
    showToast('Compression in progress, please wait...');
    return;
  }
  originalFile = null;
  compressedBlob = null;
  if (originalUrl) { URL.revokeObjectURL(originalUrl); originalUrl = null; }
  if (compressedUrl) { URL.revokeObjectURL(compressedUrl); compressedUrl = null; }

  fileInput.value = '';
  settingsPanel.classList.remove('active');
  progressSection.classList.remove('active');
  resultsSection.classList.remove('active');

  dropZone.innerHTML = '<div class="drop-zone-icon"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><polygon points="23 7 16 12 23 17 23 7"/><rect x="1" y="5" width="15" height="14" rx="2" ry="2"/></svg></div><h3>Drop your video here or click to browse</h3><p>Supports MP4, WebM, MOV, AVI -- up to 500MB</p>';
  dropZone.onclick = function() { fileInput.click(); };

  document.getElementById('originalVideo').removeAttribute('src');
  document.getElementById('compressedVideo').removeAttribute('src');
}

/* ========== UTILS ========== */
function formatBytes(bytes) {
  if (bytes === 0) return '0 B';
  var k = 1024, sizes = ['B', 'KB', 'MB', 'GB'];
  var i = Math.floor(Math.log(bytes) / Math.log(k));
  return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
}

function formatTime(seconds) {
  var m = Math.floor(seconds / 60);
  var s = Math.floor(seconds % 60);
  return m + ':' + (s < 10 ? '0' : '') + s;
}

function escapeHtml(s) { return s.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;'); }

function showToast(msg) {
  var t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(function() { t.classList.remove('show'); }, 3000);
}

/* IntersectionObserver fade-in */
var observer = new IntersectionObserver(function(entries) {
  entries.forEach(function(entry) {
    if (entry.isIntersecting) { entry.target.classList.add('visible'); observer.unobserve(entry.target); }
  });
}, { threshold: 0.1 });
document.querySelectorAll('.fade-in').forEach(function(el) { observer.observe(el); });
</script>
<script src="/js/analytics-lite.js" defer></script>
<script src="/js/revenue.js" defer></script>
<script src="/js/lead-capture.js" defer></script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    {
      "@type": "Question",
      "name": "How does the online video compressor work?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "NexTool's Video Compressor uses your browser's built-in Canvas API and MediaRecorder API to re-encode video at a lower bitrate. The video plays in a hidden element, each frame is drawn onto a canvas at your chosen resolution, and the result is captured as a compressed WebM file. No data is ever sent to a server."
      }
    },
    {
      "@type": "Question",
      "name": "Is this video compressor really free?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Yes, NexTool's Video Compressor is 100% free with no signup, no watermark, and no file limits beyond what your browser can handle (up to 500MB). Everything runs in your browser for maximum privacy."
      }
    },
    {
      "@type": "Question",
      "name": "What video formats are supported?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "You can upload MP4, WebM, MOV, and AVI files. The compressed output is always in WebM format, which offers excellent compression and is supported by all modern browsers. WebM files can be played on virtually any device and platform."
      }
    },
    {
      "@type": "Question",
      "name": "How much can I reduce my video file size?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Depending on your settings, you can reduce file size by 50-90%. Using Medium quality with 720p resolution typically achieves 60-80% reduction. Lower quality and resolution settings produce even smaller files at the cost of visual quality."
      }
    },
    {
      "@type": "Question",
      "name": "Is my video data private and secure?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Absolutely. NexTool's Video Compressor runs entirely in your browser. Your video file never leaves your device and is never uploaded to any server. All processing happens locally using browser APIs, making it completely private and secure."
      }
    }
  ]
}
</script>
</body>
</html>
