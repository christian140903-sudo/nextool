<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Image Resizer - Resize, Convert &amp; Compress Images | NexTool</title>
<meta name="description" content="Free Image Resizer with drag &amp; drop, preset sizes, quality control, format conversion (JPEG, PNG, WebP), aspect ratio lock, and live preview. No upload to server.">
<meta name="keywords" content="image resizer, resize image, compress image, image converter, webp converter, free image tool, NexTool">
<link rel="canonical" href="https://nextool.app/free-tools/image-resizer.html">
<meta property="og:title" content="Image Resizer - Resize, Convert &amp; Compress Images | NexTool">
<meta property="og:description" content="Resize, compress, and convert images in your browser. Supports JPEG, PNG, WebP. No upload required.">
<meta property="og:type" content="website">
<meta property="og:url" content="https://nextool.app/free-tools/image-resizer.html">
<meta property="og:image" content="https://nextool.app/free-tools/og/image-resizer.png">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Image Resizer - Resize, Convert &amp; Compress Images | NexTool">
<meta name="twitter:description" content="Resize, compress, and convert images in your browser. No upload required.">
<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@type":"BreadcrumbList",
  "itemListElement":[
    {"@type":"ListItem","position":1,"name":"Home","item":"https://nextool.app/"},
    {"@type":"ListItem","position":2,"name":"Free Tools","item":"https://nextool.app/free-tools/"},
    {"@type":"ListItem","position":3,"name":"Image Resizer","item":"https://nextool.app/free-tools/image-resizer.html"}
  ]
}
</script>
<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@type":"SoftwareApplication",
  "name":"Image Resizer",
  "applicationCategory":"MultimediaApplication",
  "operatingSystem":"Web",
  "description":"Free Image Resizer with drag and drop, preset sizes, quality control, format conversion, and live preview.",
  "url":"https://nextool.app/free-tools/image-resizer.html",
  "offers":{"@type":"Offer","price":"0","priceCurrency":"USD"},
  "author":{"@type":"Organization","name":"NexTool","url":"https://nextool.app"}
}
</script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{--bg:#050508;--surface:#111118;--surface2:#1a1a24;--surface3:#22222f;--primary:#6366f1;--accent:#a855f7;--pink:#ec4899;--text:#e2e8f0;--text-dim:#94a3b8;--text-muted:#64748b;--gradient:linear-gradient(135deg,#6366f1,#a855f7,#ec4899);--green:#22c55e;--red:#ef4444;--yellow:#eab308;--radius:12px;--radius-lg:20px}
html{scroll-behavior:smooth}
body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--text);line-height:1.6;-webkit-font-smoothing:antialiased;min-height:100vh}
.nav{position:fixed;top:0;left:0;right:0;z-index:1000;padding:0 2rem;height:64px;display:flex;align-items:center;justify-content:space-between;background:rgba(5,5,8,.75);backdrop-filter:blur(20px);border-bottom:1px solid rgba(99,102,241,.1)}
.nav-logo{display:flex;align-items:center;gap:.5rem;font-weight:800;font-size:1.15rem;text-decoration:none;color:var(--text)}
.nav-logo .ico{width:28px;height:28px;border-radius:7px;background:var(--gradient);display:flex;align-items:center;justify-content:center;font-size:.75rem;font-weight:900;color:#fff}
.nav-logo span{background:var(--gradient);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.nav-links{display:flex;gap:1.5rem;align-items:center}
.nav-links a{color:var(--text-dim);font-size:.85rem;font-weight:500;text-decoration:none;transition:color .2s}
.nav-links a:hover{color:var(--text)}
.breadcrumb{max-width:900px;margin:0 auto;padding:80px 1.5rem 0;font-size:.8rem}
.breadcrumb a{color:var(--text-muted);text-decoration:none;transition:color .2s}
.breadcrumb a:hover{color:var(--text)}
.breadcrumb span{color:var(--text-muted);margin:0 .4rem}
.breadcrumb .current{color:var(--text-dim)}
.main{max-width:900px;margin:0 auto;padding:1rem 1.5rem 3rem}
.tool-header{text-align:center;margin-bottom:2.5rem}
.tool-badge{display:inline-flex;align-items:center;gap:.4rem;padding:.3rem .8rem;border-radius:100px;background:rgba(99,102,241,.1);border:1px solid rgba(99,102,241,.15);font-size:.72rem;font-weight:600;color:var(--primary);text-transform:uppercase;letter-spacing:.06em;margin-bottom:1rem}
.tool-header h1{font-size:clamp(1.75rem,4vw,2.5rem);font-weight:800;margin-bottom:.5rem}
.tool-header h1 .gr{background:var(--gradient);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.tool-header p{color:var(--text-dim);font-size:1rem;max-width:560px;margin:0 auto}
.card{background:var(--surface);border:1px solid rgba(99,102,241,.1);border-radius:var(--radius-lg);padding:2rem;position:relative;overflow:hidden;margin-bottom:1.5rem}
.card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:var(--gradient)}
.card h3{font-size:1rem;font-weight:700;margin-bottom:1.25rem;display:flex;align-items:center;gap:.5rem}

/* Drop Zone */
.drop-zone{border:2px dashed var(--surface3);border-radius:var(--radius);padding:3rem 2rem;text-align:center;cursor:pointer;transition:all .3s;position:relative}
.drop-zone:hover,.drop-zone.dragover{border-color:var(--primary);background:rgba(99,102,241,.05)}
.drop-zone svg{width:48px;height:48px;color:var(--text-muted);margin-bottom:1rem}
.drop-zone p{color:var(--text-dim);font-size:.9rem;margin-bottom:.25rem}
.drop-zone .hint{color:var(--text-muted);font-size:.75rem}
.drop-zone input{position:absolute;inset:0;opacity:0;cursor:pointer}

/* Image Info */
.image-info{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:.75rem;margin-bottom:1.5rem}
.info-chip{background:var(--surface2);border:1px solid var(--surface3);border-radius:8px;padding:.6rem .85rem;text-align:center}
.info-chip .label{font-size:.65rem;text-transform:uppercase;letter-spacing:.06em;color:var(--text-muted);margin-bottom:.15rem}
.info-chip .value{font-family:'JetBrains Mono',monospace;font-size:.9rem;font-weight:600;color:var(--text)}
.info-chip .value.gradient{background:var(--gradient);-webkit-background-clip:text;-webkit-text-fill-color:transparent}

/* Presets */
.presets{display:flex;gap:.5rem;flex-wrap:wrap;margin-bottom:1.25rem}
.preset-btn{padding:.4rem .85rem;border-radius:6px;border:1px solid var(--surface3);background:var(--surface2);color:var(--text-dim);font-size:.78rem;font-weight:600;cursor:pointer;font-family:'Inter',sans-serif;transition:all .2s}
.preset-btn:hover,.preset-btn.active{border-color:var(--primary);color:var(--text);background:rgba(99,102,241,.1)}

/* Controls */
.controls-grid{display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin-bottom:1.5rem}
.form-group{display:flex;flex-direction:column;gap:.35rem}
.form-group label{font-size:.8rem;font-weight:600;color:var(--text-dim)}
.form-input{padding:.55rem .75rem;border-radius:8px;border:1px solid var(--surface3);background:var(--surface2);color:var(--text);font-family:'Inter',sans-serif;font-size:.9rem;outline:none;transition:border-color .2s;width:100%}
.form-input:focus{border-color:var(--primary)}
select.form-input{cursor:pointer}

.dim-row{display:flex;gap:.75rem;align-items:flex-end;margin-bottom:1.25rem}
.dim-row .form-group{flex:1}
.lock-btn{width:40px;height:40px;border-radius:8px;border:1px solid var(--surface3);background:var(--surface2);color:var(--text-muted);cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s;flex-shrink:0;margin-bottom:0}
.lock-btn:hover,.lock-btn.locked{border-color:var(--primary);color:var(--primary);background:rgba(99,102,241,.1)}

/* Slider */
.slider-group{margin-bottom:1.25rem}
.slider-group label{display:flex;justify-content:space-between;font-size:.8rem;font-weight:600;color:var(--text-dim);margin-bottom:.5rem}
.slider-group label span{color:var(--text);font-family:'JetBrains Mono',monospace}
.slider{-webkit-appearance:none;appearance:none;width:100%;height:6px;border-radius:3px;background:var(--surface3);outline:none;cursor:pointer}
.slider::-webkit-slider-thumb{-webkit-appearance:none;width:18px;height:18px;border-radius:50%;background:var(--gradient);cursor:pointer;border:none;box-shadow:0 2px 8px rgba(99,102,241,.4)}
.slider::-moz-range-thumb{width:18px;height:18px;border-radius:50%;background:var(--primary);cursor:pointer;border:none}

/* Preview */
.preview-area{display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin-bottom:1.5rem}
.preview-box{background:var(--surface2);border:1px solid var(--surface3);border-radius:var(--radius);overflow:hidden;position:relative;aspect-ratio:16/10;display:flex;align-items:center;justify-content:center}
.preview-box img{max-width:100%;max-height:100%;object-fit:contain}
.preview-box .preview-label{position:absolute;top:.5rem;left:.5rem;padding:.2rem .5rem;border-radius:4px;background:rgba(0,0,0,.7);font-size:.65rem;font-weight:600;color:var(--text-dim);text-transform:uppercase;letter-spacing:.06em}
.preview-box .empty-preview{color:var(--text-muted);font-size:.85rem}

/* Action buttons */
.action-row{display:flex;gap:.75rem;flex-wrap:wrap}
.btn-primary{padding:.65rem 1.5rem;border-radius:8px;border:none;background:var(--gradient);color:#fff;font-weight:700;font-size:.9rem;cursor:pointer;font-family:'Inter',sans-serif;transition:transform .2s,box-shadow .2s}
.btn-primary:hover{transform:translateY(-2px);box-shadow:0 4px 20px rgba(99,102,241,.4)}
.btn-primary:disabled{opacity:.4;cursor:not-allowed;transform:none;box-shadow:none}
.btn-secondary{padding:.65rem 1.5rem;border-radius:8px;border:1px solid var(--surface3);background:var(--surface2);color:var(--text-dim);font-weight:600;font-size:.9rem;cursor:pointer;font-family:'Inter',sans-serif;transition:all .2s}
.btn-secondary:hover{border-color:var(--primary);color:var(--text)}
.btn-secondary:disabled{opacity:.4;cursor:not-allowed}

/* Output info */
.output-info{display:flex;gap:1rem;align-items:center;padding:.75rem 1rem;background:rgba(34,197,94,.06);border:1px solid rgba(34,197,94,.15);border-radius:8px;margin-bottom:1.5rem;font-size:.85rem;color:var(--green)}
.output-info svg{flex-shrink:0}

.hidden{display:none !important}

/* Footer */
.footer{border-top:1px solid rgba(99,102,241,.06);padding:2rem 0;text-align:center}
.footer-inner{max-width:900px;margin:0 auto;padding:0 1.5rem;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:1rem}
.footer-logo{display:flex;align-items:center;gap:.4rem;font-weight:700;font-size:.9rem}
.footer-logo .ico{width:20px;height:20px;border-radius:5px;background:var(--gradient);display:flex;align-items:center;justify-content:center;font-size:.5rem;font-weight:900;color:#fff}
.footer-logo span{color:var(--text-dim)}
.footer-links{display:flex;gap:1.25rem}
.footer-links a{color:var(--text-muted);font-size:.8rem;text-decoration:none;transition:color .2s}
.footer-links a:hover{color:var(--text)}
.footer-copy{color:var(--text-muted);font-size:.75rem;width:100%;text-align:center;margin-top:.5rem}

@media(max-width:600px){
  .main{padding:1rem 1rem 2rem}
  .breadcrumb{padding:80px 1rem 0}
  .nav-links{display:none}
  .controls-grid{grid-template-columns:1fr}
  .preview-area{grid-template-columns:1fr}
  .dim-row{flex-direction:column;align-items:stretch}
  .dim-row .lock-btn{width:100%;height:36px}
  .footer-inner{flex-direction:column;text-align:center}
}
</style>
</head>
<body>
<nav class="nav">
  <a class="nav-logo" href="/"><div class="ico">N</div><span>NexTool</span></a>
  <div class="nav-links">
    <a href="/">Home</a>
    <a href="/free-tools/">Free Tools</a>
    <a href="/pro.html">Pro</a>
    <a href="/blog/">Blog</a>
  </div>
</nav>

<div class="breadcrumb">
  <a href="/">Home</a><span>/</span><a href="/free-tools/">Free Tools</a><span>/</span><span class="current">Image Resizer</span>
</div>

<div class="main">
  <div class="tool-header">
    <div class="tool-badge">Free Tool</div>
    <h1><span class="gr">Image</span> Resizer</h1>
    <p>Resize, compress, and convert images right in your browser. No upload to any server — everything stays private.</p>
  </div>

  <!-- Upload Card -->
  <div class="card" id="uploadCard">
    <h3>
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><path d="m21 15-5-5L5 21"/></svg>
      Upload Image
    </h3>
    <div class="drop-zone" id="dropZone">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
      <p>Drag &amp; drop your image here</p>
      <p class="hint">or click to browse — JPEG, PNG, WebP, GIF, BMP, SVG</p>
      <input type="file" id="fileInput" accept="image/*">
    </div>
  </div>

  <!-- Settings Card (hidden until image loaded) -->
  <div class="card hidden" id="settingsCard">
    <h3>
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
      Resize Settings
    </h3>

    <div class="image-info" id="imageInfo"></div>

    <label style="font-size:.8rem;font-weight:600;color:var(--text-dim);display:block;margin-bottom:.5rem">Preset Sizes</label>
    <div class="presets" id="presets">
      <button class="preset-btn" data-w="1920" data-h="1080">1920 x 1080</button>
      <button class="preset-btn" data-w="1280" data-h="720">1280 x 720</button>
      <button class="preset-btn" data-w="800" data-h="600">800 x 600</button>
      <button class="preset-btn" data-w="640" data-h="480">640 x 480</button>
      <button class="preset-btn" data-w="320" data-h="320">320 x 320</button>
      <button class="preset-btn active" data-w="0" data-h="0">Custom</button>
    </div>

    <div class="dim-row">
      <div class="form-group">
        <label>Width (px)</label>
        <input class="form-input" type="number" id="targetWidth" min="1" max="10000" value="800">
      </div>
      <button class="lock-btn locked" id="lockBtn" title="Lock aspect ratio">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
      </button>
      <div class="form-group">
        <label>Height (px)</label>
        <input class="form-input" type="number" id="targetHeight" min="1" max="10000" value="600">
      </div>
    </div>

    <div class="controls-grid">
      <div class="form-group">
        <label>Output Format</label>
        <select class="form-input" id="outputFormat">
          <option value="image/jpeg">JPEG</option>
          <option value="image/png">PNG</option>
          <option value="image/webp">WebP</option>
        </select>
      </div>
      <div class="form-group" id="qualityGroup">
        <div class="slider-group">
          <label>Quality <span id="qualityValue">85%</span></label>
          <input type="range" class="slider" id="qualitySlider" min="1" max="100" value="85">
        </div>
      </div>
    </div>

    <div class="action-row" style="margin-bottom:1.5rem">
      <button class="btn-primary" id="resizeBtn" onclick="resizeImage()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16" style="vertical-align:middle;margin-right:.35rem"><polyline points="15 3 21 3 21 9"/><polyline points="9 21 3 21 3 15"/><line x1="21" y1="3" x2="14" y2="10"/><line x1="3" y1="21" x2="10" y2="14"/></svg>
        Resize Image
      </button>
      <button class="btn-secondary" onclick="resetTool()">New Image</button>
    </div>
  </div>

  <!-- Preview Card (hidden until resized) -->
  <div class="card hidden" id="previewCard">
    <h3>
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
      Preview
    </h3>

    <div class="output-info hidden" id="outputInfo">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18"><polyline points="20 6 9 17 4 12"/></svg>
      <span id="outputInfoText"></span>
    </div>

    <div class="preview-area">
      <div class="preview-box">
        <span class="preview-label">Original</span>
        <img id="originalPreview" alt="Original">
      </div>
      <div class="preview-box">
        <span class="preview-label">Resized</span>
        <img id="resizedPreview" alt="Resized">
      </div>
    </div>

    <div class="action-row">
      <button class="btn-primary" id="downloadBtn" onclick="downloadImage()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16" style="vertical-align:middle;margin-right:.35rem"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
        Download
      </button>
    </div>
  </div>
</div>

<footer class="footer">
  <div class="footer-inner">
    <div class="footer-logo"><div class="ico">N</div><span>NexTool</span></div>
    <div class="footer-links">
      <a href="/">Home</a>
      <a href="/free-tools/">Free Tools</a>
      <a href="/pro.html">Pro</a>
      <a href="/blog/">Blog</a>
    </div>
    <div class="footer-copy">&copy; 2025 NexTool. All rights reserved.</div>
  </div>
</footer>

<script>
const dropZone = document.getElementById('dropZone');
const fileInput = document.getElementById('fileInput');
const uploadCard = document.getElementById('uploadCard');
const settingsCard = document.getElementById('settingsCard');
const previewCard = document.getElementById('previewCard');
const imageInfo = document.getElementById('imageInfo');
const targetWidth = document.getElementById('targetWidth');
const targetHeight = document.getElementById('targetHeight');
const lockBtn = document.getElementById('lockBtn');
const qualitySlider = document.getElementById('qualitySlider');
const qualityValue = document.getElementById('qualityValue');
const qualityGroup = document.getElementById('qualityGroup');
const outputFormat = document.getElementById('outputFormat');
const originalPreview = document.getElementById('originalPreview');
const resizedPreview = document.getElementById('resizedPreview');
const outputInfo = document.getElementById('outputInfo');
const outputInfoText = document.getElementById('outputInfoText');

let originalImage = null;
let originalFile = null;
let aspectRatio = 1;
let lockAspect = true;
let resizedBlob = null;

// Drop zone events
dropZone.addEventListener('dragover', e => { e.preventDefault(); dropZone.classList.add('dragover'); });
dropZone.addEventListener('dragleave', () => dropZone.classList.remove('dragover'));
dropZone.addEventListener('drop', e => {
  e.preventDefault();
  dropZone.classList.remove('dragover');
  const file = e.dataTransfer.files[0];
  if (file && file.type.startsWith('image/')) loadImage(file);
});
fileInput.addEventListener('change', e => {
  const file = e.target.files[0];
  if (file) loadImage(file);
});

function loadImage(file) {
  originalFile = file;
  const reader = new FileReader();
  reader.onload = e => {
    const img = new Image();
    img.onload = () => {
      originalImage = img;
      aspectRatio = img.width / img.height;
      targetWidth.value = img.width;
      targetHeight.value = img.height;
      originalPreview.src = e.target.result;

      // Show info
      imageInfo.innerHTML = `
        <div class="info-chip"><div class="label">Original Size</div><div class="value gradient">${img.width} x ${img.height}</div></div>
        <div class="info-chip"><div class="label">File Size</div><div class="value">${formatBytes(file.size)}</div></div>
        <div class="info-chip"><div class="label">Format</div><div class="value">${file.type.split('/')[1].toUpperCase()}</div></div>
        <div class="info-chip"><div class="label">Aspect Ratio</div><div class="value">${simplifyRatio(img.width, img.height)}</div></div>
      `;

      settingsCard.classList.remove('hidden');
      previewCard.classList.add('hidden');
      outputInfo.classList.add('hidden');
      // Detect format
      if (file.type === 'image/png') outputFormat.value = 'image/png';
      else if (file.type === 'image/webp') outputFormat.value = 'image/webp';
      else outputFormat.value = 'image/jpeg';
      updateQualityVisibility();
    };
    img.src = e.target.result;
  };
  reader.readAsDataURL(file);
}

function formatBytes(bytes) {
  if (bytes < 1024) return bytes + ' B';
  if (bytes < 1048576) return (bytes / 1024).toFixed(1) + ' KB';
  return (bytes / 1048576).toFixed(2) + ' MB';
}

function gcd(a, b) { return b === 0 ? a : gcd(b, a % b); }
function simplifyRatio(w, h) {
  const d = gcd(w, h);
  return (w / d) + ':' + (h / d);
}

// Aspect ratio lock
lockBtn.addEventListener('click', () => {
  lockAspect = !lockAspect;
  lockBtn.classList.toggle('locked', lockAspect);
  lockBtn.innerHTML = lockAspect
    ? '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>'
    : '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 5-5 3 3 0 0 1 3 3"/></svg>';
});

targetWidth.addEventListener('input', () => {
  if (lockAspect && originalImage) {
    targetHeight.value = Math.round(parseInt(targetWidth.value) / aspectRatio) || 1;
  }
  clearPresets();
});
targetHeight.addEventListener('input', () => {
  if (lockAspect && originalImage) {
    targetWidth.value = Math.round(parseInt(targetHeight.value) * aspectRatio) || 1;
  }
  clearPresets();
});

// Presets
document.querySelectorAll('.preset-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.preset-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    const w = parseInt(btn.dataset.w);
    const h = parseInt(btn.dataset.h);
    if (w > 0 && h > 0) {
      targetWidth.value = w;
      targetHeight.value = h;
    }
  });
});

function clearPresets() {
  document.querySelectorAll('.preset-btn').forEach(b => b.classList.remove('active'));
  document.querySelector('.preset-btn[data-w="0"]').classList.add('active');
}

// Quality slider
qualitySlider.addEventListener('input', () => {
  qualityValue.textContent = qualitySlider.value + '%';
});

outputFormat.addEventListener('change', updateQualityVisibility);

function updateQualityVisibility() {
  const fmt = outputFormat.value;
  qualityGroup.style.opacity = fmt === 'image/png' ? '.4' : '1';
}

// Resize
function resizeImage() {
  if (!originalImage) return;
  const w = parseInt(targetWidth.value) || 1;
  const h = parseInt(targetHeight.value) || 1;
  const fmt = outputFormat.value;
  const q = parseInt(qualitySlider.value) / 100;

  const canvas = document.createElement('canvas');
  canvas.width = w;
  canvas.height = h;
  const ctx = canvas.getContext('2d');

  // Use smooth rendering
  ctx.imageSmoothingEnabled = true;
  ctx.imageSmoothingQuality = 'high';

  // For better downscaling, use step-down approach
  if (w < originalImage.width / 2 || h < originalImage.height / 2) {
    stepDownResize(ctx, originalImage, w, h);
  } else {
    ctx.drawImage(originalImage, 0, 0, w, h);
  }

  canvas.toBlob(blob => {
    resizedBlob = blob;
    const url = URL.createObjectURL(blob);
    resizedPreview.src = url;

    // Calculate savings
    const savings = ((1 - blob.size / originalFile.size) * 100).toFixed(1);
    const savingsText = savings > 0
      ? `Saved ${savings}% — ${formatBytes(originalFile.size)} → ${formatBytes(blob.size)}`
      : `Output: ${formatBytes(blob.size)} (${Math.abs(savings)}% larger than original)`;

    outputInfoText.textContent = `${w} x ${h} | ${fmt.split('/')[1].toUpperCase()} | ${savingsText}`;
    outputInfo.classList.remove('hidden');
    previewCard.classList.remove('hidden');
    previewCard.scrollIntoView({ behavior: 'smooth', block: 'start' });
  }, fmt, fmt === 'image/png' ? undefined : q);
}

function stepDownResize(ctx, img, targetW, targetH) {
  let currentW = img.width;
  let currentH = img.height;
  const tempCanvas = document.createElement('canvas');
  const tempCtx = tempCanvas.getContext('2d');
  tempCanvas.width = currentW;
  tempCanvas.height = currentH;
  tempCtx.drawImage(img, 0, 0);

  while (currentW / 2 > targetW && currentH / 2 > targetH) {
    currentW = Math.round(currentW / 2);
    currentH = Math.round(currentH / 2);
    const stepCanvas = document.createElement('canvas');
    stepCanvas.width = currentW;
    stepCanvas.height = currentH;
    const stepCtx = stepCanvas.getContext('2d');
    stepCtx.imageSmoothingEnabled = true;
    stepCtx.imageSmoothingQuality = 'high';
    stepCtx.drawImage(tempCanvas, 0, 0, currentW, currentH);
    tempCanvas.width = currentW;
    tempCanvas.height = currentH;
    tempCtx.drawImage(stepCanvas, 0, 0);
  }

  ctx.drawImage(tempCanvas, 0, 0, targetW, targetH);
}

// Download
function downloadImage() {
  if (!resizedBlob) return;
  const ext = outputFormat.value.split('/')[1];
  const name = (originalFile.name.replace(/\.[^.]+$/, '') || 'image') + '-resized.' + (ext === 'jpeg' ? 'jpg' : ext);
  const a = document.createElement('a');
  a.href = URL.createObjectURL(resizedBlob);
  a.download = name;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
}

// Reset
function resetTool() {
  originalImage = null;
  originalFile = null;
  resizedBlob = null;
  fileInput.value = '';
  settingsCard.classList.add('hidden');
  previewCard.classList.add('hidden');
  uploadCard.scrollIntoView({ behavior: 'smooth' });
}
</script>
<script src="/js/revenue.js" defer></script>
</body>
</html>