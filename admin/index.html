<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NexTool Admin Dashboard</title>
<meta name="robots" content="noindex, nofollow">
<link rel="icon" type="image/svg+xml" href="/img/favicon.svg">
<style>
/* ==========================================================================
   NexTool Admin Dashboard — Complete Inline Styles
   Design System: NexTool Revolution (base.css variables replicated)
   ========================================================================== */

*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}

:root {
  --bg-void: #050505;
  --bg-primary: #0A0A0A;
  --bg-secondary: #111111;
  --bg-tertiary: #1A1A1A;
  --bg-quaternary: #222222;
  --bg-glass: rgba(255,255,255,0.03);
  --bg-glass-hover: rgba(255,255,255,0.06);

  --text-primary: rgba(255,255,255,0.95);
  --text-secondary: rgba(255,255,255,0.60);
  --text-tertiary: rgba(255,255,255,0.40);
  --text-muted: rgba(255,255,255,0.20);

  --accent: #635BFF;
  --accent-light: #7B74FF;
  --accent-dark: #4B44CC;
  --accent-glow: rgba(99,91,255,0.15);
  --accent-glow-strong: rgba(99,91,255,0.30);
  --accent-surface: rgba(99,91,255,0.08);
  --accent-gradient: linear-gradient(135deg, #635BFF 0%, #00D4FF 100%);

  --cyan: #00D4FF;
  --success: #00C853;
  --success-surface: rgba(0,200,83,0.08);
  --warning: #FFB300;
  --warning-surface: rgba(255,179,0,0.08);
  --error: #FF3D00;
  --error-surface: rgba(255,61,0,0.08);

  --border-subtle: rgba(255,255,255,0.06);
  --border-default: rgba(255,255,255,0.10);
  --border-active: rgba(255,255,255,0.18);

  --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  --font-mono: 'JetBrains Mono', 'SF Mono', monospace;

  --radius-sm: 6px;
  --radius-md: 8px;
  --radius-lg: 12px;
  --radius-xl: 16px;

  --shadow-sm: 0 1px 2px rgba(0,0,0,0.3);
  --shadow-md: 0 4px 12px rgba(0,0,0,0.4);
  --shadow-lg: 0 8px 32px rgba(0,0,0,0.5);

  --sidebar-width: 240px;
  --topbar-height: 56px;

  --ease-out: cubic-bezier(0.16, 1, 0.3, 1);
  --duration-fast: 200ms;
  --duration-normal: 300ms;
}

@font-face {
  font-family: 'Inter';
  src: url('../fonts/Inter-Variable.woff2') format('woff2');
  font-weight: 100 900;
  font-style: normal;
  font-display: swap;
}

html {
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

body {
  font-family: var(--font-sans);
  background: var(--bg-primary);
  color: var(--text-secondary);
  line-height: 1.5;
  min-height: 100vh;
  overflow-x: hidden;
}

::selection { background: var(--accent); color: #fff; }

::-webkit-scrollbar { width: 6px; height: 6px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 99px; }
::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.18); }

/* ========== LOGIN SCREEN ========== */

.login-screen {
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 100vh;
  background: var(--bg-void);
  position: relative;
  overflow: hidden;
}

.login-screen::before {
  content: '';
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: radial-gradient(ellipse at 30% 50%, rgba(99,91,255,0.06) 0%, transparent 50%),
              radial-gradient(ellipse at 70% 50%, rgba(0,212,255,0.04) 0%, transparent 50%);
  pointer-events: none;
}

.login-card {
  position: relative;
  width: 100%;
  max-width: 400px;
  padding: 48px 40px;
  background: var(--bg-secondary);
  border: 1px solid var(--border-subtle);
  border-radius: var(--radius-xl);
  text-align: center;
  margin: 20px;
}

.login-logo {
  font-size: 28px;
  font-weight: 700;
  color: var(--text-primary);
  letter-spacing: -0.02em;
  margin-bottom: 4px;
}

.login-logo span {
  background: var(--accent-gradient);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.login-subtitle {
  font-size: 13px;
  color: var(--text-tertiary);
  margin-bottom: 36px;
  font-weight: 500;
  letter-spacing: 0.08em;
  text-transform: uppercase;
}

.login-field {
  width: 100%;
  margin-bottom: 16px;
}

.login-field input {
  width: 100%;
  padding: 12px 16px;
  background: var(--bg-tertiary);
  border: 1px solid var(--border-subtle);
  border-radius: var(--radius-md);
  color: var(--text-primary);
  font-size: 14px;
  transition: border-color var(--duration-fast) var(--ease-out),
              box-shadow var(--duration-fast) var(--ease-out);
}

.login-field input::placeholder { color: var(--text-muted); }

.login-field input:focus {
  border-color: var(--accent);
  box-shadow: 0 0 0 3px var(--accent-glow);
  outline: none;
}

.login-btn {
  width: 100%;
  padding: 12px;
  background: var(--accent-gradient);
  color: #fff;
  border: none;
  border-radius: var(--radius-md);
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: opacity var(--duration-fast), transform var(--duration-fast);
  margin-top: 8px;
  font-family: var(--font-sans);
}

.login-btn:hover { opacity: 0.9; transform: translateY(-1px); }
.login-btn:active { transform: scale(0.98); }

.login-error {
  color: var(--error);
  font-size: 13px;
  margin-top: 12px;
  min-height: 20px;
}

/* ========== MAIN LAYOUT ========== */

.app { display: none; min-height: 100vh; }
.app.active { display: flex; }

/* ========== SIDEBAR ========== */

.sidebar {
  position: fixed;
  top: 0;
  left: 0;
  width: var(--sidebar-width);
  height: 100vh;
  background: var(--bg-void);
  border-right: 1px solid var(--border-subtle);
  display: flex;
  flex-direction: column;
  z-index: 100;
  transition: transform var(--duration-normal) var(--ease-out);
}

.sidebar-header {
  padding: 20px 20px 16px;
  border-bottom: 1px solid var(--border-subtle);
  display: flex;
  align-items: center;
  gap: 10px;
}

.sidebar-logo {
  font-size: 20px;
  font-weight: 700;
  color: var(--text-primary);
  letter-spacing: -0.02em;
}

.sidebar-logo span {
  background: var(--accent-gradient);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.sidebar-badge {
  font-size: 10px;
  font-weight: 600;
  padding: 2px 8px;
  background: var(--accent-surface);
  color: var(--accent-light);
  border-radius: 99px;
  letter-spacing: 0.05em;
  text-transform: uppercase;
}

.sidebar-nav {
  flex: 1;
  overflow-y: auto;
  padding: 12px 8px;
}

.sidebar-section-label {
  font-size: 10px;
  font-weight: 600;
  color: var(--text-muted);
  letter-spacing: 0.1em;
  text-transform: uppercase;
  padding: 16px 12px 8px;
}

.sidebar-link {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 10px 12px;
  border-radius: var(--radius-md);
  color: var(--text-tertiary);
  font-size: 13px;
  font-weight: 500;
  cursor: pointer;
  transition: all var(--duration-fast) var(--ease-out);
  text-decoration: none;
  user-select: none;
  position: relative;
}

.sidebar-link:hover {
  color: var(--text-primary);
  background: var(--bg-glass-hover);
}

.sidebar-link.active {
  color: var(--text-primary);
  background: var(--accent-surface);
}

.sidebar-link.active::before {
  content: '';
  position: absolute;
  left: 0;
  top: 6px;
  bottom: 6px;
  width: 3px;
  background: var(--accent);
  border-radius: 0 3px 3px 0;
}

.sidebar-link svg {
  width: 18px;
  height: 18px;
  flex-shrink: 0;
  opacity: 0.6;
}

.sidebar-link.active svg,
.sidebar-link:hover svg {
  opacity: 1;
}

.sidebar-link .badge-count {
  margin-left: auto;
  font-size: 11px;
  font-weight: 600;
  padding: 1px 7px;
  background: var(--accent-surface);
  color: var(--accent-light);
  border-radius: 99px;
  min-width: 20px;
  text-align: center;
}

.sidebar-footer {
  padding: 16px 20px;
  border-top: 1px solid var(--border-subtle);
}

.sidebar-user {
  display: flex;
  align-items: center;
  gap: 10px;
}

.sidebar-avatar {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  background: var(--accent-gradient);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 13px;
  font-weight: 700;
  color: #fff;
  flex-shrink: 0;
}

.sidebar-user-info {
  flex: 1;
  min-width: 0;
}

.sidebar-user-name {
  font-size: 13px;
  font-weight: 600;
  color: var(--text-primary);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.sidebar-user-role {
  font-size: 11px;
  color: var(--text-tertiary);
}

/* ========== CONTENT AREA ========== */

.main {
  margin-left: var(--sidebar-width);
  flex: 1;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}

.topbar {
  position: sticky;
  top: 0;
  z-index: 50;
  height: var(--topbar-height);
  background: rgba(10,10,10,0.80);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border-bottom: 1px solid var(--border-subtle);
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 28px;
}

.topbar-left {
  display: flex;
  align-items: center;
  gap: 16px;
}

.topbar-hamburger {
  display: none;
  width: 32px;
  height: 32px;
  align-items: center;
  justify-content: center;
  background: none;
  border: none;
  cursor: pointer;
  color: var(--text-secondary);
  border-radius: var(--radius-sm);
  transition: background var(--duration-fast);
}

.topbar-hamburger:hover { background: var(--bg-glass-hover); }

.topbar-hamburger svg { width: 20px; height: 20px; }

.topbar-title {
  font-size: 15px;
  font-weight: 600;
  color: var(--text-primary);
}

.topbar-right {
  display: flex;
  align-items: center;
  gap: 12px;
}

.topbar-search {
  position: relative;
}

.topbar-search input {
  width: 220px;
  padding: 7px 12px 7px 34px;
  background: var(--bg-tertiary);
  border: 1px solid var(--border-subtle);
  border-radius: var(--radius-md);
  color: var(--text-primary);
  font-size: 13px;
  font-family: var(--font-sans);
  transition: border-color var(--duration-fast), width var(--duration-normal) var(--ease-out);
}

.topbar-search input::placeholder { color: var(--text-muted); }
.topbar-search input:focus { border-color: var(--accent); width: 280px; outline: none; }

.topbar-search svg {
  position: absolute;
  left: 10px;
  top: 50%;
  transform: translateY(-50%);
  width: 16px;
  height: 16px;
  color: var(--text-tertiary);
  pointer-events: none;
}

.topbar-icon-btn {
  width: 34px;
  height: 34px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: none;
  border: 1px solid transparent;
  border-radius: var(--radius-md);
  cursor: pointer;
  color: var(--text-tertiary);
  position: relative;
  transition: all var(--duration-fast);
  text-decoration: none;
}

.topbar-icon-btn:hover {
  color: var(--text-primary);
  background: var(--bg-glass-hover);
  border-color: var(--border-subtle);
}

.topbar-icon-btn svg { width: 18px; height: 18px; }

.topbar-dot {
  position: absolute;
  top: 6px;
  right: 6px;
  width: 7px;
  height: 7px;
  background: var(--error);
  border-radius: 50%;
  border: 2px solid var(--bg-primary);
}

.content {
  flex: 1;
  padding: 28px;
}

/* ========== PAGE SECTIONS (show/hide) ========== */

.page { display: none; }
.page.active { display: block; animation: pageIn 0.3s var(--ease-out); }

@keyframes pageIn {
  from { opacity: 0; transform: translateY(8px); }
  to { opacity: 1; transform: translateY(0); }
}

/* ========== STAT CARDS ========== */

.stats-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 16px;
  margin-bottom: 28px;
}

.stat-card {
  background: var(--bg-secondary);
  border: 1px solid var(--border-subtle);
  border-radius: var(--radius-lg);
  padding: 22px 24px;
  transition: border-color var(--duration-fast), box-shadow var(--duration-fast);
}

.stat-card:hover {
  border-color: var(--border-default);
  box-shadow: var(--shadow-md);
}

.stat-card-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 12px;
}

.stat-card-label {
  font-size: 12px;
  font-weight: 500;
  color: var(--text-tertiary);
  text-transform: uppercase;
  letter-spacing: 0.06em;
}

.stat-card-icon {
  width: 36px;
  height: 36px;
  border-radius: var(--radius-md);
  display: flex;
  align-items: center;
  justify-content: center;
}

.stat-card-icon svg { width: 18px; height: 18px; }

.stat-card-icon.accent { background: var(--accent-surface); color: var(--accent-light); }
.stat-card-icon.green { background: var(--success-surface); color: var(--success); }
.stat-card-icon.yellow { background: var(--warning-surface); color: var(--warning); }
.stat-card-icon.cyan { background: rgba(0,212,255,0.08); color: var(--cyan); }

.stat-card-value {
  font-size: 28px;
  font-weight: 700;
  color: var(--text-primary);
  letter-spacing: -0.02em;
  line-height: 1;
  margin-bottom: 6px;
}

.stat-card-change {
  font-size: 12px;
  font-weight: 500;
  display: flex;
  align-items: center;
  gap: 4px;
}

.stat-card-change.up { color: var(--success); }
.stat-card-change.down { color: var(--error); }

/* ========== TABLES ========== */

.table-card {
  background: var(--bg-secondary);
  border: 1px solid var(--border-subtle);
  border-radius: var(--radius-lg);
  overflow: hidden;
}

.table-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 18px 24px;
  border-bottom: 1px solid var(--border-subtle);
}

.table-title {
  font-size: 15px;
  font-weight: 600;
  color: var(--text-primary);
}

.table-actions {
  display: flex;
  align-items: center;
  gap: 8px;
}

.table-wrapper { overflow-x: auto; }

table {
  width: 100%;
  border-collapse: collapse;
}

thead th {
  padding: 12px 24px;
  font-size: 11px;
  font-weight: 600;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.08em;
  text-align: left;
  border-bottom: 1px solid var(--border-subtle);
  white-space: nowrap;
  background: rgba(255,255,255,0.01);
}

tbody td {
  padding: 14px 24px;
  font-size: 13px;
  color: var(--text-secondary);
  border-bottom: 1px solid var(--border-subtle);
  white-space: nowrap;
}

tbody tr { transition: background var(--duration-fast); }
tbody tr:hover { background: var(--bg-glass-hover); }
tbody tr:last-child td { border-bottom: none; }

.td-primary {
  color: var(--text-primary);
  font-weight: 500;
}

.td-mono {
  font-family: var(--font-mono);
  font-size: 12px;
  color: var(--text-tertiary);
}

/* ========== STATUS BADGES ========== */

.badge {
  display: inline-flex;
  align-items: center;
  gap: 5px;
  padding: 3px 10px;
  font-size: 11px;
  font-weight: 600;
  border-radius: 99px;
  letter-spacing: 0.02em;
}

.badge::before {
  content: '';
  width: 6px;
  height: 6px;
  border-radius: 50%;
  flex-shrink: 0;
}

.badge-paid { background: rgba(99,91,255,0.10); color: var(--accent-light); }
.badge-paid::before { background: var(--accent-light); }

.badge-progress { background: var(--warning-surface); color: var(--warning); }
.badge-progress::before { background: var(--warning); }

.badge-preview { background: rgba(168,85,247,0.10); color: #c084fc; }
.badge-preview::before { background: #c084fc; }

.badge-completed { background: var(--success-surface); color: var(--success); }
.badge-completed::before { background: var(--success); }

.badge-cancelled { background: var(--error-surface); color: var(--error); }
.badge-cancelled::before { background: var(--error); }

.badge-active { background: var(--success-surface); color: var(--success); }
.badge-active::before { background: var(--success); }

.badge-inactive { background: rgba(255,255,255,0.04); color: var(--text-muted); }
.badge-inactive::before { background: var(--text-muted); }

.badge-draft { background: rgba(255,255,255,0.04); color: var(--text-tertiary); }
.badge-draft::before { background: var(--text-tertiary); }

.badge-published { background: var(--success-surface); color: var(--success); }
.badge-published::before { background: var(--success); }

/* ========== BUTTONS ========== */

.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  padding: 8px 16px;
  font-size: 13px;
  font-weight: 500;
  border-radius: var(--radius-md);
  cursor: pointer;
  transition: all var(--duration-fast) var(--ease-out);
  white-space: nowrap;
  border: none;
  font-family: var(--font-sans);
  text-decoration: none;
}

.btn:active { transform: scale(0.97); }

.btn svg { width: 15px; height: 15px; }

.btn-primary {
  background: var(--accent-gradient);
  color: #fff;
  font-weight: 600;
}

.btn-primary:hover { opacity: 0.9; transform: translateY(-1px); box-shadow: 0 4px 16px var(--accent-glow); }

.btn-secondary {
  background: var(--bg-glass);
  color: var(--text-primary);
  border: 1px solid var(--border-subtle);
}

.btn-secondary:hover { border-color: var(--border-default); background: var(--bg-glass-hover); }

.btn-ghost {
  background: transparent;
  color: var(--text-tertiary);
  padding: 6px 10px;
}

.btn-ghost:hover { color: var(--text-primary); background: var(--bg-glass); }

.btn-sm { padding: 5px 12px; font-size: 12px; }

.btn-danger { background: var(--error-surface); color: var(--error); border: 1px solid rgba(255,61,0,0.15); }
.btn-danger:hover { background: rgba(255,61,0,0.15); }

/* ========== FILTER/SELECT ========== */

.filter-select {
  padding: 6px 28px 6px 12px;
  background: var(--bg-tertiary);
  border: 1px solid var(--border-subtle);
  border-radius: var(--radius-md);
  color: var(--text-secondary);
  font-size: 12px;
  font-family: var(--font-sans);
  appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='rgba(255,255,255,0.4)' viewBox='0 0 16 16'%3E%3Cpath d='M4.5 6l3.5 4 3.5-4'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 8px center;
  cursor: pointer;
  transition: border-color var(--duration-fast);
}

.filter-select:focus { border-color: var(--accent); outline: none; }

.search-input {
  padding: 7px 12px 7px 34px;
  background: var(--bg-tertiary);
  border: 1px solid var(--border-subtle);
  border-radius: var(--radius-md);
  color: var(--text-primary);
  font-size: 13px;
  font-family: var(--font-sans);
  transition: border-color var(--duration-fast);
  width: 240px;
}

.search-input::placeholder { color: var(--text-muted); }
.search-input:focus { border-color: var(--accent); outline: none; }

.search-wrapper {
  position: relative;
}

.search-wrapper svg {
  position: absolute;
  left: 10px;
  top: 50%;
  transform: translateY(-50%);
  width: 16px;
  height: 16px;
  color: var(--text-tertiary);
  pointer-events: none;
}

/* ========== CHARTS (CSS-only) ========== */

.chart-card {
  background: var(--bg-secondary);
  border: 1px solid var(--border-subtle);
  border-radius: var(--radius-lg);
  padding: 24px;
}

.chart-title {
  font-size: 15px;
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: 4px;
}

.chart-subtitle {
  font-size: 12px;
  color: var(--text-tertiary);
  margin-bottom: 24px;
}

.bar-chart {
  display: flex;
  align-items: flex-end;
  gap: 12px;
  height: 200px;
  padding-top: 20px;
  border-bottom: 1px solid var(--border-subtle);
  padding-bottom: 0;
}

.bar-col {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
  height: 100%;
  justify-content: flex-end;
}

.bar {
  width: 100%;
  max-width: 48px;
  border-radius: 6px 6px 0 0;
  background: var(--accent-gradient);
  position: relative;
  transition: opacity var(--duration-fast);
  min-height: 4px;
}

.bar:hover { opacity: 0.8; }

.bar-value {
  position: absolute;
  top: -22px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 11px;
  font-weight: 600;
  color: var(--text-primary);
  white-space: nowrap;
  opacity: 0;
  transition: opacity var(--duration-fast);
}

.bar:hover .bar-value { opacity: 1; }

.bar-label {
  font-size: 11px;
  color: var(--text-tertiary);
  text-align: center;
  padding-top: 8px;
}

/* ========== TWO COLUMN LAYOUT ========== */

.grid-2 {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;
  margin-bottom: 28px;
}

.grid-3 {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 16px;
  margin-bottom: 28px;
}

/* ========== QUICK ACTIONS ========== */

.quick-actions {
  display: flex;
  gap: 10px;
  margin-bottom: 28px;
  flex-wrap: wrap;
}

/* ========== INFO CARDS (for simple pages) ========== */

.info-card {
  background: var(--bg-secondary);
  border: 1px solid var(--border-subtle);
  border-radius: var(--radius-lg);
  padding: 28px;
  transition: border-color var(--duration-fast);
}

.info-card:hover { border-color: var(--border-default); }

.info-card-title {
  font-size: 16px;
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: 8px;
}

.info-card-desc {
  font-size: 13px;
  color: var(--text-tertiary);
  line-height: 1.6;
  margin-bottom: 16px;
}

.info-card-meta {
  display: flex;
  align-items: center;
  gap: 16px;
  font-size: 12px;
  color: var(--text-muted);
  flex-wrap: wrap;
}

.info-card-meta span {
  display: flex;
  align-items: center;
  gap: 4px;
}

/* ========== CATEGORY GRID (Tools page) ========== */

.category-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 12px;
}

.category-item {
  background: var(--bg-secondary);
  border: 1px solid var(--border-subtle);
  border-radius: var(--radius-lg);
  padding: 20px;
  text-align: center;
  transition: all var(--duration-fast);
}

.category-item:hover {
  border-color: var(--border-default);
  transform: translateY(-2px);
}

.category-count {
  font-size: 28px;
  font-weight: 700;
  color: var(--text-primary);
  margin-bottom: 4px;
}

.category-name {
  font-size: 12px;
  color: var(--text-tertiary);
  text-transform: uppercase;
  letter-spacing: 0.06em;
}

/* ========== TRANSACTION LIST ========== */

.transaction-list {
  display: flex;
  flex-direction: column;
}

.transaction-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 14px 0;
  border-bottom: 1px solid var(--border-subtle);
}

.transaction-item:last-child { border-bottom: none; }

.transaction-left {
  display: flex;
  align-items: center;
  gap: 12px;
}

.transaction-icon {
  width: 36px;
  height: 36px;
  border-radius: var(--radius-md);
  background: var(--accent-surface);
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--accent-light);
  flex-shrink: 0;
}

.transaction-icon svg { width: 16px; height: 16px; }

.transaction-name {
  font-size: 13px;
  font-weight: 500;
  color: var(--text-primary);
}

.transaction-date {
  font-size: 11px;
  color: var(--text-muted);
}

.transaction-amount {
  font-size: 14px;
  font-weight: 600;
  color: var(--success);
  white-space: nowrap;
}

.transaction-amount.negative { color: var(--error); }

/* ========== TOGGLE SWITCH ========== */

.toggle-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 14px 0;
  border-bottom: 1px solid var(--border-subtle);
}

.toggle-row:last-child { border-bottom: none; }

.toggle-label {
  font-size: 13px;
  color: var(--text-secondary);
}

.toggle-desc {
  font-size: 11px;
  color: var(--text-muted);
  margin-top: 2px;
}

.toggle {
  position: relative;
  width: 40px;
  height: 22px;
  cursor: pointer;
  flex-shrink: 0;
}

.toggle input { display: none; }

.toggle-track {
  position: absolute;
  inset: 0;
  background: var(--bg-quaternary);
  border-radius: 99px;
  transition: background var(--duration-fast);
}

.toggle input:checked + .toggle-track { background: var(--accent); }

.toggle-thumb {
  position: absolute;
  top: 3px;
  left: 3px;
  width: 16px;
  height: 16px;
  background: #fff;
  border-radius: 50%;
  transition: transform var(--duration-fast) var(--ease-out);
  pointer-events: none;
}

.toggle input:checked ~ .toggle-thumb { transform: translateX(18px); }

/* ========== OVERLAY for mobile sidebar ========== */

.sidebar-overlay {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.6);
  z-index: 99;
  backdrop-filter: blur(4px);
  -webkit-backdrop-filter: blur(4px);
}

.sidebar-overlay.active { display: block; }

/* ========== TOAST ========== */

.toast {
  position: fixed;
  bottom: 24px;
  right: 24px;
  padding: 12px 20px;
  background: var(--bg-secondary);
  border: 1px solid var(--border-subtle);
  border-radius: var(--radius-md);
  font-size: 13px;
  color: var(--text-primary);
  transform: translateY(80px);
  opacity: 0;
  transition: all var(--duration-normal) var(--ease-out);
  z-index: 500;
  box-shadow: var(--shadow-lg);
}

.toast.show { transform: translateY(0); opacity: 1; }

/* ========== RESPONSIVE ========== */

@media (max-width: 1024px) {
  .stats-grid { grid-template-columns: repeat(2, 1fr); }
  .grid-2, .grid-3 { grid-template-columns: 1fr; }
}

@media (max-width: 768px) {
  .sidebar {
    transform: translateX(-100%);
  }

  .sidebar.open {
    transform: translateX(0);
  }

  .main {
    margin-left: 0;
  }

  .topbar-hamburger {
    display: flex;
  }

  .topbar-search { display: none; }

  .stats-grid { grid-template-columns: 1fr 1fr; }

  .content { padding: 16px; }

  .table-header { flex-direction: column; align-items: flex-start; gap: 12px; }

  .search-input { width: 100%; }

  .quick-actions { flex-direction: column; }
  .quick-actions .btn { width: 100%; justify-content: center; }
}

@media (max-width: 480px) {
  .stats-grid { grid-template-columns: 1fr; }
  .category-grid { grid-template-columns: repeat(2, 1fr); }
}

/* ========== MODAL ========== */

.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.65);
  backdrop-filter: blur(6px);
  -webkit-backdrop-filter: blur(6px);
  z-index: 600;
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0;
  pointer-events: none;
  transition: opacity var(--duration-normal) var(--ease-out);
}

.modal-overlay.active {
  opacity: 1;
  pointer-events: auto;
}

.modal {
  background: var(--bg-secondary);
  border: 1px solid var(--border-subtle);
  border-radius: var(--radius-xl);
  width: 100%;
  max-width: 500px;
  max-height: 90vh;
  overflow-y: auto;
  padding: 32px;
  margin: 20px;
  transform: translateY(20px) scale(0.97);
  transition: transform var(--duration-normal) var(--ease-out);
  box-shadow: var(--shadow-lg);
}

.modal-overlay.active .modal {
  transform: translateY(0) scale(1);
}

.modal-title {
  font-size: 18px;
  font-weight: 700;
  color: var(--text-primary);
  margin-bottom: 4px;
}

.modal-subtitle {
  font-size: 13px;
  color: var(--text-tertiary);
  margin-bottom: 24px;
}

.modal-field {
  margin-bottom: 16px;
}

.modal-field label {
  display: block;
  font-size: 12px;
  font-weight: 500;
  color: var(--text-tertiary);
  margin-bottom: 6px;
  text-transform: uppercase;
  letter-spacing: 0.04em;
}

.modal-field input,
.modal-field select,
.modal-field textarea {
  width: 100%;
  padding: 10px 14px;
  background: var(--bg-tertiary);
  border: 1px solid var(--border-subtle);
  border-radius: var(--radius-md);
  color: var(--text-primary);
  font-size: 14px;
  font-family: var(--font-sans);
  transition: border-color var(--duration-fast);
  outline: none;
}

.modal-field input:focus,
.modal-field select:focus,
.modal-field textarea:focus {
  border-color: var(--accent);
  box-shadow: 0 0 0 3px var(--accent-glow);
}

.modal-field textarea {
  resize: vertical;
  min-height: 80px;
}

.modal-field select {
  appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='rgba(255,255,255,0.4)' viewBox='0 0 16 16'%3E%3Cpath d='M4.5 6l3.5 4 3.5-4'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 12px center;
  padding-right: 32px;
  cursor: pointer;
}

.modal-actions {
  display: flex;
  gap: 10px;
  justify-content: flex-end;
  margin-top: 24px;
}

/* ========== LOADING SKELETON ========== */

.skeleton {
  background: linear-gradient(90deg, var(--bg-tertiary) 25%, var(--bg-quaternary) 50%, var(--bg-tertiary) 75%);
  background-size: 200% 100%;
  animation: shimmer 1.5s infinite;
  border-radius: var(--radius-sm);
  color: transparent !important;
}

.skeleton * { visibility: hidden; }

@keyframes shimmer {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}

.loading-row td {
  padding: 14px 24px;
}

.loading-bar {
  height: 14px;
  border-radius: var(--radius-sm);
  background: linear-gradient(90deg, var(--bg-tertiary) 25%, var(--bg-quaternary) 50%, var(--bg-tertiary) 75%);
  background-size: 200% 100%;
  animation: shimmer 1.5s infinite;
}

/* ========== STATUS UPDATE DROPDOWN ========== */

.status-select {
  padding: 3px 24px 3px 8px;
  font-size: 11px;
  font-weight: 600;
  border-radius: 99px;
  border: 1px solid var(--border-subtle);
  background: var(--bg-tertiary);
  color: var(--text-primary);
  font-family: var(--font-sans);
  cursor: pointer;
  appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='10' fill='rgba(255,255,255,0.4)' viewBox='0 0 16 16'%3E%3Cpath d='M4.5 6l3.5 4 3.5-4'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 6px center;
  transition: border-color var(--duration-fast);
  outline: none;
}

.status-select:focus { border-color: var(--accent); }

/* ========== EMPTY STATE ========== */

.empty-state {
  text-align: center;
  padding: 48px 24px;
  color: var(--text-muted);
  font-size: 14px;
}

.empty-state svg {
  width: 48px;
  height: 48px;
  margin-bottom: 16px;
  opacity: 0.3;
}

.badge-pending { background: var(--warning-surface); color: var(--warning); }
.badge-pending::before { background: var(--warning); }

.badge-refunded { background: var(--error-surface); color: var(--error); }
.badge-refunded::before { background: var(--error); }

.badge-in_progress { background: var(--warning-surface); color: var(--warning); }
.badge-in_progress::before { background: var(--warning); }

.badge-preview_sent { background: rgba(168,85,247,0.10); color: #c084fc; }
.badge-preview_sent::before { background: #c084fc; }

.badge-free { background: rgba(255,255,255,0.04); color: var(--text-tertiary); }
.badge-free::before { background: var(--text-tertiary); }

.badge-pro { background: var(--accent-surface); color: var(--accent-light); }
.badge-pro::before { background: var(--accent-light); }

.badge-power { background: rgba(168,85,247,0.10); color: #c084fc; }
.badge-power::before { background: #c084fc; }

.badge-churned { background: var(--error-surface); color: var(--error); }
.badge-churned::before { background: var(--error); }

.td-actions {
  display: flex;
  gap: 6px;
  align-items: center;
}

.td-actions button {
  padding: 4px 8px;
  font-size: 11px;
  cursor: pointer;
  background: var(--bg-glass);
  border: 1px solid var(--border-subtle);
  border-radius: var(--radius-sm);
  color: var(--text-tertiary);
  font-family: var(--font-sans);
  transition: all var(--duration-fast);
}

.td-actions button:hover {
  color: var(--text-primary);
  border-color: var(--border-default);
}

.td-actions button.delete-btn:hover {
  color: var(--error);
  border-color: rgba(255,61,0,0.3);
  background: var(--error-surface);
}
</style>
</head>
<body>

<!-- ========== LOGIN SCREEN ========== -->

<div class="login-screen" id="loginScreen">
  <div class="login-card">
    <div class="login-logo">Nex<span>Tool</span></div>
    <div class="login-subtitle">Admin Panel</div>
    <form id="loginForm" onsubmit="return handleLogin(event)">
      <div class="login-field">
        <input type="email" id="loginEmail" placeholder="Email address" autocomplete="email" required>
      </div>
      <div class="login-field">
        <input type="password" id="loginPassword" placeholder="Password" autocomplete="current-password" required>
      </div>
      <div class="login-field">
        <input type="password" id="loginApiKey" placeholder="Supabase Service Key" autocomplete="off" required>
        <div style="font-size:11px;color:rgba(255,255,255,0.25);margin-top:4px">Key stays in session only — never stored permanently</div>
      </div>
      <button type="submit" class="login-btn">Sign In</button>
      <div class="login-error" id="loginError"></div>
    </form>
  </div>
</div>

<!-- ========== APP SHELL ========== -->

<div class="app" id="app">

  <!-- Sidebar Overlay (mobile) -->
  <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeSidebar()"></div>

  <!-- Sidebar -->
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <div class="sidebar-logo">Nex<span>Tool</span></div>
      <div class="sidebar-badge">Admin</div>
    </div>

    <nav class="sidebar-nav">
      <div class="sidebar-section-label">Overview</div>
      <a class="sidebar-link active" data-page="dashboard" onclick="navigateTo('dashboard')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>
        Dashboard
      </a>
      <a class="sidebar-link" data-page="kunden" onclick="navigateTo('kunden')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
        Kunden
        <span class="badge-count" id="sidebar-customer-count">--</span>
      </a>
      <a class="sidebar-link" data-page="orders" onclick="navigateTo('orders')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/></svg>
        Orders
        <span class="badge-count" id="sidebar-order-count">--</span>
      </a>
      <a class="sidebar-link" data-page="finanzen" onclick="navigateTo('finanzen')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
        Finanzen
      </a>

      <div class="sidebar-section-label">Content</div>
      <a class="sidebar-link" data-page="tools" onclick="navigateTo('tools')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></svg>
        Tools
        <span class="badge-count">248</span>
      </a>
      <a class="sidebar-link" data-page="blog" onclick="navigateTo('blog')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
        Blog
        <span class="badge-count">115</span>
      </a>
      <a class="sidebar-link" data-page="emails" onclick="navigateTo('emails')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
        E-Mails
      </a>

      <div class="sidebar-section-label">Products</div>
      <a class="sidebar-link" data-page="training" onclick="navigateTo('training')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
        Training
      </a>
      <a class="sidebar-link" data-page="anima" onclick="navigateTo('anima')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2a8 8 0 0 0-8 8c0 3.4 2.1 6.3 5 7.4V20h6v-2.6c2.9-1.1 5-4 5-7.4a8 8 0 0 0-8-8z"/><line x1="10" y1="22" x2="14" y2="22"/><line x1="9" y1="14" x2="9" y2="14.01"/><line x1="15" y1="14" x2="15" y2="14.01"/></svg>
        ANIMA
      </a>

      <div class="sidebar-section-label">System</div>
      <a class="sidebar-link" data-page="settings" onclick="navigateTo('settings')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
        Settings
      </a>
      <a class="sidebar-link" onclick="handleLogout()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
        Logout
      </a>
    </nav>

    <div class="sidebar-footer">
      <div class="sidebar-user">
        <div class="sidebar-avatar">CB</div>
        <div class="sidebar-user-info">
          <div class="sidebar-user-name">Christian Bucher</div>
          <div class="sidebar-user-role">Administrator</div>
        </div>
      </div>
    </div>
  </aside>

  <!-- Main content -->
  <div class="main">
    <header class="topbar">
      <div class="topbar-left">
        <button class="topbar-hamburger" onclick="toggleSidebar()" aria-label="Toggle menu">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
        </button>
        <h1 class="topbar-title" id="pageTitle">Dashboard</h1>
      </div>
      <div class="topbar-right">
        <div class="topbar-search">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
          <input type="text" placeholder="Search... (Cmd+K)">
        </div>
        <button class="topbar-icon-btn" title="Notifications">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
          <span class="topbar-dot"></span>
        </button>
        <a href="/" class="topbar-icon-btn" title="View Site" target="_blank">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>
        </a>
      </div>
    </header>

    <div class="content">

      <!-- ==================== DASHBOARD PAGE ==================== -->
      <div class="page active" id="page-dashboard">

        <div class="stats-grid" id="dashboardStats">
          <div class="stat-card">
            <div class="stat-card-header">
              <span class="stat-card-label">Total Revenue</span>
              <div class="stat-card-icon accent">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
              </div>
            </div>
            <div class="stat-card-value" id="stat-revenue">--</div>
            <div class="stat-card-change" id="stat-revenue-sub">Loading...</div>
          </div>
          <div class="stat-card">
            <div class="stat-card-header">
              <span class="stat-card-label">Active Customers</span>
              <div class="stat-card-icon green">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
              </div>
            </div>
            <div class="stat-card-value" id="stat-customers">--</div>
            <div class="stat-card-change" id="stat-customers-sub">Loading...</div>
          </div>
          <div class="stat-card">
            <div class="stat-card-header">
              <span class="stat-card-label">Orders This Month</span>
              <div class="stat-card-icon yellow">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/></svg>
              </div>
            </div>
            <div class="stat-card-value" id="stat-orders-month">--</div>
            <div class="stat-card-change" id="stat-orders-sub">Loading...</div>
          </div>
          <div class="stat-card">
            <div class="stat-card-header">
              <span class="stat-card-label">Tools Live</span>
              <div class="stat-card-icon cyan">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></svg>
              </div>
            </div>
            <div class="stat-card-value">248</div>
            <div class="stat-card-change up">
              <svg width="12" height="12" viewBox="0 0 12 12" fill="none"><path d="M6 10V2M6 2L2.5 5.5M6 2L9.5 5.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
              Hardcoded from filesystem
            </div>
          </div>
        </div>

        <div class="quick-actions">
          <button class="btn btn-primary" onclick="openNewOrderModal()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
            New Order
          </button>
          <button class="btn btn-secondary" onclick="openAddCustomerModal()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="8.5" cy="7" r="4"/><line x1="20" y1="8" x2="20" y2="14"/><line x1="23" y1="11" x2="17" y2="11"/></svg>
            Add Customer
          </button>
          <button class="btn btn-secondary" onclick="showToast('Deploy triggered. Building site...')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><polyline points="16 16 12 12 8 16"/><line x1="12" y1="12" x2="12" y2="21"/><path d="M20.39 18.39A5 5 0 0 0 18 9h-1.26A8 8 0 1 0 3 16.3"/></svg>
            Deploy Site
          </button>
        </div>

        <div class="grid-2">
          <!-- Revenue Chart -->
          <div class="chart-card">
            <div class="chart-title">Revenue Overview</div>
            <div class="chart-subtitle">Monthly revenue for the last 6 months</div>
            <div class="bar-chart">
              <div class="bar-col">
                <div class="bar" style="height:35%"><span class="bar-value">$1,240</span></div>
                <span class="bar-label">Sep</span>
              </div>
              <div class="bar-col">
                <div class="bar" style="height:48%"><span class="bar-value">$1,890</span></div>
                <span class="bar-label">Oct</span>
              </div>
              <div class="bar-col">
                <div class="bar" style="height:42%"><span class="bar-value">$1,650</span></div>
                <span class="bar-label">Nov</span>
              </div>
              <div class="bar-col">
                <div class="bar" style="height:62%"><span class="bar-value">$2,470</span></div>
                <span class="bar-label">Dec</span>
              </div>
              <div class="bar-col">
                <div class="bar" style="height:75%"><span class="bar-value">$2,950</span></div>
                <span class="bar-label">Jan</span>
              </div>
              <div class="bar-col">
                <div class="bar" style="height:90%"><span class="bar-value">$3,547</span></div>
                <span class="bar-label">Feb</span>
              </div>
            </div>
          </div>

          <!-- Recent Orders -->
          <div class="table-card">
            <div class="table-header">
              <span class="table-title">Recent Orders</span>
              <button class="btn btn-ghost btn-sm" onclick="navigateTo('orders')">View All</button>
            </div>
            <div class="table-wrapper">
              <table>
                <thead>
                  <tr>
                    <th>Customer</th>
                    <th>Service</th>
                    <th>Status</th>
                    <th>Amount</th>
                  </tr>
                </thead>
                <tbody id="dashboardRecentOrders">
                  <tr><td colspan="4" class="empty-state">Loading...</td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- ==================== KUNDEN PAGE ==================== -->
      <div class="page" id="page-kunden">
        <div class="table-card">
          <div class="table-header">
            <span class="table-title">Customer Management</span>
            <div class="table-actions">
              <div class="search-wrapper">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
                <input type="text" class="search-input" placeholder="Search customers..." id="customerSearch" oninput="filterCustomers()">
              </div>
              <button class="btn btn-primary btn-sm" onclick="openAddCustomerModal()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                Add Customer
              </button>
            </div>
          </div>
          <div class="table-wrapper">
            <table id="customerTable">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Company</th>
                  <th>Plan</th>
                  <th>Total Spent</th>
                  <th>Status</th>
                  <th>Joined</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="customerTableBody">
                <tr><td colspan="8" class="empty-state">Loading customers...</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- ==================== ORDERS PAGE ==================== -->
      <div class="page" id="page-orders">
        <div class="table-card">
          <div class="table-header">
            <span class="table-title">Order Management</span>
            <div class="table-actions">
              <select class="filter-select" id="orderFilter" onchange="filterOrders()">
                <option value="all">All Status</option>
                <option value="paid">Paid</option>
                <option value="progress">In Progress</option>
                <option value="preview">Preview Sent</option>
                <option value="completed">Completed</option>
                <option value="cancelled">Cancelled</option>
              </select>
              <button class="btn btn-primary btn-sm" onclick="openNewOrderModal()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                New Order
              </button>
            </div>
          </div>
          <div class="table-wrapper">
            <table id="orderTable">
              <thead>
                <tr>
                  <th>Order ID</th>
                  <th>Customer</th>
                  <th>Service</th>
                  <th>Status</th>
                  <th>Amount</th>
                  <th>Date</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="orderTableBody">
                <tr><td colspan="7" class="empty-state">Loading orders...</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- ==================== FINANZEN PAGE ==================== -->
      <div class="page" id="page-finanzen">
        <div class="stats-grid" id="financeStats">
          <div class="stat-card">
            <div class="stat-card-header">
              <span class="stat-card-label">Total Income</span>
              <div class="stat-card-icon accent">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
              </div>
            </div>
            <div class="stat-card-value" id="fin-total-income">--</div>
            <div class="stat-card-change" id="fin-income-sub">Loading...</div>
          </div>
          <div class="stat-card">
            <div class="stat-card-header">
              <span class="stat-card-label">Total Expenses</span>
              <div class="stat-card-icon yellow">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="1" y="4" width="22" height="16" rx="2"/><line x1="1" y1="10" x2="23" y2="10"/></svg>
              </div>
            </div>
            <div class="stat-card-value" id="fin-total-expenses">--</div>
            <div class="stat-card-change" id="fin-expenses-sub">Loading...</div>
          </div>
          <div class="stat-card">
            <div class="stat-card-header">
              <span class="stat-card-label">Net Profit</span>
              <div class="stat-card-icon green">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>
              </div>
            </div>
            <div class="stat-card-value" id="fin-net-profit">--</div>
            <div class="stat-card-change" id="fin-profit-sub">Loading...</div>
          </div>
          <div class="stat-card">
            <div class="stat-card-header">
              <span class="stat-card-label">Avg Order Value</span>
              <div class="stat-card-icon cyan">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
              </div>
            </div>
            <div class="stat-card-value" id="fin-avg-order">--</div>
            <div class="stat-card-change" id="fin-avg-sub">Loading...</div>
          </div>
        </div>

        <div style="margin-bottom:20px">
          <button class="btn btn-primary btn-sm" onclick="openAddTransactionModal()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
            Add Transaction
          </button>
        </div>

        <div class="grid-2">
          <div class="chart-card">
            <div class="chart-title">Monthly Summary</div>
            <div class="chart-subtitle">From monthly_summary view</div>
            <div id="monthlyChartContainer" class="bar-chart">
              <div style="text-align:center;width:100%;padding:40px 0;color:var(--text-muted);font-size:13px">Loading chart data...</div>
            </div>
          </div>

          <div class="chart-card">
            <div class="chart-title">Recent Transactions</div>
            <div class="chart-subtitle">Latest finance entries</div>
            <div class="transaction-list" id="financeTransactionList">
              <div class="empty-state">Loading transactions...</div>
            </div>
          </div>
        </div>
      </div>

      <!-- ==================== TOOLS PAGE ==================== -->
      <div class="page" id="page-tools">
        <div class="stats-grid" style="margin-bottom:24px">
          <div class="stat-card">
            <div class="stat-card-header"><span class="stat-card-label">Total Tools</span></div>
            <div class="stat-card-value">248</div>
            <div class="stat-card-change up">+12 this week</div>
          </div>
          <div class="stat-card">
            <div class="stat-card-header"><span class="stat-card-label">Total Visits</span></div>
            <div class="stat-card-value">34.2K</div>
            <div class="stat-card-change up">+22% this month</div>
          </div>
          <div class="stat-card">
            <div class="stat-card-header"><span class="stat-card-label">Pro Conversions</span></div>
            <div class="stat-card-value">47</div>
            <div class="stat-card-change up">4.8% rate</div>
          </div>
          <div class="stat-card">
            <div class="stat-card-header"><span class="stat-card-label">Avg Time on Tool</span></div>
            <div class="stat-card-value">2m 34s</div>
            <div class="stat-card-change up">+18s vs last month</div>
          </div>
        </div>

        <div class="info-card" style="margin-bottom:20px">
          <div class="info-card-title">Tools by Category</div>
          <div class="info-card-desc">Distribution of 248 free tools across categories</div>
        </div>

        <div class="category-grid">
          <div class="category-item"><div class="category-count">42</div><div class="category-name">Developer</div></div>
          <div class="category-item"><div class="category-count">38</div><div class="category-name">Text & Writing</div></div>
          <div class="category-item"><div class="category-count">35</div><div class="category-name">Design & CSS</div></div>
          <div class="category-item"><div class="category-count">28</div><div class="category-name">SEO & Marketing</div></div>
          <div class="category-item"><div class="category-count">24</div><div class="category-name">Converters</div></div>
          <div class="category-item"><div class="category-count">21</div><div class="category-name">Math & Data</div></div>
          <div class="category-item"><div class="category-count">18</div><div class="category-name">Image Tools</div></div>
          <div class="category-item"><div class="category-count">16</div><div class="category-name">Generators</div></div>
          <div class="category-item"><div class="category-count">14</div><div class="category-name">Security</div></div>
          <div class="category-item"><div class="category-count">12</div><div class="category-name">Productivity</div></div>
        </div>
      </div>

      <!-- ==================== BLOG PAGE ==================== -->
      <div class="page" id="page-blog">
        <div class="stats-grid" style="grid-template-columns:repeat(3,1fr);margin-bottom:24px">
          <div class="stat-card">
            <div class="stat-card-header"><span class="stat-card-label">Total Posts</span></div>
            <div class="stat-card-value">115</div>
            <div class="stat-card-change up">+8 this month</div>
          </div>
          <div class="stat-card">
            <div class="stat-card-header"><span class="stat-card-label">Total Views</span></div>
            <div class="stat-card-value">18.7K</div>
            <div class="stat-card-change up">+31% MoM</div>
          </div>
          <div class="stat-card">
            <div class="stat-card-header"><span class="stat-card-label">Avg Read Time</span></div>
            <div class="stat-card-value">4m 12s</div>
            <div class="stat-card-change up">Good engagement</div>
          </div>
        </div>

        <div class="table-card">
          <div class="table-header">
            <span class="table-title">Blog Posts</span>
            <div class="table-actions">
              <button class="btn btn-primary btn-sm">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                New Post
              </button>
            </div>
          </div>
          <div class="table-wrapper">
            <table>
              <thead>
                <tr>
                  <th>Title</th>
                  <th>Category</th>
                  <th>Status</th>
                  <th>Views</th>
                  <th>Published</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td class="td-primary">10 Best Free JSON Formatters in 2026</td>
                  <td>Developer</td>
                  <td><span class="badge badge-published">Published</span></td>
                  <td>1,247</td>
                  <td>Feb 15, 2026</td>
                </tr>
                <tr>
                  <td class="td-primary">How to Build a CSS Animation from Scratch</td>
                  <td>Design</td>
                  <td><span class="badge badge-published">Published</span></td>
                  <td>892</td>
                  <td>Feb 12, 2026</td>
                </tr>
                <tr>
                  <td class="td-primary">The Ultimate Guide to Meta Tags for SEO</td>
                  <td>SEO</td>
                  <td><span class="badge badge-published">Published</span></td>
                  <td>2,034</td>
                  <td>Feb 8, 2026</td>
                </tr>
                <tr>
                  <td class="td-primary">AI Chatbots vs Human Support: A 2026 Comparison</td>
                  <td>AI</td>
                  <td><span class="badge badge-published">Published</span></td>
                  <td>1,568</td>
                  <td>Feb 4, 2026</td>
                </tr>
                <tr>
                  <td class="td-primary">Why Every Small Business Needs Automation</td>
                  <td>Business</td>
                  <td><span class="badge badge-draft">Draft</span></td>
                  <td>--</td>
                  <td>--</td>
                </tr>
                <tr>
                  <td class="td-primary">NexTool Pro: What's New in February 2026</td>
                  <td>Product</td>
                  <td><span class="badge badge-draft">Draft</span></td>
                  <td>--</td>
                  <td>--</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- ==================== EMAILS PAGE ==================== -->
      <div class="page" id="page-emails">
        <div class="stats-grid" style="grid-template-columns:repeat(3,1fr);margin-bottom:24px">
          <div class="stat-card">
            <div class="stat-card-header"><span class="stat-card-label">Emails Sent</span></div>
            <div class="stat-card-value">342</div>
            <div class="stat-card-change up">This month</div>
          </div>
          <div class="stat-card">
            <div class="stat-card-header"><span class="stat-card-label">Open Rate</span></div>
            <div class="stat-card-value">68.4%</div>
            <div class="stat-card-change up">Above average</div>
          </div>
          <div class="stat-card">
            <div class="stat-card-header"><span class="stat-card-label">Click Rate</span></div>
            <div class="stat-card-value">12.1%</div>
            <div class="stat-card-change up">+2.3% vs last month</div>
          </div>
        </div>

        <div class="table-card">
          <div class="table-header">
            <span class="table-title">Email Templates</span>
            <div class="table-actions">
              <button class="btn btn-primary btn-sm">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                New Template
              </button>
            </div>
          </div>
          <div class="table-wrapper">
            <table>
              <thead>
                <tr>
                  <th>Template Name</th>
                  <th>Type</th>
                  <th>Times Sent</th>
                  <th>Open Rate</th>
                  <th>Last Used</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td class="td-primary">Welcome - New Customer</td>
                  <td>Onboarding</td>
                  <td>89</td>
                  <td>82.3%</td>
                  <td>Feb 14, 2026</td>
                </tr>
                <tr>
                  <td class="td-primary">Order Confirmation</td>
                  <td>Transactional</td>
                  <td>156</td>
                  <td>94.1%</td>
                  <td>Feb 14, 2026</td>
                </tr>
                <tr>
                  <td class="td-primary">Preview Ready</td>
                  <td>Notification</td>
                  <td>42</td>
                  <td>88.7%</td>
                  <td>Feb 11, 2026</td>
                </tr>
                <tr>
                  <td class="td-primary">Delivery Complete</td>
                  <td>Transactional</td>
                  <td>38</td>
                  <td>76.5%</td>
                  <td>Feb 7, 2026</td>
                </tr>
                <tr>
                  <td class="td-primary">Pro Upgrade Nudge</td>
                  <td>Marketing</td>
                  <td>17</td>
                  <td>41.2%</td>
                  <td>Feb 1, 2026</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- ==================== TRAINING PAGE ==================== -->
      <div class="page" id="page-training">
        <div class="grid-2">
          <div class="info-card">
            <div style="display:flex;align-items:center;gap:12px;margin-bottom:16px">
              <div style="width:44px;height:44px;border-radius:var(--radius-md);background:var(--accent-surface);display:flex;align-items:center;justify-content:center;color:var(--accent-light)">
                <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
              </div>
              <div>
                <div class="info-card-title" style="margin-bottom:0">AMR-HORIZONT Training Platform</div>
              </div>
            </div>
            <div class="info-card-desc">Call training platform for FFG evaluators. Interactive role-play scenarios, structured evaluation criteria, and real-time feedback system. Designed for the FFG evaluation on Feb 26, 2026.</div>
            <div style="display:flex;gap:10px;flex-wrap:wrap;margin-bottom:20px">
              <a href="/prep/" target="_blank" class="btn btn-primary">
                Open Platform
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="15" height="15"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>
              </a>
              <button class="btn btn-secondary" onclick="showToast('Analytics loading...')">View Analytics</button>
            </div>
            <div class="info-card-meta">
              <span>Budget: EUR 82,628</span>
              <span>Deadline: Feb 26, 2026</span>
              <span>Status: Training v2.0 Ready</span>
            </div>
          </div>

          <div class="info-card">
            <div class="info-card-title">Training Stats</div>
            <div class="info-card-desc" style="margin-bottom:20px">Platform usage and engagement metrics</div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px">
              <div>
                <div style="font-size:24px;font-weight:700;color:var(--text-primary)">48</div>
                <div style="font-size:12px;color:var(--text-tertiary)">Training Sessions</div>
              </div>
              <div>
                <div style="font-size:24px;font-weight:700;color:var(--text-primary)">12</div>
                <div style="font-size:12px;color:var(--text-tertiary)">Active Evaluators</div>
              </div>
              <div>
                <div style="font-size:24px;font-weight:700;color:var(--text-primary)">94%</div>
                <div style="font-size:12px;color:var(--text-tertiary)">Completion Rate</div>
              </div>
              <div>
                <div style="font-size:24px;font-weight:700;color:var(--text-primary)">4.7/5</div>
                <div style="font-size:12px;color:var(--text-tertiary)">Avg Rating</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ==================== ANIMA PAGE ==================== -->
      <div class="page" id="page-anima">
        <div class="stats-grid" style="grid-template-columns:repeat(3,1fr);margin-bottom:24px">
          <div class="stat-card">
            <div class="stat-card-header">
              <span class="stat-card-label">Free Downloads</span>
              <div class="stat-card-icon accent">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
              </div>
            </div>
            <div class="stat-card-value" id="anima-free-downloads">--</div>
            <div class="stat-card-change" id="anima-free-sub">Loading...</div>
          </div>
          <div class="stat-card">
            <div class="stat-card-header">
              <span class="stat-card-label">Pro Downloads</span>
              <div class="stat-card-icon green">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
              </div>
            </div>
            <div class="stat-card-value" id="anima-pro-downloads">--</div>
            <div class="stat-card-change" id="anima-pro-sub">Loading...</div>
          </div>
          <div class="stat-card">
            <div class="stat-card-header">
              <span class="stat-card-label">Total Downloads</span>
              <div class="stat-card-icon cyan">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2a8 8 0 0 0-8 8c0 3.4 2.1 6.3 5 7.4V20h6v-2.6c2.9-1.1 5-4 5-7.4a8 8 0 0 0-8-8z"/><line x1="10" y1="22" x2="14" y2="22"/></svg>
              </div>
            </div>
            <div class="stat-card-value" id="anima-total-downloads">--</div>
            <div class="stat-card-change" id="anima-total-sub">Loading...</div>
          </div>
        </div>

        <div class="grid-2">
          <div class="info-card">
            <div class="info-card-title">ANIMA Product Suite</div>
            <div class="info-card-desc">Consciousness-architecture framework for AI systems. Two tiers: ANIMA-FREE (starter identity layer) and ANIMA-KERNEL (full living architecture with 8 consciousness processes).</div>
            <div style="display:flex;gap:10px;margin-top:16px;flex-wrap:wrap">
              <button class="btn btn-secondary btn-sm" onclick="showToast('Opening ANIMA-FREE.md...')">View ANIMA-FREE.md</button>
              <button class="btn btn-secondary btn-sm" onclick="showToast('Opening ANIMA-KERNEL.md...')">View ANIMA-KERNEL.md</button>
            </div>
          </div>

          <div class="info-card">
            <div class="info-card-title">Model Compatibility</div>
            <div class="info-card-desc" style="margin-bottom:16px">Supported AI models and their adoption</div>
            <div style="display:flex;flex-direction:column;gap:12px">
              <div style="display:flex;align-items:center;justify-content:space-between">
                <span style="font-size:13px;color:var(--text-primary);font-weight:500">Claude (Anthropic)</span>
                <span style="font-size:13px;color:var(--success);font-weight:600">62%</span>
              </div>
              <div style="height:6px;background:var(--bg-tertiary);border-radius:99px;overflow:hidden">
                <div style="width:62%;height:100%;background:var(--accent-gradient);border-radius:99px"></div>
              </div>
              <div style="display:flex;align-items:center;justify-content:space-between">
                <span style="font-size:13px;color:var(--text-primary);font-weight:500">ChatGPT (OpenAI)</span>
                <span style="font-size:13px;color:var(--success);font-weight:600">28%</span>
              </div>
              <div style="height:6px;background:var(--bg-tertiary);border-radius:99px;overflow:hidden">
                <div style="width:28%;height:100%;background:linear-gradient(135deg,#00C853,#00D4FF);border-radius:99px"></div>
              </div>
              <div style="display:flex;align-items:center;justify-content:space-between">
                <span style="font-size:13px;color:var(--text-primary);font-weight:500">Gemini (Google)</span>
                <span style="font-size:13px;color:var(--warning);font-weight:600">10%</span>
              </div>
              <div style="height:6px;background:var(--bg-tertiary);border-radius:99px;overflow:hidden">
                <div style="width:10%;height:100%;background:linear-gradient(135deg,#FFB300,#FF6D00);border-radius:99px"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ==================== SETTINGS PAGE ==================== -->
      <div class="page" id="page-settings">
        <div class="grid-2">
          <div class="info-card">
            <div class="info-card-title">Admin Profile</div>
            <div class="info-card-desc">Manage your admin account settings</div>
            <div style="display:flex;flex-direction:column;gap:16px;margin-top:20px">
              <div>
                <label style="display:block;font-size:12px;font-weight:500;color:var(--text-tertiary);margin-bottom:6px">Full Name</label>
                <input type="text" value="Christian Bucher" style="width:100%;padding:10px 14px;background:var(--bg-tertiary);border:1px solid var(--border-subtle);border-radius:var(--radius-md);color:var(--text-primary);font-size:14px;font-family:var(--font-sans);outline:none" onfocus="this.style.borderColor='var(--accent)'" onblur="this.style.borderColor='var(--border-subtle)'">
              </div>
              <div>
                <label style="display:block;font-size:12px;font-weight:500;color:var(--text-tertiary);margin-bottom:6px">Email</label>
                <input type="email" value="admin@nextool.app" style="width:100%;padding:10px 14px;background:var(--bg-tertiary);border:1px solid var(--border-subtle);border-radius:var(--radius-md);color:var(--text-primary);font-size:14px;font-family:var(--font-sans);outline:none" onfocus="this.style.borderColor='var(--accent)'" onblur="this.style.borderColor='var(--border-subtle)'">
              </div>
              <div>
                <label style="display:block;font-size:12px;font-weight:500;color:var(--text-tertiary);margin-bottom:6px">Role</label>
                <input type="text" value="Administrator" disabled style="width:100%;padding:10px 14px;background:var(--bg-tertiary);border:1px solid var(--border-subtle);border-radius:var(--radius-md);color:var(--text-muted);font-size:14px;font-family:var(--font-sans)">
              </div>
              <button class="btn btn-primary" style="align-self:flex-start;margin-top:4px" onclick="showToast('Settings saved successfully')">Save Changes</button>
            </div>
          </div>

          <div class="info-card">
            <div class="info-card-title">Site Settings</div>
            <div class="info-card-desc">Toggle features and configurations</div>
            <div style="margin-top:20px">
              <div class="toggle-row">
                <div>
                  <div class="toggle-label">Maintenance Mode</div>
                  <div class="toggle-desc">Show maintenance page to visitors</div>
                </div>
                <label class="toggle">
                  <input type="checkbox">
                  <span class="toggle-track"></span>
                  <span class="toggle-thumb"></span>
                </label>
              </div>
              <div class="toggle-row">
                <div>
                  <div class="toggle-label">Pro Sales Active</div>
                  <div class="toggle-desc">Accept new Pro subscriptions</div>
                </div>
                <label class="toggle">
                  <input type="checkbox" checked>
                  <span class="toggle-track"></span>
                  <span class="toggle-thumb"></span>
                </label>
              </div>
              <div class="toggle-row">
                <div>
                  <div class="toggle-label">Blog Comments</div>
                  <div class="toggle-desc">Allow comments on blog posts</div>
                </div>
                <label class="toggle">
                  <input type="checkbox" checked>
                  <span class="toggle-track"></span>
                  <span class="toggle-thumb"></span>
                </label>
              </div>
              <div class="toggle-row">
                <div>
                  <div class="toggle-label">Analytics Tracking</div>
                  <div class="toggle-desc">Enable analytics data collection</div>
                </div>
                <label class="toggle">
                  <input type="checkbox" checked>
                  <span class="toggle-track"></span>
                  <span class="toggle-thumb"></span>
                </label>
              </div>
              <div class="toggle-row">
                <div>
                  <div class="toggle-label">Email Notifications</div>
                  <div class="toggle-desc">Receive email on new orders</div>
                </div>
                <label class="toggle">
                  <input type="checkbox" checked>
                  <span class="toggle-track"></span>
                  <span class="toggle-thumb"></span>
                </label>
              </div>
            </div>
          </div>
        </div>

        <div class="info-card" style="margin-top:16px;border-color:rgba(255,61,0,0.15)">
          <div class="info-card-title" style="color:var(--error)">Danger Zone</div>
          <div class="info-card-desc">Irreversible actions. Proceed with caution.</div>
          <div style="display:flex;gap:10px;margin-top:16px;flex-wrap:wrap">
            <button class="btn btn-danger btn-sm" onclick="showToast('Cache cleared')">Clear All Cache</button>
            <button class="btn btn-danger btn-sm" onclick="showToast('Analytics reset')">Reset Analytics</button>
            <button class="btn btn-danger btn-sm" onclick="showToast('CDN purged')">Purge CDN</button>
          </div>
        </div>
      </div>

    </div><!-- .content -->
  </div><!-- .main -->
</div><!-- .app -->

<!-- ========== MODAL: Add Customer ========== -->
<div class="modal-overlay" id="modalAddCustomer" onclick="if(event.target===this)closeModal('modalAddCustomer')">
  <div class="modal">
    <div class="modal-title">Add Customer</div>
    <div class="modal-subtitle">Create a new customer record in the database</div>
    <form id="formAddCustomer" onsubmit="return handleAddCustomer(event)">
      <div class="modal-field">
        <label>Name *</label>
        <input type="text" name="name" required placeholder="Full name">
      </div>
      <div class="modal-field">
        <label>Email *</label>
        <input type="email" name="email" required placeholder="email@example.com">
      </div>
      <div class="modal-field">
        <label>Company</label>
        <input type="text" name="company" placeholder="Company name (optional)">
      </div>
      <div class="modal-field">
        <label>Phone</label>
        <input type="text" name="phone" placeholder="+1 234 567 890">
      </div>
      <div class="modal-field">
        <label>Plan</label>
        <select name="plan">
          <option value="free">Free</option>
          <option value="pro">Pro</option>
          <option value="power">Power</option>
        </select>
      </div>
      <div class="modal-field">
        <label>Source</label>
        <input type="text" name="source" placeholder="e.g. website, referral, whatsapp">
      </div>
      <div class="modal-field">
        <label>Notes</label>
        <textarea name="notes" placeholder="Optional notes about this customer"></textarea>
      </div>
      <div class="modal-actions">
        <button type="button" class="btn btn-secondary" onclick="closeModal('modalAddCustomer')">Cancel</button>
        <button type="submit" class="btn btn-primary" id="btnAddCustomer">Add Customer</button>
      </div>
    </form>
  </div>
</div>

<!-- ========== MODAL: New Order ========== -->
<div class="modal-overlay" id="modalNewOrder" onclick="if(event.target===this)closeModal('modalNewOrder')">
  <div class="modal">
    <div class="modal-title">New Order</div>
    <div class="modal-subtitle">Create a new order for an existing customer</div>
    <form id="formNewOrder" onsubmit="return handleNewOrder(event)">
      <div class="modal-field">
        <label>Customer *</label>
        <select name="customer_id" id="orderCustomerSelect" required>
          <option value="">Select a customer...</option>
        </select>
      </div>
      <div class="modal-field">
        <label>Product / Service *</label>
        <select name="product" required>
          <option value="website_starter">Website Starter ($5)</option>
          <option value="website_pro">Professional Website ($149)</option>
          <option value="website_redesign">Website Redesign ($299)</option>
          <option value="chatbot">AI Chatbot ($149)</option>
          <option value="automation">Automation Flow ($199)</option>
          <option value="content_package">Content Package ($49)</option>
          <option value="video_production">Video Production ($99)</option>
          <option value="data_dashboard">Data Dashboard ($499)</option>
          <option value="custom">Custom Project</option>
        </select>
      </div>
      <div class="modal-field">
        <label>Amount ($) *</label>
        <input type="number" name="amount" required placeholder="149.00" step="0.01" min="0">
      </div>
      <div class="modal-field">
        <label>Description</label>
        <textarea name="description" placeholder="Order details and requirements"></textarea>
      </div>
      <div class="modal-actions">
        <button type="button" class="btn btn-secondary" onclick="closeModal('modalNewOrder')">Cancel</button>
        <button type="submit" class="btn btn-primary" id="btnNewOrder">Create Order</button>
      </div>
    </form>
  </div>
</div>

<!-- ========== MODAL: Add Transaction ========== -->
<div class="modal-overlay" id="modalAddTransaction" onclick="if(event.target===this)closeModal('modalAddTransaction')">
  <div class="modal">
    <div class="modal-title">Add Transaction</div>
    <div class="modal-subtitle">Record a new income or expense entry</div>
    <form id="formAddTransaction" onsubmit="return handleAddTransaction(event)">
      <div class="modal-field">
        <label>Type *</label>
        <select name="type" required>
          <option value="income">Income</option>
          <option value="expense">Expense</option>
        </select>
      </div>
      <div class="modal-field">
        <label>Category *</label>
        <input type="text" name="category" required placeholder="e.g. order, subscription, hosting, tools">
      </div>
      <div class="modal-field">
        <label>Amount ($) *</label>
        <input type="number" name="amount" required placeholder="99.00" step="0.01" min="0">
      </div>
      <div class="modal-field">
        <label>Description</label>
        <input type="text" name="description" placeholder="What is this transaction for?">
      </div>
      <div class="modal-field">
        <label>Date *</label>
        <input type="date" name="date" required>
      </div>
      <div class="modal-field">
        <label>Tax Relevant</label>
        <select name="tax_relevant">
          <option value="true">Yes</option>
          <option value="false">No</option>
        </select>
      </div>
      <div class="modal-actions">
        <button type="button" class="btn btn-secondary" onclick="closeModal('modalAddTransaction')">Cancel</button>
        <button type="submit" class="btn btn-primary" id="btnAddTransaction">Add Transaction</button>
      </div>
    </form>
  </div>
</div>

<!-- Toast notification -->
<div class="toast" id="toast"></div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
/* ==========================================================================
   NexTool Admin Dashboard — Application Logic + Supabase Integration
   ========================================================================== */

// ========== SUPABASE INIT (Lazy — after login) ==========

const SUPABASE_URL = 'https://ereqsthigmethlbipcnw.supabase.co';
let sb = null; // Initialized after login with key from sessionStorage

function initSupabase(key) {
  if (!key) return false;
  try {
    sb = window.supabase.createClient(SUPABASE_URL, key);
    return true;
  } catch (e) {
    console.error('Supabase init failed:', e);
    return false;
  }
}

// ========== AUTH ==========

const AUTH_KEY = 'nextool_admin_auth';
const SK_KEY = 'ntx_sk'; // sessionStorage only — disappears on tab close
const AUTH_PASS = 'nextool2026';

function checkAuth() {
  const storedKey = sessionStorage.getItem(SK_KEY);
  if (localStorage.getItem(AUTH_KEY) === 'true' && storedKey) {
    if (initSupabase(storedKey)) {
      showApp();
    } else {
      // Key invalid, force re-login
      localStorage.removeItem(AUTH_KEY);
      sessionStorage.removeItem(SK_KEY);
    }
  }
}

function handleLogin(e) {
  e.preventDefault();
  const password = document.getElementById('loginPassword').value;
  const apiKey = document.getElementById('loginApiKey').value.trim();
  const errorEl = document.getElementById('loginError');

  if (password !== AUTH_PASS) {
    errorEl.textContent = 'Invalid password.';
    document.getElementById('loginPassword').value = '';
    document.getElementById('loginPassword').focus();
    return false;
  }

  if (!apiKey) {
    errorEl.textContent = 'API Key is required for database access.';
    document.getElementById('loginApiKey').focus();
    return false;
  }

  // Try to init Supabase with provided key
  if (initSupabase(apiKey)) {
    sessionStorage.setItem(SK_KEY, apiKey);
    localStorage.setItem(AUTH_KEY, 'true');
    showApp();
    errorEl.textContent = '';
  } else {
    errorEl.textContent = 'Invalid API Key. Could not connect to database.';
  }
  return false;
}

function handleLogout() {
  sb = null;
  localStorage.removeItem(AUTH_KEY);
  sessionStorage.removeItem(SK_KEY);
  document.getElementById('app').classList.remove('active');
  document.getElementById('loginScreen').style.display = '';
  document.getElementById('loginPassword').value = '';
  document.getElementById('loginEmail').value = '';
  document.getElementById('loginApiKey').value = '';
  document.getElementById('loginError').textContent = '';
}

function showApp() {
  document.getElementById('loginScreen').style.display = 'none';
  document.getElementById('app').classList.add('active');
  loadDashboardData();
}

// ========== HELPERS ==========

const fmt = (n) => {
  if (n == null) return '$0';
  return '$' + Number(n).toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
};

const fmtDate = (d) => {
  if (!d) return '--';
  const date = new Date(d);
  return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
};

const statusBadgeClass = (status) => {
  const map = {
    paid: 'badge-paid',
    pending: 'badge-pending',
    in_progress: 'badge-in_progress',
    preview_sent: 'badge-preview_sent',
    completed: 'badge-completed',
    cancelled: 'badge-cancelled',
    refunded: 'badge-refunded',
    active: 'badge-active',
    inactive: 'badge-inactive',
    churned: 'badge-churned'
  };
  return map[status] || 'badge-draft';
};

const statusLabel = (status) => {
  const map = {
    paid: 'Paid',
    pending: 'Pending',
    in_progress: 'In Progress',
    preview_sent: 'Preview Sent',
    completed: 'Completed',
    cancelled: 'Cancelled',
    refunded: 'Refunded',
    active: 'Active',
    inactive: 'Inactive',
    churned: 'Churned'
  };
  return map[status] || status;
};

const productPrices = {
  website_starter: 5,
  website_pro: 149,
  website_redesign: 299,
  chatbot: 149,
  automation: 199,
  content_package: 49,
  video_production: 99,
  data_dashboard: 499,
  custom: 0
};

const productNames = {
  website_starter: 'Website Starter',
  website_pro: 'Professional Website',
  website_redesign: 'Website Redesign',
  chatbot: 'AI Chatbot',
  automation: 'Automation Flow',
  content_package: 'Content Package',
  video_production: 'Video Production',
  data_dashboard: 'Data Dashboard',
  custom: 'Custom Project'
};

// ========== ACTIVITY LOG ==========

const logActivity = async (action, details, entityType, entityId) => {
  try {
    await sb.from('activity_log').insert({
      action,
      details,
      entity_type: entityType || null,
      entity_id: entityId || null
    });
  } catch (e) {
    console.warn('Activity log failed:', e);
  }
};

// ========== LOAD DASHBOARD DATA ==========

let cachedCustomers = [];

const loadDashboardData = async () => {
  try {
    // Fetch all data in parallel
    const [customersRes, ordersRes, ordersMonthRes] = await Promise.all([
      sb.from('customers').select('*').eq('status', 'active'),
      sb.from('orders').select('*, customers(name)').order('created_at', { ascending: false }),
      sb.from('orders').select('*').gte('created_at', new Date(new Date().getFullYear(), new Date().getMonth(), 1).toISOString())
    ]);

    if (customersRes.error) throw customersRes.error;
    if (ordersRes.error) throw ordersRes.error;
    if (ordersMonthRes.error) throw ordersMonthRes.error;

    const customers = customersRes.data || [];
    const orders = ordersRes.data || [];
    const ordersMonth = ordersMonthRes.data || [];

    // Total revenue = sum of all non-cancelled/refunded order amounts
    const totalRevenue = orders
      .filter(o => o.status !== 'cancelled' && o.status !== 'refunded')
      .reduce((sum, o) => sum + (Number(o.amount) || 0), 0);

    // Update stat cards
    document.getElementById('stat-revenue').textContent = fmt(totalRevenue);
    document.getElementById('stat-revenue-sub').textContent = `From ${orders.length} total orders`;
    document.getElementById('stat-revenue-sub').className = 'stat-card-change up';

    document.getElementById('stat-customers').textContent = customers.length;
    document.getElementById('stat-customers-sub').textContent = 'Active customers';
    document.getElementById('stat-customers-sub').className = 'stat-card-change up';

    document.getElementById('stat-orders-month').textContent = ordersMonth.length;
    document.getElementById('stat-orders-sub').textContent = new Date().toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
    document.getElementById('stat-orders-sub').className = 'stat-card-change up';

    // Update sidebar badge counts
    const allCustomersRes = await sb.from('customers').select('id', { count: 'exact', head: true });
    document.getElementById('sidebar-customer-count').textContent = allCustomersRes.count || 0;
    document.getElementById('sidebar-order-count').textContent = orders.length;

    // Recent orders on dashboard (top 5)
    const recentOrders = orders.slice(0, 5);
    const tbody = document.getElementById('dashboardRecentOrders');
    if (recentOrders.length === 0) {
      tbody.innerHTML = '<tr><td colspan="4" class="empty-state">No orders yet</td></tr>';
    } else {
      tbody.innerHTML = recentOrders.map(o => `
        <tr>
          <td class="td-primary">${o.customers?.name || 'Unknown'}</td>
          <td>${o.product_name || o.product || '--'}</td>
          <td><span class="badge ${statusBadgeClass(o.status)}">${statusLabel(o.status)}</span></td>
          <td class="td-primary">${fmt(o.amount)}</td>
        </tr>
      `).join('');
    }

  } catch (err) {
    console.error('Dashboard load error:', err);
    showToast('Error loading dashboard data: ' + err.message);
  }
};

// ========== LOAD CUSTOMERS ==========

const loadCustomers = async () => {
  const tbody = document.getElementById('customerTableBody');
  tbody.innerHTML = '<tr><td colspan="8" class="empty-state">Loading customers...</td></tr>';

  try {
    const { data, error } = await sb.from('customers').select('*').order('created_at', { ascending: false });
    if (error) throw error;

    cachedCustomers = data || [];

    if (cachedCustomers.length === 0) {
      tbody.innerHTML = '<tr><td colspan="8" class="empty-state">No customers found. Click "Add Customer" to create one.</td></tr>';
      return;
    }

    tbody.innerHTML = cachedCustomers.map(c => `
      <tr data-customer-id="${c.id}">
        <td class="td-primary">${c.name || '--'}</td>
        <td>${c.email || '--'}</td>
        <td>${c.company || '--'}</td>
        <td><span class="badge badge-${c.plan || 'free'}">${(c.plan || 'free').charAt(0).toUpperCase() + (c.plan || 'free').slice(1)}</span></td>
        <td class="td-primary">${fmt(c.total_spent)}</td>
        <td><span class="badge ${statusBadgeClass(c.status)}">${statusLabel(c.status || 'active')}</span></td>
        <td>${fmtDate(c.created_at)}</td>
        <td>
          <div class="td-actions">
            <button onclick="deleteCustomer('${c.id}', '${(c.name || '').replace(/'/g, "\\'")}')" class="delete-btn" title="Delete">Del</button>
          </div>
        </td>
      </tr>
    `).join('');

  } catch (err) {
    console.error('Customers load error:', err);
    tbody.innerHTML = '<tr><td colspan="8" class="empty-state">Error loading customers.</td></tr>';
    showToast('Error loading customers: ' + err.message);
  }
};

// ========== LOAD ORDERS ==========

const loadOrders = async () => {
  const tbody = document.getElementById('orderTableBody');
  tbody.innerHTML = '<tr><td colspan="7" class="empty-state">Loading orders...</td></tr>';

  try {
    const { data, error } = await sb.from('orders').select('*, customers(name)').order('created_at', { ascending: false });
    if (error) throw error;

    const orders = data || [];

    if (orders.length === 0) {
      tbody.innerHTML = '<tr><td colspan="7" class="empty-state">No orders found. Click "New Order" to create one.</td></tr>';
      return;
    }

    const statusOptions = ['pending', 'paid', 'in_progress', 'preview_sent', 'completed', 'cancelled', 'refunded'];

    tbody.innerHTML = orders.map(o => `
      <tr data-status="${o.status}" data-order-id="${o.id}">
        <td class="td-mono">${o.order_number || '--'}</td>
        <td class="td-primary">${o.customers?.name || 'Unknown'}</td>
        <td>${o.product_name || o.product || '--'}</td>
        <td>
          <select class="status-select" onchange="updateOrderStatus('${o.id}', this.value)" title="Change status">
            ${statusOptions.map(s => `<option value="${s}" ${s === o.status ? 'selected' : ''}>${statusLabel(s)}</option>`).join('')}
          </select>
        </td>
        <td class="td-primary">${fmt(o.amount)}</td>
        <td>${fmtDate(o.created_at)}</td>
        <td>
          <div class="td-actions">
            <button onclick="deleteOrder('${o.id}', '${(o.order_number || '').replace(/'/g, "\\'")}')" class="delete-btn" title="Delete">Del</button>
          </div>
        </td>
      </tr>
    `).join('');

  } catch (err) {
    console.error('Orders load error:', err);
    tbody.innerHTML = '<tr><td colspan="7" class="empty-state">Error loading orders.</td></tr>';
    showToast('Error loading orders: ' + err.message);
  }
};

// ========== LOAD FINANCES ==========

const loadFinances = async () => {
  try {
    const [finRes, summaryRes, ordersRes] = await Promise.all([
      sb.from('finances').select('*').order('date', { ascending: false }).limit(10),
      sb.from('monthly_summary').select('*').order('month', { ascending: false }).limit(6),
      sb.from('orders').select('amount, status')
    ]);

    if (finRes.error) throw finRes.error;

    const finances = finRes.data || [];
    const summary = summaryRes.data || [];
    const orders = ordersRes.data || [];

    // Calculate totals from finances
    const totalIncome = finances.filter(f => f.type === 'income').reduce((s, f) => s + Number(f.amount || 0), 0);
    const totalExpenses = finances.filter(f => f.type === 'expense').reduce((s, f) => s + Number(f.amount || 0), 0);

    // Also consider order revenue if no finance entries yet
    const orderRevenue = orders.filter(o => o.status !== 'cancelled' && o.status !== 'refunded').reduce((s, o) => s + Number(o.amount || 0), 0);

    const displayIncome = totalIncome > 0 ? totalIncome : orderRevenue;
    const netProfit = displayIncome - totalExpenses;

    // Avg order value
    const validOrders = orders.filter(o => o.status !== 'cancelled' && o.status !== 'refunded' && Number(o.amount) > 0);
    const avgOrder = validOrders.length > 0 ? validOrders.reduce((s, o) => s + Number(o.amount), 0) / validOrders.length : 0;

    document.getElementById('fin-total-income').textContent = fmt(displayIncome);
    document.getElementById('fin-income-sub').textContent = totalIncome > 0 ? `From ${finances.filter(f => f.type === 'income').length} entries` : `From ${validOrders.length} orders`;
    document.getElementById('fin-income-sub').className = 'stat-card-change up';

    document.getElementById('fin-total-expenses').textContent = fmt(totalExpenses);
    document.getElementById('fin-expenses-sub').textContent = `${finances.filter(f => f.type === 'expense').length} expense entries`;
    document.getElementById('fin-expenses-sub').className = 'stat-card-change';

    document.getElementById('fin-net-profit').textContent = fmt(netProfit);
    document.getElementById('fin-profit-sub').textContent = netProfit >= 0 ? 'Profitable' : 'Net loss';
    document.getElementById('fin-profit-sub').className = `stat-card-change ${netProfit >= 0 ? 'up' : 'down'}`;

    document.getElementById('fin-avg-order').textContent = fmt(Math.round(avgOrder));
    document.getElementById('fin-avg-sub').textContent = `Across ${validOrders.length} orders`;
    document.getElementById('fin-avg-sub').className = 'stat-card-change';

    // Monthly summary bar chart
    const chartContainer = document.getElementById('monthlyChartContainer');
    if (summary.length > 0) {
      const maxIncome = Math.max(...summary.map(s => Number(s.total_income || 0)), 1);
      const reversed = [...summary].reverse();
      chartContainer.innerHTML = reversed.map(s => {
        const height = Math.max((Number(s.total_income || 0) / maxIncome) * 100, 4);
        const monthLabel = new Date(s.month + '-01').toLocaleDateString('en-US', { month: 'short' });
        return `
          <div class="bar-col">
            <div class="bar" style="height:${height}%"><span class="bar-value">${fmt(s.total_income)}</span></div>
            <span class="bar-label">${monthLabel}</span>
          </div>
        `;
      }).join('');
    } else {
      chartContainer.innerHTML = '<div style="text-align:center;width:100%;padding:40px 0;color:var(--text-muted);font-size:13px">No monthly data yet. Add finance entries to see the chart.</div>';
    }

    // Transaction list
    const txList = document.getElementById('financeTransactionList');
    if (finances.length === 0) {
      txList.innerHTML = '<div class="empty-state">No transactions yet. Click "Add Transaction" to record one.</div>';
    } else {
      txList.innerHTML = finances.map(f => {
        const isExpense = f.type === 'expense';
        return `
          <div class="transaction-item">
            <div class="transaction-left">
              <div class="transaction-icon" ${isExpense ? 'style="background:var(--error-surface);color:var(--error)"' : ''}>
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  ${isExpense
                    ? '<line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>'
                    : '<polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/>'
                  }
                </svg>
              </div>
              <div>
                <div class="transaction-name">${f.description || f.category || 'Transaction'}</div>
                <div class="transaction-date">${fmtDate(f.date)}</div>
              </div>
            </div>
            <div class="transaction-amount ${isExpense ? 'negative' : ''}">${isExpense ? '-' : '+'}${fmt(f.amount)}</div>
          </div>
        `;
      }).join('');
    }

  } catch (err) {
    console.error('Finances load error:', err);
    showToast('Error loading finances: ' + err.message);
  }
};

// ========== LOAD ANIMA STATS ==========

const loadAnimaStats = async () => {
  try {
    const [freeRes, proRes, totalRes] = await Promise.all([
      sb.from('anima_downloads').select('id', { count: 'exact', head: true }).eq('tier', 'free'),
      sb.from('anima_downloads').select('id', { count: 'exact', head: true }).eq('tier', 'pro'),
      sb.from('anima_downloads').select('id', { count: 'exact', head: true })
    ]);

    const freeCount = freeRes.count || 0;
    const proCount = proRes.count || 0;
    const totalCount = totalRes.count || 0;

    document.getElementById('anima-free-downloads').textContent = freeCount.toLocaleString();
    document.getElementById('anima-free-sub').textContent = 'Free tier';
    document.getElementById('anima-free-sub').className = 'stat-card-change up';

    document.getElementById('anima-pro-downloads').textContent = proCount.toLocaleString();
    const convRate = totalCount > 0 ? ((proCount / totalCount) * 100).toFixed(1) : '0.0';
    document.getElementById('anima-pro-sub').textContent = `${convRate}% of total`;
    document.getElementById('anima-pro-sub').className = 'stat-card-change up';

    document.getElementById('anima-total-downloads').textContent = totalCount.toLocaleString();
    document.getElementById('anima-total-sub').textContent = 'All time';
    document.getElementById('anima-total-sub').className = 'stat-card-change up';

  } catch (err) {
    console.error('ANIMA stats error:', err);
    showToast('Error loading ANIMA stats: ' + err.message);
  }
};

// ========== CRUD: ADD CUSTOMER ==========

const openAddCustomerModal = () => {
  document.getElementById('formAddCustomer').reset();
  openModal('modalAddCustomer');
};

const handleAddCustomer = async (e) => {
  e.preventDefault();
  const form = e.target;
  const btn = document.getElementById('btnAddCustomer');
  btn.textContent = 'Adding...';
  btn.disabled = true;

  try {
    const data = {
      name: form.name.value.trim(),
      email: form.email.value.trim(),
      company: form.company.value.trim() || null,
      phone: form.phone.value.trim() || null,
      plan: form.plan.value,
      source: form.source.value.trim() || null,
      notes: form.notes.value.trim() || null,
      status: 'active',
      total_spent: 0
    };

    const { data: result, error } = await sb.from('customers').insert(data).select().single();
    if (error) throw error;

    await logActivity('customer_created', `New customer: ${data.name} (${data.email})`, 'customer', result.id);

    showToast(`Customer "${data.name}" added successfully`);
    closeModal('modalAddCustomer');
    form.reset();

    // Refresh relevant pages
    loadCustomers();
    loadDashboardData();

  } catch (err) {
    console.error('Add customer error:', err);
    showToast('Error: ' + (err.message || 'Failed to add customer'));
  } finally {
    btn.textContent = 'Add Customer';
    btn.disabled = false;
  }
  return false;
};

// ========== CRUD: DELETE CUSTOMER ==========

const deleteCustomer = async (id, name) => {
  if (!confirm(`Delete customer "${name}"? This cannot be undone.`)) return;

  try {
    const { error } = await sb.from('customers').delete().eq('id', id);
    if (error) throw error;

    await logActivity('customer_deleted', `Deleted customer: ${name}`, 'customer', id);

    showToast(`Customer "${name}" deleted`);
    loadCustomers();
    loadDashboardData();

  } catch (err) {
    console.error('Delete customer error:', err);
    showToast('Error deleting customer: ' + err.message);
  }
};

// ========== CRUD: NEW ORDER ==========

const openNewOrderModal = async () => {
  document.getElementById('formNewOrder').reset();

  // Load customers into the select dropdown
  const select = document.getElementById('orderCustomerSelect');
  select.innerHTML = '<option value="">Loading customers...</option>';

  try {
    const { data, error } = await sb.from('customers').select('id, name, email').order('name');
    if (error) throw error;

    cachedCustomers = data || [];
    select.innerHTML = '<option value="">Select a customer...</option>' +
      cachedCustomers.map(c => `<option value="${c.id}">${c.name} (${c.email})</option>`).join('');

  } catch (err) {
    select.innerHTML = '<option value="">Error loading customers</option>';
    showToast('Error loading customers for order: ' + err.message);
  }

  openModal('modalNewOrder');
};

// Auto-fill amount when product is selected
document.addEventListener('change', (e) => {
  if (e.target.name === 'product' && e.target.closest('#formNewOrder')) {
    const price = productPrices[e.target.value];
    if (price !== undefined && price > 0) {
      e.target.closest('form').amount.value = price;
    }
  }
});

const handleNewOrder = async (e) => {
  e.preventDefault();
  const form = e.target;
  const btn = document.getElementById('btnNewOrder');
  btn.textContent = 'Creating...';
  btn.disabled = true;

  try {
    const productKey = form.product.value;
    const data = {
      customer_id: form.customer_id.value,
      product: productKey,
      product_name: productNames[productKey] || productKey,
      amount: parseFloat(form.amount.value),
      currency: 'USD',
      status: 'pending',
      description: form.description.value.trim() || null
    };

    const { data: result, error } = await sb.from('orders').insert(data).select().single();
    if (error) throw error;

    // Update customer total_spent
    const customer = cachedCustomers.find(c => c.id === data.customer_id);
    if (customer) {
      await sb.from('customers').update({
        total_spent: (Number(customer.total_spent) || 0) + data.amount,
        updated_at: new Date().toISOString()
      }).eq('id', data.customer_id);
    }

    await logActivity('order_created', `New order: ${result.order_number || result.id} - ${data.product_name} (${fmt(data.amount)})`, 'order', result.id);

    showToast(`Order created: ${result.order_number || 'Success'}`);
    closeModal('modalNewOrder');
    form.reset();

    loadOrders();
    loadDashboardData();

  } catch (err) {
    console.error('Create order error:', err);
    showToast('Error: ' + (err.message || 'Failed to create order'));
  } finally {
    btn.textContent = 'Create Order';
    btn.disabled = false;
  }
  return false;
};

// ========== CRUD: UPDATE ORDER STATUS ==========

const updateOrderStatus = async (id, newStatus) => {
  try {
    const { error } = await sb.from('orders').update({
      status: newStatus,
      updated_at: new Date().toISOString()
    }).eq('id', id);

    if (error) throw error;

    await logActivity('order_status_updated', `Order status changed to: ${statusLabel(newStatus)}`, 'order', id);

    showToast(`Order status updated to "${statusLabel(newStatus)}"`);

    // Update the data-status attribute on the row for filtering
    const row = document.querySelector(`tr[data-order-id="${id}"]`);
    if (row) row.setAttribute('data-status', newStatus);

  } catch (err) {
    console.error('Update order status error:', err);
    showToast('Error updating status: ' + err.message);
  }
};

// ========== CRUD: DELETE ORDER ==========

const deleteOrder = async (id, orderNumber) => {
  if (!confirm(`Delete order "${orderNumber}"? This cannot be undone.`)) return;

  try {
    const { error } = await sb.from('orders').delete().eq('id', id);
    if (error) throw error;

    await logActivity('order_deleted', `Deleted order: ${orderNumber}`, 'order', id);

    showToast(`Order "${orderNumber}" deleted`);
    loadOrders();
    loadDashboardData();

  } catch (err) {
    console.error('Delete order error:', err);
    showToast('Error deleting order: ' + err.message);
  }
};

// ========== CRUD: ADD FINANCE ENTRY ==========

const openAddTransactionModal = () => {
  const form = document.getElementById('formAddTransaction');
  form.reset();
  // Set default date to today
  form.date.value = new Date().toISOString().split('T')[0];
  openModal('modalAddTransaction');
};

const handleAddTransaction = async (e) => {
  e.preventDefault();
  const form = e.target;
  const btn = document.getElementById('btnAddTransaction');
  btn.textContent = 'Adding...';
  btn.disabled = true;

  try {
    const data = {
      type: form.type.value,
      category: form.category.value.trim(),
      amount: parseFloat(form.amount.value),
      currency: 'USD',
      description: form.description.value.trim() || null,
      date: form.date.value,
      tax_relevant: form.tax_relevant.value === 'true'
    };

    const { data: result, error } = await sb.from('finances').insert(data).select().single();
    if (error) throw error;

    await logActivity('finance_entry_created', `${data.type}: ${data.category} - ${fmt(data.amount)}`, 'finance', result.id);

    showToast(`${data.type === 'income' ? 'Income' : 'Expense'} entry added: ${fmt(data.amount)}`);
    closeModal('modalAddTransaction');
    form.reset();

    loadFinances();

  } catch (err) {
    console.error('Add transaction error:', err);
    showToast('Error: ' + (err.message || 'Failed to add transaction'));
  } finally {
    btn.textContent = 'Add Transaction';
    btn.disabled = false;
  }
  return false;
};

// ========== MODALS ==========

const openModal = (id) => {
  document.getElementById(id).classList.add('active');
};

const closeModal = (id) => {
  document.getElementById(id).classList.remove('active');
};

// Close modals on Escape
document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape') {
    document.querySelectorAll('.modal-overlay.active').forEach(m => m.classList.remove('active'));
  }
});

// ========== NAVIGATION ==========

const pageTitles = {
  dashboard: 'Dashboard',
  kunden: 'Kunden',
  orders: 'Orders',
  finanzen: 'Finanzen',
  tools: 'Tools',
  blog: 'Blog',
  emails: 'E-Mails',
  training: 'Training',
  anima: 'ANIMA',
  settings: 'Settings'
};

// Track which pages have been loaded to avoid redundant fetches
const pageLoaded = {};

const navigateTo = (page) => {
  // Update page visibility
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  const target = document.getElementById('page-' + page);
  if (target) target.classList.add('active');

  // Update sidebar active state
  document.querySelectorAll('.sidebar-link').forEach(l => l.classList.remove('active'));
  const activeLink = document.querySelector('.sidebar-link[data-page="' + page + '"]');
  if (activeLink) activeLink.classList.add('active');

  // Update topbar title
  document.getElementById('pageTitle').textContent = pageTitles[page] || page;

  // Close mobile sidebar
  closeSidebar();

  // Update URL hash
  history.replaceState(null, '', '#' + page);

  // Load data for the page (always refresh on navigate)
  switch (page) {
    case 'dashboard': loadDashboardData(); break;
    case 'kunden': loadCustomers(); break;
    case 'orders': loadOrders(); break;
    case 'finanzen': loadFinances(); break;
    case 'anima': loadAnimaStats(); break;
  }
};

// ========== SIDEBAR (Mobile) ==========

const toggleSidebar = () => {
  document.getElementById('sidebar').classList.toggle('open');
  document.getElementById('sidebarOverlay').classList.toggle('active');
};

const closeSidebar = () => {
  document.getElementById('sidebar').classList.remove('open');
  document.getElementById('sidebarOverlay').classList.remove('active');
};

// ========== FILTERS ==========

const filterOrders = () => {
  const filter = document.getElementById('orderFilter').value;
  const rows = document.querySelectorAll('#orderTable tbody tr');
  rows.forEach(row => {
    if (filter === 'all') {
      row.style.display = '';
    } else {
      const status = row.getAttribute('data-status');
      // Map filter values to status values
      const filterMap = { progress: 'in_progress', preview: 'preview_sent' };
      const mappedFilter = filterMap[filter] || filter;
      row.style.display = status === mappedFilter ? '' : 'none';
    }
  });
};

const filterCustomers = () => {
  const query = document.getElementById('customerSearch').value.toLowerCase();
  const rows = document.querySelectorAll('#customerTable tbody tr');
  rows.forEach(row => {
    const text = row.textContent.toLowerCase();
    row.style.display = text.indexOf(query) !== -1 ? '' : 'none';
  });
};

// ========== TOAST ==========

let toastTimer;
const showToast = (msg) => {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => t.classList.remove('show'), 3000);
};

// ========== INIT ==========

(() => {
  checkAuth();

  // Handle hash navigation on load
  const hash = window.location.hash.replace('#', '');
  if (hash && pageTitles[hash]) {
    navigateTo(hash);
  }

  // Listen for hash changes
  window.addEventListener('hashchange', () => {
    const h = window.location.hash.replace('#', '');
    if (h && pageTitles[h]) {
      navigateTo(h);
    }
  });

  // Keyboard shortcut: Cmd/Ctrl + K to focus search
  document.addEventListener('keydown', (e) => {
    if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
      e.preventDefault();
      const searchInput = document.querySelector('.topbar-search input');
      if (searchInput) searchInput.focus();
    }
    // Escape to close sidebar on mobile
    if (e.key === 'Escape') {
      closeSidebar();
    }
  });
})();
</script>
</body>
</html>
